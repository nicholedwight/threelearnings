{
    "asset": {
        "profile": {
            "api": "WebGL",
            "version": "1.0.3"
        },
        "version": "1.0"
    },
    "extras": {
        "lights": {}
    },
    "materials": {
        "Material": {
            "technique": "MaterialTechnique",
            "values": {}
        },
        "Material.002": {
            "technique": "Material.002Technique",
            "values": {}
        }
    },
    "nodes": {
        "Teapot": {
            "children": [],
            "matrix": [1,0,0,0,0,1,0,0,0,0,1,0,0.037633,-0.09082,-0.224854,1],
            "meshes": ["Mesh"],
            "name": "Teapot"
        }
    },
    "programs": {
        "Material.002Program": {
            "attributes": ["bl_Vertex","bl_Normal"],
            "fragmentShader": "Material.002FS",
            "vertexShader": "Material.002VS"
        },
        "MaterialProgram": {
            "attributes": ["bl_Vertex","bl_Normal"],
            "fragmentShader": "MaterialFS",
            "vertexShader": "MaterialVS"
        }
    },
    "samplers": {
        "default": {}
    },
    "scene": "Scene",
    "scenes": {
        "Scene": {
            "extras": {
                "active_camera": "",
                "background_color": [0.050876,0.050876,0.050876],
                "frames_per_second": 24
            },
            "nodes": ["Teapot"]
        }
    },
    "shaders": {
        "Material.002FS": {
            "type": 35632,
            "uri": "data:text/plain;base64,I3ZlcnNpb24gMTAwCiNleHRlbnNpb24gR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzOiBlbmFibGUKCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1hdDQgYmxfUHJvamVjdGlvbk1hdHJpeDsKdW5pZm9ybSBtYXQ0IGJsX01vZGVsVmlld01hdHJpeDsKdW5pZm9ybSBtYXQ0IGJsX01vZGVsVmlld01hdHJpeEludmVyc2U7CnVuaWZvcm0gbWF0MyBibF9Ob3JtYWxNYXRyaXg7CnVuaWZvcm0gbWF0NCBibF9Qcm9qZWN0aW9uTWF0cml4SW52ZXJzZTsKLyogQ29udmVydGVycyAqLw0KDQpmbG9hdCBjb252ZXJ0X3JnYmFfdG9fZmxvYXQodmVjNCBjb2xvcikNCnsNCiNpZmRlZiBVU0VfTkVXX1NIQURJTkcNCglyZXR1cm4gY29sb3IuciAqIDAuMjEyNiArIGNvbG9yLmcgKiAwLjcxNTIgKyBjb2xvci5iICogMC4wNzIyOw0KI2Vsc2UNCglyZXR1cm4gKGNvbG9yLnIgKyBjb2xvci5nICsgY29sb3IuYikgLyAzLjA7DQojZW5kaWYNCn0NCg0KZmxvYXQgZXhwX2JsZW5kZXIoZmxvYXQgZikNCnsNCglyZXR1cm4gcG93KDIuNzE4MjgxODI4NDYsIGYpOw0KfQ0KDQpmbG9hdCBjb21wYXRpYmxlX3BvdyhmbG9hdCB4LCBmbG9hdCB5KQ0Kew0KCWlmICh5ID09IDAuMCkgLyogeF4wIC0+IDEsIGluY2x1ZGluZyAwXjAgKi8NCgkJcmV0dXJuIDEuMDsNCg0KCS8qIGdsc2wgcG93IGRvZXNuJ3QgYWNjZXB0IG5lZ2F0aXZlIHggKi8NCglpZiAoeCA8IDAuMCkgew0KCQlpZiAobW9kKC15LCAyLjApID09IDAuMCkNCgkJCXJldHVybiBwb3coLXgsIHkpOw0KCQllbHNlDQoJCQlyZXR1cm4gLXBvdygteCwgeSk7DQoJfQ0KCWVsc2UgaWYgKHggPT0gMC4wKQ0KCQlyZXR1cm4gMC4wOw0KDQoJcmV0dXJuIHBvdyh4LCB5KTsNCn0NCg0Kdm9pZCByZ2JfdG9faHN2KHZlYzQgcmdiLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmxvYXQgY21heCwgY21pbiwgaCwgcywgdiwgY2RlbHRhOw0KCXZlYzMgYzsNCg0KCWNtYXggPSBtYXgocmdiWzBdLCBtYXgocmdiWzFdLCByZ2JbMl0pKTsNCgljbWluID0gbWluKHJnYlswXSwgbWluKHJnYlsxXSwgcmdiWzJdKSk7DQoJY2RlbHRhID0gY21heCAtIGNtaW47DQoNCgl2ID0gY21heDsNCglpZiAoY21heCAhPSAwLjApDQoJCXMgPSBjZGVsdGEgLyBjbWF4Ow0KCWVsc2Ugew0KCQlzID0gMC4wOw0KCQloID0gMC4wOw0KCX0NCg0KCWlmIChzID09IDAuMCkgew0KCQloID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJYyA9ICh2ZWMzKGNtYXgsIGNtYXgsIGNtYXgpIC0gcmdiLnh5eikgLyBjZGVsdGE7DQoNCgkJaWYgKHJnYi54ID09IGNtYXgpIGggPSBjWzJdIC0gY1sxXTsNCgkJZWxzZSBpZiAocmdiLnkgPT0gY21heCkgaCA9IDIuMCArIGNbMF0gLSAgY1syXTsNCgkJZWxzZSBoID0gNC4wICsgY1sxXSAtIGNbMF07DQoNCgkJaCAvPSA2LjA7DQoNCgkJaWYgKGggPCAwLjApDQoJCQloICs9IDEuMDsNCgl9DQoNCglvdXRjb2wgPSB2ZWM0KGgsIHMsIHYsIHJnYi53KTsNCn0NCg0Kdm9pZCBoc3ZfdG9fcmdiKHZlYzQgaHN2LCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmxvYXQgaSwgZiwgcCwgcSwgdCwgaCwgcywgdjsNCgl2ZWMzIHJnYjsNCg0KCWggPSBoc3ZbMF07DQoJcyA9IGhzdlsxXTsNCgl2ID0gaHN2WzJdOw0KDQoJaWYgKHMgPT0gMC4wKSB7DQoJCXJnYiA9IHZlYzModiwgdiwgdik7DQoJfQ0KCWVsc2Ugew0KCQlpZiAoaCA9PSAxLjApDQoJCQloID0gMC4wOw0KDQoJCWggKj0gNi4wOw0KCQlpID0gZmxvb3IoaCk7DQoJCWYgPSBoIC0gaTsNCgkJcmdiID0gdmVjMyhmLCBmLCBmKTsNCgkJcCA9IHYgKiAoMS4wIC0gcyk7DQoJCXEgPSB2ICogKDEuMCAtIChzICogZikpOw0KCQl0ID0gdiAqICgxLjAgLSAocyAqICgxLjAgLSBmKSkpOw0KDQoJCWlmIChpID09IDAuMCkgcmdiID0gdmVjMyh2LCB0LCBwKTsNCgkJZWxzZSBpZiAoaSA9PSAxLjApIHJnYiA9IHZlYzMocSwgdiwgcCk7DQoJCWVsc2UgaWYgKGkgPT0gMi4wKSByZ2IgPSB2ZWMzKHAsIHYsIHQpOw0KCQllbHNlIGlmIChpID09IDMuMCkgcmdiID0gdmVjMyhwLCBxLCB2KTsNCgkJZWxzZSBpZiAoaSA9PSA0LjApIHJnYiA9IHZlYzModCwgcCwgdik7DQoJCWVsc2UgcmdiID0gdmVjMyh2LCBwLCBxKTsNCgl9DQoNCglvdXRjb2wgPSB2ZWM0KHJnYiwgaHN2LncpOw0KfQ0KDQpmbG9hdCBzcmdiX3RvX2xpbmVhcnJnYihmbG9hdCBjKQ0Kew0KCWlmIChjIDwgMC4wNDA0NSkNCgkJcmV0dXJuIChjIDwgMC4wKSA/IDAuMCA6IGMgKiAoMS4wIC8gMTIuOTIpOw0KCWVsc2UNCgkJcmV0dXJuIHBvdygoYyArIDAuMDU1KSAqICgxLjAgLyAxLjA1NSksIDIuNCk7DQp9DQoNCmZsb2F0IGxpbmVhcnJnYl90b19zcmdiKGZsb2F0IGMpDQp7DQoJaWYgKGMgPCAwLjAwMzEzMDgpDQoJCXJldHVybiAoYyA8IDAuMCkgPyAwLjAgOiBjICogMTIuOTI7DQoJZWxzZQ0KCQlyZXR1cm4gMS4wNTUgKiBwb3coYywgMS4wIC8gMi40KSAtIDAuMDU1Ow0KfQ0KDQp2b2lkIHNyZ2JfdG9fbGluZWFycmdiKHZlYzQgY29sX2Zyb20sIG91dCB2ZWM0IGNvbF90bykNCnsNCgljb2xfdG8uciA9IHNyZ2JfdG9fbGluZWFycmdiKGNvbF9mcm9tLnIpOw0KCWNvbF90by5nID0gc3JnYl90b19saW5lYXJyZ2IoY29sX2Zyb20uZyk7DQoJY29sX3RvLmIgPSBzcmdiX3RvX2xpbmVhcnJnYihjb2xfZnJvbS5iKTsNCgljb2xfdG8uYSA9IGNvbF9mcm9tLmE7DQp9DQoNCnZvaWQgbGluZWFycmdiX3RvX3NyZ2IodmVjNCBjb2xfZnJvbSwgb3V0IHZlYzQgY29sX3RvKQ0Kew0KCWNvbF90by5yID0gbGluZWFycmdiX3RvX3NyZ2IoY29sX2Zyb20ucik7DQoJY29sX3RvLmcgPSBsaW5lYXJyZ2JfdG9fc3JnYihjb2xfZnJvbS5nKTsNCgljb2xfdG8uYiA9IGxpbmVhcnJnYl90b19zcmdiKGNvbF9mcm9tLmIpOw0KCWNvbF90by5hID0gY29sX2Zyb20uYTsNCn0NCg0Kdm9pZCBjb2xvcl90b19ub3JtYWwodmVjMyBjb2xvciwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCW5vcm1hbC54ID0gIDIuMCAqICgoY29sb3IucikgLSAwLjUpOw0KCW5vcm1hbC55ID0gLTIuMCAqICgoY29sb3IuZykgLSAwLjUpOw0KCW5vcm1hbC56ID0gIDIuMCAqICgoY29sb3IuYikgLSAwLjUpOw0KfQ0KDQp2b2lkIGNvbG9yX3RvX25vcm1hbF9uZXdfc2hhZGluZyh2ZWMzIGNvbG9yLCBvdXQgdmVjMyBub3JtYWwpDQp7DQoJbm9ybWFsLnggPSAgMi4wICogKChjb2xvci5yKSAtIDAuNSk7DQoJbm9ybWFsLnkgPSAgMi4wICogKChjb2xvci5nKSAtIDAuNSk7DQoJbm9ybWFsLnogPSAgMi4wICogKChjb2xvci5iKSAtIDAuNSk7DQp9DQoNCnZvaWQgY29sb3JfdG9fYmxlbmRlcl9ub3JtYWxfbmV3X3NoYWRpbmcodmVjMyBjb2xvciwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCW5vcm1hbC54ID0gIDIuMCAqICgoY29sb3IucikgLSAwLjUpOw0KCW5vcm1hbC55ID0gLTIuMCAqICgoY29sb3IuZykgLSAwLjUpOw0KCW5vcm1hbC56ID0gLTIuMCAqICgoY29sb3IuYikgLSAwLjUpOw0KfQ0KDQojZGVmaW5lIE1fUEkgMy4xNDE1OTI2NTM1ODk3OTMyMzg0Ng0KI2RlZmluZSBNXzFfUEkgMC4zMTgzMDk4ODYxODM3OTA2OQ0KDQovKioqKioqKioqKiogU0hBREVSIE5PREVTICoqKioqKioqKioqKioqKi8NCg0Kdm9pZCB2Y29sX2F0dHJpYnV0ZSh2ZWM0IGF0dHZjb2wsIG91dCB2ZWM0IHZjb2wpDQp7DQoJdmNvbCA9IHZlYzQoYXR0dmNvbC54LCBhdHR2Y29sLnksIGF0dHZjb2wueiwgMS4wKTsNCn0NCg0Kdm9pZCB1dl9hdHRyaWJ1dGUodmVjMiBhdHR1diwgb3V0IHZlYzMgdXYpDQp7DQoJdXYgPSB2ZWMzKGF0dHV2ICogMi4wIC0gdmVjMigxLjAsIDEuMCksIDAuMCk7DQp9DQoNCnZvaWQgZ2VvbSgNCiAgICAgICAgdmVjMyBjbywgdmVjMyBub3IsIG1hdDQgdmlld2ludm1hdCwgdmVjMyBhdHRvcmNvLCB2ZWMyIGF0dHV2LCB2ZWM0IGF0dHZjb2wsDQogICAgICAgIG91dCB2ZWMzIGdsb2JhbCwgb3V0IHZlYzMgbG9jYWwsIG91dCB2ZWMzIHZpZXcsIG91dCB2ZWMzIG9yY28sIG91dCB2ZWMzIHV2LA0KICAgICAgICBvdXQgdmVjMyBub3JtYWwsIG91dCB2ZWM0IHZjb2wsIG91dCBmbG9hdCB2Y29sX2FscGhhLCBvdXQgZmxvYXQgZnJvbnRiYWNrKQ0Kew0KCWxvY2FsID0gY287DQoJdmlldyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPyBub3JtYWxpemUobG9jYWwpIDogdmVjMygwLjAsIDAuMCwgLTEuMCk7DQoJZ2xvYmFsID0gKHZpZXdpbnZtYXQgKiB2ZWM0KGxvY2FsLCAxLjApKS54eXo7DQoJb3JjbyA9IGF0dG9yY287DQoJdXZfYXR0cmlidXRlKGF0dHV2LCB1dik7DQoJbm9ybWFsID0gLW5vcm1hbGl6ZShub3IpOyAgIC8qIGJsZW5kZXIgcmVuZGVyIG5vcm1hbCBpcyBuZWdhdGVkICovDQoJdmNvbF9hdHRyaWJ1dGUoYXR0dmNvbCwgdmNvbCk7DQoJc3JnYl90b19saW5lYXJyZ2IodmNvbCwgdmNvbCk7DQoJdmNvbF9hbHBoYSA9IGF0dHZjb2wuYTsNCglmcm9udGJhY2sgPSAoZ2xfRnJvbnRGYWNpbmcpID8gMS4wIDogMC4wOw0KfQ0KDQp2b2lkIHBhcnRpY2xlX2luZm8oDQogICAgICAgIHZlYzQgc3Byb3BzLCB2ZWMzIGxvYywgdmVjMyB2ZWwsIHZlYzMgYXZlbCwNCiAgICAgICAgb3V0IGZsb2F0IGluZGV4LCBvdXQgZmxvYXQgYWdlLCBvdXQgZmxvYXQgbGlmZV90aW1lLCBvdXQgdmVjMyBsb2NhdGlvbiwNCiAgICAgICAgb3V0IGZsb2F0IHNpemUsIG91dCB2ZWMzIHZlbG9jaXR5LCBvdXQgdmVjMyBhbmd1bGFyX3ZlbG9jaXR5KQ0Kew0KCWluZGV4ID0gc3Byb3BzLng7DQoJYWdlID0gc3Byb3BzLnk7DQoJbGlmZV90aW1lID0gc3Byb3BzLno7DQoJc2l6ZSA9IHNwcm9wcy53Ow0KDQoJbG9jYXRpb24gPSBsb2M7DQoJdmVsb2NpdHkgPSB2ZWw7DQoJYW5ndWxhcl92ZWxvY2l0eSA9IGF2ZWw7DQp9DQoNCnZvaWQgdmVjdF9ub3JtYWxpemUodmVjMyB2aW4sIG91dCB2ZWMzIHZvdXQpDQp7DQoJdm91dCA9IG5vcm1hbGl6ZSh2aW4pOw0KfQ0KDQp2b2lkIGRpcmVjdGlvbl90cmFuc2Zvcm1fbTR2Myh2ZWMzIHZpbiwgbWF0NCBtYXQsIG91dCB2ZWMzIHZvdXQpDQp7DQoJdm91dCA9IChtYXQgKiB2ZWM0KHZpbiwgMC4wKSkueHl6Ow0KfQ0KDQp2b2lkIHBvaW50X3RyYW5zZm9ybV9tNHYzKHZlYzMgdmluLCBtYXQ0IG1hdCwgb3V0IHZlYzMgdm91dCkNCnsNCgl2b3V0ID0gKG1hdCAqIHZlYzQodmluLCAxLjApKS54eXo7DQp9DQoNCnZvaWQgcG9pbnRfdGV4Y29fcmVtYXBfc3F1YXJlKHZlYzMgdmluLCBvdXQgdmVjMyB2b3V0KQ0Kew0KCXZvdXQgPSB2ZWMzKHZpbiAtIHZlYzMoMC41LCAwLjUsIDAuNSkpICogMi4wOw0KfQ0KDQp2b2lkIHBvaW50X21hcF90b19zcGhlcmUodmVjMyB2aW4sIG91dCB2ZWMzIHZvdXQpDQp7DQoJZmxvYXQgbGVuID0gbGVuZ3RoKHZpbik7DQoJZmxvYXQgdiwgdTsNCglpZiAobGVuID4gMC4wKSB7DQoJCWlmICh2aW4ueCA9PSAwLjAgJiYgdmluLnkgPT0gMC4wKQ0KCQkJdSA9IDAuMDsNCgkJZWxzZQ0KCQkJdSA9ICgxLjAgLSBhdGFuKHZpbi54LCB2aW4ueSkgLyBNX1BJKSAvIDIuMDsNCg0KCQl2ID0gMS4wIC0gYWNvcyh2aW4ueiAvIGxlbikgLyBNX1BJOw0KCX0NCgllbHNlDQoJCXYgPSB1ID0gMC4wOw0KDQoJdm91dCA9IHZlYzModSwgdiwgMC4wKTsNCn0NCg0Kdm9pZCBwb2ludF9tYXBfdG9fdHViZSh2ZWMzIHZpbiwgb3V0IHZlYzMgdm91dCkNCnsNCglmbG9hdCB1LCB2Ow0KCXYgPSAodmluLnogKyAxLjApICogMC41Ow0KCWZsb2F0IGxlbiA9IHNxcnQodmluLnggKiB2aW4ueCArIHZpbi55ICogdmluWzFdKTsNCglpZiAobGVuID4gMC4wKQ0KCQl1ID0gKDEuMCAtIChhdGFuKHZpbi54IC8gbGVuLCB2aW4ueSAvIGxlbikgLyBNX1BJKSkgKiAwLjU7DQoJZWxzZQ0KCQl2ID0gdSA9IDAuMDsNCg0KCXZvdXQgPSB2ZWMzKHUsIHYsIDAuMCk7DQp9DQoNCnZvaWQgbWFwcGluZyh2ZWMzIHZlYywgbWF0NCBtYXQsIHZlYzMgbWludmVjLCB2ZWMzIG1heHZlYywgZmxvYXQgZG9taW4sIGZsb2F0IGRvbWF4LCBvdXQgdmVjMyBvdXR2ZWMpDQp7DQoJb3V0dmVjID0gKG1hdCAqIHZlYzQodmVjLCAxLjApKS54eXo7DQoJaWYgKGRvbWluID09IDEuMCkNCgkJb3V0dmVjID0gbWF4KG91dHZlYywgbWludmVjKTsNCglpZiAoZG9tYXggPT0gMS4wKQ0KCQlvdXR2ZWMgPSBtaW4ob3V0dmVjLCBtYXh2ZWMpOw0KfQ0KDQp2b2lkIGNhbWVyYSh2ZWMzIGNvLCBvdXQgdmVjMyBvdXR2aWV3LCBvdXQgZmxvYXQgb3V0ZGVwdGgsIG91dCBmbG9hdCBvdXRkaXN0KQ0Kew0KCW91dGRlcHRoID0gYWJzKGNvLnopOw0KCW91dGRpc3QgPSBsZW5ndGgoY28pOw0KCW91dHZpZXcgPSBub3JtYWxpemUoY28pOw0KfQ0KDQp2b2lkIGxhbXAoDQogICAgICAgIHZlYzQgY29sLCBmbG9hdCBlbmVyZ3ksIHZlYzMgbHYsIGZsb2F0IGRpc3QsIHZlYzMgc2hhZG93LCBmbG9hdCB2aXNpZmFjLA0KICAgICAgICBvdXQgdmVjNCBvdXRjb2wsIG91dCB2ZWMzIG91dGx2LCBvdXQgZmxvYXQgb3V0ZGlzdCwgb3V0IHZlYzQgb3V0c2hhZG93LCBvdXQgZmxvYXQgb3V0dmlzaWZhYykNCnsNCglvdXRjb2wgPSBjb2wgKiBlbmVyZ3k7DQoJb3V0bHYgPSBsdjsNCglvdXRkaXN0ID0gZGlzdDsNCglvdXRzaGFkb3cgPSB2ZWM0KHNoYWRvdywgMS4wKTsNCglvdXR2aXNpZmFjID0gdmlzaWZhYzsNCn0NCg0Kdm9pZCBtYXRoX2FkZChmbG9hdCB2YWwxLCBmbG9hdCB2YWwyLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IHZhbDEgKyB2YWwyOw0KfQ0KDQp2b2lkIG1hdGhfc3VidHJhY3QoZmxvYXQgdmFsMSwgZmxvYXQgdmFsMiwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSB2YWwxIC0gdmFsMjsNCn0NCg0Kdm9pZCBtYXRoX211bHRpcGx5KGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmFsMSAqIHZhbDI7DQp9DQoNCnZvaWQgbWF0aF9kaXZpZGUoZmxvYXQgdmFsMSwgZmxvYXQgdmFsMiwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglpZiAodmFsMiA9PSAwLjApDQoJCW91dHZhbCA9IDAuMDsNCgllbHNlDQoJCW91dHZhbCA9IHZhbDEgLyB2YWwyOw0KfQ0KDQp2b2lkIG1hdGhfc2luZShmbG9hdCB2YWwsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gc2luKHZhbCk7DQp9DQoNCnZvaWQgbWF0aF9jb3NpbmUoZmxvYXQgdmFsLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IGNvcyh2YWwpOw0KfQ0KDQp2b2lkIG1hdGhfdGFuZ2VudChmbG9hdCB2YWwsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdGFuKHZhbCk7DQp9DQoNCnZvaWQgbWF0aF9hc2luKGZsb2F0IHZhbCwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglpZiAodmFsIDw9IDEuMCAmJiB2YWwgPj0gLTEuMCkNCgkJb3V0dmFsID0gYXNpbih2YWwpOw0KCWVsc2UNCgkJb3V0dmFsID0gMC4wOw0KfQ0KDQp2b2lkIG1hdGhfYWNvcyhmbG9hdCB2YWwsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJaWYgKHZhbCA8PSAxLjAgJiYgdmFsID49IC0xLjApDQoJCW91dHZhbCA9IGFjb3ModmFsKTsNCgllbHNlDQoJCW91dHZhbCA9IDAuMDsNCn0NCg0Kdm9pZCBtYXRoX2F0YW4oZmxvYXQgdmFsLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IGF0YW4odmFsKTsNCn0NCg0Kdm9pZCBtYXRoX3BvdyhmbG9hdCB2YWwxLCBmbG9hdCB2YWwyLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCWlmICh2YWwxID49IDAuMCkgew0KCQlvdXR2YWwgPSBjb21wYXRpYmxlX3Bvdyh2YWwxLCB2YWwyKTsNCgl9DQoJZWxzZSB7DQoJCWZsb2F0IHZhbDJfbW9kXzEgPSBtb2QoYWJzKHZhbDIpLCAxLjApOw0KDQoJCWlmICh2YWwyX21vZF8xID4gMC45OTkgfHwgdmFsMl9tb2RfMSA8IDAuMDAxKQ0KCQkJb3V0dmFsID0gY29tcGF0aWJsZV9wb3codmFsMSwgZmxvb3IodmFsMiArIDAuNSkpOw0KCQllbHNlDQoJCQlvdXR2YWwgPSAwLjA7DQoJfQ0KfQ0KDQp2b2lkIG1hdGhfbG9nKGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJaWYgKHZhbDEgPiAwLjAgICYmIHZhbDIgPiAwLjApDQoJCW91dHZhbCA9IGxvZzIodmFsMSkgLyBsb2cyKHZhbDIpOw0KCWVsc2UNCgkJb3V0dmFsID0gMC4wOw0KfQ0KDQp2b2lkIG1hdGhfbWF4KGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gbWF4KHZhbDEsIHZhbDIpOw0KfQ0KDQp2b2lkIG1hdGhfbWluKGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gbWluKHZhbDEsIHZhbDIpOw0KfQ0KDQp2b2lkIG1hdGhfcm91bmQoZmxvYXQgdmFsLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IGZsb29yKHZhbCArIDAuNSk7DQp9DQoNCnZvaWQgbWF0aF9sZXNzX3RoYW4oZmxvYXQgdmFsMSwgZmxvYXQgdmFsMiwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglpZiAodmFsMSA8IHZhbDIpDQoJCW91dHZhbCA9IDEuMDsNCgllbHNlDQoJCW91dHZhbCA9IDAuMDsNCn0NCg0Kdm9pZCBtYXRoX2dyZWF0ZXJfdGhhbihmbG9hdCB2YWwxLCBmbG9hdCB2YWwyLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCWlmICh2YWwxID4gdmFsMikNCgkJb3V0dmFsID0gMS4wOw0KCWVsc2UNCgkJb3V0dmFsID0gMC4wOw0KfQ0KDQp2b2lkIG1hdGhfbW9kdWxvKGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJaWYgKHZhbDIgPT0gMC4wKQ0KCQlvdXR2YWwgPSAwLjA7DQoJZWxzZQ0KCQlvdXR2YWwgPSBtb2QodmFsMSwgdmFsMik7DQoNCgkvKiBjaGFuZ2Ugc2lnbiB0byBtYXRjaCBDIGNvbnZlbnRpb24sIG1vZCB2YXJ5aW5nIEdMU0wgd2lsbCB0YWtlIGFic29sdXRlIGZvciBuZWdhdGl2ZSBudW1iZXJzLA0KCSAqIHNlZSBodHRwczovL3d3dy5vcGVuZ2wub3JnL3Nkay9kb2NzL21hbi9odG1sL21vZC54aHRtbCAqLw0KCW91dHZhbCA9ICh2YWwxID4gMC4wKSA/IG91dHZhbCA6IC1vdXR2YWw7DQp9DQoNCnZvaWQgbWF0aF9hYnMoZmxvYXQgdmFsMSwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSBhYnModmFsMSk7DQp9DQoNCnZvaWQgc3F1ZWV6ZShmbG9hdCB2YWwsIGZsb2F0IHdpZHRoLCBmbG9hdCBjZW50ZXIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gMS4wIC8gKDEuMCArIHBvdygyLjcxODI4MTgzLCAtKCh2YWwgLSBjZW50ZXIpICogd2lkdGgpKSk7DQp9DQoNCnZvaWQgdmVjX21hdGhfYWRkKHZlYzMgdjEsIHZlYzMgdjIsIG91dCB2ZWMzIG91dHZlYywgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2ZWMgPSB2MSArIHYyOw0KCW91dHZhbCA9IChhYnMob3V0dmVjWzBdKSArIGFicyhvdXR2ZWNbMV0pICsgYWJzKG91dHZlY1syXSkpIC8gMy4wOw0KfQ0KDQp2b2lkIHZlY19tYXRoX3N1Yih2ZWMzIHYxLCB2ZWMzIHYyLCBvdXQgdmVjMyBvdXR2ZWMsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmVjID0gdjEgLSB2MjsNCglvdXR2YWwgPSAoYWJzKG91dHZlY1swXSkgKyBhYnMob3V0dmVjWzFdKSArIGFicyhvdXR2ZWNbMl0pKSAvIDMuMDsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9hdmVyYWdlKHZlYzMgdjEsIHZlYzMgdjIsIG91dCB2ZWMzIG91dHZlYywgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2ZWMgPSB2MSArIHYyOw0KCW91dHZhbCA9IGxlbmd0aChvdXR2ZWMpOw0KCW91dHZlYyA9IG5vcm1hbGl6ZShvdXR2ZWMpOw0KfQ0Kdm9pZCB2ZWNfbWF0aF9taXgoZmxvYXQgc3RyZW5ndGgsIHZlYzMgdjEsIHZlYzMgdjIsIG91dCB2ZWMzIG91dHZlYykNCnsNCglvdXR2ZWMgPSBzdHJlbmd0aCAqIHYxICsgKDEgLSBzdHJlbmd0aCkgKiB2MjsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9kb3QodmVjMyB2MSwgdmVjMyB2Miwgb3V0IHZlYzMgb3V0dmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZlYyA9IHZlYzMoMCwgMCwgMCk7DQoJb3V0dmFsID0gZG90KHYxLCB2Mik7DQp9DQoNCnZvaWQgdmVjX21hdGhfY3Jvc3ModmVjMyB2MSwgdmVjMyB2Miwgb3V0IHZlYzMgb3V0dmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZlYyA9IGNyb3NzKHYxLCB2Mik7DQoJb3V0dmFsID0gbGVuZ3RoKG91dHZlYyk7DQoJb3V0dmVjIC89IG91dHZhbDsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9ub3JtYWxpemUodmVjMyB2LCBvdXQgdmVjMyBvdXR2ZWMsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gbGVuZ3RoKHYpOw0KCW91dHZlYyA9IG5vcm1hbGl6ZSh2KTsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9uZWdhdGUodmVjMyB2LCBvdXQgdmVjMyBvdXR2KQ0Kew0KCW91dHYgPSAtdjsNCn0NCg0Kdm9pZCBpbnZlcnRfeih2ZWMzIHYsIG91dCB2ZWMzIG91dHYpDQp7DQoJdi56ID0gLXYuejsNCglvdXR2ID0gdjsNCn0NCg0Kdm9pZCBub3JtYWwodmVjMyBkaXIsIHZlYzMgbm9yLCBvdXQgdmVjMyBvdXRub3IsIG91dCBmbG9hdCBvdXRkb3QpDQp7DQoJb3V0bm9yID0gbm9yOw0KCW91dGRvdCA9IC1kb3QoZGlyLCBub3IpOw0KfQ0KDQp2b2lkIG5vcm1hbF9uZXdfc2hhZGluZyh2ZWMzIGRpciwgdmVjMyBub3IsIG91dCB2ZWMzIG91dG5vciwgb3V0IGZsb2F0IG91dGRvdCkNCnsNCglvdXRub3IgPSBub3JtYWxpemUobm9yKTsNCglvdXRkb3QgPSBkb3Qobm9ybWFsaXplKGRpciksIG5vcik7DQp9DQoNCnZvaWQgY3VydmVzX3ZlYyhmbG9hdCBmYWMsIHZlYzMgdmVjLCBzYW1wbGVyMkQgY3VydmVtYXAsIG91dCB2ZWMzIG91dHZlYykNCnsNCglvdXR2ZWMueCA9IHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMigodmVjLnggKyAxLjApICogMC41LCAwLjApKS54Ow0KCW91dHZlYy55ID0gdGV4dHVyZTJEKGN1cnZlbWFwLCB2ZWMyKCh2ZWMueSArIDEuMCkgKiAwLjUsIDAuMCkpLnk7DQoJb3V0dmVjLnogPSB0ZXh0dXJlMkQoY3VydmVtYXAsIHZlYzIoKHZlYy56ICsgMS4wKSAqIDAuNSwgMC4wKSkuejsNCg0KCWlmIChmYWMgIT0gMS4wKQ0KCQlvdXR2ZWMgPSAob3V0dmVjICogZmFjKSArICh2ZWMgKiAoMS4wIC0gZmFjKSk7DQoNCn0NCg0Kdm9pZCBjdXJ2ZXNfcmdiKGZsb2F0IGZhYywgdmVjNCBjb2wsIHNhbXBsZXIyRCBjdXJ2ZW1hcCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbC5yID0gdGV4dHVyZTJEKGN1cnZlbWFwLCB2ZWMyKHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMihjb2wuciwgMC4wKSkuYSwgMC4wKSkucjsNCglvdXRjb2wuZyA9IHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMih0ZXh0dXJlMkQoY3VydmVtYXAsIHZlYzIoY29sLmcsIDAuMCkpLmEsIDAuMCkpLmc7DQoJb3V0Y29sLmIgPSB0ZXh0dXJlMkQoY3VydmVtYXAsIHZlYzIodGV4dHVyZTJEKGN1cnZlbWFwLCB2ZWMyKGNvbC5iLCAwLjApKS5hLCAwLjApKS5iOw0KDQoJaWYgKGZhYyAhPSAxLjApDQoJCW91dGNvbCA9IChvdXRjb2wgKiBmYWMpICsgKGNvbCAqICgxLjAgLSBmYWMpKTsNCg0KCW91dGNvbC5hID0gY29sLmE7DQp9DQoNCnZvaWQgc2V0X3ZhbHVlKGZsb2F0IHZhbCwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSB2YWw7DQp9DQoNCnZvaWQgc2V0X3JnYih2ZWMzIGNvbCwgb3V0IHZlYzMgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDsNCn0NCg0Kdm9pZCBzZXRfcmdiYSh2ZWM0IGNvbCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDsNCn0NCg0Kdm9pZCBzZXRfdmFsdWVfemVybyhvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IDAuMDsNCn0NCg0Kdm9pZCBzZXRfdmFsdWVfb25lKG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gMS4wOw0KfQ0KDQp2b2lkIHNldF9yZ2JfemVybyhvdXQgdmVjMyBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmVjMygwLjApOw0KfQ0KDQp2b2lkIHNldF9yZ2Jfb25lKG91dCB2ZWMzIG91dHZhbCkNCnsNCglvdXR2YWwgPSB2ZWMzKDEuMCk7DQp9DQoNCnZvaWQgc2V0X3JnYmFfemVybyhvdXQgdmVjNCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmVjNCgwLjApOw0KfQ0KDQp2b2lkIHNldF9yZ2JhX29uZShvdXQgdmVjNCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmVjNCgxLjApOw0KfQ0KDQp2b2lkIGJyaWdodG5lc3NfY29udHJhc3QodmVjNCBjb2wsIGZsb2F0IGJyaWdodG5lc3MsIGZsb2F0IGNvbnRyYXN0LCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmxvYXQgYSA9IDEuMCArIGNvbnRyYXN0Ow0KCWZsb2F0IGIgPSBicmlnaHRuZXNzIC0gY29udHJhc3QgKiAwLjU7DQoNCglvdXRjb2wuciA9IG1heChhICogY29sLnIgKyBiLCAwLjApOw0KCW91dGNvbC5nID0gbWF4KGEgKiBjb2wuZyArIGIsIDAuMCk7DQoJb3V0Y29sLmIgPSBtYXgoYSAqIGNvbC5iICsgYiwgMC4wKTsNCglvdXRjb2wuYSA9IGNvbC5hOw0KfQ0KDQp2b2lkIG1peF9ibGVuZChmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gbWl4KGNvbDEsIGNvbDIsIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X2FkZChmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gbWl4KGNvbDEsIGNvbDEgKyBjb2wyLCBmYWMpOw0KCW91dGNvbC5hID0gY29sMS5hOw0KfQ0KDQp2b2lkIG1peF9tdWx0KGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wgPSBtaXgoY29sMSwgY29sMSAqIGNvbDIsIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X3NjcmVlbihmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJZmxvYXQgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IHZlYzQoMS4wKSAtICh2ZWM0KGZhY20pICsgZmFjICogKHZlYzQoMS4wKSAtIGNvbDIpKSAqICh2ZWM0KDEuMCkgLSBjb2wxKTsNCglvdXRjb2wuYSA9IGNvbDEuYTsNCn0NCg0Kdm9pZCBtaXhfb3ZlcmxheShmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJZmxvYXQgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IGNvbDE7DQoNCglpZiAob3V0Y29sLnIgPCAwLjUpDQoJCW91dGNvbC5yICo9IGZhY20gKyAyLjAgKiBmYWMgKiBjb2wyLnI7DQoJZWxzZQ0KCQlvdXRjb2wuciA9IDEuMCAtIChmYWNtICsgMi4wICogZmFjICogKDEuMCAtIGNvbDIucikpICogKDEuMCAtIG91dGNvbC5yKTsNCg0KCWlmIChvdXRjb2wuZyA8IDAuNSkNCgkJb3V0Y29sLmcgKj0gZmFjbSArIDIuMCAqIGZhYyAqIGNvbDIuZzsNCgllbHNlDQoJCW91dGNvbC5nID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWMgKiAoMS4wIC0gY29sMi5nKSkgKiAoMS4wIC0gb3V0Y29sLmcpOw0KDQoJaWYgKG91dGNvbC5iIDwgMC41KQ0KCQlvdXRjb2wuYiAqPSBmYWNtICsgMi4wICogZmFjICogY29sMi5iOw0KCWVsc2UNCgkJb3V0Y29sLmIgPSAxLjAgLSAoZmFjbSArIDIuMCAqIGZhYyAqICgxLjAgLSBjb2wyLmIpKSAqICgxLjAgLSBvdXRjb2wuYik7DQp9DQoNCnZvaWQgbWl4X3N1YihmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gbWl4KGNvbDEsIGNvbDEgLSBjb2wyLCBmYWMpOw0KCW91dGNvbC5hID0gY29sMS5hOw0KfQ0KDQp2b2lkIG1peF9kaXYoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCglvdXRjb2wgPSBjb2wxOw0KDQoJaWYgKGNvbDIuciAhPSAwLjApIG91dGNvbC5yID0gZmFjbSAqIG91dGNvbC5yICsgZmFjICogb3V0Y29sLnIgLyBjb2wyLnI7DQoJaWYgKGNvbDIuZyAhPSAwLjApIG91dGNvbC5nID0gZmFjbSAqIG91dGNvbC5nICsgZmFjICogb3V0Y29sLmcgLyBjb2wyLmc7DQoJaWYgKGNvbDIuYiAhPSAwLjApIG91dGNvbC5iID0gZmFjbSAqIG91dGNvbC5iICsgZmFjICogb3V0Y29sLmIgLyBjb2wyLmI7DQp9DQoNCnZvaWQgbWl4X2RpZmYoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCW91dGNvbCA9IG1peChjb2wxLCBhYnMoY29sMSAtIGNvbDIpLCBmYWMpOw0KCW91dGNvbC5hID0gY29sMS5hOw0KfQ0KDQp2b2lkIG1peF9kYXJrKGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wucmdiID0gbWluKGNvbDEucmdiLCBjb2wyLnJnYiAqIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X2xpZ2h0KGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wucmdiID0gbWF4KGNvbDEucmdiLCBjb2wyLnJnYiAqIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X2RvZGdlKGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wgPSBjb2wxOw0KDQoJaWYgKG91dGNvbC5yICE9IDAuMCkgew0KCQlmbG9hdCB0bXAgPSAxLjAgLSBmYWMgKiBjb2wyLnI7DQoJCWlmICh0bXAgPD0gMC4wKQ0KCQkJb3V0Y29sLnIgPSAxLjA7DQoJCWVsc2UgaWYgKCh0bXAgPSBvdXRjb2wuciAvIHRtcCkgPiAxLjApDQoJCQlvdXRjb2wuciA9IDEuMDsNCgkJZWxzZQ0KCQkJb3V0Y29sLnIgPSB0bXA7DQoJfQ0KCWlmIChvdXRjb2wuZyAhPSAwLjApIHsNCgkJZmxvYXQgdG1wID0gMS4wIC0gZmFjICogY29sMi5nOw0KCQlpZiAodG1wIDw9IDAuMCkNCgkJCW91dGNvbC5nID0gMS4wOw0KCQllbHNlIGlmICgodG1wID0gb3V0Y29sLmcgLyB0bXApID4gMS4wKQ0KCQkJb3V0Y29sLmcgPSAxLjA7DQoJCWVsc2UNCgkJCW91dGNvbC5nID0gdG1wOw0KCX0NCglpZiAob3V0Y29sLmIgIT0gMC4wKSB7DQoJCWZsb2F0IHRtcCA9IDEuMCAtIGZhYyAqIGNvbDIuYjsNCgkJaWYgKHRtcCA8PSAwLjApDQoJCQlvdXRjb2wuYiA9IDEuMDsNCgkJZWxzZSBpZiAoKHRtcCA9IG91dGNvbC5iIC8gdG1wKSA+IDEuMCkNCgkJCW91dGNvbC5iID0gMS4wOw0KCQllbHNlDQoJCQlvdXRjb2wuYiA9IHRtcDsNCgl9DQp9DQoNCnZvaWQgbWl4X2J1cm4oZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IHRtcCwgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IGNvbDE7DQoNCgl0bXAgPSBmYWNtICsgZmFjICogY29sMi5yOw0KCWlmICh0bXAgPD0gMC4wKQ0KCQlvdXRjb2wuciA9IDAuMDsNCgllbHNlIGlmICgodG1wID0gKDEuMCAtICgxLjAgLSBvdXRjb2wucikgLyB0bXApKSA8IDAuMCkNCgkJb3V0Y29sLnIgPSAwLjA7DQoJZWxzZSBpZiAodG1wID4gMS4wKQ0KCQlvdXRjb2wuciA9IDEuMDsNCgllbHNlDQoJCW91dGNvbC5yID0gdG1wOw0KDQoJdG1wID0gZmFjbSArIGZhYyAqIGNvbDIuZzsNCglpZiAodG1wIDw9IDAuMCkNCgkJb3V0Y29sLmcgPSAwLjA7DQoJZWxzZSBpZiAoKHRtcCA9ICgxLjAgLSAoMS4wIC0gb3V0Y29sLmcpIC8gdG1wKSkgPCAwLjApDQoJCW91dGNvbC5nID0gMC4wOw0KCWVsc2UgaWYgKHRtcCA+IDEuMCkNCgkJb3V0Y29sLmcgPSAxLjA7DQoJZWxzZQ0KCQlvdXRjb2wuZyA9IHRtcDsNCg0KCXRtcCA9IGZhY20gKyBmYWMgKiBjb2wyLmI7DQoJaWYgKHRtcCA8PSAwLjApDQoJCW91dGNvbC5iID0gMC4wOw0KCWVsc2UgaWYgKCh0bXAgPSAoMS4wIC0gKDEuMCAtIG91dGNvbC5iKSAvIHRtcCkpIDwgMC4wKQ0KCQlvdXRjb2wuYiA9IDAuMDsNCgllbHNlIGlmICh0bXAgPiAxLjApDQoJCW91dGNvbC5iID0gMS4wOw0KCWVsc2UNCgkJb3V0Y29sLmIgPSB0bXA7DQp9DQoNCnZvaWQgbWl4X2h1ZShmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJZmxvYXQgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IGNvbDE7DQoNCgl2ZWM0IGhzdiwgaHN2MiwgdG1wOw0KCXJnYl90b19oc3YoY29sMiwgaHN2Mik7DQoNCglpZiAoaHN2Mi55ICE9IDAuMCkgew0KCQlyZ2JfdG9faHN2KG91dGNvbCwgaHN2KTsNCgkJaHN2LnggPSBoc3YyLng7DQoJCWhzdl90b19yZ2IoaHN2LCB0bXApOw0KDQoJCW91dGNvbCA9IG1peChvdXRjb2wsIHRtcCwgZmFjKTsNCgkJb3V0Y29sLmEgPSBjb2wxLmE7DQoJfQ0KfQ0KDQp2b2lkIG1peF9zYXQoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCglvdXRjb2wgPSBjb2wxOw0KDQoJdmVjNCBoc3YsIGhzdjI7DQoJcmdiX3RvX2hzdihvdXRjb2wsIGhzdik7DQoNCglpZiAoaHN2LnkgIT0gMC4wKSB7DQoJCXJnYl90b19oc3YoY29sMiwgaHN2Mik7DQoNCgkJaHN2LnkgPSBmYWNtICogaHN2LnkgKyBmYWMgKiBoc3YyLnk7DQoJCWhzdl90b19yZ2IoaHN2LCBvdXRjb2wpOw0KCX0NCn0NCg0Kdm9pZCBtaXhfdmFsKGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglmbG9hdCBmYWNtID0gMS4wIC0gZmFjOw0KDQoJdmVjNCBoc3YsIGhzdjI7DQoJcmdiX3RvX2hzdihjb2wxLCBoc3YpOw0KCXJnYl90b19oc3YoY29sMiwgaHN2Mik7DQoNCgloc3YueiA9IGZhY20gKiBoc3YueiArIGZhYyAqIGhzdjIuejsNCgloc3ZfdG9fcmdiKGhzdiwgb3V0Y29sKTsNCn0NCg0Kdm9pZCBtaXhfY29sb3IoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCglvdXRjb2wgPSBjb2wxOw0KDQoJdmVjNCBoc3YsIGhzdjIsIHRtcDsNCglyZ2JfdG9faHN2KGNvbDIsIGhzdjIpOw0KDQoJaWYgKGhzdjIueSAhPSAwLjApIHsNCgkJcmdiX3RvX2hzdihvdXRjb2wsIGhzdik7DQoJCWhzdi54ID0gaHN2Mi54Ow0KCQloc3YueSA9IGhzdjIueTsNCgkJaHN2X3RvX3JnYihoc3YsIHRtcCk7DQoNCgkJb3V0Y29sID0gbWl4KG91dGNvbCwgdG1wLCBmYWMpOw0KCQlvdXRjb2wuYSA9IGNvbDEuYTsNCgl9DQp9DQoNCnZvaWQgbWl4X3NvZnQoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCgl2ZWM0IG9uZSA9IHZlYzQoMS4wKTsNCgl2ZWM0IHNjciA9IG9uZSAtIChvbmUgLSBjb2wyKSAqIChvbmUgLSBjb2wxKTsNCglvdXRjb2wgPSBmYWNtICogY29sMSArIGZhYyAqICgob25lIC0gY29sMSkgKiBjb2wyICogY29sMSArIGNvbDEgKiBzY3IpOw0KfQ0KDQp2b2lkIG1peF9saW5lYXIoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KDQoJb3V0Y29sID0gY29sMSArIGZhYyAqICgyLjAgKiAoY29sMiAtIHZlYzQoMC41KSkpOw0KfQ0KDQp2b2lkIHZhbHRvcmdiKGZsb2F0IGZhYywgc2FtcGxlcjJEIGNvbG9ybWFwLCBvdXQgdmVjNCBvdXRjb2wsIG91dCBmbG9hdCBvdXRhbHBoYSkNCnsNCglvdXRjb2wgPSB0ZXh0dXJlMkQoY29sb3JtYXAsIHZlYzIoZmFjLCAwLjApKTsNCglvdXRhbHBoYSA9IG91dGNvbC5hOw0KfQ0KDQp2b2lkIHJnYnRvYncodmVjNCBjb2xvciwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCiNpZmRlZiBVU0VfTkVXX1NIQURJTkcNCglvdXR2YWwgPSBjb2xvci5yICogMC4yMTI2ICsgY29sb3IuZyAqIDAuNzE1MiArIGNvbG9yLmIgKiAwLjA3MjI7DQojZWxzZQ0KCW91dHZhbCA9IGNvbG9yLnIgKiAwLjM1ICsgY29sb3IuZyAqIDAuNDUgKyBjb2xvci5iICogMC4yOyAvKiBrZWVwIHRoZXNlIGZhY3RvcnMgdmFyeWluZyBzeW5jIHdpdGggdGV4dHVyZS5oOlJHQlRPQlcgKi8NCiNlbmRpZg0KfQ0KDQp2b2lkIGludmVydChmbG9hdCBmYWMsIHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sLnh5eiA9IG1peChjb2wueHl6LCB2ZWMzKDEuMCwgMS4wLCAxLjApIC0gY29sLnh5eiwgZmFjKTsNCglvdXRjb2wudyA9IGNvbC53Ow0KfQ0KDQp2b2lkIGNsYW1wX3ZlYzModmVjMyB2ZWMsIHZlYzMgbWluLCB2ZWMzIG1heCwgb3V0IHZlYzMgb3V0X3ZlYykNCnsNCglvdXRfdmVjID0gY2xhbXAodmVjLCBtaW4sIG1heCk7DQp9DQoNCnZvaWQgY2xhbXBfdmFsKGZsb2F0IHZhbHVlLCBmbG9hdCBtaW4sIGZsb2F0IG1heCwgb3V0IGZsb2F0IG91dF92YWx1ZSkNCnsNCglvdXRfdmFsdWUgPSBjbGFtcCh2YWx1ZSwgbWluLCBtYXgpOw0KfQ0KDQp2b2lkIGh1ZV9zYXQoZmxvYXQgaHVlLCBmbG9hdCBzYXQsIGZsb2F0IHZhbHVlLCBmbG9hdCBmYWMsIHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJdmVjNCBoc3Y7DQoNCglyZ2JfdG9faHN2KGNvbCwgaHN2KTsNCg0KCWhzdlswXSArPSAoaHVlIC0gMC41KTsNCglpZiAoaHN2WzBdID4gMS4wKSBoc3ZbMF0gLT0gMS4wOyBlbHNlIGlmIChoc3ZbMF0gPCAwLjApIGhzdlswXSArPSAxLjA7DQoJaHN2WzFdICo9IHNhdDsNCglpZiAoaHN2WzFdID4gMS4wKSBoc3ZbMV0gPSAxLjA7IGVsc2UgaWYgKGhzdlsxXSA8IDAuMCkgaHN2WzFdID0gMC4wOw0KCWhzdlsyXSAqPSB2YWx1ZTsNCglpZiAoaHN2WzJdID4gMS4wKSBoc3ZbMl0gPSAxLjA7IGVsc2UgaWYgKGhzdlsyXSA8IDAuMCkgaHN2WzJdID0gMC4wOw0KDQoJaHN2X3RvX3JnYihoc3YsIG91dGNvbCk7DQoNCglvdXRjb2wgPSBtaXgoY29sLCBvdXRjb2wsIGZhYyk7DQp9DQoNCnZvaWQgc2VwYXJhdGVfcmdiKHZlYzQgY29sLCBvdXQgZmxvYXQgciwgb3V0IGZsb2F0IGcsIG91dCBmbG9hdCBiKQ0Kew0KCXIgPSBjb2wucjsNCglnID0gY29sLmc7DQoJYiA9IGNvbC5iOw0KfQ0KDQp2b2lkIGNvbWJpbmVfcmdiKGZsb2F0IHIsIGZsb2F0IGcsIGZsb2F0IGIsIG91dCB2ZWM0IGNvbCkNCnsNCgljb2wgPSB2ZWM0KHIsIGcsIGIsIDEuMCk7DQp9DQoNCnZvaWQgc2VwYXJhdGVfeHl6KHZlYzMgdmVjLCBvdXQgZmxvYXQgeCwgb3V0IGZsb2F0IHksIG91dCBmbG9hdCB6KQ0Kew0KCXggPSB2ZWMucjsNCgl5ID0gdmVjLmc7DQoJeiA9IHZlYy5iOw0KfQ0KDQp2b2lkIGNvbWJpbmVfeHl6KGZsb2F0IHgsIGZsb2F0IHksIGZsb2F0IHosIG91dCB2ZWMzIHZlYykNCnsNCgl2ZWMgPSB2ZWMzKHgsIHksIHopOw0KfQ0KDQp2b2lkIHNlcGFyYXRlX2hzdih2ZWM0IGNvbCwgb3V0IGZsb2F0IGgsIG91dCBmbG9hdCBzLCBvdXQgZmxvYXQgdikNCnsNCgl2ZWM0IGhzdjsNCg0KCXJnYl90b19oc3YoY29sLCBoc3YpOw0KCWggPSBoc3ZbMF07DQoJcyA9IGhzdlsxXTsNCgl2ID0gaHN2WzJdOw0KfQ0KDQp2b2lkIGNvbWJpbmVfaHN2KGZsb2F0IGgsIGZsb2F0IHMsIGZsb2F0IHYsIG91dCB2ZWM0IGNvbCkNCnsNCgloc3ZfdG9fcmdiKHZlYzQoaCwgcywgdiwgMS4wKSwgY29sKTsNCn0NCg0Kdm9pZCBvdXRwdXRfbm9kZSh2ZWM0IHJnYiwgZmxvYXQgYWxwaGEsIG91dCB2ZWM0IG91dHJnYikNCnsNCglvdXRyZ2IgPSB2ZWM0KHJnYi5yZ2IsIGFscGhhKTsNCn0NCg0KLyoqKioqKioqKioqIFRFWFRVUkVTICoqKioqKioqKioqKioqKi8NCg0Kdm9pZCB0ZXh0dXJlX2ZsaXBfYmxlbmQodmVjMyB2ZWMsIG91dCB2ZWMzIG91dHZlYykNCnsNCglvdXR2ZWMgPSB2ZWMueXh6Ow0KfQ0KDQp2b2lkIHRleHR1cmVfYmxlbmRfbGluKHZlYzMgdmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9ICgxLjAgKyB2ZWMueCkgLyAyLjA7DQp9DQoNCnZvaWQgdGV4dHVyZV9ibGVuZF9xdWFkKHZlYzMgdmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IG1heCgoMS4wICsgdmVjLngpIC8gMi4wLCAwLjApOw0KCW91dHZhbCAqPSBvdXR2YWw7DQp9DQoNCnZvaWQgdGV4dHVyZV93b29kX3Npbih2ZWMzIHZlYywgb3V0IGZsb2F0IHZhbHVlLCBvdXQgdmVjNCBjb2xvciwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCWZsb2F0IGEgPSBzcXJ0KHZlYy54ICogdmVjLnggKyB2ZWMueSAqIHZlYy55ICsgdmVjLnogKiB2ZWMueikgKiAyMC4wOw0KCWZsb2F0IHdpID0gMC41ICsgMC41ICogc2luKGEpOw0KDQoJdmFsdWUgPSB3aTsNCgljb2xvciA9IHZlYzQod2ksIHdpLCB3aSwgMS4wKTsNCglub3JtYWwgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOw0KfQ0KDQp2b2lkIHRleHR1cmVfaW1hZ2UodmVjMyB2ZWMsIHNhbXBsZXIyRCBpbWEsIG91dCBmbG9hdCB2YWx1ZSwgb3V0IHZlYzQgY29sb3IsIG91dCB2ZWMzIG5vcm1hbCkNCnsNCgljb2xvciA9IHRleHR1cmUyRChpbWEsICh2ZWMueHkgKyB2ZWMyKDEuMCwgMS4wKSkgKiAwLjUpOw0KCXZhbHVlID0gY29sb3IuYTsNCg0KCW5vcm1hbC54ID0gMi4wICogKGNvbG9yLnIgLSAwLjUpOw0KCW5vcm1hbC55ID0gMi4wICogKDAuNSAtIGNvbG9yLmcpOw0KCW5vcm1hbC56ID0gMi4wICogKGNvbG9yLmIgLSAwLjUpOw0KfQ0KDQovKioqKioqKioqKioqKiBNVEVYICoqKioqKioqKioqKioqKioqLw0KDQp2b2lkIHRleGNvX29yY28odmVjMyBhdHRvcmNvLCBvdXQgdmVjMyBvcmNvKQ0Kew0KCW9yY28gPSBhdHRvcmNvOw0KfQ0KDQp2b2lkIHRleGNvX3V2KHZlYzIgYXR0dXYsIG91dCB2ZWMzIHV2KQ0Kew0KCS8qIGRpc2FibGVkIGZvciBub3csIHdvcmtzIHRvZ2V0aGVyIHdpdGggbGVhdmluZyBvdXQgbXRleF8yZF9tYXBwaW5nDQoJICAgdXYgPSB2ZWMzKGF0dHV2KjIuMCAtIHZlYzIoMS4wLCAxLjApLCAwLjApOyAqLw0KCXV2ID0gdmVjMyhhdHR1diwgMC4wKTsNCn0NCg0Kdm9pZCB0ZXhjb19ub3JtKHZlYzMgbm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJLyogY29ycmVzcG9uZHMgdG8gc2hpLT5vcm4sIHdoaWNoIGlzIG5lZ2F0ZWQgc28gY2FuY2Vscw0KCSAgIG91dCBibGVuZGVyIG5vcm1hbCBuZWdhdGlvbiAqLw0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZShub3JtYWwpOw0KfQ0KDQp2b2lkIHRleGNvX3RhbmdlbnQodmVjNCB0YW5nZW50LCBvdXQgdmVjMyBvdXR0YW5nZW50KQ0Kew0KCW91dHRhbmdlbnQgPSBub3JtYWxpemUodGFuZ2VudC54eXopOw0KfQ0KDQp2b2lkIHRleGNvX2dsb2JhbChtYXQ0IHZpZXdpbnZtYXQsIHZlYzMgY28sIG91dCB2ZWMzIGdsb2JhbCkNCnsNCglnbG9iYWwgPSAodmlld2ludm1hdCAqIHZlYzQoY28sIDEuMCkpLnh5ejsNCn0NCg0Kdm9pZCB0ZXhjb19vYmplY3QobWF0NCB2aWV3aW52bWF0LCBtYXQ0IG9iaW52bWF0LCB2ZWMzIGNvLCBvdXQgdmVjMyBvYmplY3QpDQp7DQoJb2JqZWN0ID0gKG9iaW52bWF0ICogKHZpZXdpbnZtYXQgKiB2ZWM0KGNvLCAxLjApKSkueHl6Ow0KfQ0KDQp2b2lkIHRleGNvX3JlZmwodmVjMyB2biwgdmVjMyB2aWV3LCBvdXQgdmVjMyByZWYpDQp7DQoJcmVmID0gdmlldyAtIDIuMCAqIGRvdCh2biwgdmlldykgKiB2bjsNCn0NCg0Kdm9pZCBzaGFkZV9ub3JtKHZlYzMgbm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJLyogYmxlbmRlciByZW5kZXIgbm9ybWFsIGlzIG5lZ2F0ZWQgKi8NCglvdXRub3JtYWwgPSAtbm9ybWFsaXplKG5vcm1hbCk7DQp9DQoNCnZvaWQgbXRleF9taXJyb3IodmVjMyB0Y29sLCB2ZWM0IHJlZmNvbCwgZmxvYXQgdGluLCBmbG9hdCBjb2xtaXJmYWMsIG91dCB2ZWM0IG91dHJlZmNvbCkNCnsNCglvdXRyZWZjb2wgPSBtaXgocmVmY29sLCB2ZWM0KDEuMCwgdGNvbCksIHRpbiAqIGNvbG1pcmZhYyk7DQp9DQoNCnZvaWQgbXRleF9yZ2JfYmxlbmQodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaW5jb2wgPSBmYWN0ICogdGV4Y29sICsgZmFjbSAqIG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9tdWwodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaW5jb2wgPSAoZmFjbSArIGZhY3QgKiB0ZXhjb2wpICogb3V0Y29sOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX3NjcmVlbih2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoNCglmYWN0ICo9IGZhY2c7DQoJZmFjbSA9IDEuMCAtIGZhY3Q7DQoNCglpbmNvbCA9IHZlYzMoMS4wKSAtICh2ZWMzKGZhY20pICsgZmFjdCAqICh2ZWMzKDEuMCkgLSB0ZXhjb2wpKSAqICh2ZWMzKDEuMCkgLSBvdXRjb2wpOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX292ZXJsYXkodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaWYgKG91dGNvbC5yIDwgMC41KQ0KCQlpbmNvbC5yID0gb3V0Y29sLnIgKiAoZmFjbSArIDIuMCAqIGZhY3QgKiB0ZXhjb2wucik7DQoJZWxzZQ0KCQlpbmNvbC5yID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWN0ICogKDEuMCAtIHRleGNvbC5yKSkgKiAoMS4wIC0gb3V0Y29sLnIpOw0KDQoJaWYgKG91dGNvbC5nIDwgMC41KQ0KCQlpbmNvbC5nID0gb3V0Y29sLmcgKiAoZmFjbSArIDIuMCAqIGZhY3QgKiB0ZXhjb2wuZyk7DQoJZWxzZQ0KCQlpbmNvbC5nID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWN0ICogKDEuMCAtIHRleGNvbC5nKSkgKiAoMS4wIC0gb3V0Y29sLmcpOw0KDQoJaWYgKG91dGNvbC5iIDwgMC41KQ0KCQlpbmNvbC5iID0gb3V0Y29sLmIgKiAoZmFjbSArIDIuMCAqIGZhY3QgKiB0ZXhjb2wuYik7DQoJZWxzZQ0KCQlpbmNvbC5iID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWN0ICogKDEuMCAtIHRleGNvbC5iKSkgKiAoMS4wIC0gb3V0Y29sLmIpOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX3N1Yih2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWluY29sID0gLWZhY3QgKiBmYWNnICogdGV4Y29sICsgb3V0Y29sOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2FkZCh2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWluY29sID0gZmFjdCAqIGZhY2cgKiB0ZXhjb2wgKyBvdXRjb2w7DQp9DQoNCnZvaWQgbXRleF9yZ2JfZGl2KHZlYzMgb3V0Y29sLCB2ZWMzIHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IHZlYzMgaW5jb2wpDQp7DQoJZmxvYXQgZmFjbTsNCg0KCWZhY3QgKj0gZmFjZzsNCglmYWNtID0gMS4wIC0gZmFjdDsNCg0KCWlmICh0ZXhjb2wuciAhPSAwLjApIGluY29sLnIgPSBmYWNtICogb3V0Y29sLnIgKyBmYWN0ICogb3V0Y29sLnIgLyB0ZXhjb2wucjsNCglpZiAodGV4Y29sLmcgIT0gMC4wKSBpbmNvbC5nID0gZmFjbSAqIG91dGNvbC5nICsgZmFjdCAqIG91dGNvbC5nIC8gdGV4Y29sLmc7DQoJaWYgKHRleGNvbC5iICE9IDAuMCkgaW5jb2wuYiA9IGZhY20gKiBvdXRjb2wuYiArIGZhY3QgKiBvdXRjb2wuYiAvIHRleGNvbC5iOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2RpZmYodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIGFicyh0ZXhjb2wgLSBvdXRjb2wpOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2RhcmsodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtLCBjb2w7DQoNCglmYWN0ICo9IGZhY2c7DQoJZmFjbSA9IDEuMCAtIGZhY3Q7DQoNCglpbmNvbC5yID0gbWluKG91dGNvbC5yLCB0ZXhjb2wucikgKiBmYWN0ICsgb3V0Y29sLnIgKiBmYWNtOw0KCWluY29sLmcgPSBtaW4ob3V0Y29sLmcsIHRleGNvbC5nKSAqIGZhY3QgKyBvdXRjb2wuZyAqIGZhY207DQoJaW5jb2wuYiA9IG1pbihvdXRjb2wuYiwgdGV4Y29sLmIpICogZmFjdCArIG91dGNvbC5iICogZmFjbTsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9saWdodCh2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWZsb2F0IGZhY20sIGNvbDsNCg0KCWZhY3QgKj0gZmFjZzsNCg0KCWNvbCA9IGZhY3QgKiB0ZXhjb2wucjsNCglpZiAoY29sID4gb3V0Y29sLnIpIGluY29sLnIgPSBjb2w7IGVsc2UgaW5jb2wuciA9IG91dGNvbC5yOw0KCWNvbCA9IGZhY3QgKiB0ZXhjb2wuZzsNCglpZiAoY29sID4gb3V0Y29sLmcpIGluY29sLmcgPSBjb2w7IGVsc2UgaW5jb2wuZyA9IG91dGNvbC5nOw0KCWNvbCA9IGZhY3QgKiB0ZXhjb2wuYjsNCglpZiAoY29sID4gb3V0Y29sLmIpIGluY29sLmIgPSBjb2w7IGVsc2UgaW5jb2wuYiA9IG91dGNvbC5iOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2h1ZSh2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCXZlYzQgY29sOw0KDQoJbWl4X2h1ZShmYWN0ICogZmFjZywgdmVjNChvdXRjb2wsIDEuMCksIHZlYzQodGV4Y29sLCAxLjApLCBjb2wpOw0KCWluY29sLnJnYiA9IGNvbC5yZ2I7DQp9DQoNCnZvaWQgbXRleF9yZ2Jfc2F0KHZlYzMgb3V0Y29sLCB2ZWMzIHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IHZlYzMgaW5jb2wpDQp7DQoJdmVjNCBjb2w7DQoNCgltaXhfc2F0KGZhY3QgKiBmYWNnLCB2ZWM0KG91dGNvbCwgMS4wKSwgdmVjNCh0ZXhjb2wsIDEuMCksIGNvbCk7DQoJaW5jb2wucmdiID0gY29sLnJnYjsNCn0NCg0Kdm9pZCBtdGV4X3JnYl92YWwodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCgl2ZWM0IGNvbDsNCg0KCW1peF92YWwoZmFjdCAqIGZhY2csIHZlYzQob3V0Y29sLCAxLjApLCB2ZWM0KHRleGNvbCwgMS4wKSwgY29sKTsNCglpbmNvbC5yZ2IgPSBjb2wucmdiOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2NvbG9yKHZlYzMgb3V0Y29sLCB2ZWMzIHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IHZlYzMgaW5jb2wpDQp7DQoJdmVjNCBjb2w7DQoNCgltaXhfY29sb3IoZmFjdCAqIGZhY2csIHZlYzQob3V0Y29sLCAxLjApLCB2ZWM0KHRleGNvbCwgMS4wKSwgY29sKTsNCglpbmNvbC5yZ2IgPSBjb2wucmdiOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX3NvZnQodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCgl2ZWM0IGNvbDsNCg0KCW1peF9zb2Z0KGZhY3QgKiBmYWNnLCB2ZWM0KG91dGNvbCwgMS4wKSwgdmVjNCh0ZXhjb2wsIDEuMCksIGNvbCk7DQoJaW5jb2wucmdiID0gY29sLnJnYjsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9saW5lYXIodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmYWN0ICo9IGZhY2c7DQoNCglpZiAodGV4Y29sLnIgPiAwLjUpDQoJCWluY29sLnIgPSBvdXRjb2wuciArIGZhY3QgKiAoMi4wICogKHRleGNvbC5yIC0gMC41KSk7DQoJZWxzZQ0KCQlpbmNvbC5yID0gb3V0Y29sLnIgKyBmYWN0ICogKDIuMCAqICh0ZXhjb2wucikgLSAxLjApOw0KDQoJaWYgKHRleGNvbC5nID4gMC41KQ0KCQlpbmNvbC5nID0gb3V0Y29sLmcgKyBmYWN0ICogKDIuMCAqICh0ZXhjb2wuZyAtIDAuNSkpOw0KCWVsc2UNCgkJaW5jb2wuZyA9IG91dGNvbC5nICsgZmFjdCAqICgyLjAgKiAodGV4Y29sLmcpIC0gMS4wKTsNCg0KCWlmICh0ZXhjb2wuYiA+IDAuNSkNCgkJaW5jb2wuYiA9IG91dGNvbC5iICsgZmFjdCAqICgyLjAgKiAodGV4Y29sLmIgLSAwLjUpKTsNCgllbHNlDQoJCWluY29sLmIgPSBvdXRjb2wuYiArIGZhY3QgKiAoMi4wICogKHRleGNvbC5iKSAtIDEuMCk7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV92YXJzKGlub3V0IGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCBmbG9hdCBmYWNtKQ0Kew0KCWZhY3QgKj0gYWJzKGZhY2cpOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaWYgKGZhY2cgPCAwLjApIHsNCgkJZmxvYXQgdG1wID0gZmFjdDsNCgkJZmFjdCA9IGZhY207DQoJCWZhY20gPSB0bXA7DQoJfQ0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfYmxlbmQoZmxvYXQgb3V0Y29sLCBmbG9hdCB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCBmbG9hdCBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KCW10ZXhfdmFsdWVfdmFycyhmYWN0LCBmYWNnLCBmYWNtKTsNCg0KCWluY29sID0gZmFjdCAqIHRleGNvbCArIGZhY20gKiBvdXRjb2w7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV9tdWwoZmxvYXQgb3V0Y29sLCBmbG9hdCB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCBmbG9hdCBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KCW10ZXhfdmFsdWVfdmFycyhmYWN0LCBmYWNnLCBmYWNtKTsNCg0KCWZhY20gPSAxLjAgLSBmYWNnOw0KCWluY29sID0gKGZhY20gKyBmYWN0ICogdGV4Y29sKSAqIG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX3NjcmVlbihmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmFjbSA9IDEuMCAtIGZhY2c7DQoJaW5jb2wgPSAxLjAgLSAoZmFjbSArIGZhY3QgKiAoMS4wIC0gdGV4Y29sKSkgKiAoMS4wIC0gb3V0Y29sKTsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX3N1YihmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmFjdCA9IC1mYWN0Ow0KCWluY29sID0gZmFjdCAqIHRleGNvbCArIG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX2FkZChmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmFjdCA9IGZhY3Q7DQoJaW5jb2wgPSBmYWN0ICogdGV4Y29sICsgb3V0Y29sOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfZGl2KGZsb2F0IG91dGNvbCwgZmxvYXQgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgZmxvYXQgaW5jb2wpDQp7DQoJZmxvYXQgZmFjbTsNCgltdGV4X3ZhbHVlX3ZhcnMoZmFjdCwgZmFjZywgZmFjbSk7DQoNCglpZiAodGV4Y29sICE9IDAuMCkNCgkJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIG91dGNvbCAvIHRleGNvbDsNCgllbHNlDQoJCWluY29sID0gMC4wOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfZGlmZihmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIGFicyh0ZXhjb2wgLSBvdXRjb2wpOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfZGFyayhmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIG1pbihvdXRjb2wsIHRleGNvbCk7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV9saWdodChmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmxvYXQgY29sID0gZmFjdCAqIHRleGNvbDsNCglpZiAoY29sID4gb3V0Y29sKSBpbmNvbCA9IGNvbDsgZWxzZSBpbmNvbCA9IG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX2NsYW1wX3Bvc2l0aXZlKGZsb2F0IGZhYywgb3V0IGZsb2F0IG91dGZhYykNCnsNCglvdXRmYWMgPSBtYXgoZmFjLCAwLjApOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfY2xhbXAoZmxvYXQgZmFjLCBvdXQgZmxvYXQgb3V0ZmFjKQ0Kew0KCW91dGZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KfQ0KDQp2b2lkIG10ZXhfaGFyX2RpdmlkZShmbG9hdCBoYXIsIG91dCBmbG9hdCBvdXRoYXIpDQp7DQoJb3V0aGFyID0gaGFyIC8gMTI4LjA7DQp9DQoNCnZvaWQgbXRleF9oYXJfbXVsdGlwbHlfY2xhbXAoZmxvYXQgaGFyLCBvdXQgZmxvYXQgb3V0aGFyKQ0Kew0KCWhhciAqPSAxMjguMDsNCg0KCWlmIChoYXIgPCAxLjApIG91dGhhciA9IDEuMDsNCgllbHNlIGlmIChoYXIgPiA1MTEuMCkgb3V0aGFyID0gNTExLjA7DQoJZWxzZSBvdXRoYXIgPSBoYXI7DQp9DQoNCnZvaWQgbXRleF9hbHBoYV9mcm9tX2NvbCh2ZWM0IGNvbCwgb3V0IGZsb2F0IGFscGhhKQ0Kew0KCWFscGhhID0gY29sLmE7DQp9DQoNCnZvaWQgbXRleF9hbHBoYV90b19jb2wodmVjNCBjb2wsIGZsb2F0IGFscGhhLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gdmVjNChjb2wucmdiLCBhbHBoYSk7DQp9DQoNCnZvaWQgbXRleF9hbHBoYV9tdWx0aXBseV92YWx1ZSh2ZWM0IGNvbCwgZmxvYXQgdmFsdWUsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSB2ZWM0KGNvbC5yZ2IsIGNvbC5hICogdmFsdWUpOw0KfQ0KDQp2b2lkIG10ZXhfcmdidG9pbnQodmVjNCByZ2IsIG91dCBmbG9hdCBpbnRlbnNpdHkpDQp7DQoJaW50ZW5zaXR5ID0gZG90KHZlYzMoMC4zNSwgMC40NSwgMC4yKSwgcmdiLnJnYik7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV9pbnZlcnQoZmxvYXQgaW52YWx1ZSwgb3V0IGZsb2F0IG91dHZhbHVlKQ0Kew0KCW91dHZhbHVlID0gMS4wIC0gaW52YWx1ZTsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9pbnZlcnQodmVjNCBpbnJnYiwgb3V0IHZlYzQgb3V0cmdiKQ0Kew0KCW91dHJnYiA9IHZlYzQodmVjMygxLjApIC0gaW5yZ2IucmdiLCBpbnJnYi5hKTsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX3N0ZW5jaWwoZmxvYXQgc3RlbmNpbCwgZmxvYXQgaW50ZW5zaXR5LCBvdXQgZmxvYXQgb3V0c3RlbmNpbCwgb3V0IGZsb2F0IG91dGludGVuc2l0eSkNCnsNCglmbG9hdCBmYWN0ID0gaW50ZW5zaXR5Ow0KCW91dGludGVuc2l0eSA9IGludGVuc2l0eSAqIHN0ZW5jaWw7DQoJb3V0c3RlbmNpbCA9IHN0ZW5jaWwgKiBmYWN0Ow0KfQ0KDQp2b2lkIG10ZXhfcmdiX3N0ZW5jaWwoZmxvYXQgc3RlbmNpbCwgdmVjNCByZ2IsIG91dCBmbG9hdCBvdXRzdGVuY2lsLCBvdXQgdmVjNCBvdXRyZ2IpDQp7DQoJZmxvYXQgZmFjdCA9IHJnYi5hOw0KCW91dHJnYiA9IHZlYzQocmdiLnJnYiwgcmdiLmEgKiBzdGVuY2lsKTsNCglvdXRzdGVuY2lsID0gc3RlbmNpbCAqIGZhY3Q7DQp9DQoNCnZvaWQgbXRleF9tYXBwaW5nX29mcyh2ZWMzIHRleGNvLCB2ZWMzIG9mcywgb3V0IHZlYzMgb3V0dGV4Y28pDQp7DQoJb3V0dGV4Y28gPSB0ZXhjbyArIG9mczsNCn0NCg0Kdm9pZCBtdGV4X21hcHBpbmdfc2l6ZSh2ZWMzIHRleGNvLCB2ZWMzIHNpemUsIG91dCB2ZWMzIG91dHRleGNvKQ0Kew0KCW91dHRleGNvID0gc2l6ZSAqIHRleGNvOw0KfQ0KDQp2b2lkIG10ZXhfMmRfbWFwcGluZyh2ZWMzIHZlYywgb3V0IHZlYzMgb3V0dmVjKQ0Kew0KCW91dHZlYyA9IHZlYzModmVjLnh5ICogMC41ICsgdmVjMigwLjUpLCB2ZWMueik7DQp9DQoNCnZlYzMgbXRleF8yZF9tYXBwaW5nKHZlYzMgdmVjKQ0Kew0KCXJldHVybiB2ZWMzKHZlYy54eSAqIDAuNSArIHZlYzIoMC41KSwgdmVjLnopOw0KfQ0KDQp2b2lkIG10ZXhfY3ViZV9tYXAodmVjMyBjbywgc2FtcGxlckN1YmUgaW1hLCBvdXQgZmxvYXQgdmFsdWUsIG91dCB2ZWM0IGNvbG9yKQ0Kew0KCWNvbG9yID0gdGV4dHVyZUN1YmUoaW1hLCBjbyk7DQoJdmFsdWUgPSAxLjA7DQp9DQoNCnZvaWQgbXRleF9jdWJlX21hcF9yZWZsX2Zyb21fcmVmbGRpcigNCiAgICAgICAgc2FtcGxlckN1YmUgaW1hLCB2ZWMzIHJlZmxlY3RlZGRpcmVjdGlvbiwgb3V0IGZsb2F0IHZhbHVlLCBvdXQgdmVjNCBjb2xvcikNCnsNCiAgICAgICAgY29sb3IgPSB0ZXh0dXJlQ3ViZShpbWEsIHJlZmxlY3RlZGRpcmVjdGlvbik7DQogICAgICAgIHZhbHVlID0gMS4wOw0KfQ0KDQp2b2lkIG10ZXhfY3ViZV9tYXBfcmVmbCgNCiAgICAgICAgc2FtcGxlckN1YmUgaW1hLCB2ZWMzIHZwLCB2ZWMzIHZuLCBtYXQ0IHZpZXdtYXRyaXhpbnZlcnNlLCBtYXQ0IHZpZXdtYXRyaXgsDQogICAgICAgIG91dCBmbG9hdCB2YWx1ZSwgb3V0IHZlYzQgY29sb3IpDQp7DQoJdmVjMyB2aWV3ZGlyZWN0aW9uID0gdmVjMyh2aWV3bWF0cml4aW52ZXJzZSAqIHZlYzQodnAsIDAuMCkpOw0KCXZlYzMgbm9ybWFsZGlyZWN0aW9uID0gbm9ybWFsaXplKHZlYzModmVjNCh2biwgMC4wKSAqIHZpZXdtYXRyaXgpKTsNCgl2ZWMzIHJlZmxlY3RlZGRpcmVjdGlvbiA9IHJlZmxlY3Qodmlld2RpcmVjdGlvbiwgbm9ybWFsZGlyZWN0aW9uKTsNCgljb2xvciA9IHRleHR1cmVDdWJlKGltYSwgcmVmbGVjdGVkZGlyZWN0aW9uKTsNCgl2YWx1ZSA9IDEuMDsNCn0NCg0Kdm9pZCBtdGV4X2ltYWdlKHZlYzMgdGV4Y28sIHNhbXBsZXIyRCBpbWEsIG91dCBmbG9hdCB2YWx1ZSwgb3V0IHZlYzQgY29sb3IpDQp7DQoJY29sb3IgPSB0ZXh0dXJlMkQoaW1hLCB0ZXhjby54eSk7DQoJdmFsdWUgPSAxLjA7DQp9DQoNCnZvaWQgbXRleF9ub3JtYWwodmVjMyB0ZXhjbywgc2FtcGxlcjJEIGltYSwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCS8vIFRoZSBpbnZlcnQgb2YgdGhlIHJlZCBjaGFubmVsIGlzIHRvIG1ha2UNCgkvLyB0aGUgbm9ybWFsIG1hcCBjb21wbGlhbnQgd2l0aCB0aGUgb3V0c2lkZSB3b3JsZC4NCgkvLyBJdCBuZWVkcyB0byBiZSBkb25lIGJlY2F1c2UgdmFyeWluZyBCbGVuZGVyDQoJLy8gdGhlIG5vcm1hbCB1c2VkIHBvaW50cyBpbndhcmQuDQoJLy8gU2hvdWxkIHRoaXMgZXZlciBjaGFuZ2UgdGhpcyBuZWdhdGUgbXVzdCBiZSByZW1vdmVkLg0KCXZlYzQgY29sb3IgPSB0ZXh0dXJlMkQoaW1hLCB0ZXhjby54eSk7DQoJbm9ybWFsID0gMi4wICogKHZlYzMoLWNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIpIC0gdmVjMygtMC41LCAwLjUsIDAuNSkpOw0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9ub3JtYWxzX2luaXQodmVjMyB2Tiwgb3V0IHZlYzMgdk5vcmcsIG91dCB2ZWMzIHZOYWNjLCBvdXQgZmxvYXQgZlByZXZNYWduaXR1ZGUpDQp7DQoJdk5vcmcgPSB2TjsNCgl2TmFjYyA9IHZOOw0KCWZQcmV2TWFnbml0dWRlID0gMS4wOw0KfQ0KDQovKiogaGVscGVyIG1ldGhvZCB0byBleHRyYWN0IHRoZSB1cHBlciBsZWZ0IDN4MyBtYXRyaXggZnJvbSBhIDR4NCBtYXRyaXggKi8NCm1hdDMgdG9fbWF0MyhtYXQ0IG00KQ0Kew0KCW1hdDMgbTM7DQoJbTNbMF0gPSBtNFswXS54eXo7DQoJbTNbMV0gPSBtNFsxXS54eXo7DQoJbTNbMl0gPSBtNFsyXS54eXo7DQoJcmV0dXJuIG0zOw0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9pbml0X29ianNwYWNlKA0KICAgICAgICB2ZWMzIHN1cmZfcG9zLCB2ZWMzIHN1cmZfbm9ybSwNCiAgICAgICAgbWF0NCBtVmlldywgbWF0NCBtVmlld0ludiwgbWF0NCBtT2JqLCBtYXQ0IG1PYmpJbnYsDQogICAgICAgIGZsb2F0IGZQcmV2TWFnbml0dWRlX2luLCB2ZWMzIHZOYWNjX2luLA0KICAgICAgICBvdXQgZmxvYXQgZlByZXZNYWduaXR1ZGVfb3V0LCBvdXQgdmVjMyB2TmFjY19vdXQsDQogICAgICAgIG91dCB2ZWMzIHZSMSwgb3V0IHZlYzMgdlIyLCBvdXQgZmxvYXQgZkRldCkNCnsNCgltYXQzIG9iajJ2aWV3ID0gdG9fbWF0MyhibF9Nb2RlbFZpZXdNYXRyaXgpOw0KCW1hdDMgdmlldzJvYmogPSB0b19tYXQzKGJsX01vZGVsVmlld01hdHJpeEludmVyc2UpOw0KDQoJdmVjMyB2U2lnbWFTID0gdmlldzJvYmogKiBkRmR4KHN1cmZfcG9zKTsNCgl2ZWMzIHZTaWdtYVQgPSB2aWV3Mm9iaiAqIGRGZHkoc3VyZl9wb3MpOw0KCXZlYzMgdk4gPSBub3JtYWxpemUoc3VyZl9ub3JtICogb2JqMnZpZXcpOw0KDQoJdlIxID0gY3Jvc3ModlNpZ21hVCwgdk4pOw0KCXZSMiA9IGNyb3NzKHZOLCB2U2lnbWFTKTsNCglmRGV0ID0gZG90KHZTaWdtYVMsIHZSMSk7DQoNCgkvKiBwcmV0cmFuc2Zvcm0gdk5hY2MgKHZhcnlpbmcgbXRleF9idW1wX2FwcGx5KSB1c2luZyB0aGUgaW52ZXJzZSB0cmFuc3Bvc2VkICovDQoJdlIxID0gdlIxICogdmlldzJvYmo7DQoJdlIyID0gdlIyICogdmlldzJvYmo7DQoJdk4gPSB2TiAqIHZpZXcyb2JqOw0KDQoJZmxvYXQgZk1hZ25pdHVkZSA9IGFicyhmRGV0KSAqIGxlbmd0aCh2Tik7DQoJdk5hY2Nfb3V0ID0gdk5hY2NfaW4gKiAoZk1hZ25pdHVkZSAvIGZQcmV2TWFnbml0dWRlX2luKTsNCglmUHJldk1hZ25pdHVkZV9vdXQgPSBmTWFnbml0dWRlOw0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9pbml0X3RleHR1cmVzcGFjZSgNCiAgICAgICAgdmVjMyBzdXJmX3BvcywgdmVjMyBzdXJmX25vcm0sDQogICAgICAgIGZsb2F0IGZQcmV2TWFnbml0dWRlX2luLCB2ZWMzIHZOYWNjX2luLA0KICAgICAgICBvdXQgZmxvYXQgZlByZXZNYWduaXR1ZGVfb3V0LCBvdXQgdmVjMyB2TmFjY19vdXQsDQogICAgICAgIG91dCB2ZWMzIHZSMSwgb3V0IHZlYzMgdlIyLCBvdXQgZmxvYXQgZkRldCkNCnsNCgl2ZWMzIHZTaWdtYVMgPSBkRmR4KHN1cmZfcG9zKTsNCgl2ZWMzIHZTaWdtYVQgPSBkRmR5KHN1cmZfcG9zKTsNCgl2ZWMzIHZOID0gc3VyZl9ub3JtOyAvKiBub3JtYWxpemVkIGludGVycG9sYXRlZCB2ZXJ0ZXggbm9ybWFsICovDQoNCgl2UjEgPSBub3JtYWxpemUoY3Jvc3ModlNpZ21hVCwgdk4pKTsNCgl2UjIgPSBub3JtYWxpemUoY3Jvc3Modk4sIHZTaWdtYVMpKTsNCglmRGV0ID0gc2lnbihkb3QodlNpZ21hUywgdlIxKSk7DQoNCglmbG9hdCBmTWFnbml0dWRlID0gYWJzKGZEZXQpOw0KCXZOYWNjX291dCA9IHZOYWNjX2luICogKGZNYWduaXR1ZGUgLyBmUHJldk1hZ25pdHVkZV9pbik7DQoJZlByZXZNYWduaXR1ZGVfb3V0ID0gZk1hZ25pdHVkZTsNCn0NCg0Kdm9pZCBtdGV4X2J1bXBfaW5pdF92aWV3c3BhY2UoDQogICAgICAgIHZlYzMgc3VyZl9wb3MsIHZlYzMgc3VyZl9ub3JtLA0KICAgICAgICBmbG9hdCBmUHJldk1hZ25pdHVkZV9pbiwgdmVjMyB2TmFjY19pbiwNCiAgICAgICAgb3V0IGZsb2F0IGZQcmV2TWFnbml0dWRlX291dCwgb3V0IHZlYzMgdk5hY2Nfb3V0LA0KICAgICAgICBvdXQgdmVjMyB2UjEsIG91dCB2ZWMzIHZSMiwgb3V0IGZsb2F0IGZEZXQpDQp7DQoJdmVjMyB2U2lnbWFTID0gZEZkeChzdXJmX3Bvcyk7DQoJdmVjMyB2U2lnbWFUID0gZEZkeShzdXJmX3Bvcyk7DQoJdmVjMyB2TiA9IHN1cmZfbm9ybTsgLyogbm9ybWFsaXplZCBpbnRlcnBvbGF0ZWQgdmVydGV4IG5vcm1hbCAqLw0KDQoJdlIxID0gY3Jvc3ModlNpZ21hVCwgdk4pOw0KCXZSMiA9IGNyb3NzKHZOLCB2U2lnbWFTKTsNCglmRGV0ID0gZG90KHZTaWdtYVMsIHZSMSk7DQoNCglmbG9hdCBmTWFnbml0dWRlID0gYWJzKGZEZXQpOw0KCXZOYWNjX291dCA9IHZOYWNjX2luICogKGZNYWduaXR1ZGUgLyBmUHJldk1hZ25pdHVkZV9pbik7DQoJZlByZXZNYWduaXR1ZGVfb3V0ID0gZk1hZ25pdHVkZTsNCn0NCg0Kdm9pZCBtdGV4X2J1bXBfdGFwMygNCiAgICAgICAgdmVjMyB0ZXhjbywgc2FtcGxlcjJEIGltYSwgZmxvYXQgaFNjYWxlLA0KICAgICAgICBvdXQgZmxvYXQgZEJzLCBvdXQgZmxvYXQgZEJ0KQ0Kew0KCXZlYzIgU1RsbCA9IHRleGNvLnh5Ow0KCXZlYzIgU1RsciA9IHRleGNvLnh5ICsgZEZkeCh0ZXhjby54eSk7DQoJdmVjMiBTVHVsID0gdGV4Y28ueHkgKyBkRmR5KHRleGNvLnh5KTsNCg0KCWZsb2F0IEhsbCwgSGxyLCBIdWw7DQoJcmdidG9idyh0ZXh0dXJlMkQoaW1hLCBTVGxsKSwgSGxsKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUbHIpLCBIbHIpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1R1bCksIEh1bCk7DQoNCglkQnMgPSBoU2NhbGUgKiAoSGxyIC0gSGxsKTsNCglkQnQgPSBoU2NhbGUgKiAoSHVsIC0gSGxsKTsNCn0NCg0KI2lmZGVmIEJVTVBfQklDVUJJQw0KDQp2b2lkIG10ZXhfYnVtcF9iaWN1YmljKA0KICAgICAgICB2ZWMzIHRleGNvLCBzYW1wbGVyMkQgaW1hLCBmbG9hdCBoU2NhbGUsDQogICAgICAgIG91dCBmbG9hdCBkQnMsIG91dCBmbG9hdCBkQnQgKQ0Kew0KCWZsb2F0IEhsOw0KCWZsb2F0IEhyOw0KCWZsb2F0IEhkOw0KCWZsb2F0IEh1Ow0KDQoJdmVjMiBUZXhEeCA9IGRGZHgodGV4Y28ueHkpOw0KCXZlYzIgVGV4RHkgPSBkRmR5KHRleGNvLnh5KTsNCg0KCXZlYzIgU1RsID0gdGV4Y28ueHkgLSAwLjUgKiBUZXhEeDsNCgl2ZWMyIFNUciA9IHRleGNvLnh5ICsgMC41ICogVGV4RHg7DQoJdmVjMiBTVGQgPSB0ZXhjby54eSAtIDAuNSAqIFRleER5Ow0KCXZlYzIgU1R1ID0gdGV4Y28ueHkgKyAwLjUgKiBUZXhEeTsNCg0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1RsKSwgSGwpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1RyKSwgSHIpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1RkKSwgSGQpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1R1KSwgSHUpOw0KDQoJdmVjMiBkSGR4eSA9IHZlYzIoSHIgLSBIbCwgSHUgLSBIZCk7DQoJZmxvYXQgZkJsZW5kID0gY2xhbXAoMS4wIC0gdGV4dHVyZVF1ZXJ5TE9EKGltYSwgdGV4Y28ueHkpLngsIDAuMCwgMS4wKTsNCglpZiAoZkJsZW5kICE9IDAuMCkgew0KCQkvLyB0aGUgZGVyaXZhdGl2ZSBvZiB0aGUgYmljdWJpYyBzYW1wbGluZyBvZiBsZXZlbCAwDQoJCWl2ZWMyIHZEaW07DQoJCXZEaW0gPSB0ZXh0dXJlU2l6ZShpbWEsIDApOw0KDQoJCS8vIHRha2luZyB0aGUgZnJhY3QgcGFydCBvZiB0aGUgdGV4dHVyZSBjb29yZGluYXRlIGlzIGEgaGFyZGNvZGVkIHdyYXAgbW9kZS4NCgkJLy8gdGhpcyBpcyBhY2NlcHRhYmxlIGFzIHRleHR1cmVzIHVzZSB3cmFwIG1vZGUgZXhjbHVzaXZlbHkgdmFyeWluZyAzRCB2aWV3IGVsc2V3aGVyZSB2YXJ5aW5nIGJsZW5kZXIuDQoJCS8vIHRoaXMgaXMgZG9uZSBzbyB0aGF0IHdlIGNhbiBzdGlsbCBnZXQgYSB2YWxpZCB0ZXhlbCB3aXRoIHV2cyBvdXRzaWRlIHRoZSAwLDEgcmFuZ2UNCgkJLy8gYnkgdGV4ZWxGZXRjaCBiZWxvdywgYXMgY29vcmRpbmF0ZXMgYXJlIGNsYW1wZWQgd2hlbiB1c2luZyB0aGlzIGZ1bmN0aW9uLg0KCQl2ZWMyIGZUZXhMb2MgPSB2RGltICogZnJhY3QodGV4Y28ueHkpIC0gdmVjMigwLjUsIDAuNSk7DQoJCWl2ZWMyIGlUZXhMb2MgPSBpdmVjMihmbG9vcihmVGV4TG9jKSk7DQoJCXZlYzIgdCA9IGNsYW1wKGZUZXhMb2MgLSBpVGV4TG9jLCAwLjAsIDEuMCk7ICAgICAgICAvLyBzYXQganVzdCB0byBiZSBwZWRhbnRpYw0KDQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICogVGhpcyBibG9jayB3aWxsIHJlcGxhY2UgdGhlIG9uZSBiZWxvdyB3aGVuIG9uZSBjaGFubmVsIHRleHR1cmVzIGFyZSBwcm9wZXJseSBzdXBwb3J0ZWQuICoNCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoJCXZlYzQgdlNhbXBsZXNVTCA9IHRleHR1cmVHYXRoZXIoaW1hLCAoaVRleExvYytpdmVjMigtMSwtMSkgKyB2ZWMyKDAuNSwwLjUpKS92RGltKTsNCgkJdmVjNCB2U2FtcGxlc1VSID0gdGV4dHVyZUdhdGhlcihpbWEsIChpVGV4TG9jK2l2ZWMyKDEsLTEpICsgdmVjMigwLjUsMC41KSkvdkRpbSk7DQoJCXZlYzQgdlNhbXBsZXNMTCA9IHRleHR1cmVHYXRoZXIoaW1hLCAoaVRleExvYytpdmVjMigtMSwxKSArIHZlYzIoMC41LDAuNSkpL3ZEaW0pOw0KCQl2ZWM0IHZTYW1wbGVzTFIgPSB0ZXh0dXJlR2F0aGVyKGltYSwgKGlUZXhMb2MraXZlYzIoMSwxKSArIHZlYzIoMC41LDAuNSkpL3ZEaW0pOw0KDQoJCW1hdDQgSCA9IG1hdDQodlNhbXBsZXNVTC53LCB2U2FtcGxlc1VMLngsIHZTYW1wbGVzTEwudywgdlNhbXBsZXNMTC54LA0KCQkgICAgICAgICAgICB2U2FtcGxlc1VMLnosIHZTYW1wbGVzVUwueSwgdlNhbXBsZXNMTC56LCB2U2FtcGxlc0xMLnksDQoJCSAgICAgICAgICAgIHZTYW1wbGVzVVIudywgdlNhbXBsZXNVUi54LCB2U2FtcGxlc0xSLncsIHZTYW1wbGVzTFIueCwNCgkJICAgICAgICAgICAgdlNhbXBsZXNVUi56LCB2U2FtcGxlc1VSLnksIHZTYW1wbGVzTFIueiwgdlNhbXBsZXNMUi55KTsNCiAqLw0KCQlpdmVjMiBpVGV4TG9jTW9kID0gaVRleExvYyArIGl2ZWMyKC0xLCAtMSk7DQoNCgkJbWF0NCBIOw0KDQoJCWZvciAoaW50IGkgPSAwOyBpIDwgNDsgaSsrKSB7DQoJCQlmb3IgKGludCBqID0gMDsgaiA8IDQ7IGorKykgew0KCQkJCWl2ZWMyIGlUZXhUbXAgPSBpVGV4TG9jTW9kICsgaXZlYzIoaSwgaik7DQoNCgkJCQkvLyB3cmFwIHRleHR1cmUgY29vcmRpbmF0ZXMgbWFudWFsbHkgZm9yIHRleGVsRmV0Y2ggdG8gd29yayBvbiB1dnMgb2l0c2lkZSB0aGUgMCwxIHJhbmdlLg0KCQkJCS8vIHRoaXMgaXMgZ3VhcmFudGVlZCB0byB3b3JrIHNpbmNlIHdlIHRha2UgdGhlIGZyYWN0aW9uYWwgcGFydCBvZiB0aGUgdXYgYWJvdmUuDQoJCQkJaVRleFRtcC54ID0gKGlUZXhUbXAueCA8IDApID8gaVRleFRtcC54ICsgdkRpbS54IDogKChpVGV4VG1wLnggPj0gdkRpbS54KSA/IGlUZXhUbXAueCAtIHZEaW0ueCA6IGlUZXhUbXAueCk7DQoJCQkJaVRleFRtcC55ID0gKGlUZXhUbXAueSA8IDApID8gaVRleFRtcC55ICsgdkRpbS55IDogKChpVGV4VG1wLnkgPj0gdkRpbS55KSA/IGlUZXhUbXAueSAtIHZEaW0ueSA6IGlUZXhUbXAueSk7DQoNCgkJCQlyZ2J0b2J3KHRleGVsRmV0Y2goaW1hLCBpVGV4VG1wLCAwKSwgSFtpXVtqXSk7DQoJCQl9DQoJCX0NCg0KCQlmbG9hdCB4ID0gdC54LCB5ID0gdC55Ow0KCQlmbG9hdCB4MiA9IHggKiB4LCB4MyA9IHgyICogeCwgeTIgPSB5ICogeSwgeTMgPSB5MiAqIHk7DQoNCgkJdmVjNCBYICA9IHZlYzQoLTAuNSAqICh4MyArIHgpICsgeDIsICAgIDEuNSAqIHgzIC0gMi41ICogeDIgKyAxLCAtMS41ICogeDMgKyAyICogeDIgKyAwLjUgKiB4LCAwLjUgKiAoeDMgLSB4MikpOw0KCQl2ZWM0IFkgID0gdmVjNCgtMC41ICogKHkzICsgeSkgKyB5MiwgICAgMS41ICogeTMgLSAyLjUgKiB5MiArIDEsIC0xLjUgKiB5MyArIDIgKiB5MiArIDAuNSAqIHksIDAuNSAqICh5MyAtIHkyKSk7DQoJCXZlYzQgZFggPSB2ZWM0KC0xLjUgKiB4MiArIDIgKiB4IC0gMC41LCA0LjUgKiB4MiAtIDUgKiB4LCAgICAgICAgLTQuNSAqIHgyICsgNCAqIHggKyAwLjUsICAgICAgMS41ICogeDIgLSB4KTsNCgkJdmVjNCBkWSA9IHZlYzQoLTEuNSAqIHkyICsgMiAqIHkgLSAwLjUsIDQuNSAqIHkyIC0gNSAqIHksICAgICAgICAtNC41ICogeTIgKyA0ICogeSArIDAuNSwgICAgICAxLjUgKiB5MiAtIHkpOw0KDQoJCS8vIGNvbXBsZXRlIGRlcml2YXRpdmUgdmFyeWluZyBub3JtYWxpemVkIGNvb3JkaW5hdGVzIChtdWwgYnkgdkRpbSkNCgkJdmVjMiBkSGRTVCA9IHZEaW0gKiB2ZWMyKGRvdChZLCBIICogZFgpLCBkb3QoZFksIEggKiBYKSk7DQoNCgkJLy8gdHJhbnNmb3JtIGRlcml2YXRpdmUgdG8gc2NyZWVuLXNwYWNlDQoJCXZlYzIgZEhkeHlfYmljdWJpYyA9IHZlYzIoZEhkU1QueCAqIFRleER4LnggKyBkSGRTVC55ICogVGV4RHgueSwNCgkJICAgICAgICAgICAgICAgICAgICAgICAgICBkSGRTVC54ICogVGV4RHkueCArIGRIZFNULnkgKiBUZXhEeS55KTsNCg0KCQkvLyBibGVuZCBiZXR3ZWVuIHRoZSB0d28NCgkJZEhkeHkgPSBkSGR4eSAqICgxIC0gZkJsZW5kKSArIGRIZHh5X2JpY3ViaWMgKiBmQmxlbmQ7DQoJfQ0KDQoJZEJzID0gaFNjYWxlICogZEhkeHkueDsNCglkQnQgPSBoU2NhbGUgKiBkSGR4eS55Ow0KfQ0KDQojZW5kaWYNCg0Kdm9pZCBtdGV4X2J1bXBfdGFwNSgNCiAgICAgICAgdmVjMyB0ZXhjbywgc2FtcGxlcjJEIGltYSwgZmxvYXQgaFNjYWxlLA0KICAgICAgICBvdXQgZmxvYXQgZEJzLCBvdXQgZmxvYXQgZEJ0KQ0Kew0KCXZlYzIgVGV4RHggPSBkRmR4KHRleGNvLnh5KTsNCgl2ZWMyIFRleER5ID0gZEZkeSh0ZXhjby54eSk7DQoNCgl2ZWMyIFNUYyA9IHRleGNvLnh5Ow0KCXZlYzIgU1RsID0gdGV4Y28ueHkgLSAwLjUgKiBUZXhEeDsNCgl2ZWMyIFNUciA9IHRleGNvLnh5ICsgMC41ICogVGV4RHg7DQoJdmVjMiBTVGQgPSB0ZXhjby54eSAtIDAuNSAqIFRleER5Ow0KCXZlYzIgU1R1ID0gdGV4Y28ueHkgKyAwLjUgKiBUZXhEeTsNCg0KCWZsb2F0IEhjLCBIbCwgSHIsIEhkLCBIdTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUYyksIEhjKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUbCksIEhsKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUciksIEhyKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUZCksIEhkKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUdSksIEh1KTsNCg0KCWRCcyA9IGhTY2FsZSAqIChIciAtIEhsKTsNCglkQnQgPSBoU2NhbGUgKiAoSHUgLSBIZCk7DQp9DQoNCnZvaWQgbXRleF9idW1wX2Rlcml2KA0KICAgICAgICB2ZWMzIHRleGNvLCBzYW1wbGVyMkQgaW1hLCBmbG9hdCBpbWFfeCwgZmxvYXQgaW1hX3ksIGZsb2F0IGhTY2FsZSwNCiAgICAgICAgb3V0IGZsb2F0IGRCcywgb3V0IGZsb2F0IGRCdCkNCnsNCglmbG9hdCBzID0gMS4wOyAgICAgIC8vIG5lZ2F0ZSB0aGlzIGlmIGZsaXBwZWQgdGV4dHVyZSBjb29yZGluYXRlDQoJdmVjMiBUZXhEeCA9IGRGZHgodGV4Y28ueHkpOw0KCXZlYzIgVGV4RHkgPSBkRmR5KHRleGNvLnh5KTsNCg0KCS8vIHRoaXMgdmFyaWFudCB1c2luZyBhIGRlcml2YXRpdmUgbWFwIGlzIGRlc2NyaWJlZCBoZXJlDQoJLy8gaHR0cDovL21taWtrZWxzZW4zZC5ibG9nc3BvdC5jb20vMjAxMS8wNy9kZXJpdmF0aXZlLW1hcHMuaHRtbA0KCXZlYzIgZGltID0gdmVjMihpbWFfeCwgaW1hX3kpOw0KCXZlYzIgZEJkdXYgPSBoU2NhbGUgKiBkaW0gKiAoMi4wICogdGV4dHVyZTJEKGltYSwgdGV4Y28ueHkpLnh5IC0gMS4wKTsNCg0KCWRCcyA9IGRCZHV2LnggKiBUZXhEeC54ICsgcyAqIGRCZHV2LnkgKiBUZXhEeC55Ow0KCWRCdCA9IGRCZHV2LnggKiBUZXhEeS54ICsgcyAqIGRCZHV2LnkgKiBUZXhEeS55Ow0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9hcHBseSgNCiAgICAgICAgZmxvYXQgZkRldCwgZmxvYXQgZEJzLCBmbG9hdCBkQnQsIHZlYzMgdlIxLCB2ZWMzIHZSMiwgdmVjMyB2TmFjY19pbiwNCiAgICAgICAgb3V0IHZlYzMgdk5hY2Nfb3V0LCBvdXQgdmVjMyBwZXJ0dXJiZWRfbm9ybSkNCnsNCgl2ZWMzIHZTdXJmR3JhZCA9IHNpZ24oZkRldCkgKiAoZEJzICogdlIxICsgZEJ0ICogdlIyKTsNCg0KCXZOYWNjX291dCA9IHZOYWNjX2luIC0gdlN1cmZHcmFkOw0KCXBlcnR1cmJlZF9ub3JtID0gbm9ybWFsaXplKHZOYWNjX291dCk7DQp9DQoNCnZvaWQgbXRleF9idW1wX2FwcGx5X3RleHNwYWNlKA0KICAgICAgICBmbG9hdCBmRGV0LCBmbG9hdCBkQnMsIGZsb2F0IGRCdCwgdmVjMyB2UjEsIHZlYzMgdlIyLA0KICAgICAgICBzYW1wbGVyMkQgaW1hLCB2ZWMzIHRleGNvLCBmbG9hdCBpbWFfeCwgZmxvYXQgaW1hX3ksIHZlYzMgdk5hY2NfaW4sDQogICAgICAgIG91dCB2ZWMzIHZOYWNjX291dCwgb3V0IHZlYzMgcGVydHVyYmVkX25vcm0pDQp7DQoJdmVjMiBUZXhEeCA9IGRGZHgodGV4Y28ueHkpOw0KCXZlYzIgVGV4RHkgPSBkRmR5KHRleGNvLnh5KTsNCg0KCXZlYzMgdlN1cmZHcmFkID0gc2lnbihmRGV0KSAqICgNCgkgICAgICAgIGRCcyAvIGxlbmd0aCh2ZWMyKGltYV94ICogVGV4RHgueCwgaW1hX3kgKiBUZXhEeC55KSkgKiB2UjEgKw0KCSAgICAgICAgZEJ0IC8gbGVuZ3RoKHZlYzIoaW1hX3ggKiBUZXhEeS54LCBpbWFfeSAqIFRleER5LnkpKSAqIHZSMik7DQoNCgl2TmFjY19vdXQgPSB2TmFjY19pbiAtIHZTdXJmR3JhZDsNCglwZXJ0dXJiZWRfbm9ybSA9IG5vcm1hbGl6ZSh2TmFjY19vdXQpOw0KfQ0KDQp2b2lkIG10ZXhfbmVnYXRlX3RleG5vcm1hbCh2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCW91dG5vcm1hbCA9IHZlYzMoLW5vcm1hbC54LCAtbm9ybWFsLnksIG5vcm1hbC56KTsNCn0NCg0Kdm9pZCBtdGV4X25zcGFjZV90YW5nZW50KHZlYzQgdGFuZ2VudCwgdmVjMyBub3JtYWwsIHZlYzMgdGV4bm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJdmVjMyBCID0gdGFuZ2VudC53ICogY3Jvc3Mobm9ybWFsLCB0YW5nZW50Lnh5eik7DQoNCglvdXRub3JtYWwgPSB0ZXhub3JtYWwueCAqIHRhbmdlbnQueHl6ICsgdGV4bm9ybWFsLnkgKiBCICsgdGV4bm9ybWFsLnogKiBub3JtYWw7DQoJb3V0bm9ybWFsID0gbm9ybWFsaXplKG91dG5vcm1hbCk7DQp9DQoNCnZvaWQgbXRleF9uc3BhY2Vfd29ybGQobWF0NCB2aWV3bWF0LCB2ZWMzIHRleG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZSgodmlld21hdCAqIHZlYzQodGV4bm9ybWFsLCAwLjApKS54eXopOw0KfQ0KDQp2b2lkIG10ZXhfbnNwYWNlX29iamVjdCh2ZWMzIHRleG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZShibF9Ob3JtYWxNYXRyaXggKiB0ZXhub3JtYWwpOw0KfQ0KDQp2b2lkIG10ZXhfYmxlbmRfbm9ybWFsKGZsb2F0IG5vcmZhYywgdmVjMyBub3JtYWwsIHZlYzMgbmV3bm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJb3V0bm9ybWFsID0gKDEuMCAtIG5vcmZhYykgKiBub3JtYWwgKyBub3JmYWMgKiBuZXdub3JtYWw7DQoJb3V0bm9ybWFsID0gbm9ybWFsaXplKG91dG5vcm1hbCk7DQp9DQoNCi8qKioqKioqIE1BVEVSSUFMICoqKioqKioqKi8NCg0Kdm9pZCBsYW1wX3Zpc2liaWxpdHlfc3VuX2hlbWkodmVjMyBsYW1wdmVjLCBvdXQgdmVjMyBsdiwgb3V0IGZsb2F0IGRpc3QsIG91dCBmbG9hdCB2aXNpZmFjKQ0Kew0KCWx2ID0gbGFtcHZlYzsNCglkaXN0ID0gMS4wOw0KCXZpc2lmYWMgPSAxLjA7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X290aGVyKHZlYzMgY28sIHZlYzMgbGFtcGNvLCBvdXQgdmVjMyBsdiwgb3V0IGZsb2F0IGRpc3QsIG91dCBmbG9hdCB2aXNpZmFjKQ0Kew0KCWx2ID0gY28gLSBsYW1wY287DQoJZGlzdCA9IGxlbmd0aChsdik7DQoJbHYgPSBub3JtYWxpemUobHYpOw0KCXZpc2lmYWMgPSAxLjA7DQp9DQoNCnZvaWQgbGFtcF9mYWxsb2ZmX2ludmxpbmVhcihmbG9hdCBsYW1wZGlzdCwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJdmlzaWZhYyA9IGxhbXBkaXN0IC8gKGxhbXBkaXN0ICsgZGlzdCk7DQp9DQoNCnZvaWQgbGFtcF9mYWxsb2ZmX2ludnNxdWFyZShmbG9hdCBsYW1wZGlzdCwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJdmlzaWZhYyA9IGxhbXBkaXN0IC8gKGxhbXBkaXN0ICsgZGlzdCAqIGRpc3QpOw0KfQ0KDQp2b2lkIGxhbXBfZmFsbG9mZl9zbGlkZXJzKGZsb2F0IGxhbXBkaXN0LCBmbG9hdCBsZDEsIGZsb2F0IGxkMiwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJZmxvYXQgbGFtcGRpc3RrdyA9IGxhbXBkaXN0ICogbGFtcGRpc3Q7DQoNCgl2aXNpZmFjID0gbGFtcGRpc3QgLyAobGFtcGRpc3QgKyBsZDEgKiBkaXN0KTsNCgl2aXNpZmFjICo9IGxhbXBkaXN0a3cgLyAobGFtcGRpc3RrdyArIGxkMiAqIGRpc3QgKiBkaXN0KTsNCn0NCg0Kdm9pZCBsYW1wX2ZhbGxvZmZfaW52Y29lZmZpY2llbnRzKGZsb2F0IGNvZWZmX2NvbnN0LCBmbG9hdCBjb2VmZl9saW4sIGZsb2F0IGNvZWZmX3F1YWQsIGZsb2F0IGRpc3QsIG91dCBmbG9hdCB2aXNpZmFjKQ0Kew0KCXZlYzMgY29lZmYgPSB2ZWMzKGNvZWZmX2NvbnN0LCBjb2VmZl9saW4sIGNvZWZmX3F1YWQpOw0KCXZlYzMgZF9jb2VmZiA9IHZlYzMoMS4wLCBkaXN0LCBkaXN0ICogZGlzdCk7DQoJZmxvYXQgdmlzaWZhY19yID0gZG90KGNvZWZmLCBkX2NvZWZmKTsNCglpZiAodmlzaWZhY19yID4gMC4wKQ0KCQl2aXNpZmFjID0gMS4wIC8gdmlzaWZhY19yOw0KCWVsc2UNCgkJdmlzaWZhYyA9IDAuMDsNCn0NCg0Kdm9pZCBsYW1wX2ZhbGxvZmZfY3VydmUoZmxvYXQgbGFtcGRpc3QsIHNhbXBsZXIyRCBjdXJ2ZW1hcCwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJdmlzaWZhYyA9IHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMihkaXN0IC8gbGFtcGRpc3QsIDAuMCkpLng7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X3NwaGVyZShmbG9hdCBsYW1wZGlzdCwgZmxvYXQgZGlzdCwgZmxvYXQgdmlzaWZhYywgb3V0IGZsb2F0IG91dHZpc2lmYWMpDQp7DQoJZmxvYXQgdCA9IGxhbXBkaXN0IC0gZGlzdDsNCg0KCW91dHZpc2lmYWMgPSB2aXNpZmFjICogbWF4KHQsIDAuMCkgLyBsYW1wZGlzdDsNCn0NCg0Kdm9pZCBsYW1wX3Zpc2liaWxpdHlfc3BvdF9zcXVhcmUodmVjMyBsYW1wdmVjLCBtYXQ0IGxhbXBpbWF0LCB2ZWMyIHNjYWxlLCB2ZWMzIGx2LCBvdXQgZmxvYXQgaW5wcikNCnsNCglpZiAoZG90KGx2LCBsYW1wdmVjKSA+IDAuMCkgew0KCQl2ZWMzIGx2cm90ID0gKGxhbXBpbWF0ICogdmVjNChsdiwgMC4wKSkueHl6Ow0KCQkvKiB3aXRob3V0IGNsZXZlciBub24tdW5pZm9ybSBzY2FsZSwgd2UgY291bGQgZG86ICovDQoJCS8vIGZsb2F0IHggPSBtYXgoYWJzKGx2cm90LnggLyBsdnJvdC56KSwgYWJzKGx2cm90LnkgLyBsdnJvdC56KSk7DQoJCWZsb2F0IHggPSBtYXgoYWJzKChsdnJvdC54IC8gc2NhbGUueCkgLyBsdnJvdC56KSwgYWJzKChsdnJvdC55IC8gc2NhbGUueSkgLyBsdnJvdC56KSk7DQoNCgkJaW5wciA9IDEuMCAvIHNxcnQoMS4wICsgeCAqIHgpOw0KCX0NCgllbHNlDQoJCWlucHIgPSAwLjA7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X3Nwb3RfY2lyY2xlKHZlYzMgbGFtcHZlYywgbWF0NCBsYW1waW1hdCwgdmVjMiBzY2FsZSwgdmVjMyBsdiwgb3V0IGZsb2F0IGlucHIpDQp7DQoJLyogd2l0aG91dCBjbGV2ZXIgbm9uLXVuaWZvcm0gc2NhbGUsIHdlIGNvdWxkIGRvOiAqLw0KCS8vIGlucHIgPSBkb3QobHYsIGxhbXB2ZWMpOw0KCWlmIChkb3QobHYsIGxhbXB2ZWMpID4gMC4wKSB7DQoJCXZlYzMgbHZyb3QgPSAobGFtcGltYXQgKiB2ZWM0KGx2LCAwLjApKS54eXo7DQoJCWZsb2F0IHggPSBhYnMobHZyb3QueCAvIGx2cm90LnopOw0KCQlmbG9hdCB5ID0gYWJzKGx2cm90LnkgLyBsdnJvdC56KTsNCg0KCQlmbG9hdCBlbGxpcHNlID0gYWJzKCh4ICogeCkgLyAoc2NhbGUueCAqIHNjYWxlLngpICsgKHkgKiB5KSAvIChzY2FsZS55ICogc2NhbGUueSkpOw0KDQoJCWlucHIgPSAxLjAgLyBzcXJ0KDEuMCArIGVsbGlwc2UpOw0KCX0NCgllbHNlDQoJCWlucHIgPSAwLjA7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X3Nwb3QoZmxvYXQgc3BvdHNpLCBmbG9hdCBzcG90YmwsIGZsb2F0IGlucHIsIGZsb2F0IHZpc2lmYWMsIG91dCBmbG9hdCBvdXR2aXNpZmFjKQ0Kew0KCWZsb2F0IHQgPSBzcG90c2k7DQoNCglpZiAoaW5wciA8PSB0KSB7DQoJCW91dHZpc2lmYWMgPSAwLjA7DQoJfQ0KCWVsc2Ugew0KCQl0ID0gaW5wciAtIHQ7DQoNCgkJLyogc29mdCBhcmVhICovDQoJCWlmIChzcG90YmwgIT0gMC4wKQ0KCQkJaW5wciAqPSBzbW9vdGhzdGVwKDAuMCwgMS4wLCB0IC8gc3BvdGJsKTsNCg0KCQlvdXR2aXNpZmFjID0gdmlzaWZhYyAqIGlucHI7DQoJfQ0KfQ0KDQp2b2lkIGxhbXBfdmlzaWJpbGl0eV9jbGFtcChmbG9hdCB2aXNpZmFjLCBvdXQgZmxvYXQgb3V0dmlzaWZhYykNCnsNCglvdXR2aXNpZmFjID0gKHZpc2lmYWMgPCAwLjAwMSkgPyAwLjAgOiB2aXNpZmFjOw0KfQ0KDQp2b2lkIHdvcmxkX3BhcGVyX3ZpZXcodmVjMyB2ZWMsIG91dCB2ZWMzIG91dHZlYykNCnsNCgl2ZWMzIG52ZWMgPSBub3JtYWxpemUodmVjKTsNCglvdXR2ZWMgPSAoYmxfUHJvamVjdGlvbk1hdHJpeFszXVszXSA9PSAwLjApID8gdmVjMyhudmVjLngsIDAuMCwgbnZlYy55KSA6IHZlYzMoMC4wLCAwLjAsIC0xLjApOw0KfQ0KDQp2b2lkIHdvcmxkX3plbl9tYXBwaW5nKHZlYzMgdmlldywgZmxvYXQgemVudXAsIGZsb2F0IHplbmRvd24sIG91dCBmbG9hdCB6ZW5mYWMpDQp7DQoJaWYgKHZpZXcueiA+PSAwLjApDQoJCXplbmZhYyA9IHplbnVwOw0KCWVsc2UNCgkJemVuZmFjID0gemVuZG93bjsNCn0NCg0Kdm9pZCB3b3JsZF9ibGVuZF9wYXBlcl9yZWFsKHZlYzMgdmVjLCBvdXQgZmxvYXQgYmxlbmQpDQp7DQoJYmxlbmQgPSBhYnModmVjLnkpOw0KfQ0KDQp2b2lkIHdvcmxkX2JsZW5kX3BhcGVyKHZlYzMgdmVjLCBvdXQgZmxvYXQgYmxlbmQpDQp7DQoJYmxlbmQgPSAodmVjLnkgKyAxLjApICogMC41Ow0KfQ0KDQp2b2lkIHdvcmxkX2JsZW5kX3JlYWwodmVjMyB2ZWMsIG91dCBmbG9hdCBibGVuZCkNCnsNCglibGVuZCA9IGFicyhub3JtYWxpemUodmVjKS56KTsNCn0NCg0Kdm9pZCB3b3JsZF9ibGVuZCh2ZWMzIHZlYywgb3V0IGZsb2F0IGJsZW5kKQ0Kew0KCWJsZW5kID0gKG5vcm1hbGl6ZSh2ZWMpLnogKyAxLjApICogMC41Ow0KfQ0KDQp2b2lkIHNoYWRlX3ZpZXcodmVjMyBjbywgb3V0IHZlYzMgdmlldykNCnsNCgkvKiBoYW5kbGUgcGVyc3BlY3RpdmUvb3J0aG9ncmFwaGljICovDQoJdmlldyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPyBub3JtYWxpemUoY28pIDogdmVjMygwLjAsIDAuMCwgLTEuMCk7DQp9DQoNCnZvaWQgc2hhZGVfdGFuZ2VudF92KHZlYzMgbHYsIHZlYzMgdGFuZywgb3V0IHZlYzMgdm4pDQp7DQoJdmVjMyBjID0gY3Jvc3MobHYsIHRhbmcpOw0KCXZlYzMgdm5vciA9IGNyb3NzKGMsIHRhbmcpOw0KDQoJdm4gPSAtbm9ybWFsaXplKHZub3IpOw0KfQ0KDQp2b2lkIHNoYWRlX2lucCh2ZWMzIHZuLCB2ZWMzIGx2LCBvdXQgZmxvYXQgaW5wKQ0Kew0KCWlucCA9IGRvdCh2biwgbHYpOw0KfQ0KDQp2b2lkIHNoYWRlX2lzX25vX2RpZmZ1c2Uob3V0IGZsb2F0IGlzKQ0Kew0KCWlzID0gMC4wOw0KfQ0KDQp2b2lkIHNoYWRlX2lzX2hlbWkoZmxvYXQgaW5wLCBvdXQgZmxvYXQgaXMpDQp7DQoJaXMgPSAwLjUgKiBpbnAgKyAwLjU7DQp9DQoNCmZsb2F0IGFyZWFfbGFtcF9lbmVyZ3kobWF0NCBhcmVhLCB2ZWMzIGNvLCB2ZWMzIHZuKQ0Kew0KCXZlYzMgdmVjWzRdLCBjWzRdOw0KCWZsb2F0IHJhZFs0XSwgZmFjOw0KDQoJdmVjWzBdID0gbm9ybWFsaXplKGNvIC0gYXJlYVswXS54eXopOw0KCXZlY1sxXSA9IG5vcm1hbGl6ZShjbyAtIGFyZWFbMV0ueHl6KTsNCgl2ZWNbMl0gPSBub3JtYWxpemUoY28gLSBhcmVhWzJdLnh5eik7DQoJdmVjWzNdID0gbm9ybWFsaXplKGNvIC0gYXJlYVszXS54eXopOw0KDQoJY1swXSA9IG5vcm1hbGl6ZShjcm9zcyh2ZWNbMF0sIHZlY1sxXSkpOw0KCWNbMV0gPSBub3JtYWxpemUoY3Jvc3ModmVjWzFdLCB2ZWNbMl0pKTsNCgljWzJdID0gbm9ybWFsaXplKGNyb3NzKHZlY1syXSwgdmVjWzNdKSk7DQoJY1szXSA9IG5vcm1hbGl6ZShjcm9zcyh2ZWNbM10sIHZlY1swXSkpOw0KDQoJcmFkWzBdID0gYWNvcyhkb3QodmVjWzBdLCB2ZWNbMV0pKTsNCglyYWRbMV0gPSBhY29zKGRvdCh2ZWNbMV0sIHZlY1syXSkpOw0KCXJhZFsyXSA9IGFjb3MoZG90KHZlY1syXSwgdmVjWzNdKSk7DQoJcmFkWzNdID0gYWNvcyhkb3QodmVjWzNdLCB2ZWNbMF0pKTsNCg0KCWZhYyA9ICByYWRbMF0gKiBkb3Qodm4sIGNbMF0pOw0KCWZhYyArPSByYWRbMV0gKiBkb3Qodm4sIGNbMV0pOw0KCWZhYyArPSByYWRbMl0gKiBkb3Qodm4sIGNbMl0pOw0KCWZhYyArPSByYWRbM10gKiBkb3Qodm4sIGNbM10pOw0KDQoJcmV0dXJuIG1heChmYWMsIDAuMCk7DQp9DQoNCnZvaWQgc2hhZGVfaW5wX2FyZWEoDQogICAgICAgIHZlYzMgcG9zaXRpb24sIHZlYzMgbGFtcGNvLCB2ZWMzIGxhbXB2ZWMsIHZlYzMgdm4sIG1hdDQgYXJlYSwgZmxvYXQgYXJlYXNpemUsIGZsb2F0IGssDQogICAgICAgIG91dCBmbG9hdCBpbnApDQp7DQoJdmVjMyBjbyA9IHBvc2l0aW9uOw0KCXZlYzMgdmVjID0gY28gLSBsYW1wY287DQoNCglpZiAoZG90KHZlYywgbGFtcHZlYykgPCAwLjApIHsNCgkJaW5wID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJZmxvYXQgaW50ZW5zID0gYXJlYV9sYW1wX2VuZXJneShhcmVhLCBjbywgdm4pOw0KDQoJCWlucCA9IHBvdyhpbnRlbnMgKiBhcmVhc2l6ZSwgayk7DQoJfQ0KfQ0KDQp2b2lkIHNoYWRlX2RpZmZ1c2Vfb3Jlbl9uYXllcihmbG9hdCBubCwgdmVjMyBuLCB2ZWMzIGwsIHZlYzMgdiwgZmxvYXQgcm91Z2gsIG91dCBmbG9hdCBpcykNCnsNCgl2ZWMzIGggPSBub3JtYWxpemUodiArIGwpOw0KCWZsb2F0IG5oID0gbWF4KGRvdChuLCBoKSwgMC4wKTsNCglmbG9hdCBudiA9IG1heChkb3QobiwgdiksIDAuMCk7DQoJZmxvYXQgcmVhbG5sID0gZG90KG4sIGwpOw0KDQoJaWYgKHJlYWxubCA8IDAuMCkgew0KCQlpcyA9IDAuMDsNCgl9DQoJZWxzZSBpZiAobmwgPCAwLjApIHsNCgkJaXMgPSAwLjA7DQoJfQ0KCWVsc2Ugew0KCQlmbG9hdCB2aCA9IG1heChkb3QodiwgaCksIDAuMCk7DQoJCWZsb2F0IExpdF9BID0gYWNvcyhyZWFsbmwpOw0KCQlmbG9hdCBWaWV3X0EgPSBhY29zKG52KTsNCg0KCQl2ZWMzIExpdF9CID0gbm9ybWFsaXplKGwgLSByZWFsbmwgKiBuKTsNCgkJdmVjMyBWaWV3X0IgPSBub3JtYWxpemUodiAtIG52ICogbik7DQoNCgkJZmxvYXQgdCA9IG1heChkb3QoTGl0X0IsIFZpZXdfQiksIDAuMCk7DQoNCgkJZmxvYXQgYSwgYjsNCg0KCQlpZiAoTGl0X0EgPiBWaWV3X0EpIHsNCgkJCWEgPSBMaXRfQTsNCgkJCWIgPSBWaWV3X0E7DQoJCX0NCgkJZWxzZSB7DQoJCQlhID0gVmlld19BOw0KCQkJYiA9IExpdF9BOw0KCQl9DQoNCgkJZmxvYXQgQSA9IDEuMCAtICgwLjUgKiAoKHJvdWdoICogcm91Z2gpIC8gKChyb3VnaCAqIHJvdWdoKSArIDAuMzMpKSk7DQoJCWZsb2F0IEIgPSAwLjQ1ICogKChyb3VnaCAqIHJvdWdoKSAvICgocm91Z2ggKiByb3VnaCkgKyAwLjA5KSk7DQoNCgkJYiAqPSAwLjk1Ow0KCQlpcyA9IG5sICogKEEgKyAoQiAqIHQgKiBzaW4oYSkgKiB0YW4oYikpKTsNCgl9DQp9DQoNCnZvaWQgc2hhZGVfZGlmZnVzZV90b29uKHZlYzMgbiwgdmVjMyBsLCB2ZWMzIHYsIGZsb2F0IHNpemUsIGZsb2F0IHRzbW9vdGgsIG91dCBmbG9hdCBpcykNCnsNCglmbG9hdCByc2x0ID0gZG90KG4sIGwpOw0KCWZsb2F0IGFuZyA9IGFjb3MocnNsdCk7DQoNCglpZiAoYW5nIDwgc2l6ZSkgaXMgPSAxLjA7DQoJZWxzZSBpZiAoYW5nID4gKHNpemUgKyB0c21vb3RoKSB8fCB0c21vb3RoID09IDAuMCkgaXMgPSAwLjA7DQoJZWxzZSBpcyA9IDEuMCAtICgoYW5nIC0gc2l6ZSkgLyB0c21vb3RoKTsNCn0NCg0Kdm9pZCBzaGFkZV9kaWZmdXNlX21pbm5hZXJ0KGZsb2F0IG5sLCB2ZWMzIG4sIHZlYzMgdiwgZmxvYXQgZGFya25lc3MsIG91dCBmbG9hdCBpcykNCnsNCglpZiAobmwgPD0gMC4wKSB7DQoJCWlzID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJZmxvYXQgbnYgPSBtYXgoZG90KG4sIHYpLCAwLjApOw0KDQoJCWlmIChkYXJrbmVzcyA8PSAxLjApDQoJCQlpcyA9IG5sICogcG93KG1heChudiAqIG5sLCAwLjEpLCBkYXJrbmVzcyAtIDEuMCk7DQoJCWVsc2UNCgkJCWlzID0gbmwgKiBwb3coMS4wMDAxIC0gbnYsIGRhcmtuZXNzIC0gMS4wKTsNCgl9DQp9DQoNCmZsb2F0IGZyZXNuZWxfZmFjKHZlYzMgdmlldywgdmVjMyB2biwgZmxvYXQgZ3JhZCwgZmxvYXQgZmFjKQ0Kew0KCWZsb2F0IHQxLCB0MjsNCglmbG9hdCBmZmFjOw0KDQoJaWYgKGZhYyA9PSAwLjApIHsNCgkJZmZhYyA9IDEuMDsNCgl9DQoJZWxzZSB7DQoJCXQxID0gZG90KHZpZXcsIHZuKTsNCgkJaWYgKHQxID4gMC4wKSB0MiA9IDEuMCArIHQxOw0KCQllbHNlIHQyID0gMS4wIC0gdDE7DQoNCgkJdDIgPSBncmFkICsgKDEuMCAtIGdyYWQpICogcG93KHQyLCBmYWMpOw0KDQoJCWlmICh0MiA8IDAuMCkgZmZhYyA9IDAuMDsNCgkJZWxzZSBpZiAodDIgPiAxLjApIGZmYWMgPSAxLjA7DQoJCWVsc2UgZmZhYyA9IHQyOw0KCX0NCg0KCXJldHVybiBmZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX2RpZmZ1c2VfZnJlc25lbCh2ZWMzIHZuLCB2ZWMzIGx2LCB2ZWMzIHZpZXcsIGZsb2F0IGZhY19pLCBmbG9hdCBmYWMsIG91dCBmbG9hdCBpcykNCnsNCglpcyA9IGZyZXNuZWxfZmFjKGx2LCB2biwgZmFjX2ksIGZhYyk7DQp9DQoNCnZvaWQgc2hhZGVfY3ViaWMoZmxvYXQgaXMsIG91dCBmbG9hdCBvdXRpcykNCnsNCglpZiAoaXMgPiAwLjAgJiYgaXMgPCAxLjApDQoJCW91dGlzID0gc21vb3Roc3RlcCgwLjAsIDEuMCwgaXMpOw0KCWVsc2UNCgkJb3V0aXMgPSBpczsNCn0NCg0Kdm9pZCBzaGFkZV92aXNpZmFjKGZsb2F0IGksIGZsb2F0IHZpc2lmYWMsIGZsb2F0IHJlZmwsIG91dCBmbG9hdCBvdXRpKQ0Kew0KCS8qaWYgKGkgPiAwLjApKi8NCglvdXRpID0gbWF4KGkgKiB2aXNpZmFjICogcmVmbCwgMC4wKTsNCgkvKmVsc2UNCgkgICAgb3V0aSA9IGk7Ki8NCn0NCg0Kdm9pZCBzaGFkZV90YW5nZW50X3Zfc3BlYyh2ZWMzIHRhbmcsIG91dCB2ZWMzIHZuKQ0Kew0KCXZuID0gdGFuZzsNCn0NCg0Kdm9pZCBzaGFkZV9hZGRfdG9fZGlmZnVzZShmbG9hdCBpLCB2ZWMzIGxhbXBjb2wsIHZlYzMgY29sLCBvdXQgdmVjMyBvdXRjb2wpDQp7DQoJaWYgKGkgPiAwLjApDQoJCW91dGNvbCA9IGkgKiBsYW1wY29sICogY29sOw0KCWVsc2UNCgkJb3V0Y29sID0gdmVjMygwLjAsIDAuMCwgMC4wKTsNCn0NCg0Kdm9pZCBzaGFkZV9oZW1pX3NwZWModmVjMyB2biwgdmVjMyBsdiwgdmVjMyB2aWV3LCBmbG9hdCBzcGVjLCBmbG9hdCBoYXJkLCBmbG9hdCB2aXNpZmFjLCBvdXQgZmxvYXQgdCkNCnsNCglsdiArPSB2aWV3Ow0KCWx2ID0gbm9ybWFsaXplKGx2KTsNCg0KCXQgPSBkb3Qodm4sIGx2KTsNCgl0ID0gMC41ICogdCArIDAuNTsNCg0KCXQgPSB2aXNpZmFjICogc3BlYyAqIHBvdyh0LCBoYXJkKTsNCn0NCg0Kdm9pZCBzaGFkZV9waG9uZ19zcGVjKHZlYzMgbiwgdmVjMyBsLCB2ZWMzIHYsIGZsb2F0IGhhcmQsIG91dCBmbG9hdCBzcGVjZmFjKQ0Kew0KCXZlYzMgaCA9IG5vcm1hbGl6ZShsICsgdik7DQoJZmxvYXQgcnNsdCA9IG1heChkb3QoaCwgbiksIDAuMCk7DQoNCglzcGVjZmFjID0gcG93KHJzbHQsIGhhcmQpOw0KfQ0KDQp2b2lkIHNoYWRlX2Nvb2t0b3JyX3NwZWModmVjMyBuLCB2ZWMzIGwsIHZlYzMgdiwgZmxvYXQgaGFyZCwgb3V0IGZsb2F0IHNwZWNmYWMpDQp7DQoJdmVjMyBoID0gbm9ybWFsaXplKHYgKyBsKTsNCglmbG9hdCBuaCA9IGRvdChuLCBoKTsNCg0KCWlmIChuaCA8IDAuMCkgew0KCQlzcGVjZmFjID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJZmxvYXQgbnYgPSBtYXgoZG90KG4sIHYpLCAwLjApOw0KCQlmbG9hdCBpID0gcG93KG5oLCBoYXJkKTsNCg0KCQlpID0gaSAvICgwLjEgKyBudik7DQoJCXNwZWNmYWMgPSBpOw0KCX0NCn0NCg0Kdm9pZCBzaGFkZV9ibGlubl9zcGVjKHZlYzMgbiwgdmVjMyBsLCB2ZWMzIHYsIGZsb2F0IHJlZnJhYywgZmxvYXQgc3BlY19wb3dlciwgb3V0IGZsb2F0IHNwZWNmYWMpDQp7DQoJaWYgKHJlZnJhYyA8IDEuMCkgew0KCQlzcGVjZmFjID0gMC4wOw0KCX0NCgllbHNlIGlmIChzcGVjX3Bvd2VyID09IDAuMCkgew0KCQlzcGVjZmFjID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJaWYgKHNwZWNfcG93ZXIgPCAxMDAuMCkNCgkJCXNwZWNfcG93ZXIgPSBzcXJ0KDEuMCAvIHNwZWNfcG93ZXIpOw0KCQllbHNlDQoJCQlzcGVjX3Bvd2VyID0gMTAuMCAvIHNwZWNfcG93ZXI7DQoNCgkJdmVjMyBoID0gbm9ybWFsaXplKHYgKyBsKTsNCgkJZmxvYXQgbmggPSBkb3QobiwgaCk7DQoJCWlmIChuaCA8IDAuMCkgew0KCQkJc3BlY2ZhYyA9IDAuMDsNCgkJfQ0KCQllbHNlIHsNCgkJCWZsb2F0IG52ID0gbWF4KGRvdChuLCB2KSwgMC4wMSk7DQoJCQlmbG9hdCBubCA9IGRvdChuLCBsKTsNCgkJCWlmIChubCA8PSAwLjAxKSB7DQoJCQkJc3BlY2ZhYyA9IDAuMDsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCWZsb2F0IHZoID0gbWF4KGRvdCh2LCBoKSwgMC4wMSk7DQoNCgkJCQlmbG9hdCBhID0gMS4wOw0KCQkJCWZsb2F0IGIgPSAoMi4wICogbmggKiBudikgLyB2aDsNCgkJCQlmbG9hdCBjID0gKDIuMCAqIG5oICogbmwpIC8gdmg7DQoNCgkJCQlmbG9hdCBnID0gMC4wOw0KDQoJCQkJaWYgKGEgPCBiICYmIGEgPCBjKSBnID0gYTsNCgkJCQllbHNlIGlmIChiIDwgYSAmJiBiIDwgYykgZyA9IGI7DQoJCQkJZWxzZSBpZiAoYyA8IGEgJiYgYyA8IGIpIGcgPSBjOw0KDQoJCQkJZmxvYXQgcCA9IHNxcnQoKChyZWZyYWMgKiByZWZyYWMpICsgKHZoICogdmgpIC0gMS4wKSk7DQoJCQkJZmxvYXQgZiA9ICgoKChwIC0gdmgpICogKHAgLSB2aCkpIC8gKChwICsgdmgpICogKHAgKyB2aCkpKSAqDQoJCQkJICAgICAgICAgICAoMS4wICsgKCgoKHZoICogKHAgKyB2aCkpIC0gMS4wKSAqICgodmggKiAocCArIHZoKSkgLSAxLjApKSAvDQoJCQkJICAgICAgICAgICAgICAgICAgICgoKHZoICogKHAgLSB2aCkpICsgMS4wKSAqICgodmggKiAocCAtIHZoKSkgKyAxLjApKSkpKTsNCgkJCQlmbG9hdCBhbmcgPSBhY29zKG5oKTsNCg0KCQkJCXNwZWNmYWMgPSBtYXgoZiAqIGcgKiBleHBfYmxlbmRlcigoLShhbmcgKiBhbmcpIC8gKDIuMCAqIHNwZWNfcG93ZXIgKiBzcGVjX3Bvd2VyKSkpLCAwLjApOw0KCQkJfQ0KCQl9DQoJfQ0KfQ0KDQp2b2lkIHNoYWRlX3dhcmRpc29fc3BlYyh2ZWMzIG4sIHZlYzMgbCwgdmVjMyB2LCBmbG9hdCBybXMsIG91dCBmbG9hdCBzcGVjZmFjKQ0Kew0KCXZlYzMgaCA9IG5vcm1hbGl6ZShsICsgdik7DQoJZmxvYXQgbmggPSBtYXgoZG90KG4sIGgpLCAwLjAwMSk7DQoJZmxvYXQgbnYgPSBtYXgoZG90KG4sIHYpLCAwLjAwMSk7DQoJZmxvYXQgbmwgPSBtYXgoZG90KG4sIGwpLCAwLjAwMSk7DQoJZmxvYXQgYW5nbGUgPSB0YW4oYWNvcyhuaCkpOw0KCWZsb2F0IGFscGhhID0gbWF4KHJtcywgMC4wMDEpOw0KDQoJc3BlY2ZhYyA9IG5sICogKDEuMCAvICg0LjAgKiBNX1BJICogYWxwaGEgKiBhbHBoYSkpICogKGV4cF9ibGVuZGVyKC0oYW5nbGUgKiBhbmdsZSkgLyAoYWxwaGEgKiBhbHBoYSkpIC8gKHNxcnQobnYgKiBubCkpKTsNCn0NCg0Kdm9pZCBzaGFkZV90b29uX3NwZWModmVjMyBuLCB2ZWMzIGwsIHZlYzMgdiwgZmxvYXQgc2l6ZSwgZmxvYXQgdHNtb290aCwgb3V0IGZsb2F0IHNwZWNmYWMpDQp7DQoJdmVjMyBoID0gbm9ybWFsaXplKGwgKyB2KTsNCglmbG9hdCByc2x0ID0gZG90KGgsIG4pOw0KCWZsb2F0IGFuZyA9IGFjb3MocnNsdCk7DQoNCglpZiAoYW5nIDwgc2l6ZSkgcnNsdCA9IDEuMDsNCgllbHNlIGlmIChhbmcgPj0gKHNpemUgKyB0c21vb3RoKSB8fCB0c21vb3RoID09IDAuMCkgcnNsdCA9IDAuMDsNCgllbHNlIHJzbHQgPSAxLjAgLSAoKGFuZyAtIHNpemUpIC8gdHNtb290aCk7DQoNCglzcGVjZmFjID0gcnNsdDsNCn0NCg0Kdm9pZCBzaGFkZV9zcGVjX2FyZWFfaW5wKGZsb2F0IHNwZWNmYWMsIGZsb2F0IGlucCwgb3V0IGZsb2F0IG91dHNwZWNmYWMpDQp7DQoJb3V0c3BlY2ZhYyA9IHNwZWNmYWMgKiBpbnA7DQp9DQoNCnZvaWQgc2hhZGVfc3BlY190KGZsb2F0IHNoYWRmYWMsIGZsb2F0IHNwZWMsIGZsb2F0IHZpc2lmYWMsIGZsb2F0IHNwZWNmYWMsIG91dCBmbG9hdCB0KQ0Kew0KCXQgPSBzaGFkZmFjICogc3BlYyAqIHZpc2lmYWMgKiBzcGVjZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX2FkZF9zcGVjKGZsb2F0IHQsIHZlYzMgbGFtcGNvbCwgdmVjMyBzcGVjY29sLCBvdXQgdmVjMyBvdXRjb2wpDQp7DQoJb3V0Y29sID0gdCAqIGxhbXBjb2wgKiBzcGVjY29sOw0KfQ0KDQp2b2lkIHNoYWRlX2FkZF9taXJyb3IodmVjMyBtaXIsIHZlYzQgcmVmY29sLCB2ZWMzIGNvbWJpbmVkLCBvdXQgdmVjMyByZXN1bHQpDQp7DQoJcmVzdWx0ID0gbWlyICogcmVmY29sLmdiYSArICh2ZWMzKDEuMCkgLSBtaXIgKiByZWZjb2wucnJyKSAqIGNvbWJpbmVkOw0KfQ0KDQp2b2lkIGFscGhhX3NwZWNfY29ycmVjdGlvbih2ZWMzIHNwZWMsIGZsb2F0IHNwZWN0cmEsIGZsb2F0IGFscGhhLCBvdXQgZmxvYXQgb3V0YWxwaGEpDQp7DQoJaWYgKHNwZWN0cmEgPiAwLjApIHsNCgkJZmxvYXQgdCA9IGNsYW1wKG1heChtYXgoc3BlYy5yLCBzcGVjLmcpLCBzcGVjLmIpICogc3BlY3RyYSwgMC4wLCAxLjApOw0KCQlvdXRhbHBoYSA9ICgxLjAgLSB0KSAqIGFscGhhICsgdDsNCgl9DQoJZWxzZSB7DQoJCW91dGFscGhhID0gYWxwaGE7DQoJfQ0KfQ0KDQp2b2lkIHNoYWRlX2FkZCh2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDEgKyBjb2wyOw0KfQ0KDQp2b2lkIHNoYWRlX21hZGQodmVjNCBjb2wsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gY29sICsgY29sMSAqIGNvbDI7DQp9DQoNCnZvaWQgc2hhZGVfYWRkX2NsYW1wZWQodmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSBjb2wxICsgbWF4KGNvbDIsIHZlYzQoMC4wLCAwLjAsIDAuMCwgMC4wKSk7DQp9DQoNCnZvaWQgc2hhZGVfbWFkZF9jbGFtcGVkKHZlYzQgY29sLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbCArIG1heChjb2wxICogY29sMiwgdmVjNCgwLjAsIDAuMCwgMC4wLCAwLjApKTsNCn0NCg0Kdm9pZCBlbnZfYXBwbHkodmVjNCBjb2wsIHZlYzMgaG9yLCB2ZWMzIHplbiwgdmVjNCBmLCBtYXQ0IHZtLCB2ZWMzIHZuLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJdmVjMyB2diA9IG5vcm1hbGl6ZSh2bVsyXS54eXopOw0KCWZsb2F0IHNreWZhYyA9IDAuNSAqICgxLjAgKyBkb3Qodm4sIC12dikpOw0KCW91dGNvbCA9IGNvbCArIGYgKiB2ZWM0KG1peChob3IsIHplbiwgc2t5ZmFjKSwgMCk7DQp9DQoNCnZvaWQgc2hhZGVfbWFkZGYodmVjNCBjb2wsIGZsb2F0IGYsIHZlYzQgY29sMSwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbCArIGYgKiBjb2wxOw0KfQ0KDQp2b2lkIHNoYWRlX211bCh2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDEgKiBjb2wyOw0KfQ0KDQp2b2lkIHNoYWRlX211bF92YWx1ZShmbG9hdCBmYWMsIHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gY29sICogZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX211bF92YWx1ZV92MyhmbG9hdCBmYWMsIHZlYzMgY29sLCBvdXQgdmVjMyBvdXRjb2wpDQp7DQoJb3V0Y29sID0gY29sICogZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX29iY29sb3IodmVjNCBjb2wsIHZlYzQgb2Jjb2wsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSB2ZWM0KGNvbC5yZ2IgKiBvYmNvbC5yZ2IsIGNvbC5hKTsNCn0NCg0Kdm9pZCByYW1wX3JnYnRvYncodmVjMyBjb2xvciwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSBjb2xvci5yICogMC4zICsgY29sb3IuZyAqIDAuNTggKyBjb2xvci5iICogMC4xMjsNCn0NCg0Kdm9pZCBzaGFkZV9vbmx5X3NoYWRvdyhmbG9hdCBpLCBmbG9hdCBzaGFkZmFjLCBmbG9hdCBlbmVyZ3ksIHZlYzMgc2hhZGNvbCwgb3V0IHZlYzMgb3V0c2hhZHJnYikNCnsNCglvdXRzaGFkcmdiID0gaSAqIGVuZXJneSAqICgxLjAgLSBzaGFkZmFjKSAqICh2ZWMzKDEuMCkgLSBzaGFkY29sKTsNCn0NCg0Kdm9pZCBzaGFkZV9vbmx5X3NoYWRvd19kaWZmdXNlKHZlYzMgc2hhZHJnYiwgdmVjMyByZ2IsIHZlYzQgZGlmZiwgb3V0IHZlYzQgb3V0ZGlmZikNCnsNCglvdXRkaWZmID0gZGlmZiAtIHZlYzQocmdiICogc2hhZHJnYiwgMC4wKTsNCn0NCg0Kdm9pZCBzaGFkZV9vbmx5X3NoYWRvd19zcGVjdWxhcih2ZWMzIHNoYWRyZ2IsIHZlYzMgc3BlY3JnYiwgdmVjNCBzcGVjLCBvdXQgdmVjNCBvdXRzcGVjKQ0Kew0KCW91dHNwZWMgPSBzcGVjIC0gdmVjNChzcGVjcmdiICogc2hhZHJnYiwgMC4wKTsNCn0NCg0Kdm9pZCBzaGFkZV9jbGFtcF9wb3NpdGl2ZSh2ZWM0IGNvbCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IG1heChjb2wsIHZlYzQoMC4wKSk7DQp9DQoNCnZvaWQgdGVzdF9zaGFkb3didWYoDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsIGZsb2F0IHNoYWRvd2JpYXMsIGZsb2F0IGlucCwNCiAgICAgICAgb3V0IGZsb2F0IHJlc3VsdCkNCnsNCglpZiAoaW5wIDw9IDAuMCkgew0KCQlyZXN1bHQgPSAwLjA7DQoJfQ0KCWVsc2Ugew0KCQl2ZWM0IGNvID0gc2hhZG93cGVyc21hdCAqIHZlYzQocmNvLCAxLjApOw0KDQoJCS8vZmxvYXQgYmlhcyA9ICgxLjUgLSBpbnAqaW5wKSpzaGFkb3diaWFzOw0KCQljby56IC09IHNoYWRvd2JpYXMgKiBjby53Ow0KDQoJCWlmIChjby53ID4gMC4wICYmIGNvLnggPiAwLjAgJiYgY28ueCAvIGNvLncgPCAxLjAgJiYgY28ueSA+IDAuMCAmJiBjby55IC8gY28udyA8IDEuMCkNCgkJCXJlc3VsdCA9IHRleHR1cmUyRFByb2ooc2hhZG93bWFwLCBjbykueDsNCgkJZWxzZQ0KCQkJcmVzdWx0ID0gMS4wOw0KCX0NCn0NCg0Kdm9pZCB0ZXN0X3NoYWRvd2J1Zl92c20oDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsIGZsb2F0IHNoYWRvd2JpYXMsIGZsb2F0IGJsZWVkYmlhcywgZmxvYXQgaW5wLA0KICAgICAgICBvdXQgZmxvYXQgcmVzdWx0KQ0Kew0KCWlmIChpbnAgPD0gMC4wKSB7DQoJCXJlc3VsdCA9IDAuMDsNCgl9DQoJZWxzZSB7DQoJCXZlYzQgY28gPSBzaGFkb3dwZXJzbWF0ICogdmVjNChyY28sIDEuMCk7DQoJCWlmIChjby53ID4gMC4wICYmIGNvLnggPiAwLjAgJiYgY28ueCAvIGNvLncgPCAxLjAgJiYgY28ueSA+IDAuMCAmJiBjby55IC8gY28udyA8IDEuMCkgew0KCQkJdmVjMiBtb21lbnRzID0gdGV4dHVyZTJEUHJvaihzaGFkb3dtYXAsIGNvKS5yZzsNCgkJCWZsb2F0IGRpc3QgPSBjby56IC8gY28udzsNCgkJCWZsb2F0IHAgPSAwLjA7DQoNCgkJCWlmIChkaXN0IDw9IG1vbWVudHMueCkNCgkJCQlwID0gMS4wOw0KDQoJCQlmbG9hdCB2YXJpYW5jZSA9IG1vbWVudHMueSAtIChtb21lbnRzLnggKiBtb21lbnRzLngpOw0KCQkJdmFyaWFuY2UgPSBtYXgodmFyaWFuY2UsIHNoYWRvd2JpYXMgLyAxMC4wKTsNCg0KCQkJZmxvYXQgZCA9IG1vbWVudHMueCAtIGRpc3Q7DQoJCQlmbG9hdCBwX21heCA9IHZhcmlhbmNlIC8gKHZhcmlhbmNlICsgZCAqIGQpOw0KDQoJCQkvLyBOb3cgcmVkdWNlIGxpZ2h0LWJsZWVkaW5nIGJ5IHJlbW92aW5nIHRoZSBbMCwgeF0gdGFpbCBhbmQgbGluZWFybHkgcmVzY2FsaW5nICh4LCAxXQ0KCQkJcF9tYXggPSBjbGFtcCgocF9tYXggLSBibGVlZGJpYXMpIC8gKDEuMCAtIGJsZWVkYmlhcyksIDAuMCwgMS4wKTsNCg0KCQkJcmVzdWx0ID0gbWF4KHAsIHBfbWF4KTsNCgkJfQ0KCQllbHNlIHsNCgkJCXJlc3VsdCA9IDEuMDsNCgkJfQ0KCX0NCn0NCg0Kdm9pZCBzaGFkb3dzX29ubHkoDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsDQogICAgICAgIGZsb2F0IHNoYWRvd2JpYXMsIHZlYzMgc2hhZG93Y29sb3IsIGZsb2F0IGlucCwNCiAgICAgICAgb3V0IHZlYzMgcmVzdWx0KQ0Kew0KCXJlc3VsdCA9IHZlYzMoMS4wKTsNCg0KCWlmIChpbnAgPiAwLjApIHsNCgkJZmxvYXQgc2hhZGZhYzsNCg0KCQl0ZXN0X3NoYWRvd2J1ZihyY28sIHNoYWRvd21hcCwgc2hhZG93cGVyc21hdCwgc2hhZG93YmlhcywgaW5wLCBzaGFkZmFjKTsNCgkJcmVzdWx0IC09ICgxLjAgLSBzaGFkZmFjKSAqICh2ZWMzKDEuMCkgLSBzaGFkb3djb2xvcik7DQoJfQ0KfQ0KDQp2b2lkIHNoYWRvd3Nfb25seV92c20oDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsDQogICAgICAgIGZsb2F0IHNoYWRvd2JpYXMsIGZsb2F0IGJsZWVkYmlhcywgdmVjMyBzaGFkb3djb2xvciwgZmxvYXQgaW5wLA0KICAgICAgICBvdXQgdmVjMyByZXN1bHQpDQp7DQoJcmVzdWx0ID0gdmVjMygxLjApOw0KDQoJaWYgKGlucCA+IDAuMCkgew0KCQlmbG9hdCBzaGFkZmFjOw0KDQoJCXRlc3Rfc2hhZG93YnVmX3ZzbShyY28sIHNoYWRvd21hcCwgc2hhZG93cGVyc21hdCwgc2hhZG93YmlhcywgYmxlZWRiaWFzLCBpbnAsIHNoYWRmYWMpOw0KCQlyZXN1bHQgLT0gKDEuMCAtIHNoYWRmYWMpICogKHZlYzMoMS4wKSAtIHNoYWRvd2NvbG9yKTsNCgl9DQp9DQoNCnZvaWQgc2hhZGVfbGlnaHRfdGV4dHVyZSh2ZWMzIHJjbywgc2FtcGxlcjJEIGNvb2tpZSwgbWF0NCBzaGFkb3dwZXJzbWF0LCBvdXQgdmVjNCByZXN1bHQpDQp7DQoNCgl2ZWM0IGNvID0gc2hhZG93cGVyc21hdCAqIHZlYzQocmNvLCAxLjApOw0KDQoJcmVzdWx0ID0gdGV4dHVyZTJEUHJvaihjb29raWUsIGNvKTsNCn0NCg0Kdm9pZCBzaGFkZV9leHBvc3VyZV9jb3JyZWN0KHZlYzMgY29sLCBmbG9hdCBsaW5mYWMsIGZsb2F0IGxvZ2ZhYywgb3V0IHZlYzMgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGxpbmZhYyAqICgxLjAgLSBleHAoY29sICogbG9nZmFjKSk7DQp9DQoNCnZvaWQgc2hhZGVfbWlzdF9mYWN0b3IoDQogICAgICAgIHZlYzMgY28sIGZsb2F0IGVuYWJsZSwgZmxvYXQgbWlzdHN0YSwgZmxvYXQgbWlzdGRpc3QsIGZsb2F0IG1pc3R0eXBlLCBmbG9hdCBtaXNpLA0KICAgICAgICBvdXQgZmxvYXQgb3V0ZmFjKQ0Kew0KCWlmIChlbmFibGUgPT0gMS4wKSB7DQoJCWZsb2F0IGZhYywgemNvcjsNCg0KCQl6Y29yID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IGxlbmd0aChjbykgOiAtY29bMl07DQoNCgkJZmFjID0gY2xhbXAoKHpjb3IgLSBtaXN0c3RhKSAvIG1pc3RkaXN0LCAwLjAsIDEuMCk7DQoJCWlmIChtaXN0dHlwZSA9PSAwLjApIGZhYyAqPSBmYWM7DQoJCWVsc2UgaWYgKG1pc3R0eXBlID09IDEuMCkgOw0KCQllbHNlIGZhYyA9IHNxcnQoZmFjKTsNCg0KCQlvdXRmYWMgPSAxLjAgLSAoMS4wIC0gZmFjKSAqICgxLjAgLSBtaXNpKTsNCgl9DQoJZWxzZSB7DQoJCW91dGZhYyA9IDAuMDsNCgl9DQp9DQoNCnZvaWQgc2hhZGVfd29ybGRfbWl4KHZlYzMgaG9yLCB2ZWM0IGNvbCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZsb2F0IGZhYyA9IGNsYW1wKGNvbC5hLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gdmVjNChtaXgoaG9yLCBjb2wucmdiLCBmYWMpLCBjb2wuYSk7DQp9DQoNCnZvaWQgc2hhZGVfYWxwaGFfb3BhcXVlKHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gdmVjNChjb2wucmdiLCAxLjApOw0KfQ0KDQp2b2lkIHNoYWRlX2FscGhhX29iY29sb3IodmVjNCBjb2wsIHZlYzQgb2Jjb2wsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSB2ZWM0KGNvbC5yZ2IsIGNvbC5hICogb2Jjb2wuYSk7DQp9DQoNCi8qKioqKioqKioqKiBORVcgU0hBREVSIFVUSUxJVElFUyAqKioqKioqKioqKioqKi8NCg0KZmxvYXQgZnJlc25lbF9kaWVsZWN0cmljKHZlYzMgSW5jb21pbmcsIHZlYzMgTm9ybWFsLCBmbG9hdCBldGEpDQp7DQoJLyogY29tcHV0ZSBmcmVzbmVsIHJlZmxlY3RhbmNlIHdpdGhvdXQgZXhwbGljaXRseSBjb21wdXRpbmcNCgkgKiB0aGUgcmVmcmFjdGVkIGRpcmVjdGlvbiAqLw0KCWZsb2F0IGMgPSBhYnMoZG90KEluY29taW5nLCBOb3JtYWwpKTsNCglmbG9hdCBnID0gZXRhICogZXRhIC0gMS4wICsgYyAqIGM7DQoJZmxvYXQgcmVzdWx0Ow0KDQoJaWYgKGcgPiAwLjApIHsNCgkJZyA9IHNxcnQoZyk7DQoJCWZsb2F0IEEgPSAoZyAtIGMpIC8gKGcgKyBjKTsNCgkJZmxvYXQgQiA9IChjICogKGcgKyBjKSAtIDEuMCkgLyAoYyAqIChnIC0gYykgKyAxLjApOw0KCQlyZXN1bHQgPSAwLjUgKiBBICogQSAqICgxLjAgKyBCICogQik7DQoJfQ0KCWVsc2Ugew0KCQlyZXN1bHQgPSAxLjA7ICAvKiBUSVIgKG5vIHJlZnJhY3RlZCBjb21wb25lbnQpICovDQoJfQ0KDQoJcmV0dXJuIHJlc3VsdDsNCn0NCg0KZmxvYXQgaHlwb3QoZmxvYXQgeCwgZmxvYXQgeSkNCnsNCglyZXR1cm4gc3FydCh4ICogeCArIHkgKiB5KTsNCn0NCg0Kdm9pZCBnZW5lcmF0ZWRfZnJvbV9vcmNvKHZlYzMgb3Jjbywgb3V0IHZlYzMgZ2VuZXJhdGVkKQ0Kew0KCWdlbmVyYXRlZCA9IG9yY28gKiAwLjUgKyB2ZWMzKDAuNSk7DQp9DQoNCmludCBmbG9vcl90b19pbnQoZmxvYXQgeCkNCnsNCglyZXR1cm4gaW50KGZsb29yKHgpKTsNCn0NCg0KaW50IHF1aWNrX2Zsb29yKGZsb2F0IHgpDQp7DQoJcmV0dXJuIGludCh4KSAtICgoeCA8IDApID8gMSA6IDApOw0KfQ0KDQojaWZkZWYgQklUX09QRVJBVElPTlMNCmZsb2F0IGludGVnZXJfbm9pc2UoaW50IG4pDQp7DQoJaW50IG5uOw0KCW4gPSAobiArIDEwMTMpICYgMHg3ZmZmZmZmZjsNCgluID0gKG4gPj4gMTMpIF4gbjsNCglubiA9IChuICogKG4gKiBuICogNjA0OTMgKyAxOTk5MDMwMykgKyAxMzc2MzEyNTg5KSAmIDB4N2ZmZmZmZmY7DQoJcmV0dXJuIDAuNSAqIChmbG9hdChubikgLyAxMDczNzQxODI0LjApOw0KfQ0KDQp1aW50IGhhc2godWludCBreCwgdWludCBreSwgdWludCBreikNCnsNCiNkZWZpbmUgcm90KHgsIGspICgoKHgpIDw8IChrKSkgfCAoKHgpID4+ICgzMiAtIChrKSkpKQ0KI2RlZmluZSBmaW5hbChhLCBiLCBjKSBcDQp7IFwNCgljIF49IGI7IGMgLT0gcm90KGIsIDE0KTsgXA0KCWEgXj0gYzsgYSAtPSByb3QoYywgMTEpOyBcDQoJYiBePSBhOyBiIC09IHJvdChhLCAyNSk7IFwNCgljIF49IGI7IGMgLT0gcm90KGIsIDE2KTsgXA0KCWEgXj0gYzsgYSAtPSByb3QoYywgNCk7ICBcDQoJYiBePSBhOyBiIC09IHJvdChhLCAxNCk7IFwNCgljIF49IGI7IGMgLT0gcm90KGIsIDI0KTsgXA0KfQ0KCS8vIG5vdyBoYXNoIHRoZSBkYXRhIQ0KCXVpbnQgYSwgYiwgYywgbGVuID0gM3U7DQoJYSA9IGIgPSBjID0gMHhkZWFkYmVlZnUgKyAobGVuIDw8IDJ1KSArIDEzdTsNCg0KCWMgKz0ga3o7DQoJYiArPSBreTsNCglhICs9IGt4Ow0KCWZpbmFsIChhLCBiLCBjKTsNCg0KCXJldHVybiBjOw0KI3VuZGVmIHJvdA0KI3VuZGVmIGZpbmFsDQp9DQoNCnVpbnQgaGFzaChpbnQga3gsIGludCBreSwgaW50IGt6KQ0Kew0KCXJldHVybiBoYXNoKHVpbnQoa3gpLCB1aW50KGt5KSwgdWludChreikpOw0KfQ0KDQpmbG9hdCBiaXRzX3RvXzAxKHVpbnQgYml0cykNCnsNCglmbG9hdCB4ID0gZmxvYXQoYml0cykgKiAoMS4wIC8gZmxvYXQoMHhmZmZmZmZmZnUpKTsNCglyZXR1cm4geDsNCn0NCg0KZmxvYXQgY2VsbG5vaXNlKHZlYzMgcCkNCnsNCglpbnQgaXggPSBxdWlja19mbG9vcihwLngpOw0KCWludCBpeSA9IHF1aWNrX2Zsb29yKHAueSk7DQoJaW50IGl6ID0gcXVpY2tfZmxvb3IocC56KTsNCg0KCXJldHVybiBiaXRzX3RvXzAxKGhhc2godWludChpeCksIHVpbnQoaXkpLCB1aW50KGl6KSkpOw0KfQ0KDQp2ZWMzIGNlbGxub2lzZV9jb2xvcih2ZWMzIHApDQp7DQoJZmxvYXQgciA9IGNlbGxub2lzZShwKTsNCglmbG9hdCBnID0gY2VsbG5vaXNlKHZlYzMocC55LCBwLngsIHAueikpOw0KCWZsb2F0IGIgPSBjZWxsbm9pc2UodmVjMyhwLnksIHAueiwgcC54KSk7DQoNCglyZXR1cm4gdmVjMyhyLCBnLCBiKTsNCn0NCiNlbmRpZiAgLy8gQklUX09QRVJBVElPTlMNCg0KZmxvYXQgZmxvb3JmcmFjKGZsb2F0IHgsIG91dCBpbnQgaSkNCnsNCglpID0gZmxvb3JfdG9faW50KHgpOw0KCXJldHVybiB4IC0gaTsNCn0NCg0KLyoqKioqKioqKioqIE5FVyBTSEFERVIgTk9ERVMgKioqKioqKioqKioqKioqLw0KDQojZGVmaW5lIE5VTV9MSUdIVFMgMw0KDQovKiBic2RmcyAqLw0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCnZvaWQgbm9kZV9hbWJpZW50X29jY2x1c2lvbih2ZWM0IGNvbG9yLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJcmVzdWx0ID0gY29sb3I7DQp9DQoNCi8qIGVtaXNzaW9uICovDQoNCnZvaWQgbm9kZV9lbWlzc2lvbih2ZWM0IGNvbG9yLCBmbG9hdCBzdHJlbmd0aCwgdmVjMyBOLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJcmVzdWx0ID0gY29sb3IgKiBzdHJlbmd0aDsNCn0NCg0KLyogYmFja2dyb3VuZCAqLw0KDQp2b2lkIGJhY2tncm91bmRfdHJhbnNmb3JtX3RvX3dvcmxkKHZlYzMgdmlld3ZlYywgb3V0IHZlYzMgd29ybGR2ZWMpDQp7DQoJdmVjNCB2ID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IHZlYzQodmlld3ZlYywgMS4wKSA6IHZlYzQoMC4wLCAwLjAsIDEuMCwgMS4wKTsNCgl2ZWM0IGNvX2hvbW9nZW5vdXMgPSAoYmxfUHJvamVjdGlvbk1hdHJpeEludmVyc2UgKiB2KTsNCg0KCXZlYzQgY28gPSB2ZWM0KGNvX2hvbW9nZW5vdXMueHl6IC8gY29faG9tb2dlbm91cy53LCAwLjApOw0KCXdvcmxkdmVjID0gKGJsX01vZGVsVmlld01hdHJpeEludmVyc2UgKiBjbykueHl6Ow0KfQ0KDQp2b2lkIG5vZGVfYmFja2dyb3VuZCh2ZWM0IGNvbG9yLCBmbG9hdCBzdHJlbmd0aCwgdmVjMyBOLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJcmVzdWx0ID0gY29sb3IgKiBzdHJlbmd0aDsNCn0NCg0KLyogY2xvc3VyZXMgKi8NCg0Kdm9pZCBub2RlX21peF9zaGFkZXIoZmxvYXQgZmFjLCB2ZWM0IHNoYWRlcjEsIHZlYzQgc2hhZGVyMiwgb3V0IHZlYzQgc2hhZGVyKQ0Kew0KCXNoYWRlciA9IG1peChzaGFkZXIxLCBzaGFkZXIyLCBmYWMpOw0KfQ0KDQp2b2lkIG5vZGVfYWRkX3NoYWRlcih2ZWM0IHNoYWRlcjEsIHZlYzQgc2hhZGVyMiwgb3V0IHZlYzQgc2hhZGVyKQ0Kew0KCXNoYWRlciA9IHNoYWRlcjEgKyBzaGFkZXIyOw0KfQ0KDQovKiBmcmVzbmVsICovDQoNCnZvaWQgbm9kZV9mcmVzbmVsKGZsb2F0IGlvciwgdmVjMyBOLCB2ZWMzIEksIG91dCBmbG9hdCByZXN1bHQpDQp7DQoJLyogaGFuZGxlIHBlcnNwZWN0aXZlL29ydGhvZ3JhcGhpYyAqLw0KCXZlYzMgSV92aWV3ID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IG5vcm1hbGl6ZShJKSA6IHZlYzMoMC4wLCAwLjAsIC0xLjApOw0KDQoJZmxvYXQgZXRhID0gbWF4KGlvciwgMC4wMDAwMSk7DQoJcmVzdWx0ID0gZnJlc25lbF9kaWVsZWN0cmljKElfdmlldywgTiwgKGdsX0Zyb250RmFjaW5nKSA/IGV0YSA6IDEuMCAvIGV0YSk7DQp9DQoNCi8qIGxheWVyX3dlaWdodCAqLw0KDQp2b2lkIG5vZGVfbGF5ZXJfd2VpZ2h0KGZsb2F0IGJsZW5kLCB2ZWMzIE4sIHZlYzMgSSwgb3V0IGZsb2F0IGZyZXNuZWwsIG91dCBmbG9hdCBmYWNpbmcpDQp7DQoJLyogZnJlc25lbCAqLw0KCWZsb2F0IGV0YSA9IG1heCgxLjAgLSBibGVuZCwgMC4wMDAwMSk7DQoJdmVjMyBJX3ZpZXcgPSAoYmxfUHJvamVjdGlvbk1hdHJpeFszXVszXSA9PSAwLjApID8gbm9ybWFsaXplKEkpIDogdmVjMygwLjAsIDAuMCwgLTEuMCk7DQoNCglmcmVzbmVsID0gZnJlc25lbF9kaWVsZWN0cmljKElfdmlldywgTiwgKGdsX0Zyb250RmFjaW5nKSA/IDEuMCAvIGV0YSA6IGV0YSk7DQoNCgkvKiBmYWNpbmcgKi8NCglmYWNpbmcgPSBhYnMoZG90KElfdmlldywgTikpOw0KCWlmIChibGVuZCAhPSAwLjUpIHsNCgkJYmxlbmQgPSBjbGFtcChibGVuZCwgMC4wLCAwLjk5OTk5KTsNCgkJYmxlbmQgPSAoYmxlbmQgPCAwLjUpID8gMi4wICogYmxlbmQgOiAwLjUgLyAoMS4wIC0gYmxlbmQpOw0KCQlmYWNpbmcgPSBwb3coZmFjaW5nLCBibGVuZCk7DQoJfQ0KCWZhY2luZyA9IDEuMCAtIGZhY2luZzsNCn0NCg0KLyogZ2FtbWEgKi8NCg0Kdm9pZCBub2RlX2dhbW1hKHZlYzQgY29sLCBmbG9hdCBnYW1tYSwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDsNCg0KCWlmIChjb2wuciA+IDAuMCkNCgkJb3V0Y29sLnIgPSBjb21wYXRpYmxlX3Bvdyhjb2wuciwgZ2FtbWEpOw0KCWlmIChjb2wuZyA+IDAuMCkNCgkJb3V0Y29sLmcgPSBjb21wYXRpYmxlX3Bvdyhjb2wuZywgZ2FtbWEpOw0KCWlmIChjb2wuYiA+IDAuMCkNCgkJb3V0Y29sLmIgPSBjb21wYXRpYmxlX3Bvdyhjb2wuYiwgZ2FtbWEpOw0KfQ0KDQovKiBnZW9tZXRyeSAqLw0KDQp2b2lkIG5vZGVfYXR0cmlidXRlKHZlYzMgYXR0ciwgb3V0IHZlYzQgb3V0Y29sLCBvdXQgdmVjMyBvdXR2ZWMsIG91dCBmbG9hdCBvdXRmKQ0Kew0KCW91dGNvbCA9IHZlYzQoYXR0ciwgMS4wKTsNCglvdXR2ZWMgPSBhdHRyOw0KCW91dGYgPSAoYXR0ci54ICsgYXR0ci55ICsgYXR0ci56KSAvIDMuMDsNCn0NCg0Kdm9pZCBub2RlX3V2bWFwKHZlYzMgYXR0cl91diwgb3V0IHZlYzMgb3V0dmVjKQ0Kew0KCW91dHZlYyA9IGF0dHJfdXY7DQp9DQoNCnZvaWQgbm9kZV9nZW9tZXRyeSgNCiAgICAgICAgdmVjMyBJLCB2ZWMzIE4sIG1hdDQgdG93b3JsZCwNCiAgICAgICAgb3V0IHZlYzMgcG9zaXRpb24sIG91dCB2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgdGFuZ2VudCwNCiAgICAgICAgb3V0IHZlYzMgdHJ1ZV9ub3JtYWwsIG91dCB2ZWMzIGluY29taW5nLCBvdXQgdmVjMyBwYXJhbWV0cmljLA0KICAgICAgICBvdXQgZmxvYXQgYmFja2ZhY2luZywgb3V0IGZsb2F0IHBvaW50aW5lc3MpDQp7DQoJcG9zaXRpb24gPSAodG93b3JsZCAqIHZlYzQoSSwgMS4wKSkueHl6Ow0KCW5vcm1hbCA9ICh0b3dvcmxkICogdmVjNChOLCAwLjApKS54eXo7DQoJdGFuZ2VudCA9IHZlYzMoMC4wKTsNCgl0cnVlX25vcm1hbCA9IG5vcm1hbDsNCg0KCS8qIGhhbmRsZSBwZXJzcGVjdGl2ZS9vcnRob2dyYXBoaWMgKi8NCgl2ZWMzIElfdmlldyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPyBub3JtYWxpemUoSSkgOiB2ZWMzKDAuMCwgMC4wLCAtMS4wKTsNCglpbmNvbWluZyA9IC0odG93b3JsZCAqIHZlYzQoSV92aWV3LCAwLjApKS54eXo7DQoNCglwYXJhbWV0cmljID0gdmVjMygwLjApOw0KCWJhY2tmYWNpbmcgPSAoZ2xfRnJvbnRGYWNpbmcpID8gMC4wIDogMS4wOw0KCXBvaW50aW5lc3MgPSAwLjU7DQp9DQoNCnZvaWQgbm9kZV90ZXhfY29vcmQoDQogICAgICAgIHZlYzMgSSwgdmVjMyBOLCBtYXQ0IHZpZXdpbnZtYXQsIG1hdDQgb2JpbnZtYXQsIHZlYzQgY2FtZXJhZmFjLA0KICAgICAgICB2ZWMzIGF0dHJfb3JjbywgdmVjMyBhdHRyX3V2LA0KICAgICAgICBvdXQgdmVjMyBnZW5lcmF0ZWQsIG91dCB2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgdXYsIG91dCB2ZWMzIG9iamVjdCwNCiAgICAgICAgb3V0IHZlYzMgY2FtZXJhLCBvdXQgdmVjMyB3aW5kb3csIG91dCB2ZWMzIHJlZmxlY3Rpb24pDQp7DQoJZ2VuZXJhdGVkID0gYXR0cl9vcmNvICogMC41ICsgdmVjMygwLjUpOw0KCW5vcm1hbCA9IG5vcm1hbGl6ZSgob2JpbnZtYXQgKiAodmlld2ludm1hdCAqIHZlYzQoTiwgMC4wKSkpLnh5eik7DQoJdXYgPSBhdHRyX3V2Ow0KCW9iamVjdCA9IChvYmludm1hdCAqICh2aWV3aW52bWF0ICogdmVjNChJLCAxLjApKSkueHl6Ow0KCWNhbWVyYSA9IHZlYzMoSS54eSwgLUkueik7DQoJdmVjNCBwcm9qdmVjID0gYmxfUHJvamVjdGlvbk1hdHJpeCAqIHZlYzQoSSwgMS4wKTsNCgl3aW5kb3cgPSB2ZWMzKG10ZXhfMmRfbWFwcGluZyhwcm9qdmVjLnh5eiAvIHByb2p2ZWMudykueHkgKiBjYW1lcmFmYWMueHkgKyBjYW1lcmFmYWMuencsIDAuMCk7DQoNCgl2ZWMzIHNoYWRlX0k7DQoJc2hhZGVfdmlldyhJLCBzaGFkZV9JKTsNCgl2ZWMzIHZpZXdfcmVmbGVjdGlvbiA9IHJlZmxlY3Qoc2hhZGVfSSwgbm9ybWFsaXplKE4pKTsNCglyZWZsZWN0aW9uID0gKHZpZXdpbnZtYXQgKiB2ZWM0KHZpZXdfcmVmbGVjdGlvbiwgMC4wKSkueHl6Ow0KfQ0KDQp2b2lkIG5vZGVfdGV4X2Nvb3JkX2JhY2tncm91bmQoDQogICAgICAgIHZlYzMgSSwgdmVjMyBOLCBtYXQ0IHZpZXdpbnZtYXQsIG1hdDQgb2JpbnZtYXQsIHZlYzQgY2FtZXJhZmFjLA0KICAgICAgICB2ZWMzIGF0dHJfb3JjbywgdmVjMyBhdHRyX3V2LA0KICAgICAgICBvdXQgdmVjMyBnZW5lcmF0ZWQsIG91dCB2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgdXYsIG91dCB2ZWMzIG9iamVjdCwNCiAgICAgICAgb3V0IHZlYzMgY2FtZXJhLCBvdXQgdmVjMyB3aW5kb3csIG91dCB2ZWMzIHJlZmxlY3Rpb24pDQp7DQoJdmVjNCB2ID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IHZlYzQoSSwgMS4wKSA6IHZlYzQoMC4wLCAwLjAsIDEuMCwgMS4wKTsNCgl2ZWM0IGNvX2hvbW9nZW5vdXMgPSAoYmxfUHJvamVjdGlvbk1hdHJpeEludmVyc2UgKiB2KTsNCg0KCXZlYzQgY28gPSB2ZWM0KGNvX2hvbW9nZW5vdXMueHl6IC8gY29faG9tb2dlbm91cy53LCAwLjApOw0KDQoJY28gPSBub3JtYWxpemUoY28pOw0KCXZlYzMgY29vcmRzID0gKGJsX01vZGVsVmlld01hdHJpeEludmVyc2UgKiBjbykueHl6Ow0KDQoJZ2VuZXJhdGVkID0gY29vcmRzOw0KCW5vcm1hbCA9IC1jb29yZHM7DQoJdXYgPSB2ZWMzKGF0dHJfdXYueHksIDAuMCk7DQoJb2JqZWN0ID0gY29vcmRzOw0KDQoJY2FtZXJhID0gdmVjMyhjby54eSwgLWNvLnopOw0KCXdpbmRvdyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPw0KCSAgICAgICAgIHZlYzMobXRleF8yZF9tYXBwaW5nKEkpLnh5ICogY2FtZXJhZmFjLnh5ICsgY2FtZXJhZmFjLnp3LCAwLjApIDoNCgkgICAgICAgICB2ZWMzKHZlYzIoMC41KSAqIGNhbWVyYWZhYy54eSArIGNhbWVyYWZhYy56dywgMC4wKTsNCg0KCXJlZmxlY3Rpb24gPSAtY29vcmRzOw0KfQ0KDQovKiB0ZXh0dXJlcyAqLw0KDQpmbG9hdCBjYWxjX2dyYWRpZW50KHZlYzMgcCwgaW50IGdyYWRpZW50X3R5cGUpDQp7DQoJZmxvYXQgeCwgeSwgejsNCgl4ID0gcC54Ow0KCXkgPSBwLnk7DQoJeiA9IHAuejsNCglpZiAoZ3JhZGllbnRfdHlwZSA9PSAwKSB7ICAvKiBsaW5lYXIgKi8NCgkJcmV0dXJuIHg7DQoJfQ0KCWVsc2UgaWYgKGdyYWRpZW50X3R5cGUgPT0gMSkgeyAgLyogcXVhZHJhdGljICovDQoJCWZsb2F0IHIgPSBtYXgoeCwgMC4wKTsNCgkJcmV0dXJuIHIgKiByOw0KCX0NCgllbHNlIGlmIChncmFkaWVudF90eXBlID09IDIpIHsgIC8qIGVhc2luZyAqLw0KCQlmbG9hdCByID0gbWluKG1heCh4LCAwLjApLCAxLjApOw0KCQlmbG9hdCB0ID0gciAqIHI7DQoJCXJldHVybiAoMy4wICogdCAtIDIuMCAqIHQgKiByKTsNCgl9DQoJZWxzZSBpZiAoZ3JhZGllbnRfdHlwZSA9PSAzKSB7ICAvKiBkaWFnb25hbCAqLw0KCQlyZXR1cm4gKHggKyB5KSAqIDAuNTsNCgl9DQoJZWxzZSBpZiAoZ3JhZGllbnRfdHlwZSA9PSA0KSB7ICAvKiByYWRpYWwgKi8NCgkJcmV0dXJuIGF0YW4oeSwgeCkgLyAoTV9QSSAqIDIpICsgMC41Ow0KCX0NCgllbHNlIHsNCgkJZmxvYXQgciA9IG1heCgxLjAgLSBzcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeiksIDAuMCk7DQoJCWlmIChncmFkaWVudF90eXBlID09IDUpIHsgIC8qIHF1YWRyYXRpYyBzcGhlcmUgKi8NCgkJCXJldHVybiByICogcjsNCgkJfQ0KCQllbHNlIGlmIChncmFkaWVudF90eXBlID09IDYpIHsgIC8qIHNwaGVyZSAqLw0KCQkJcmV0dXJuIHI7DQoJCX0NCgl9DQoJcmV0dXJuIDAuMDsNCn0NCg0Kdm9pZCBub2RlX3RleF9ncmFkaWVudCh2ZWMzIGNvLCBmbG9hdCBncmFkaWVudF90eXBlLCBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCglmbG9hdCBmID0gY2FsY19ncmFkaWVudChjbywgaW50KGdyYWRpZW50X3R5cGUpKTsNCglmID0gY2xhbXAoZiwgMC4wLCAxLjApOw0KDQoJY29sb3IgPSB2ZWM0KGYsIGYsIGYsIDEuMCk7DQoJZmFjID0gZjsNCn0NCg0Kdm9pZCBub2RlX3RleF9jaGVja2VyKHZlYzMgY28sIHZlYzQgY29sb3IxLCB2ZWM0IGNvbG9yMiwgZmxvYXQgc2NhbGUsIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgZmFjKQ0Kew0KCXZlYzMgcCA9IGNvICogc2NhbGU7DQoNCgkvKiBQcmV2ZW50IHByZWNpc2lvbiBpc3N1ZXMgb24gdW5pdCBjb29yZGluYXRlcy4gKi8NCglwLnggPSAocC54ICsgMC4wMDAwMDEpICogMC45OTk5OTk7DQoJcC55ID0gKHAueSArIDAuMDAwMDAxKSAqIDAuOTk5OTk5Ow0KCXAueiA9IChwLnogKyAwLjAwMDAwMSkgKiAwLjk5OTk5OTsNCg0KCWludCB4aSA9IGludChhYnMoZmxvb3IocC54KSkpOw0KCWludCB5aSA9IGludChhYnMoZmxvb3IocC55KSkpOw0KCWludCB6aSA9IGludChhYnMoZmxvb3IocC56KSkpOw0KDQoJYm9vbCBjaGVjayA9ICgobW9kKHhpLCAyKSA9PSBtb2QoeWksIDIpKSA9PSBib29sKG1vZCh6aSwgMikpKTsNCg0KCWNvbG9yID0gY2hlY2sgPyBjb2xvcjEgOiBjb2xvcjI7DQoJZmFjID0gY2hlY2sgPyAxLjAgOiAwLjA7DQp9DQoNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KdmVjMiBjYWxjX2JyaWNrX3RleHR1cmUodmVjMyBwLCBmbG9hdCBtb3J0YXJfc2l6ZSwgZmxvYXQgYmlhcywNCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IGJyaWNrX3dpZHRoLCBmbG9hdCByb3dfaGVpZ2h0LA0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgb2Zmc2V0X2Ftb3VudCwgaW50IG9mZnNldF9mcmVxdWVuY3ksDQogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBzcXVhc2hfYW1vdW50LCBpbnQgc3F1YXNoX2ZyZXF1ZW5jeSkNCnsNCglpbnQgYnJpY2tudW0sIHJvd251bTsNCglmbG9hdCBvZmZzZXQgPSAwLjA7DQoJZmxvYXQgeCwgeTsNCg0KCXJvd251bSA9IGZsb29yX3RvX2ludChwLnkgLyByb3dfaGVpZ2h0KTsNCg0KCWlmIChvZmZzZXRfZnJlcXVlbmN5ICE9IDAgJiYgc3F1YXNoX2ZyZXF1ZW5jeSAhPSAwKSB7DQoJCWJyaWNrX3dpZHRoICo9IChyb3dudW0gJSBzcXVhc2hfZnJlcXVlbmN5ICE9IDApID8gMS4wIDogc3F1YXNoX2Ftb3VudDsgLyogc3F1YXNoICovDQoJCW9mZnNldCA9IChyb3dudW0gJSBvZmZzZXRfZnJlcXVlbmN5ICE9IDApID8gMC4wIDogKGJyaWNrX3dpZHRoICogb2Zmc2V0X2Ftb3VudCk7IC8qIG9mZnNldCAqLw0KCX0NCg0KCWJyaWNrbnVtID0gZmxvb3JfdG9faW50KChwLnggKyBvZmZzZXQpIC8gYnJpY2tfd2lkdGgpOw0KDQoJeCA9IChwLnggKyBvZmZzZXQpIC0gYnJpY2tfd2lkdGggKiBicmlja251bTsNCgl5ID0gcC55IC0gcm93X2hlaWdodCAqIHJvd251bTsNCg0KCXJldHVybiB2ZWMyKGNsYW1wKChpbnRlZ2VyX25vaXNlKChyb3dudW0gPDwgMTYpICsgKGJyaWNrbnVtICYgMHhGRkZGKSkgKyBiaWFzKSwgMC4wLCAxLjApLA0KCSAgICAgICAgICAgICh4IDwgbW9ydGFyX3NpemUgfHwgeSA8IG1vcnRhcl9zaXplIHx8DQoJICAgICAgICAgICAgIHggPiAoYnJpY2tfd2lkdGggLSBtb3J0YXJfc2l6ZSkgfHwNCgkgICAgICAgICAgICAgeSA+IChyb3dfaGVpZ2h0IC0gbW9ydGFyX3NpemUpKSA/IDEuMCA6IDAuMCk7DQp9DQojZW5kaWYNCg0Kdm9pZCBub2RlX3RleF9icmljayh2ZWMzIGNvLA0KICAgICAgICAgICAgICAgICAgICB2ZWM0IGNvbG9yMSwgdmVjNCBjb2xvcjIsDQogICAgICAgICAgICAgICAgICAgIHZlYzQgbW9ydGFyLCBmbG9hdCBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgbW9ydGFyX3NpemUsIGZsb2F0IGJpYXMsDQogICAgICAgICAgICAgICAgICAgIGZsb2F0IGJyaWNrX3dpZHRoLCBmbG9hdCByb3dfaGVpZ2h0LA0KICAgICAgICAgICAgICAgICAgICBmbG9hdCBvZmZzZXRfYW1vdW50LCBmbG9hdCBvZmZzZXRfZnJlcXVlbmN5LA0KICAgICAgICAgICAgICAgICAgICBmbG9hdCBzcXVhc2hfYW1vdW50LCBmbG9hdCBzcXVhc2hfZnJlcXVlbmN5LA0KICAgICAgICAgICAgICAgICAgICBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KCXZlYzIgZjIgPSBjYWxjX2JyaWNrX3RleHR1cmUoY28gKiBzY2FsZSwNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcnRhcl9zaXplLCBiaWFzLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJpY2tfd2lkdGgsIHJvd19oZWlnaHQsDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRfYW1vdW50LCBpbnQob2Zmc2V0X2ZyZXF1ZW5jeSksDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcXVhc2hfYW1vdW50LCBpbnQoc3F1YXNoX2ZyZXF1ZW5jeSkpOw0KCWZsb2F0IHRpbnQgPSBmMi54Ow0KCWZsb2F0IGYgPSBmMi55Ow0KCWlmIChmICE9IDEuMCkgew0KCQlmbG9hdCBmYWNtID0gMS4wIC0gdGludDsNCgkJY29sb3IxID0gZmFjbSAqIGNvbG9yMSArIHRpbnQgKiBjb2xvcjI7DQoJfQ0KCWNvbG9yID0gKGYgPT0gMS4wKSA/IG1vcnRhciA6IGNvbG9yMTsNCglmYWMgPSBmOw0KI2Vsc2UNCgljb2xvciA9IHZlYzQoMS4wKTsNCglmYWMgPSAxLjA7DQojZW5kaWYNCn0NCg0Kdm9pZCBub2RlX3RleF9jbG91ZHModmVjMyBjbywgZmxvYXQgc2l6ZSwgb3V0IHZlYzQgY29sb3IsIG91dCBmbG9hdCBmYWMpDQp7DQoJY29sb3IgPSB2ZWM0KDEuMCk7DQoJZmFjID0gMS4wOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2Vudmlyb25tZW50X2VxdWlyZWN0YW5ndWxhcih2ZWMzIGNvLCBzYW1wbGVyMkQgaW1hLCBvdXQgdmVjNCBjb2xvcikNCnsNCgl2ZWMzIG5jbyA9IG5vcm1hbGl6ZShjbyk7DQoJZmxvYXQgdSA9IC1hdGFuKG5jby55LCBuY28ueCkgLyAoMi4wICogTV9QSSkgKyAwLjU7DQoJZmxvYXQgdiA9IGF0YW4obmNvLnosIGh5cG90KG5jby54LCBuY28ueSkpIC8gTV9QSSArIDAuNTsNCg0KCWNvbG9yID0gdGV4dHVyZTJEKGltYSwgdmVjMih1LCB2KSk7DQp9DQoNCnZvaWQgbm9kZV90ZXhfZW52aXJvbm1lbnRfbWlycm9yX2JhbGwodmVjMyBjbywgc2FtcGxlcjJEIGltYSwgb3V0IHZlYzQgY29sb3IpDQp7DQoJdmVjMyBuY28gPSBub3JtYWxpemUoY28pOw0KDQoJbmNvLnkgLT0gMS4wOw0KDQoJZmxvYXQgZGl2ID0gMi4wICogc3FydChtYXgoLTAuNSAqIG5jby55LCAwLjApKTsNCglpZiAoZGl2ID4gMC4wKQ0KCQluY28gLz0gZGl2Ow0KDQoJZmxvYXQgdSA9IDAuNSAqIChuY28ueCArIDEuMCk7DQoJZmxvYXQgdiA9IDAuNSAqIChuY28ueiArIDEuMCk7DQoNCgljb2xvciA9IHRleHR1cmUyRChpbWEsIHZlYzIodSwgdikpOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2Vudmlyb25tZW50X2VtcHR5KHZlYzMgY28sIG91dCB2ZWM0IGNvbG9yKQ0Kew0KCWNvbG9yID0gdmVjNCgxLjAsIDAuMCwgMS4wLCAxLjApOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2ltYWdlKHZlYzMgY28sIHNhbXBsZXIyRCBpbWEsIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgYWxwaGEpDQp7DQoJY29sb3IgPSB0ZXh0dXJlMkQoaW1hLCBjby54eSk7DQoJYWxwaGEgPSBjb2xvci5hOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2ltYWdlX2JveCh2ZWMzIHRleGNvLA0KICAgICAgICAgICAgICAgICAgICAgICAgdmVjMyBub2IsDQogICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVyMkQgaW1hLA0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgYmxlbmQsDQogICAgICAgICAgICAgICAgICAgICAgICBvdXQgdmVjNCBjb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICAgIG91dCBmbG9hdCBhbHBoYSkNCnsNCgkvKiBwcm9qZWN0IGZyb20gZGlyZWN0aW9uIHZlY3RvciB0byBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyB2YXJ5aW5nIHRyaWFuZ2xlcyAqLw0KCW5vYiA9IHZlYzMoYWJzKG5vYi54KSwgYWJzKG5vYi55KSwgYWJzKG5vYi56KSk7DQoJbm9iIC89IChub2IueCArIG5vYi55ICsgbm9iLnopOw0KDQoJLyogYmFzaWMgaWRlYSBpcyB0byB0aGluayBvZiB0aGlzIGFzIGEgdHJpYW5nbGUsIGVhY2ggY29ybmVyIHJlcHJlc2VudGluZw0KCSAqIG9uZSBvZiB0aGUgMyBmYWNlcyBvZiB0aGUgY3ViZS4gdmFyeWluZyB0aGUgY29ybmVycyB3ZSBoYXZlIHNpbmdsZSB0ZXh0dXJlcywNCgkgKiB2YXJ5aW5nIGJldHdlZW4gd2UgYmxlbmQgYmV0d2VlbiB0d28gdGV4dHVyZXMsIGFuZCB2YXJ5aW5nIHRoZSBtaWRkbGUgd2UgYSBibGVuZA0KCSAqIGJldHdlZW4gdGhyZWUgdGV4dHVyZXMuDQoJICoNCgkgKiB0aGUgTnh5eiB2YWx1ZXMgYXJlIHRoZSBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyB2YXJ5aW5nIGFuIGVxdWlsYXRlcmFsDQoJICogdHJpYW5nbGUsIHdoaWNoIHZhcnlpbmcgY2FzZSBvZiBibGVuZGluZywgdmFyeWluZyB0aGUgbWlkZGxlIGhhcyBhIHNtYWxsZXINCgkgKiBlcXVpbGF0ZXJhbCB0cmlhbmdsZSB3aGVyZSAzIHRleHR1cmVzIGJsZW5kLiB0aGlzIGRpdmlkZXMgdGhpbmdzIGludG8NCgkgKiA3IHpvbmVzLCB3aXRoIGFuIGlmICgpIHRlc3QgZm9yIGVhY2ggem9uZSAqLw0KDQoJdmVjMyB3ZWlnaHQgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOw0KCWZsb2F0IGxpbWl0ID0gMC41ICogKDEuMCArIGJsZW5kKTsNCg0KCS8qIGZpcnN0IHRlc3QgZm9yIGNvcm5lcnMgd2l0aCBzaW5nbGUgdGV4dHVyZSAqLw0KCWlmIChub2IueCA+IGxpbWl0ICogKG5vYi54ICsgbm9iLnkpICYmIG5vYi54ID4gbGltaXQgKiAobm9iLnggKyBub2IueikpIHsNCgkJd2VpZ2h0LnggPSAxLjA7DQoJfQ0KCWVsc2UgaWYgKG5vYi55ID4gbGltaXQgKiAobm9iLnggKyBub2IueSkgJiYgbm9iLnkgPiBsaW1pdCAqIChub2IueSArIG5vYi56KSkgew0KCQl3ZWlnaHQueSA9IDEuMDsNCgl9DQoJZWxzZSBpZiAobm9iLnogPiBsaW1pdCAqIChub2IueCArIG5vYi56KSAmJiBub2IueiA+IGxpbWl0ICogKG5vYi55ICsgbm9iLnopKSB7DQoJCXdlaWdodC56ID0gMS4wOw0KCX0NCgllbHNlIGlmIChibGVuZCA+IDAuMCkgew0KCQkvKiB2YXJ5aW5nIGNhc2Ugb2YgYmxlbmRpbmcsIHRlc3QgZm9yIG1peGVzIGJldHdlZW4gdHdvIHRleHR1cmVzICovDQoJCWlmIChub2IueiA8ICgxLjAgLSBsaW1pdCkgKiAobm9iLnkgKyBub2IueCkpIHsNCgkJCXdlaWdodC54ID0gbm9iLnggLyAobm9iLnggKyBub2IueSk7DQoJCQl3ZWlnaHQueCA9IGNsYW1wKCh3ZWlnaHQueCAtIDAuNSAqICgxLjAgLSBibGVuZCkpIC8gYmxlbmQsIDAuMCwgMS4wKTsNCgkJCXdlaWdodC55ID0gMS4wIC0gd2VpZ2h0Lng7DQoJCX0NCgkJZWxzZSBpZiAobm9iLnggPCAoMS4wIC0gbGltaXQpICogKG5vYi55ICsgbm9iLnopKSB7DQoJCQl3ZWlnaHQueSA9IG5vYi55IC8gKG5vYi55ICsgbm9iLnopOw0KCQkJd2VpZ2h0LnkgPSBjbGFtcCgod2VpZ2h0LnkgLSAwLjUgKiAoMS4wIC0gYmxlbmQpKSAvIGJsZW5kLCAwLjAsIDEuMCk7DQoJCQl3ZWlnaHQueiA9IDEuMCAtIHdlaWdodC55Ow0KCQl9DQoJCWVsc2UgaWYgKG5vYi55IDwgKDEuMCAtIGxpbWl0KSAqIChub2IueCArIG5vYi56KSkgew0KCQkJd2VpZ2h0LnggPSBub2IueCAvIChub2IueCArIG5vYi56KTsNCgkJCXdlaWdodC54ID0gY2xhbXAoKHdlaWdodC54IC0gMC41ICogKDEuMCAtIGJsZW5kKSkgLyBibGVuZCwgMC4wLCAxLjApOw0KCQkJd2VpZ2h0LnogPSAxLjAgLSB3ZWlnaHQueDsNCgkJfQ0KCQllbHNlIHsNCgkJCS8qIGxhc3QgY2FzZSwgd2UgaGF2ZSBhIG1peCBiZXR3ZWVuIHRocmVlICovDQoJCQl3ZWlnaHQueCA9ICgoMi4wIC0gbGltaXQpICogbm9iLnggKyAobGltaXQgLSAxLjApKSAvICgyLjAgKiBsaW1pdCAtIDEuMCk7DQoJCQl3ZWlnaHQueSA9ICgoMi4wIC0gbGltaXQpICogbm9iLnkgKyAobGltaXQgLSAxLjApKSAvICgyLjAgKiBsaW1pdCAtIDEuMCk7DQoJCQl3ZWlnaHQueiA9ICgoMi4wIC0gbGltaXQpICogbm9iLnogKyAobGltaXQgLSAxLjApKSAvICgyLjAgKiBsaW1pdCAtIDEuMCk7DQoJCX0NCgl9DQoJZWxzZSB7DQoJCS8qIERlc3BlcmF0ZSBtb2RlLCBubyB2YWxpZCBjaG9pY2UgYW55d2F5LCBmYWxsYmFjayB0byBvbmUgc2lkZS4qLw0KCQl3ZWlnaHQueCA9IDEuMDsNCgl9DQoJY29sb3IgPSB2ZWM0KDApOw0KCWlmICh3ZWlnaHQueCA+IDAuMCkgew0KCQljb2xvciArPSB3ZWlnaHQueCAqIHRleHR1cmUyRChpbWEsIHRleGNvLnl6KTsNCgl9DQoJaWYgKHdlaWdodC55ID4gMC4wKSB7DQoJCWNvbG9yICs9IHdlaWdodC55ICogdGV4dHVyZTJEKGltYSwgdGV4Y28ueHopOw0KCX0NCglpZiAod2VpZ2h0LnogPiAwLjApIHsNCgkJY29sb3IgKz0gd2VpZ2h0LnogKiB0ZXh0dXJlMkQoaW1hLCB0ZXhjby55eCk7DQoJfQ0KDQoJYWxwaGEgPSBjb2xvci5hOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2ltYWdlX2VtcHR5KHZlYzMgY28sIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgYWxwaGEpDQp7DQoJY29sb3IgPSB2ZWM0KDAuMCk7DQoJYWxwaGEgPSAwLjA7DQp9DQoNCnZvaWQgbm9kZV90ZXhfbWFnaWModmVjMyBjbywgZmxvYXQgc2NhbGUsIGZsb2F0IGRpc3RvcnRpb24sIGZsb2F0IGRlcHRoLCBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCgl2ZWMzIHAgPSBjbyAqIHNjYWxlOw0KCWZsb2F0IHggPSBzaW4oKHAueCArIHAueSArIHAueikgKiA1LjApOw0KCWZsb2F0IHkgPSBjb3MoKC1wLnggKyBwLnkgLSBwLnopICogNS4wKTsNCglmbG9hdCB6ID0gLWNvcygoLXAueCAtIHAueSArIHAueikgKiA1LjApOw0KDQoJaWYgKGRlcHRoID4gMCkgew0KCQl4ICo9IGRpc3RvcnRpb247DQoJCXkgKj0gZGlzdG9ydGlvbjsNCgkJeiAqPSBkaXN0b3J0aW9uOw0KCQl5ID0gLWNvcyh4IC0geSArIHopOw0KCQl5ICo9IGRpc3RvcnRpb247DQoJCWlmIChkZXB0aCA+IDEpIHsNCgkJCXggPSBjb3MoeCAtIHkgLSB6KTsNCgkJCXggKj0gZGlzdG9ydGlvbjsNCgkJCWlmIChkZXB0aCA+IDIpIHsNCgkJCQl6ID0gc2luKC14IC0geSAtIHopOw0KCQkJCXogKj0gZGlzdG9ydGlvbjsNCgkJCQlpZiAoZGVwdGggPiAzKSB7DQoJCQkJCXggPSAtY29zKC14ICsgeSAtIHopOw0KCQkJCQl4ICo9IGRpc3RvcnRpb247DQoJCQkJCWlmIChkZXB0aCA+IDQpIHsNCgkJCQkJCXkgPSAtc2luKC14ICsgeSArIHopOw0KCQkJCQkJeSAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJaWYgKGRlcHRoID4gNSkgew0KCQkJCQkJCXkgPSAtY29zKC14ICsgeSArIHopOw0KCQkJCQkJCXkgKj0gZGlzdG9ydGlvbjsNCgkJCQkJCQlpZiAoZGVwdGggPiA2KSB7DQoJCQkJCQkJCXggPSBjb3MoeCArIHkgKyB6KTsNCgkJCQkJCQkJeCAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJCQlpZiAoZGVwdGggPiA3KSB7DQoJCQkJCQkJCQl6ID0gc2luKHggKyB5IC0geik7DQoJCQkJCQkJCQl6ICo9IGRpc3RvcnRpb247DQoJCQkJCQkJCQlpZiAoZGVwdGggPiA4KSB7DQoJCQkJCQkJCQkJeCA9IC1jb3MoLXggLSB5ICsgeik7DQoJCQkJCQkJCQkJeCAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJCQkJCWlmIChkZXB0aCA+IDkpIHsNCgkJCQkJCQkJCQkJeSA9IC1zaW4oeCAtIHkgKyB6KTsNCgkJCQkJCQkJCQkJeSAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0NCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KCX0NCglpZiAoZGlzdG9ydGlvbiAhPSAwLjApIHsNCgkJZGlzdG9ydGlvbiAqPSAyLjA7DQoJCXggLz0gZGlzdG9ydGlvbjsNCgkJeSAvPSBkaXN0b3J0aW9uOw0KCQl6IC89IGRpc3RvcnRpb247DQoJfQ0KDQoJY29sb3IgPSB2ZWM0KDAuNSAtIHgsIDAuNSAtIHksIDAuNSAtIHosIDEuMCk7DQoJZmFjID0gKGNvbG9yLnggKyBjb2xvci55ICsgY29sb3IueikgLyAzLjA7DQp9DQoNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KZmxvYXQgbm9pc2VfZmFkZShmbG9hdCB0KQ0Kew0KCXJldHVybiB0ICogdCAqIHQgKiAodCAqICh0ICogNi4wIC0gMTUuMCkgKyAxMC4wKTsNCn0NCg0KZmxvYXQgbm9pc2Vfc2NhbGUzKGZsb2F0IHJlc3VsdCkNCnsNCglyZXR1cm4gMC45ODIwICogcmVzdWx0Ow0KfQ0KDQpmbG9hdCBub2lzZV9uZXJwKGZsb2F0IHQsIGZsb2F0IGEsIGZsb2F0IGIpDQp7DQoJcmV0dXJuICgxLjAgLSB0KSAqIGEgKyB0ICogYjsNCn0NCg0KZmxvYXQgbm9pc2VfZ3JhZCh1aW50IGhhc2gsIGZsb2F0IHgsIGZsb2F0IHksIGZsb2F0IHopDQp7DQoJdWludCBoID0gaGFzaCAmIDE1dTsNCglmbG9hdCB1ID0gaCA8IDh1ID8geCA6IHk7DQoJZmxvYXQgdnQgPSAoKGggPT0gMTJ1KSB8fCAoaCA9PSAxNHUpKSA/IHggOiB6Ow0KCWZsb2F0IHYgPSBoIDwgNHUgPyB5IDogdnQ7DQoJcmV0dXJuICgoKGggJiAxdSkgIT0gMHUpID8gLXUgOiB1KSArICgoKGggJiAydSkgIT0gMHUpID8gLXYgOiB2KTsNCn0NCg0KZmxvYXQgbm9pc2VfcGVybGluKGZsb2F0IHgsIGZsb2F0IHksIGZsb2F0IHopDQp7DQoJaW50IFg7IGZsb2F0IGZ4ID0gZmxvb3JmcmFjKHgsIFgpOw0KCWludCBZOyBmbG9hdCBmeSA9IGZsb29yZnJhYyh5LCBZKTsNCglpbnQgWjsgZmxvYXQgZnogPSBmbG9vcmZyYWMoeiwgWik7DQoNCglmbG9hdCB1ID0gbm9pc2VfZmFkZShmeCk7DQoJZmxvYXQgdiA9IG5vaXNlX2ZhZGUoZnkpOw0KCWZsb2F0IHcgPSBub2lzZV9mYWRlKGZ6KTsNCg0KCWZsb2F0IHJlc3VsdDsNCg0KCXJlc3VsdCA9IG5vaXNlX25lcnAodywgbm9pc2VfbmVycCh2LCBub2lzZV9uZXJwKHUsIG5vaXNlX2dyYWQoaGFzaChYLCBZLCBaKSwgZngsIGZ5LCBmeiksDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9pc2VfZ3JhZChoYXNoKFggKyAxLCBZLCBaKSwgZnggLSAxLjAsIGZ5LCBmeikpLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2lzZV9uZXJwKHUsIG5vaXNlX2dyYWQoaGFzaChYLCBZICsgMSwgWiksIGZ4LCBmeSAtIDEuMCwgZnopLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX2dyYWQoaGFzaChYICsgMSwgWSArIDEsIFopLCBmeCAtIDEuMCwgZnkgLSAxLjAsIGZ6KSkpLA0KCSAgICAgICAgICAgICAgICAgICAgbm9pc2VfbmVycCh2LCBub2lzZV9uZXJwKHUsIG5vaXNlX2dyYWQoaGFzaChYLCBZLCBaICsgMSksIGZ4LCBmeSwgZnogLSAxLjApLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX2dyYWQoaGFzaChYICsgMSwgWSwgWiArIDEpLCBmeCAtIDEuMCwgZnksIGZ6IC0gMS4wKSksDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX25lcnAodSwgbm9pc2VfZ3JhZChoYXNoKFgsIFkgKyAxLCBaICsgMSksIGZ4LCBmeSAtIDEuMCwgZnogLSAxLjApLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX2dyYWQoaGFzaChYICsgMSwgWSArIDEsIFogKyAxKSwgZnggLSAxLjAsIGZ5IC0gMS4wLCBmeiAtIDEuMCkpKSk7DQoJcmV0dXJuIG5vaXNlX3NjYWxlMyhyZXN1bHQpOw0KfQ0KDQpmbG9hdCBub2lzZSh2ZWMzIHApDQp7DQoJcmV0dXJuIDAuNSAqIG5vaXNlX3BlcmxpbihwLngsIHAueSwgcC56KSArIDAuNTsNCn0NCg0KZmxvYXQgc25vaXNlKHZlYzMgcCkNCnsNCglyZXR1cm4gbm9pc2VfcGVybGluKHAueCwgcC55LCBwLnopOw0KfQ0KDQpmbG9hdCBub2lzZV90dXJidWxlbmNlKHZlYzMgcCwgZmxvYXQgb2N0YXZlcywgaW50IGhhcmQpDQp7DQoJZmxvYXQgZnNjYWxlID0gMS4wOw0KCWZsb2F0IGFtcCA9IDEuMDsNCglmbG9hdCBzdW0gPSAwLjA7DQoJaW50IGksIG47DQoJb2N0YXZlcyA9IGNsYW1wKG9jdGF2ZXMsIDAuMCwgMTYuMCk7DQoJbiA9IGludChvY3RhdmVzKTsNCglmb3IgKGkgPSAwOyBpIDw9IG47IGkrKykgew0KCQlmbG9hdCB0ID0gbm9pc2UoZnNjYWxlICogcCk7DQoJCWlmIChoYXJkICE9IDApIHsNCgkJCXQgPSBhYnMoMi4wICogdCAtIDEuMCk7DQoJCX0NCgkJc3VtICs9IHQgKiBhbXA7DQoJCWFtcCAqPSAwLjU7DQoJCWZzY2FsZSAqPSAyLjA7DQoJfQ0KCWZsb2F0IHJtZCA9IG9jdGF2ZXMgLSBmbG9vcihvY3RhdmVzKTsNCglpZiAgKHJtZCAhPSAwLjApIHsNCgkJZmxvYXQgdCA9IG5vaXNlKGZzY2FsZSAqIHApOw0KCQlpZiAoaGFyZCAhPSAwKSB7DQoJCQl0ID0gYWJzKDIuMCAqIHQgLSAxLjApOw0KCQl9DQoJCWZsb2F0IHN1bTIgPSBzdW0gKyB0ICogYW1wOw0KCQlzdW0gKj0gKGZsb2F0KDEgPDwgbikgLyBmbG9hdCgoMSA8PCAobiArIDEpKSAtIDEpKTsNCgkJc3VtMiAqPSAoZmxvYXQoMSA8PCAobiArIDEpKSAvIGZsb2F0KCgxIDw8IChuICsgMikpIC0gMSkpOw0KCQlyZXR1cm4gKDEuMCAtIHJtZCkgKiBzdW0gKyBybWQgKiBzdW0yOw0KCX0NCgllbHNlIHsNCgkJc3VtICo9IChmbG9hdCgxIDw8IG4pIC8gZmxvYXQoKDEgPDwgKG4gKyAxKSkgLSAxKSk7DQoJCXJldHVybiBzdW07DQoJfQ0KfQ0KI2VuZGlmICAvLyBCSVRfT1BFUkFUSU9OUw0KDQp2b2lkIG5vZGVfdGV4X25vaXNlKHZlYzMgY28sIGZsb2F0IHNjYWxlLCBmbG9hdCBkZXRhaWwsIGZsb2F0IGRpc3RvcnRpb24sIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgZmFjKQ0Kew0KI2lmZGVmIEJJVF9PUEVSQVRJT05TDQoJdmVjMyBwID0gY28gKiBzY2FsZTsNCglpbnQgaGFyZCA9IDA7DQoJaWYgKGRpc3RvcnRpb24gIT0gMC4wKSB7DQoJCXZlYzMgciwgb2Zmc2V0ID0gdmVjMygxMy41LCAxMy41LCAxMy41KTsNCgkJci54ID0gbm9pc2UocCArIG9mZnNldCkgKiBkaXN0b3J0aW9uOw0KCQlyLnkgPSBub2lzZShwKSAqIGRpc3RvcnRpb247DQoJCXIueiA9IG5vaXNlKHAgLSBvZmZzZXQpICogZGlzdG9ydGlvbjsNCgkJcCArPSByOw0KCX0NCg0KCWZhYyA9IG5vaXNlX3R1cmJ1bGVuY2UocCwgZGV0YWlsLCBoYXJkKTsNCgljb2xvciA9IHZlYzQoZmFjLA0KCSAgICAgICAgICAgICBub2lzZV90dXJidWxlbmNlKHZlYzMocC55LCBwLngsIHAueiksIGRldGFpbCwgaGFyZCksDQoJICAgICAgICAgICAgIG5vaXNlX3R1cmJ1bGVuY2UodmVjMyhwLnksIHAueiwgcC54KSwgZGV0YWlsLCBoYXJkKSwNCgkgICAgICAgICAgICAgMSk7DQojZWxzZSAgLy8gQklUX09QRVJBVElPTlMNCgljb2xvciA9IHZlYzQoMS4wKTsNCglmYWMgPSAxLjA7DQojZW5kaWYgIC8vIEJJVF9PUEVSQVRJT05TDQp9DQoNCg0KI2lmZGVmIEJJVF9PUEVSQVRJT05TDQoNCi8qIE11c2dyYXZlIGZCbQ0KICoNCiAqIEg6IGZyYWN0YWwgaW5jcmVtZW50IHBhcmFtZXRlcg0KICogbGFjdW5hcml0eTogZ2FwIGJldHdlZW4gc3VjY2Vzc2l2ZSBmcmVxdWVuY2llcw0KICogb2N0YXZlczogbnVtYmVyIG9mIGZyZXF1ZW5jaWVzIHZhcnlpbmcgdGhlIGZCbQ0KICoNCiAqIGZyb20gIlRleHR1cmluZyBhbmQgTW9kZWxsaW5nOiBBIHByb2NlZHVyYWwgYXBwcm9hY2giDQogKi8NCg0KZmxvYXQgbm9pc2VfbXVzZ3JhdmVfZkJtKHZlYzMgcCwgZmxvYXQgSCwgZmxvYXQgbGFjdW5hcml0eSwgZmxvYXQgb2N0YXZlcykNCnsNCglmbG9hdCBybWQ7DQoJZmxvYXQgdmFsdWUgPSAwLjA7DQoJZmxvYXQgcHdyID0gMS4wOw0KCWZsb2F0IHB3SEwgPSBwb3cobGFjdW5hcml0eSwgLUgpOw0KCWludCBpOw0KDQoJZm9yIChpID0gMDsgaSA8IGludChvY3RhdmVzKTsgaSsrKSB7DQoJCXZhbHVlICs9IHNub2lzZShwKSAqIHB3cjsNCgkJcHdyICo9IHB3SEw7DQoJCXAgKj0gbGFjdW5hcml0eTsNCgl9DQoNCglybWQgPSBvY3RhdmVzIC0gZmxvb3Iob2N0YXZlcyk7DQoJaWYgKHJtZCAhPSAwLjApDQoJCXZhbHVlICs9IHJtZCAqIHNub2lzZShwKSAqIHB3cjsNCg0KCXJldHVybiB2YWx1ZTsNCn0NCg0KLyogTXVzZ3JhdmUgTXVsdGlmcmFjdGFsDQogKg0KICogSDogaGlnaGVzdCBmcmFjdGFsIGRpbWVuc2lvbg0KICogbGFjdW5hcml0eTogZ2FwIGJldHdlZW4gc3VjY2Vzc2l2ZSBmcmVxdWVuY2llcw0KICogb2N0YXZlczogbnVtYmVyIG9mIGZyZXF1ZW5jaWVzIHZhcnlpbmcgdGhlIGZCbQ0KICovDQoNCmZsb2F0IG5vaXNlX211c2dyYXZlX211bHRpX2ZyYWN0YWwodmVjMyBwLCBmbG9hdCBILCBmbG9hdCBsYWN1bmFyaXR5LCBmbG9hdCBvY3RhdmVzKQ0Kew0KCWZsb2F0IHJtZDsNCglmbG9hdCB2YWx1ZSA9IDEuMDsNCglmbG9hdCBwd3IgPSAxLjA7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJaW50IGk7DQoNCglmb3IgKGkgPSAwOyBpIDwgaW50KG9jdGF2ZXMpOyBpKyspIHsNCgkJdmFsdWUgKj0gKHB3ciAqIHNub2lzZShwKSArIDEuMCk7DQoJCXB3ciAqPSBwd0hMOw0KCQlwICo9IGxhY3VuYXJpdHk7DQoJfQ0KDQoJcm1kID0gb2N0YXZlcyAtIGZsb29yKG9jdGF2ZXMpOw0KCWlmIChybWQgIT0gMC4wKQ0KCQl2YWx1ZSAqPSAocm1kICogcHdyICogc25vaXNlKHApICsgMS4wKTsgLyogY29ycmVjdD8gKi8NCg0KCXJldHVybiB2YWx1ZTsNCn0NCg0KLyogTXVzZ3JhdmUgSGV0ZXJvZ2VuZW91cyBUZXJyYWluDQogKg0KICogSDogZnJhY3RhbCBkaW1lbnNpb24gb2YgdGhlIHJvdWdoZXN0IGFyZWENCiAqIGxhY3VuYXJpdHk6IGdhcCBiZXR3ZWVuIHN1Y2Nlc3NpdmUgZnJlcXVlbmNpZXMNCiAqIG9jdGF2ZXM6IG51bWJlciBvZiBmcmVxdWVuY2llcyB2YXJ5aW5nIHRoZSBmQm0NCiAqIG9mZnNldDogcmFpc2VzIHRoZSB0ZXJyYWluIGZyb20gYHNlYSBsZXZlbCcNCiAqLw0KDQpmbG9hdCBub2lzZV9tdXNncmF2ZV9oZXRlcm9fdGVycmFpbih2ZWMzIHAsIGZsb2F0IEgsIGZsb2F0IGxhY3VuYXJpdHksIGZsb2F0IG9jdGF2ZXMsIGZsb2F0IG9mZnNldCkNCnsNCglmbG9hdCB2YWx1ZSwgaW5jcmVtZW50LCBybWQ7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJZmxvYXQgcHdyID0gcHdITDsNCglpbnQgaTsNCg0KCS8qIGZpcnN0IHVuc2NhbGVkIG9jdGF2ZSBvZiBmdW5jdGlvbjsgbGF0ZXIgb2N0YXZlcyBhcmUgc2NhbGVkICovDQoJdmFsdWUgPSBvZmZzZXQgKyBzbm9pc2UocCk7DQoJcCAqPSBsYWN1bmFyaXR5Ow0KDQoJZm9yIChpID0gMTsgaSA8IGludChvY3RhdmVzKTsgaSsrKSB7DQoJCWluY3JlbWVudCA9IChzbm9pc2UocCkgKyBvZmZzZXQpICogcHdyICogdmFsdWU7DQoJCXZhbHVlICs9IGluY3JlbWVudDsNCgkJcHdyICo9IHB3SEw7DQoJCXAgKj0gbGFjdW5hcml0eTsNCgl9DQoNCglybWQgPSBvY3RhdmVzIC0gZmxvb3Iob2N0YXZlcyk7DQoJaWYgKHJtZCAhPSAwLjApIHsNCgkJaW5jcmVtZW50ID0gKHNub2lzZShwKSArIG9mZnNldCkgKiBwd3IgKiB2YWx1ZTsNCgkJdmFsdWUgKz0gcm1kICogaW5jcmVtZW50Ow0KCX0NCg0KCXJldHVybiB2YWx1ZTsNCn0NCg0KLyogSHlicmlkIEFkZGl0aXZlL011bHRpcGxpY2F0aXZlIE11bHRpZnJhY3RhbCBUZXJyYWluDQogKg0KICogSDogZnJhY3RhbCBkaW1lbnNpb24gb2YgdGhlIHJvdWdoZXN0IGFyZWENCiAqIGxhY3VuYXJpdHk6IGdhcCBiZXR3ZWVuIHN1Y2Nlc3NpdmUgZnJlcXVlbmNpZXMNCiAqIG9jdGF2ZXM6IG51bWJlciBvZiBmcmVxdWVuY2llcyB2YXJ5aW5nIHRoZSBmQm0NCiAqIG9mZnNldDogcmFpc2VzIHRoZSB0ZXJyYWluIGZyb20gYHNlYSBsZXZlbCcNCiAqLw0KDQpmbG9hdCBub2lzZV9tdXNncmF2ZV9oeWJyaWRfbXVsdGlfZnJhY3RhbCh2ZWMzIHAsIGZsb2F0IEgsIGZsb2F0IGxhY3VuYXJpdHksIGZsb2F0IG9jdGF2ZXMsIGZsb2F0IG9mZnNldCwgZmxvYXQgZ2FpbikNCnsNCglmbG9hdCByZXN1bHQsIHNpZ25hbCwgd2VpZ2h0LCBybWQ7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJZmxvYXQgcHdyID0gcHdITDsNCglpbnQgaTsNCg0KCXJlc3VsdCA9IHNub2lzZShwKSArIG9mZnNldDsNCgl3ZWlnaHQgPSBnYWluICogcmVzdWx0Ow0KCXAgKj0gbGFjdW5hcml0eTsNCg0KCWZvciAoaSA9IDE7ICh3ZWlnaHQgPiAwLjAwMWYpICYmIChpIDwgaW50KG9jdGF2ZXMpKTsgaSsrKSB7DQoJCWlmICh3ZWlnaHQgPiAxLjApDQoJCQl3ZWlnaHQgPSAxLjA7DQoNCgkJc2lnbmFsID0gKHNub2lzZShwKSArIG9mZnNldCkgKiBwd3I7DQoJCXB3ciAqPSBwd0hMOw0KCQlyZXN1bHQgKz0gd2VpZ2h0ICogc2lnbmFsOw0KCQl3ZWlnaHQgKj0gZ2FpbiAqIHNpZ25hbDsNCgkJcCAqPSBsYWN1bmFyaXR5Ow0KCX0NCg0KCXJtZCA9IG9jdGF2ZXMgLSBmbG9vcihvY3RhdmVzKTsNCglpZiAocm1kICE9IDAuMCkNCgkJcmVzdWx0ICs9IHJtZCAqICgoc25vaXNlKHApICsgb2Zmc2V0KSAqIHB3cik7DQoNCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQovKiBSaWRnZWQgTXVsdGlmcmFjdGFsIFRlcnJhaW4NCiAqDQogKiBIOiBmcmFjdGFsIGRpbWVuc2lvbiBvZiB0aGUgcm91Z2hlc3QgYXJlYQ0KICogbGFjdW5hcml0eTogZ2FwIGJldHdlZW4gc3VjY2Vzc2l2ZSBmcmVxdWVuY2llcw0KICogb2N0YXZlczogbnVtYmVyIG9mIGZyZXF1ZW5jaWVzIHZhcnlpbmcgdGhlIGZCbQ0KICogb2Zmc2V0OiByYWlzZXMgdGhlIHRlcnJhaW4gZnJvbSBgc2VhIGxldmVsJw0KICovDQoNCmZsb2F0IG5vaXNlX211c2dyYXZlX3JpZGdlZF9tdWx0aV9mcmFjdGFsKHZlYzMgcCwgZmxvYXQgSCwgZmxvYXQgbGFjdW5hcml0eSwgZmxvYXQgb2N0YXZlcywgZmxvYXQgb2Zmc2V0LCBmbG9hdCBnYWluKQ0Kew0KCWZsb2F0IHJlc3VsdCwgc2lnbmFsLCB3ZWlnaHQ7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJZmxvYXQgcHdyID0gcHdITDsNCglpbnQgaTsNCg0KCXNpZ25hbCA9IG9mZnNldCAtIGFicyhzbm9pc2UocCkpOw0KCXNpZ25hbCAqPSBzaWduYWw7DQoJcmVzdWx0ID0gc2lnbmFsOw0KCXdlaWdodCA9IDEuMDsNCg0KCWZvciAoaSA9IDE7IGkgPCBpbnQob2N0YXZlcyk7IGkrKykgew0KCQlwICo9IGxhY3VuYXJpdHk7DQoJCXdlaWdodCA9IGNsYW1wKHNpZ25hbCAqIGdhaW4sIDAuMCwgMS4wKTsNCgkJc2lnbmFsID0gb2Zmc2V0IC0gYWJzKHNub2lzZShwKSk7DQoJCXNpZ25hbCAqPSBzaWduYWw7DQoJCXNpZ25hbCAqPSB3ZWlnaHQ7DQoJCXJlc3VsdCArPSBzaWduYWwgKiBwd3I7DQoJCXB3ciAqPSBwd0hMOw0KCX0NCg0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZsb2F0IHN2bV9tdXNncmF2ZShpbnQgdHlwZSwNCiAgICAgICAgICAgICAgICAgICBmbG9hdCBkaW1lbnNpb24sDQogICAgICAgICAgICAgICAgICAgZmxvYXQgbGFjdW5hcml0eSwNCiAgICAgICAgICAgICAgICAgICBmbG9hdCBvY3RhdmVzLA0KICAgICAgICAgICAgICAgICAgIGZsb2F0IG9mZnNldCwNCiAgICAgICAgICAgICAgICAgICBmbG9hdCBpbnRlbnNpdHksDQogICAgICAgICAgICAgICAgICAgZmxvYXQgZ2FpbiwNCiAgICAgICAgICAgICAgICAgICB2ZWMzIHApDQp7DQoJaWYgKHR5cGUgPT0gMCAvKk5PREVfTVVTR1JBVkVfTVVMVElGUkFDVEFMKi8pDQoJCXJldHVybiBpbnRlbnNpdHkgKiBub2lzZV9tdXNncmF2ZV9tdWx0aV9mcmFjdGFsKHAsIGRpbWVuc2lvbiwgbGFjdW5hcml0eSwgb2N0YXZlcyk7DQoJZWxzZSBpZiAodHlwZSA9PSAxIC8qTk9ERV9NVVNHUkFWRV9GQk0qLykNCgkJcmV0dXJuIGludGVuc2l0eSAqIG5vaXNlX211c2dyYXZlX2ZCbShwLCBkaW1lbnNpb24sIGxhY3VuYXJpdHksIG9jdGF2ZXMpOw0KCWVsc2UgaWYgKHR5cGUgPT0gMiAvKk5PREVfTVVTR1JBVkVfSFlCUklEX01VTFRJRlJBQ1RBTCovKQ0KCQlyZXR1cm4gaW50ZW5zaXR5ICogbm9pc2VfbXVzZ3JhdmVfaHlicmlkX211bHRpX2ZyYWN0YWwocCwgZGltZW5zaW9uLCBsYWN1bmFyaXR5LCBvY3RhdmVzLCBvZmZzZXQsIGdhaW4pOw0KCWVsc2UgaWYgKHR5cGUgPT0gMyAvKk5PREVfTVVTR1JBVkVfUklER0VEX01VTFRJRlJBQ1RBTCovKQ0KCQlyZXR1cm4gaW50ZW5zaXR5ICogbm9pc2VfbXVzZ3JhdmVfcmlkZ2VkX211bHRpX2ZyYWN0YWwocCwgZGltZW5zaW9uLCBsYWN1bmFyaXR5LCBvY3RhdmVzLCBvZmZzZXQsIGdhaW4pOw0KCWVsc2UgaWYgKHR5cGUgPT0gNCAvKk5PREVfTVVTR1JBVkVfSEVURVJPX1RFUlJBSU4qLykNCgkJcmV0dXJuIGludGVuc2l0eSAqIG5vaXNlX211c2dyYXZlX2hldGVyb190ZXJyYWluKHAsIGRpbWVuc2lvbiwgbGFjdW5hcml0eSwgb2N0YXZlcywgb2Zmc2V0KTsNCglyZXR1cm4gMC4wOw0KfQ0KI2VuZGlmICAvLyAjaWZkZWYgQklUX09QRVJBVElPTlMNCg0Kdm9pZCBub2RlX3RleF9tdXNncmF2ZSh2ZWMzIGNvLA0KICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgZGV0YWlsLA0KICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBkaW1lbnNpb24sDQogICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IGxhY3VuYXJpdHksDQogICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IG9mZnNldCwNCiAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgZ2FpbiwNCiAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgdHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgb3V0IHZlYzQgY29sb3IsDQogICAgICAgICAgICAgICAgICAgICAgIG91dCBmbG9hdCBmYWMpDQp7DQojaWZkZWYgQklUX09QRVJBVElPTlMNCglmYWMgPSBzdm1fbXVzZ3JhdmUoaW50KHR5cGUpLA0KCSAgICAgICAgICAgICAgICAgICBkaW1lbnNpb24sDQoJICAgICAgICAgICAgICAgICAgIGxhY3VuYXJpdHksDQoJICAgICAgICAgICAgICAgICAgIGRldGFpbCwNCgkgICAgICAgICAgICAgICAgICAgb2Zmc2V0LA0KCSAgICAgICAgICAgICAgICAgICAxLjAsDQoJICAgICAgICAgICAgICAgICAgIGdhaW4sDQoJICAgICAgICAgICAgICAgICAgIGNvICogc2NhbGUpOw0KI2Vsc2UNCglmYWMgPSAxLjA7DQojZW5kaWYNCg0KCWNvbG9yID0gdmVjNChmYWMsIGZhYywgZmFjLCAxLjApOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X3NreSh2ZWMzIGNvLCBvdXQgdmVjNCBjb2xvcikNCnsNCgljb2xvciA9IHZlYzQoMS4wKTsNCn0NCg0Kdm9pZCBub2RlX3RleF92b3Jvbm9pKHZlYzMgY28sIGZsb2F0IHNjYWxlLCBmbG9hdCBjb2xvcmluZywgb3V0IHZlYzQgY29sb3IsIG91dCBmbG9hdCBmYWMpDQp7DQojaWZkZWYgQklUX09QRVJBVElPTlMNCgl2ZWMzIHAgPSBjbyAqIHNjYWxlOw0KCWludCB4eCwgeXksIHp6LCB4aSwgeWksIHppOw0KCWZsb2F0IGRhWzRdOw0KCXZlYzMgcGFbNF07DQoNCgl4aSA9IGZsb29yX3RvX2ludChwWzBdKTsNCgl5aSA9IGZsb29yX3RvX2ludChwWzFdKTsNCgl6aSA9IGZsb29yX3RvX2ludChwWzJdKTsNCg0KCWRhWzBdID0gMWUrMTA7DQoJZGFbMV0gPSAxZSsxMDsNCglkYVsyXSA9IDFlKzEwOw0KCWRhWzNdID0gMWUrMTA7DQoNCglmb3IgKHh4ID0geGkgLSAxOyB4eCA8PSB4aSArIDE7IHh4KyspIHsNCgkJZm9yICh5eSA9IHlpIC0gMTsgeXkgPD0geWkgKyAxOyB5eSsrKSB7DQoJCQlmb3IgKHp6ID0gemkgLSAxOyB6eiA8PSB6aSArIDE7IHp6KyspIHsNCgkJCQl2ZWMzIGlwID0gdmVjMyh4eCwgeXksIHp6KTsNCgkJCQl2ZWMzIHZwID0gY2VsbG5vaXNlX2NvbG9yKGlwKTsNCgkJCQl2ZWMzIHBkID0gcCAtICh2cCArIGlwKTsNCgkJCQlmbG9hdCBkID0gZG90KHBkLCBwZCk7DQoJCQkJdnAgKz0gdmVjMyh4eCwgeXksIHp6KTsNCgkJCQlpZiAoZCA8IGRhWzBdKSB7DQoJCQkJCWRhWzNdID0gZGFbMl07DQoJCQkJCWRhWzJdID0gZGFbMV07DQoJCQkJCWRhWzFdID0gZGFbMF07DQoJCQkJCWRhWzBdID0gZDsNCgkJCQkJcGFbM10gPSBwYVsyXTsNCgkJCQkJcGFbMl0gPSBwYVsxXTsNCgkJCQkJcGFbMV0gPSBwYVswXTsNCgkJCQkJcGFbMF0gPSB2cDsNCgkJCQl9DQoJCQkJZWxzZSBpZiAoZCA8IGRhWzFdKSB7DQoJCQkJCWRhWzNdID0gZGFbMl07DQoJCQkJCWRhWzJdID0gZGFbMV07DQoJCQkJCWRhWzFdID0gZDsNCg0KCQkJCQlwYVszXSA9IHBhWzJdOw0KCQkJCQlwYVsyXSA9IHBhWzFdOw0KCQkJCQlwYVsxXSA9IHZwOw0KCQkJCX0NCgkJCQllbHNlIGlmIChkIDwgZGFbMl0pIHsNCgkJCQkJZGFbM10gPSBkYVsyXTsNCgkJCQkJZGFbMl0gPSBkOw0KDQoJCQkJCXBhWzNdID0gcGFbMl07DQoJCQkJCXBhWzJdID0gdnA7DQoJCQkJfQ0KCQkJCWVsc2UgaWYgKGQgPCBkYVszXSkgew0KCQkJCQlkYVszXSA9IGQ7DQoJCQkJCXBhWzNdID0gdnA7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfQ0KDQoJaWYgKGNvbG9yaW5nID09IDAuMCkgew0KCQlmYWMgPSBhYnMoZGFbMF0pOw0KCQljb2xvciA9IHZlYzQoZmFjLCBmYWMsIGZhYywgMSk7DQoJfQ0KCWVsc2Ugew0KCQljb2xvciA9IHZlYzQoY2VsbG5vaXNlX2NvbG9yKHBhWzBdKSwgMSk7DQoJCWZhYyA9IChjb2xvci54ICsgY29sb3IueSArIGNvbG9yLnopICogKDEuMCAvIDMuMCk7DQoJfQ0KI2Vsc2UgIC8vIEJJVF9PUEVSQVRJT05TDQoJY29sb3IgPSB2ZWM0KDEuMCk7DQoJZmFjID0gMS4wOw0KI2VuZGlmICAvLyBCSVRfT1BFUkFUSU9OUw0KfQ0KDQojaWZkZWYgQklUX09QRVJBVElPTlMNCmZsb2F0IGNhbGNfd2F2ZSh2ZWMzIHAsIGZsb2F0IGRpc3RvcnRpb24sIGZsb2F0IGRldGFpbCwgZmxvYXQgZGV0YWlsX3NjYWxlLCBpbnQgd2F2ZV90eXBlLCBpbnQgd2F2ZV9wcm9maWxlKQ0Kew0KCWZsb2F0IG47DQoNCglpZiAod2F2ZV90eXBlID09IDApIC8qIHR5cGUgYmFuZHMgKi8NCgkJbiA9IChwLnggKyBwLnkgKyBwLnopICogMTAuMDsNCgllbHNlIC8qIHR5cGUgcmluZ3MgKi8NCgkJbiA9IGxlbmd0aChwKSAqIDIwLjA7DQoNCglpZiAoZGlzdG9ydGlvbiAhPSAwLjApDQoJCW4gKz0gZGlzdG9ydGlvbiAqIG5vaXNlX3R1cmJ1bGVuY2UocCAqIGRldGFpbF9zY2FsZSwgZGV0YWlsLCAwKTsNCg0KCWlmICh3YXZlX3Byb2ZpbGUgPT0gMCkgeyAvKiBwcm9maWxlIHNpbiAqLw0KCQlyZXR1cm4gMC41ICsgMC41ICogc2luKG4pOw0KCX0NCgllbHNlIHsgLyogcHJvZmlsZSBzYXcgKi8NCgkJbiAvPSAyLjAgKiBNX1BJOw0KCQluIC09IGludChuKTsNCgkJcmV0dXJuIChuIDwgMC4wKSA/IG4gKyAxLjAgOiBuOw0KCX0NCn0NCiNlbmRpZiAgLy8gQklUX09QRVJBVElPTlMNCg0Kdm9pZCBub2RlX3RleF93YXZlKA0KICAgICAgICB2ZWMzIGNvLCBmbG9hdCBzY2FsZSwgZmxvYXQgZGlzdG9ydGlvbiwgZmxvYXQgZGV0YWlsLCBmbG9hdCBkZXRhaWxfc2NhbGUsIGZsb2F0IHdhdmVfdHlwZSwgZmxvYXQgd2F2ZV9wcm9maWxlLA0KICAgICAgICBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KCWZsb2F0IGY7DQoJZiA9IGNhbGNfd2F2ZShjbyAqIHNjYWxlLCBkaXN0b3J0aW9uLCBkZXRhaWwsIGRldGFpbF9zY2FsZSwgaW50KHdhdmVfdHlwZSksIGludCh3YXZlX3Byb2ZpbGUpKTsNCg0KCWNvbG9yID0gdmVjNChmLCBmLCBmLCAxLjApOw0KCWZhYyA9IGY7DQojZWxzZSAgLy8gQklUX09QRVJBVElPTlMNCgljb2xvciA9IHZlYzQoMS4wKTsNCglmYWMgPSAxOw0KI2VuZGlmICAvLyBCSVRfT1BFUkFUSU9OUw0KfQ0KDQovKiBsaWdodCBwYXRoICovDQoNCnZvaWQgbm9kZV9saWdodF9wYXRoKA0KCW91dCBmbG9hdCBpc19jYW1lcmFfcmF5LA0KCW91dCBmbG9hdCBpc19zaGFkb3dfcmF5LA0KCW91dCBmbG9hdCBpc19kaWZmdXNlX3JheSwNCglvdXQgZmxvYXQgaXNfZ2xvc3N5X3JheSwNCglvdXQgZmxvYXQgaXNfc2luZ3VsYXJfcmF5LA0KCW91dCBmbG9hdCBpc19yZWZsZWN0aW9uX3JheSwNCglvdXQgZmxvYXQgaXNfdHJhbnNtaXNzaW9uX3JheSwNCglvdXQgZmxvYXQgcmF5X2xlbmd0aCwNCglvdXQgZmxvYXQgcmF5X2RlcHRoLA0KCW91dCBmbG9hdCB0cmFuc3BhcmVudF9kZXB0aCwNCglvdXQgZmxvYXQgdHJhbnNtaXNzaW9uX2RlcHRoKQ0Kew0KCWlzX2NhbWVyYV9yYXkgPSAxLjA7DQoJaXNfc2hhZG93X3JheSA9IDAuMDsNCglpc19kaWZmdXNlX3JheSA9IDAuMDsNCglpc19nbG9zc3lfcmF5ID0gMC4wOw0KCWlzX3Npbmd1bGFyX3JheSA9IDAuMDsNCglpc19yZWZsZWN0aW9uX3JheSA9IDAuMDsNCglpc190cmFuc21pc3Npb25fcmF5ID0gMC4wOw0KCXJheV9sZW5ndGggPSAxLjA7DQoJcmF5X2RlcHRoID0gMS4wOw0KCXRyYW5zcGFyZW50X2RlcHRoID0gMS4wOw0KCXRyYW5zbWlzc2lvbl9kZXB0aCA9IDEuMDsNCn0NCg0Kdm9pZCBub2RlX2xpZ2h0X2ZhbGxvZmYoZmxvYXQgc3RyZW5ndGgsIGZsb2F0IHRzbW9vdGgsIG91dCBmbG9hdCBxdWFkcmF0aWMsIG91dCBmbG9hdCBsaW5lYXIsIG91dCBmbG9hdCBjb25zdGFudCkNCnsNCglxdWFkcmF0aWMgPSBzdHJlbmd0aDsNCglsaW5lYXIgPSBzdHJlbmd0aDsNCgljb25zdGFudCA9IHN0cmVuZ3RoOw0KfQ0KDQp2b2lkIG5vZGVfb2JqZWN0X2luZm8ob3V0IHZlYzMgbG9jYXRpb24sIG91dCBmbG9hdCBvYmplY3RfaW5kZXgsIG91dCBmbG9hdCBtYXRlcmlhbF9pbmRleCwgb3V0IGZsb2F0IHJhbmRvbSkNCnsNCglsb2NhdGlvbiA9IHZlYzMoMC4wKTsNCglvYmplY3RfaW5kZXggPSAwLjA7DQoJbWF0ZXJpYWxfaW5kZXggPSAwLjA7DQoJcmFuZG9tID0gMC4wOw0KfQ0KDQp2b2lkIG5vZGVfbm9ybWFsX21hcCh2ZWM0IHRhbmdlbnQsIHZlYzMgbm9ybWFsLCB2ZWMzIHRleG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCXZlYzMgQiA9IHRhbmdlbnQudyAqIGNyb3NzKG5vcm1hbCwgdGFuZ2VudC54eXopOw0KDQoJb3V0bm9ybWFsID0gdGV4bm9ybWFsLnggKiB0YW5nZW50Lnh5eiArIHRleG5vcm1hbC55ICogQiArIHRleG5vcm1hbC56ICogbm9ybWFsOw0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZShvdXRub3JtYWwpOw0KfQ0KDQp2b2lkIG5vZGVfYnVtcChmbG9hdCBzdHJlbmd0aCwgZmxvYXQgZGlzdCwgZmxvYXQgaGVpZ2h0LCB2ZWMzIE4sIHZlYzMgc3VyZl9wb3MsIGZsb2F0IGludmVydCwgb3V0IHZlYzMgcmVzdWx0KQ0Kew0KCWlmIChpbnZlcnQgIT0gMC4wKSB7DQoJCWRpc3QgKj0gLTEuMDsNCgl9DQoJdmVjMyBkUGR4ID0gZEZkeChzdXJmX3Bvcyk7DQoJdmVjMyBkUGR5ID0gZEZkeShzdXJmX3Bvcyk7DQoNCgkvKiBHZXQgc3VyZmFjZSB0YW5nZW50cyBmcm9tIG5vcm1hbC4gKi8NCgl2ZWMzIFJ4ID0gY3Jvc3MoZFBkeSwgTik7DQoJdmVjMyBSeSA9IGNyb3NzKE4sIGRQZHgpOw0KDQoJLyogQ29tcHV0ZSBzdXJmYWNlIGdyYWRpZW50IGFuZCBkZXRlcm1pbmFudC4gKi8NCglmbG9hdCBkZXQgPSBkb3QoZFBkeCwgUngpOw0KCWZsb2F0IGFic2RldCA9IGFicyhkZXQpOw0KDQoJZmxvYXQgZEhkeCA9IGRGZHgoaGVpZ2h0KTsNCglmbG9hdCBkSGR5ID0gZEZkeShoZWlnaHQpOw0KCXZlYzMgc3VyZmdyYWQgPSBkSGR4ICogUnggKyBkSGR5ICogUnk7DQoNCglzdHJlbmd0aCA9IG1heChzdHJlbmd0aCwgMC4wKTsNCg0KCXJlc3VsdCA9IG5vcm1hbGl6ZShhYnNkZXQgKiBOIC0gZGlzdCAqIHNpZ24oZGV0KSAqIHN1cmZncmFkKTsNCglyZXN1bHQgPSBub3JtYWxpemUoc3RyZW5ndGggKiByZXN1bHQgKyAoMS4wIC0gc3RyZW5ndGgpICogTik7DQp9DQoNCi8qIG91dHB1dCAqLw0KDQp2b2lkIG5vZGVfb3V0cHV0X21hdGVyaWFsKHZlYzQgc3VyZmFjZSwgdmVjNCB2b2x1bWUsIGZsb2F0IGRpc3BsYWNlbWVudCwgb3V0IHZlYzQgcmVzdWx0KQ0Kew0KCXJlc3VsdCA9IHN1cmZhY2U7DQp9DQoNCnZvaWQgbm9kZV9vdXRwdXRfd29ybGQodmVjNCBzdXJmYWNlLCB2ZWM0IHZvbHVtZSwgb3V0IHZlYzQgcmVzdWx0KQ0Kew0KCXJlc3VsdCA9IHN1cmZhY2U7DQp9DQoNCi8qICoqKioqKioqKioqKioqKioqKioqKiogbWF0Y2FwIHN0eWxlIHJlbmRlciAqKioqKioqKioqKioqKioqKioqKiAqLw0KDQp2b2lkIG1hdGVyaWFsX3ByZXZpZXdfbWF0Y2FwKHZlYzQgY29sb3IsIHNhbXBsZXIyRCBpbWEsIHZlYzQgTiwgdmVjNCBtYXNrLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJdmVjMyBub3JtYWw7DQoJdmVjMiB0ZXg7DQoJDQojaWZuZGVmIFVTRV9PUEVOU1VCRElWDQoJLyogcmVtYXAgdG8gMC4wIC0gMS4wIHJhbmdlLiBUaGlzIGlzIGRvbmUgYmVjYXVzZSBPcGVuR0wgMi4wIGNsYW1wcyBjb2xvcnMNCgkgKiBiZXR3ZWVuIHNoYWRlciBzdGFnZXMgYW5kIHdlIHdhbnQgdGhlIGZ1bGwgcmFuZ2Ugb2YgdGhlIG5vcm1hbCAqLw0KCW5vcm1hbCA9IHZlYzMoMi4wLCAyLjAsIDIuMCkgKiB2ZWMzKE4ueCwgTi55LCBOLnopIC0gdmVjMygxLjAsIDEuMCwgMS4wKTsNCglpZiAobm9ybWFsLnogPCAwLjApIHsNCgkJbm9ybWFsLnogPSAwLjA7DQoJfQ0KCW5vcm1hbCA9IG5vcm1hbGl6ZShub3JtYWwpOw0KI2Vsc2UNCglub3JtYWwgPSBpbnB0LnYubm9ybWFsOw0KCW1hc2sgPSB2ZWM0KDEuMCwgMS4wLCAxLjAsIDEuMCk7DQojZW5kaWYNCg0KCXRleC54ID0gMC41ICsgMC40OSAqIG5vcm1hbC54Ow0KCXRleC55ID0gMC41ICsgMC40OSAqIG5vcm1hbC55Ow0KCXJlc3VsdCA9IHRleHR1cmUyRChpbWEsIHRleCkgKiBtYXNrOw0KfQ0KY29uc3QgdmVjNCBjb25zMSA9IHZlYzQoMC44MDAwMDAsIDAuMjI4MTI5LCAwLjI4Nzc5MywgMS4wMDAwMDApOwpjb25zdCBmbG9hdCBjb25zMiA9IGZsb2F0KDAuMDAwMDAwKTsKdmFyeWluZyB2ZWMzIHZhcm5vcm1hbDsKY29uc3QgdmVjNCBjb25zNiA9IHZlYzQoMC4wMDAwMDAsIDAuMDAwMDAwLCAwLjAwMDAwMCwgMS4wMDAwMDApOwpjb25zdCBmbG9hdCBjb25zNyA9IGZsb2F0KDAuMDAwMDAwKTsKCnZvaWQgbWFpbigpCnsKCXZlYzMgZmFjaW5nbm9ybWFsID0gZ2xfRnJvbnRGYWNpbmc/IHZhcm5vcm1hbDogLXZhcm5vcm1hbDsKCXZlYzQgdG1wNDsKCXZlYzQgdG1wODsKCXZlYzQgdG1wMTA7CgoJbm9kZV9ic2RmX2RpZmZ1c2UoY29uczEsIGNvbnMyLCBmYWNpbmdub3JtYWwsIHRtcDQpOwoJbm9kZV9vdXRwdXRfbWF0ZXJpYWwodG1wNCwgY29uczYsIGNvbnM3LCB0bXA4KTsKCWxpbmVhcnJnYl90b19zcmdiKHRtcDgsIHRtcDEwKTsKCglnbF9GcmFnQ29sb3IgPSB0bXAxMDsKfQo="
        },
        "Material.002VS": {
            "type": 35633,
            "uri": "data:text/plain;base64,I3ZlcnNpb24gMTAwCgpwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKYXR0cmlidXRlIHZlYzQgYmxfVmVydGV4OwphdHRyaWJ1dGUgdmVjMyBibF9Ob3JtYWw7CnVuaWZvcm0gbWF0NCBibF9Nb2RlbFZpZXdNYXRyaXg7CnVuaWZvcm0gbWF0NCBibF9Qcm9qZWN0aW9uTWF0cml4Owp1bmlmb3JtIG1hdDMgYmxfTm9ybWFsTWF0cml4OwoKDQoNCnZhcnlpbmcgdmVjMyB2YXJwb3NpdGlvbjsNCnZhcnlpbmcgdmVjMyB2YXJub3JtYWw7DQoNCg0KDQoNCi8qIENvbG9yLCBrZWVwIGF0dHJpYnV0ZSBzeW5jIHdpdGg6IGdwdV9zaGFkZXJfdmVydGV4X3dvcmxkLmdsc2wgKi8NCg0KZmxvYXQgc3JnYl90b19saW5lYXJyZ2IoZmxvYXQgYykNCnsNCglpZiAoYyA8IDAuMDQwNDUpDQoJCXJldHVybiAoYyA8IDAuMCkgPyAwLjAgOiBjICogKDEuMCAvIDEyLjkyKTsNCgllbHNlDQoJCXJldHVybiBwb3coKGMgKyAwLjA1NSkgKiAoMS4wIC8gMS4wNTUpLCAyLjQpOw0KfQ0KDQp2b2lkIHNyZ2JfdG9fbGluZWFycmdiKHZlYzMgY29sX2Zyb20sIHZhcnlpbmcgdmVjMyBjb2xfdG8pDQp7DQoJY29sX3RvLnIgPSBzcmdiX3RvX2xpbmVhcnJnYihjb2xfZnJvbS5yKTsNCgljb2xfdG8uZyA9IHNyZ2JfdG9fbGluZWFycmdiKGNvbF9mcm9tLmcpOw0KCWNvbF90by5iID0gc3JnYl90b19saW5lYXJyZ2IoY29sX2Zyb20uYik7DQp9DQoNCnZvaWQgc3JnYl90b19saW5lYXJyZ2IodmVjNCBjb2xfZnJvbSwgdmFyeWluZyB2ZWM0IGNvbF90bykNCnsNCgljb2xfdG8uciA9IHNyZ2JfdG9fbGluZWFycmdiKGNvbF9mcm9tLnIpOw0KCWNvbF90by5nID0gc3JnYl90b19saW5lYXJyZ2IoY29sX2Zyb20uZyk7DQoJY29sX3RvLmIgPSBzcmdiX3RvX2xpbmVhcnJnYihjb2xfZnJvbS5iKTsNCgljb2xfdG8uYSA9IGNvbF9mcm9tLmE7DQp9DQoNCmJvb2wgaXNfc3JnYihpbnQgaW5mbykNCnsNCiNpZmRlZiBVU0VfTkVXX1NIQURJTkcNCglyZXR1cm4gKGluZm8gPT0gMSk/IHRydWU6IGZhbHNlOw0KI2Vsc2UNCglyZXR1cm4gZmFsc2U7DQojZW5kaWYNCn0NCg0Kdm9pZCBzZXRfdmFyX2Zyb21fYXR0cihmbG9hdCBhdHRyLCBpbnQgaW5mbywgdmFyeWluZyBmbG9hdCB2YXIpDQp7DQoJdmFyID0gYXR0cjsNCn0NCg0Kdm9pZCBzZXRfdmFyX2Zyb21fYXR0cih2ZWMyIGF0dHIsIGludCBpbmZvLCB2YXJ5aW5nIHZlYzIgdmFyKQ0Kew0KCXZhciA9IGF0dHI7DQp9DQoNCnZvaWQgc2V0X3Zhcl9mcm9tX2F0dHIodmVjMyBhdHRyLCBpbnQgaW5mbywgdmFyeWluZyB2ZWMzIHZhcikNCnsNCglpZiAoaXNfc3JnYihpbmZvKSkgew0KCQlzcmdiX3RvX2xpbmVhcnJnYihhdHRyLCB2YXIpOw0KCX0NCgllbHNlIHsNCgkJdmFyID0gYXR0cjsNCgl9DQp9DQoNCnZvaWQgc2V0X3Zhcl9mcm9tX2F0dHIodmVjNCBhdHRyLCBpbnQgaW5mbywgdmFyeWluZyB2ZWM0IHZhcikNCnsNCglpZiAoaXNfc3JnYihpbmZvKSkgew0KCQlzcmdiX3RvX2xpbmVhcnJnYihhdHRyLCB2YXIpOw0KCX0NCgllbHNlIHsNCgkJdmFyID0gYXR0cjsNCgl9DQp9DQoNCi8qIGVuZCBjb2xvciBjb2RlICovDQoNCg0Kdm9pZCBtYWluKCkNCnsNCg0KCXZlYzQgcG9zaXRpb24gPSBibF9WZXJ0ZXg7DQoJdmVjMyBub3JtYWwgPSBibF9Ob3JtYWw7DQoNCg0KCXZlYzQgY28gPSBibF9Nb2RlbFZpZXdNYXRyaXggKiBwb3NpdGlvbjsNCg0KCXZhcnBvc2l0aW9uID0gY28ueHl6Ow0KCXZhcm5vcm1hbCA9IG5vcm1hbGl6ZShibF9Ob3JtYWxNYXRyaXggKiBub3JtYWwpOw0KCWdsX1Bvc2l0aW9uID0gYmxfUHJvamVjdGlvbk1hdHJpeCAqIGNvOw0KDQogDQoNCg0KfQo="
        },
        "MaterialFS": {
            "type": 35632,
            "uri": "data:text/plain;base64,I3ZlcnNpb24gMTAwCiNleHRlbnNpb24gR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzOiBlbmFibGUKCnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwpwcmVjaXNpb24gbWVkaXVtcCBpbnQ7Cgp1bmlmb3JtIG1hdDQgYmxfUHJvamVjdGlvbk1hdHJpeDsKdW5pZm9ybSBtYXQ0IGJsX01vZGVsVmlld01hdHJpeDsKdW5pZm9ybSBtYXQ0IGJsX01vZGVsVmlld01hdHJpeEludmVyc2U7CnVuaWZvcm0gbWF0MyBibF9Ob3JtYWxNYXRyaXg7CnVuaWZvcm0gbWF0NCBibF9Qcm9qZWN0aW9uTWF0cml4SW52ZXJzZTsKLyogQ29udmVydGVycyAqLw0KDQpmbG9hdCBjb252ZXJ0X3JnYmFfdG9fZmxvYXQodmVjNCBjb2xvcikNCnsNCiNpZmRlZiBVU0VfTkVXX1NIQURJTkcNCglyZXR1cm4gY29sb3IuciAqIDAuMjEyNiArIGNvbG9yLmcgKiAwLjcxNTIgKyBjb2xvci5iICogMC4wNzIyOw0KI2Vsc2UNCglyZXR1cm4gKGNvbG9yLnIgKyBjb2xvci5nICsgY29sb3IuYikgLyAzLjA7DQojZW5kaWYNCn0NCg0KZmxvYXQgZXhwX2JsZW5kZXIoZmxvYXQgZikNCnsNCglyZXR1cm4gcG93KDIuNzE4MjgxODI4NDYsIGYpOw0KfQ0KDQpmbG9hdCBjb21wYXRpYmxlX3BvdyhmbG9hdCB4LCBmbG9hdCB5KQ0Kew0KCWlmICh5ID09IDAuMCkgLyogeF4wIC0+IDEsIGluY2x1ZGluZyAwXjAgKi8NCgkJcmV0dXJuIDEuMDsNCg0KCS8qIGdsc2wgcG93IGRvZXNuJ3QgYWNjZXB0IG5lZ2F0aXZlIHggKi8NCglpZiAoeCA8IDAuMCkgew0KCQlpZiAobW9kKC15LCAyLjApID09IDAuMCkNCgkJCXJldHVybiBwb3coLXgsIHkpOw0KCQllbHNlDQoJCQlyZXR1cm4gLXBvdygteCwgeSk7DQoJfQ0KCWVsc2UgaWYgKHggPT0gMC4wKQ0KCQlyZXR1cm4gMC4wOw0KDQoJcmV0dXJuIHBvdyh4LCB5KTsNCn0NCg0Kdm9pZCByZ2JfdG9faHN2KHZlYzQgcmdiLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmxvYXQgY21heCwgY21pbiwgaCwgcywgdiwgY2RlbHRhOw0KCXZlYzMgYzsNCg0KCWNtYXggPSBtYXgocmdiWzBdLCBtYXgocmdiWzFdLCByZ2JbMl0pKTsNCgljbWluID0gbWluKHJnYlswXSwgbWluKHJnYlsxXSwgcmdiWzJdKSk7DQoJY2RlbHRhID0gY21heCAtIGNtaW47DQoNCgl2ID0gY21heDsNCglpZiAoY21heCAhPSAwLjApDQoJCXMgPSBjZGVsdGEgLyBjbWF4Ow0KCWVsc2Ugew0KCQlzID0gMC4wOw0KCQloID0gMC4wOw0KCX0NCg0KCWlmIChzID09IDAuMCkgew0KCQloID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJYyA9ICh2ZWMzKGNtYXgsIGNtYXgsIGNtYXgpIC0gcmdiLnh5eikgLyBjZGVsdGE7DQoNCgkJaWYgKHJnYi54ID09IGNtYXgpIGggPSBjWzJdIC0gY1sxXTsNCgkJZWxzZSBpZiAocmdiLnkgPT0gY21heCkgaCA9IDIuMCArIGNbMF0gLSAgY1syXTsNCgkJZWxzZSBoID0gNC4wICsgY1sxXSAtIGNbMF07DQoNCgkJaCAvPSA2LjA7DQoNCgkJaWYgKGggPCAwLjApDQoJCQloICs9IDEuMDsNCgl9DQoNCglvdXRjb2wgPSB2ZWM0KGgsIHMsIHYsIHJnYi53KTsNCn0NCg0Kdm9pZCBoc3ZfdG9fcmdiKHZlYzQgaHN2LCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmxvYXQgaSwgZiwgcCwgcSwgdCwgaCwgcywgdjsNCgl2ZWMzIHJnYjsNCg0KCWggPSBoc3ZbMF07DQoJcyA9IGhzdlsxXTsNCgl2ID0gaHN2WzJdOw0KDQoJaWYgKHMgPT0gMC4wKSB7DQoJCXJnYiA9IHZlYzModiwgdiwgdik7DQoJfQ0KCWVsc2Ugew0KCQlpZiAoaCA9PSAxLjApDQoJCQloID0gMC4wOw0KDQoJCWggKj0gNi4wOw0KCQlpID0gZmxvb3IoaCk7DQoJCWYgPSBoIC0gaTsNCgkJcmdiID0gdmVjMyhmLCBmLCBmKTsNCgkJcCA9IHYgKiAoMS4wIC0gcyk7DQoJCXEgPSB2ICogKDEuMCAtIChzICogZikpOw0KCQl0ID0gdiAqICgxLjAgLSAocyAqICgxLjAgLSBmKSkpOw0KDQoJCWlmIChpID09IDAuMCkgcmdiID0gdmVjMyh2LCB0LCBwKTsNCgkJZWxzZSBpZiAoaSA9PSAxLjApIHJnYiA9IHZlYzMocSwgdiwgcCk7DQoJCWVsc2UgaWYgKGkgPT0gMi4wKSByZ2IgPSB2ZWMzKHAsIHYsIHQpOw0KCQllbHNlIGlmIChpID09IDMuMCkgcmdiID0gdmVjMyhwLCBxLCB2KTsNCgkJZWxzZSBpZiAoaSA9PSA0LjApIHJnYiA9IHZlYzModCwgcCwgdik7DQoJCWVsc2UgcmdiID0gdmVjMyh2LCBwLCBxKTsNCgl9DQoNCglvdXRjb2wgPSB2ZWM0KHJnYiwgaHN2LncpOw0KfQ0KDQpmbG9hdCBzcmdiX3RvX2xpbmVhcnJnYihmbG9hdCBjKQ0Kew0KCWlmIChjIDwgMC4wNDA0NSkNCgkJcmV0dXJuIChjIDwgMC4wKSA/IDAuMCA6IGMgKiAoMS4wIC8gMTIuOTIpOw0KCWVsc2UNCgkJcmV0dXJuIHBvdygoYyArIDAuMDU1KSAqICgxLjAgLyAxLjA1NSksIDIuNCk7DQp9DQoNCmZsb2F0IGxpbmVhcnJnYl90b19zcmdiKGZsb2F0IGMpDQp7DQoJaWYgKGMgPCAwLjAwMzEzMDgpDQoJCXJldHVybiAoYyA8IDAuMCkgPyAwLjAgOiBjICogMTIuOTI7DQoJZWxzZQ0KCQlyZXR1cm4gMS4wNTUgKiBwb3coYywgMS4wIC8gMi40KSAtIDAuMDU1Ow0KfQ0KDQp2b2lkIHNyZ2JfdG9fbGluZWFycmdiKHZlYzQgY29sX2Zyb20sIG91dCB2ZWM0IGNvbF90bykNCnsNCgljb2xfdG8uciA9IHNyZ2JfdG9fbGluZWFycmdiKGNvbF9mcm9tLnIpOw0KCWNvbF90by5nID0gc3JnYl90b19saW5lYXJyZ2IoY29sX2Zyb20uZyk7DQoJY29sX3RvLmIgPSBzcmdiX3RvX2xpbmVhcnJnYihjb2xfZnJvbS5iKTsNCgljb2xfdG8uYSA9IGNvbF9mcm9tLmE7DQp9DQoNCnZvaWQgbGluZWFycmdiX3RvX3NyZ2IodmVjNCBjb2xfZnJvbSwgb3V0IHZlYzQgY29sX3RvKQ0Kew0KCWNvbF90by5yID0gbGluZWFycmdiX3RvX3NyZ2IoY29sX2Zyb20ucik7DQoJY29sX3RvLmcgPSBsaW5lYXJyZ2JfdG9fc3JnYihjb2xfZnJvbS5nKTsNCgljb2xfdG8uYiA9IGxpbmVhcnJnYl90b19zcmdiKGNvbF9mcm9tLmIpOw0KCWNvbF90by5hID0gY29sX2Zyb20uYTsNCn0NCg0Kdm9pZCBjb2xvcl90b19ub3JtYWwodmVjMyBjb2xvciwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCW5vcm1hbC54ID0gIDIuMCAqICgoY29sb3IucikgLSAwLjUpOw0KCW5vcm1hbC55ID0gLTIuMCAqICgoY29sb3IuZykgLSAwLjUpOw0KCW5vcm1hbC56ID0gIDIuMCAqICgoY29sb3IuYikgLSAwLjUpOw0KfQ0KDQp2b2lkIGNvbG9yX3RvX25vcm1hbF9uZXdfc2hhZGluZyh2ZWMzIGNvbG9yLCBvdXQgdmVjMyBub3JtYWwpDQp7DQoJbm9ybWFsLnggPSAgMi4wICogKChjb2xvci5yKSAtIDAuNSk7DQoJbm9ybWFsLnkgPSAgMi4wICogKChjb2xvci5nKSAtIDAuNSk7DQoJbm9ybWFsLnogPSAgMi4wICogKChjb2xvci5iKSAtIDAuNSk7DQp9DQoNCnZvaWQgY29sb3JfdG9fYmxlbmRlcl9ub3JtYWxfbmV3X3NoYWRpbmcodmVjMyBjb2xvciwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCW5vcm1hbC54ID0gIDIuMCAqICgoY29sb3IucikgLSAwLjUpOw0KCW5vcm1hbC55ID0gLTIuMCAqICgoY29sb3IuZykgLSAwLjUpOw0KCW5vcm1hbC56ID0gLTIuMCAqICgoY29sb3IuYikgLSAwLjUpOw0KfQ0KDQojZGVmaW5lIE1fUEkgMy4xNDE1OTI2NTM1ODk3OTMyMzg0Ng0KI2RlZmluZSBNXzFfUEkgMC4zMTgzMDk4ODYxODM3OTA2OQ0KDQovKioqKioqKioqKiogU0hBREVSIE5PREVTICoqKioqKioqKioqKioqKi8NCg0Kdm9pZCB2Y29sX2F0dHJpYnV0ZSh2ZWM0IGF0dHZjb2wsIG91dCB2ZWM0IHZjb2wpDQp7DQoJdmNvbCA9IHZlYzQoYXR0dmNvbC54LCBhdHR2Y29sLnksIGF0dHZjb2wueiwgMS4wKTsNCn0NCg0Kdm9pZCB1dl9hdHRyaWJ1dGUodmVjMiBhdHR1diwgb3V0IHZlYzMgdXYpDQp7DQoJdXYgPSB2ZWMzKGF0dHV2ICogMi4wIC0gdmVjMigxLjAsIDEuMCksIDAuMCk7DQp9DQoNCnZvaWQgZ2VvbSgNCiAgICAgICAgdmVjMyBjbywgdmVjMyBub3IsIG1hdDQgdmlld2ludm1hdCwgdmVjMyBhdHRvcmNvLCB2ZWMyIGF0dHV2LCB2ZWM0IGF0dHZjb2wsDQogICAgICAgIG91dCB2ZWMzIGdsb2JhbCwgb3V0IHZlYzMgbG9jYWwsIG91dCB2ZWMzIHZpZXcsIG91dCB2ZWMzIG9yY28sIG91dCB2ZWMzIHV2LA0KICAgICAgICBvdXQgdmVjMyBub3JtYWwsIG91dCB2ZWM0IHZjb2wsIG91dCBmbG9hdCB2Y29sX2FscGhhLCBvdXQgZmxvYXQgZnJvbnRiYWNrKQ0Kew0KCWxvY2FsID0gY287DQoJdmlldyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPyBub3JtYWxpemUobG9jYWwpIDogdmVjMygwLjAsIDAuMCwgLTEuMCk7DQoJZ2xvYmFsID0gKHZpZXdpbnZtYXQgKiB2ZWM0KGxvY2FsLCAxLjApKS54eXo7DQoJb3JjbyA9IGF0dG9yY287DQoJdXZfYXR0cmlidXRlKGF0dHV2LCB1dik7DQoJbm9ybWFsID0gLW5vcm1hbGl6ZShub3IpOyAgIC8qIGJsZW5kZXIgcmVuZGVyIG5vcm1hbCBpcyBuZWdhdGVkICovDQoJdmNvbF9hdHRyaWJ1dGUoYXR0dmNvbCwgdmNvbCk7DQoJc3JnYl90b19saW5lYXJyZ2IodmNvbCwgdmNvbCk7DQoJdmNvbF9hbHBoYSA9IGF0dHZjb2wuYTsNCglmcm9udGJhY2sgPSAoZ2xfRnJvbnRGYWNpbmcpID8gMS4wIDogMC4wOw0KfQ0KDQp2b2lkIHBhcnRpY2xlX2luZm8oDQogICAgICAgIHZlYzQgc3Byb3BzLCB2ZWMzIGxvYywgdmVjMyB2ZWwsIHZlYzMgYXZlbCwNCiAgICAgICAgb3V0IGZsb2F0IGluZGV4LCBvdXQgZmxvYXQgYWdlLCBvdXQgZmxvYXQgbGlmZV90aW1lLCBvdXQgdmVjMyBsb2NhdGlvbiwNCiAgICAgICAgb3V0IGZsb2F0IHNpemUsIG91dCB2ZWMzIHZlbG9jaXR5LCBvdXQgdmVjMyBhbmd1bGFyX3ZlbG9jaXR5KQ0Kew0KCWluZGV4ID0gc3Byb3BzLng7DQoJYWdlID0gc3Byb3BzLnk7DQoJbGlmZV90aW1lID0gc3Byb3BzLno7DQoJc2l6ZSA9IHNwcm9wcy53Ow0KDQoJbG9jYXRpb24gPSBsb2M7DQoJdmVsb2NpdHkgPSB2ZWw7DQoJYW5ndWxhcl92ZWxvY2l0eSA9IGF2ZWw7DQp9DQoNCnZvaWQgdmVjdF9ub3JtYWxpemUodmVjMyB2aW4sIG91dCB2ZWMzIHZvdXQpDQp7DQoJdm91dCA9IG5vcm1hbGl6ZSh2aW4pOw0KfQ0KDQp2b2lkIGRpcmVjdGlvbl90cmFuc2Zvcm1fbTR2Myh2ZWMzIHZpbiwgbWF0NCBtYXQsIG91dCB2ZWMzIHZvdXQpDQp7DQoJdm91dCA9IChtYXQgKiB2ZWM0KHZpbiwgMC4wKSkueHl6Ow0KfQ0KDQp2b2lkIHBvaW50X3RyYW5zZm9ybV9tNHYzKHZlYzMgdmluLCBtYXQ0IG1hdCwgb3V0IHZlYzMgdm91dCkNCnsNCgl2b3V0ID0gKG1hdCAqIHZlYzQodmluLCAxLjApKS54eXo7DQp9DQoNCnZvaWQgcG9pbnRfdGV4Y29fcmVtYXBfc3F1YXJlKHZlYzMgdmluLCBvdXQgdmVjMyB2b3V0KQ0Kew0KCXZvdXQgPSB2ZWMzKHZpbiAtIHZlYzMoMC41LCAwLjUsIDAuNSkpICogMi4wOw0KfQ0KDQp2b2lkIHBvaW50X21hcF90b19zcGhlcmUodmVjMyB2aW4sIG91dCB2ZWMzIHZvdXQpDQp7DQoJZmxvYXQgbGVuID0gbGVuZ3RoKHZpbik7DQoJZmxvYXQgdiwgdTsNCglpZiAobGVuID4gMC4wKSB7DQoJCWlmICh2aW4ueCA9PSAwLjAgJiYgdmluLnkgPT0gMC4wKQ0KCQkJdSA9IDAuMDsNCgkJZWxzZQ0KCQkJdSA9ICgxLjAgLSBhdGFuKHZpbi54LCB2aW4ueSkgLyBNX1BJKSAvIDIuMDsNCg0KCQl2ID0gMS4wIC0gYWNvcyh2aW4ueiAvIGxlbikgLyBNX1BJOw0KCX0NCgllbHNlDQoJCXYgPSB1ID0gMC4wOw0KDQoJdm91dCA9IHZlYzModSwgdiwgMC4wKTsNCn0NCg0Kdm9pZCBwb2ludF9tYXBfdG9fdHViZSh2ZWMzIHZpbiwgb3V0IHZlYzMgdm91dCkNCnsNCglmbG9hdCB1LCB2Ow0KCXYgPSAodmluLnogKyAxLjApICogMC41Ow0KCWZsb2F0IGxlbiA9IHNxcnQodmluLnggKiB2aW4ueCArIHZpbi55ICogdmluWzFdKTsNCglpZiAobGVuID4gMC4wKQ0KCQl1ID0gKDEuMCAtIChhdGFuKHZpbi54IC8gbGVuLCB2aW4ueSAvIGxlbikgLyBNX1BJKSkgKiAwLjU7DQoJZWxzZQ0KCQl2ID0gdSA9IDAuMDsNCg0KCXZvdXQgPSB2ZWMzKHUsIHYsIDAuMCk7DQp9DQoNCnZvaWQgbWFwcGluZyh2ZWMzIHZlYywgbWF0NCBtYXQsIHZlYzMgbWludmVjLCB2ZWMzIG1heHZlYywgZmxvYXQgZG9taW4sIGZsb2F0IGRvbWF4LCBvdXQgdmVjMyBvdXR2ZWMpDQp7DQoJb3V0dmVjID0gKG1hdCAqIHZlYzQodmVjLCAxLjApKS54eXo7DQoJaWYgKGRvbWluID09IDEuMCkNCgkJb3V0dmVjID0gbWF4KG91dHZlYywgbWludmVjKTsNCglpZiAoZG9tYXggPT0gMS4wKQ0KCQlvdXR2ZWMgPSBtaW4ob3V0dmVjLCBtYXh2ZWMpOw0KfQ0KDQp2b2lkIGNhbWVyYSh2ZWMzIGNvLCBvdXQgdmVjMyBvdXR2aWV3LCBvdXQgZmxvYXQgb3V0ZGVwdGgsIG91dCBmbG9hdCBvdXRkaXN0KQ0Kew0KCW91dGRlcHRoID0gYWJzKGNvLnopOw0KCW91dGRpc3QgPSBsZW5ndGgoY28pOw0KCW91dHZpZXcgPSBub3JtYWxpemUoY28pOw0KfQ0KDQp2b2lkIGxhbXAoDQogICAgICAgIHZlYzQgY29sLCBmbG9hdCBlbmVyZ3ksIHZlYzMgbHYsIGZsb2F0IGRpc3QsIHZlYzMgc2hhZG93LCBmbG9hdCB2aXNpZmFjLA0KICAgICAgICBvdXQgdmVjNCBvdXRjb2wsIG91dCB2ZWMzIG91dGx2LCBvdXQgZmxvYXQgb3V0ZGlzdCwgb3V0IHZlYzQgb3V0c2hhZG93LCBvdXQgZmxvYXQgb3V0dmlzaWZhYykNCnsNCglvdXRjb2wgPSBjb2wgKiBlbmVyZ3k7DQoJb3V0bHYgPSBsdjsNCglvdXRkaXN0ID0gZGlzdDsNCglvdXRzaGFkb3cgPSB2ZWM0KHNoYWRvdywgMS4wKTsNCglvdXR2aXNpZmFjID0gdmlzaWZhYzsNCn0NCg0Kdm9pZCBtYXRoX2FkZChmbG9hdCB2YWwxLCBmbG9hdCB2YWwyLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IHZhbDEgKyB2YWwyOw0KfQ0KDQp2b2lkIG1hdGhfc3VidHJhY3QoZmxvYXQgdmFsMSwgZmxvYXQgdmFsMiwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSB2YWwxIC0gdmFsMjsNCn0NCg0Kdm9pZCBtYXRoX211bHRpcGx5KGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmFsMSAqIHZhbDI7DQp9DQoNCnZvaWQgbWF0aF9kaXZpZGUoZmxvYXQgdmFsMSwgZmxvYXQgdmFsMiwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglpZiAodmFsMiA9PSAwLjApDQoJCW91dHZhbCA9IDAuMDsNCgllbHNlDQoJCW91dHZhbCA9IHZhbDEgLyB2YWwyOw0KfQ0KDQp2b2lkIG1hdGhfc2luZShmbG9hdCB2YWwsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gc2luKHZhbCk7DQp9DQoNCnZvaWQgbWF0aF9jb3NpbmUoZmxvYXQgdmFsLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IGNvcyh2YWwpOw0KfQ0KDQp2b2lkIG1hdGhfdGFuZ2VudChmbG9hdCB2YWwsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdGFuKHZhbCk7DQp9DQoNCnZvaWQgbWF0aF9hc2luKGZsb2F0IHZhbCwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglpZiAodmFsIDw9IDEuMCAmJiB2YWwgPj0gLTEuMCkNCgkJb3V0dmFsID0gYXNpbih2YWwpOw0KCWVsc2UNCgkJb3V0dmFsID0gMC4wOw0KfQ0KDQp2b2lkIG1hdGhfYWNvcyhmbG9hdCB2YWwsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJaWYgKHZhbCA8PSAxLjAgJiYgdmFsID49IC0xLjApDQoJCW91dHZhbCA9IGFjb3ModmFsKTsNCgllbHNlDQoJCW91dHZhbCA9IDAuMDsNCn0NCg0Kdm9pZCBtYXRoX2F0YW4oZmxvYXQgdmFsLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IGF0YW4odmFsKTsNCn0NCg0Kdm9pZCBtYXRoX3BvdyhmbG9hdCB2YWwxLCBmbG9hdCB2YWwyLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCWlmICh2YWwxID49IDAuMCkgew0KCQlvdXR2YWwgPSBjb21wYXRpYmxlX3Bvdyh2YWwxLCB2YWwyKTsNCgl9DQoJZWxzZSB7DQoJCWZsb2F0IHZhbDJfbW9kXzEgPSBtb2QoYWJzKHZhbDIpLCAxLjApOw0KDQoJCWlmICh2YWwyX21vZF8xID4gMC45OTkgfHwgdmFsMl9tb2RfMSA8IDAuMDAxKQ0KCQkJb3V0dmFsID0gY29tcGF0aWJsZV9wb3codmFsMSwgZmxvb3IodmFsMiArIDAuNSkpOw0KCQllbHNlDQoJCQlvdXR2YWwgPSAwLjA7DQoJfQ0KfQ0KDQp2b2lkIG1hdGhfbG9nKGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJaWYgKHZhbDEgPiAwLjAgICYmIHZhbDIgPiAwLjApDQoJCW91dHZhbCA9IGxvZzIodmFsMSkgLyBsb2cyKHZhbDIpOw0KCWVsc2UNCgkJb3V0dmFsID0gMC4wOw0KfQ0KDQp2b2lkIG1hdGhfbWF4KGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gbWF4KHZhbDEsIHZhbDIpOw0KfQ0KDQp2b2lkIG1hdGhfbWluKGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gbWluKHZhbDEsIHZhbDIpOw0KfQ0KDQp2b2lkIG1hdGhfcm91bmQoZmxvYXQgdmFsLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IGZsb29yKHZhbCArIDAuNSk7DQp9DQoNCnZvaWQgbWF0aF9sZXNzX3RoYW4oZmxvYXQgdmFsMSwgZmxvYXQgdmFsMiwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglpZiAodmFsMSA8IHZhbDIpDQoJCW91dHZhbCA9IDEuMDsNCgllbHNlDQoJCW91dHZhbCA9IDAuMDsNCn0NCg0Kdm9pZCBtYXRoX2dyZWF0ZXJfdGhhbihmbG9hdCB2YWwxLCBmbG9hdCB2YWwyLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCWlmICh2YWwxID4gdmFsMikNCgkJb3V0dmFsID0gMS4wOw0KCWVsc2UNCgkJb3V0dmFsID0gMC4wOw0KfQ0KDQp2b2lkIG1hdGhfbW9kdWxvKGZsb2F0IHZhbDEsIGZsb2F0IHZhbDIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJaWYgKHZhbDIgPT0gMC4wKQ0KCQlvdXR2YWwgPSAwLjA7DQoJZWxzZQ0KCQlvdXR2YWwgPSBtb2QodmFsMSwgdmFsMik7DQoNCgkvKiBjaGFuZ2Ugc2lnbiB0byBtYXRjaCBDIGNvbnZlbnRpb24sIG1vZCB2YXJ5aW5nIEdMU0wgd2lsbCB0YWtlIGFic29sdXRlIGZvciBuZWdhdGl2ZSBudW1iZXJzLA0KCSAqIHNlZSBodHRwczovL3d3dy5vcGVuZ2wub3JnL3Nkay9kb2NzL21hbi9odG1sL21vZC54aHRtbCAqLw0KCW91dHZhbCA9ICh2YWwxID4gMC4wKSA/IG91dHZhbCA6IC1vdXR2YWw7DQp9DQoNCnZvaWQgbWF0aF9hYnMoZmxvYXQgdmFsMSwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSBhYnModmFsMSk7DQp9DQoNCnZvaWQgc3F1ZWV6ZShmbG9hdCB2YWwsIGZsb2F0IHdpZHRoLCBmbG9hdCBjZW50ZXIsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gMS4wIC8gKDEuMCArIHBvdygyLjcxODI4MTgzLCAtKCh2YWwgLSBjZW50ZXIpICogd2lkdGgpKSk7DQp9DQoNCnZvaWQgdmVjX21hdGhfYWRkKHZlYzMgdjEsIHZlYzMgdjIsIG91dCB2ZWMzIG91dHZlYywgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2ZWMgPSB2MSArIHYyOw0KCW91dHZhbCA9IChhYnMob3V0dmVjWzBdKSArIGFicyhvdXR2ZWNbMV0pICsgYWJzKG91dHZlY1syXSkpIC8gMy4wOw0KfQ0KDQp2b2lkIHZlY19tYXRoX3N1Yih2ZWMzIHYxLCB2ZWMzIHYyLCBvdXQgdmVjMyBvdXR2ZWMsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmVjID0gdjEgLSB2MjsNCglvdXR2YWwgPSAoYWJzKG91dHZlY1swXSkgKyBhYnMob3V0dmVjWzFdKSArIGFicyhvdXR2ZWNbMl0pKSAvIDMuMDsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9hdmVyYWdlKHZlYzMgdjEsIHZlYzMgdjIsIG91dCB2ZWMzIG91dHZlYywgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2ZWMgPSB2MSArIHYyOw0KCW91dHZhbCA9IGxlbmd0aChvdXR2ZWMpOw0KCW91dHZlYyA9IG5vcm1hbGl6ZShvdXR2ZWMpOw0KfQ0Kdm9pZCB2ZWNfbWF0aF9taXgoZmxvYXQgc3RyZW5ndGgsIHZlYzMgdjEsIHZlYzMgdjIsIG91dCB2ZWMzIG91dHZlYykNCnsNCglvdXR2ZWMgPSBzdHJlbmd0aCAqIHYxICsgKDEgLSBzdHJlbmd0aCkgKiB2MjsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9kb3QodmVjMyB2MSwgdmVjMyB2Miwgb3V0IHZlYzMgb3V0dmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZlYyA9IHZlYzMoMCwgMCwgMCk7DQoJb3V0dmFsID0gZG90KHYxLCB2Mik7DQp9DQoNCnZvaWQgdmVjX21hdGhfY3Jvc3ModmVjMyB2MSwgdmVjMyB2Miwgb3V0IHZlYzMgb3V0dmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZlYyA9IGNyb3NzKHYxLCB2Mik7DQoJb3V0dmFsID0gbGVuZ3RoKG91dHZlYyk7DQoJb3V0dmVjIC89IG91dHZhbDsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9ub3JtYWxpemUodmVjMyB2LCBvdXQgdmVjMyBvdXR2ZWMsIG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gbGVuZ3RoKHYpOw0KCW91dHZlYyA9IG5vcm1hbGl6ZSh2KTsNCn0NCg0Kdm9pZCB2ZWNfbWF0aF9uZWdhdGUodmVjMyB2LCBvdXQgdmVjMyBvdXR2KQ0Kew0KCW91dHYgPSAtdjsNCn0NCg0Kdm9pZCBpbnZlcnRfeih2ZWMzIHYsIG91dCB2ZWMzIG91dHYpDQp7DQoJdi56ID0gLXYuejsNCglvdXR2ID0gdjsNCn0NCg0Kdm9pZCBub3JtYWwodmVjMyBkaXIsIHZlYzMgbm9yLCBvdXQgdmVjMyBvdXRub3IsIG91dCBmbG9hdCBvdXRkb3QpDQp7DQoJb3V0bm9yID0gbm9yOw0KCW91dGRvdCA9IC1kb3QoZGlyLCBub3IpOw0KfQ0KDQp2b2lkIG5vcm1hbF9uZXdfc2hhZGluZyh2ZWMzIGRpciwgdmVjMyBub3IsIG91dCB2ZWMzIG91dG5vciwgb3V0IGZsb2F0IG91dGRvdCkNCnsNCglvdXRub3IgPSBub3JtYWxpemUobm9yKTsNCglvdXRkb3QgPSBkb3Qobm9ybWFsaXplKGRpciksIG5vcik7DQp9DQoNCnZvaWQgY3VydmVzX3ZlYyhmbG9hdCBmYWMsIHZlYzMgdmVjLCBzYW1wbGVyMkQgY3VydmVtYXAsIG91dCB2ZWMzIG91dHZlYykNCnsNCglvdXR2ZWMueCA9IHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMigodmVjLnggKyAxLjApICogMC41LCAwLjApKS54Ow0KCW91dHZlYy55ID0gdGV4dHVyZTJEKGN1cnZlbWFwLCB2ZWMyKCh2ZWMueSArIDEuMCkgKiAwLjUsIDAuMCkpLnk7DQoJb3V0dmVjLnogPSB0ZXh0dXJlMkQoY3VydmVtYXAsIHZlYzIoKHZlYy56ICsgMS4wKSAqIDAuNSwgMC4wKSkuejsNCg0KCWlmIChmYWMgIT0gMS4wKQ0KCQlvdXR2ZWMgPSAob3V0dmVjICogZmFjKSArICh2ZWMgKiAoMS4wIC0gZmFjKSk7DQoNCn0NCg0Kdm9pZCBjdXJ2ZXNfcmdiKGZsb2F0IGZhYywgdmVjNCBjb2wsIHNhbXBsZXIyRCBjdXJ2ZW1hcCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbC5yID0gdGV4dHVyZTJEKGN1cnZlbWFwLCB2ZWMyKHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMihjb2wuciwgMC4wKSkuYSwgMC4wKSkucjsNCglvdXRjb2wuZyA9IHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMih0ZXh0dXJlMkQoY3VydmVtYXAsIHZlYzIoY29sLmcsIDAuMCkpLmEsIDAuMCkpLmc7DQoJb3V0Y29sLmIgPSB0ZXh0dXJlMkQoY3VydmVtYXAsIHZlYzIodGV4dHVyZTJEKGN1cnZlbWFwLCB2ZWMyKGNvbC5iLCAwLjApKS5hLCAwLjApKS5iOw0KDQoJaWYgKGZhYyAhPSAxLjApDQoJCW91dGNvbCA9IChvdXRjb2wgKiBmYWMpICsgKGNvbCAqICgxLjAgLSBmYWMpKTsNCg0KCW91dGNvbC5hID0gY29sLmE7DQp9DQoNCnZvaWQgc2V0X3ZhbHVlKGZsb2F0IHZhbCwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSB2YWw7DQp9DQoNCnZvaWQgc2V0X3JnYih2ZWMzIGNvbCwgb3V0IHZlYzMgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDsNCn0NCg0Kdm9pZCBzZXRfcmdiYSh2ZWM0IGNvbCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDsNCn0NCg0Kdm9pZCBzZXRfdmFsdWVfemVybyhvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IDAuMDsNCn0NCg0Kdm9pZCBzZXRfdmFsdWVfb25lKG91dCBmbG9hdCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gMS4wOw0KfQ0KDQp2b2lkIHNldF9yZ2JfemVybyhvdXQgdmVjMyBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmVjMygwLjApOw0KfQ0KDQp2b2lkIHNldF9yZ2Jfb25lKG91dCB2ZWMzIG91dHZhbCkNCnsNCglvdXR2YWwgPSB2ZWMzKDEuMCk7DQp9DQoNCnZvaWQgc2V0X3JnYmFfemVybyhvdXQgdmVjNCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmVjNCgwLjApOw0KfQ0KDQp2b2lkIHNldF9yZ2JhX29uZShvdXQgdmVjNCBvdXR2YWwpDQp7DQoJb3V0dmFsID0gdmVjNCgxLjApOw0KfQ0KDQp2b2lkIGJyaWdodG5lc3NfY29udHJhc3QodmVjNCBjb2wsIGZsb2F0IGJyaWdodG5lc3MsIGZsb2F0IGNvbnRyYXN0LCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmxvYXQgYSA9IDEuMCArIGNvbnRyYXN0Ow0KCWZsb2F0IGIgPSBicmlnaHRuZXNzIC0gY29udHJhc3QgKiAwLjU7DQoNCglvdXRjb2wuciA9IG1heChhICogY29sLnIgKyBiLCAwLjApOw0KCW91dGNvbC5nID0gbWF4KGEgKiBjb2wuZyArIGIsIDAuMCk7DQoJb3V0Y29sLmIgPSBtYXgoYSAqIGNvbC5iICsgYiwgMC4wKTsNCglvdXRjb2wuYSA9IGNvbC5hOw0KfQ0KDQp2b2lkIG1peF9ibGVuZChmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gbWl4KGNvbDEsIGNvbDIsIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X2FkZChmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gbWl4KGNvbDEsIGNvbDEgKyBjb2wyLCBmYWMpOw0KCW91dGNvbC5hID0gY29sMS5hOw0KfQ0KDQp2b2lkIG1peF9tdWx0KGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wgPSBtaXgoY29sMSwgY29sMSAqIGNvbDIsIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X3NjcmVlbihmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJZmxvYXQgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IHZlYzQoMS4wKSAtICh2ZWM0KGZhY20pICsgZmFjICogKHZlYzQoMS4wKSAtIGNvbDIpKSAqICh2ZWM0KDEuMCkgLSBjb2wxKTsNCglvdXRjb2wuYSA9IGNvbDEuYTsNCn0NCg0Kdm9pZCBtaXhfb3ZlcmxheShmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJZmxvYXQgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IGNvbDE7DQoNCglpZiAob3V0Y29sLnIgPCAwLjUpDQoJCW91dGNvbC5yICo9IGZhY20gKyAyLjAgKiBmYWMgKiBjb2wyLnI7DQoJZWxzZQ0KCQlvdXRjb2wuciA9IDEuMCAtIChmYWNtICsgMi4wICogZmFjICogKDEuMCAtIGNvbDIucikpICogKDEuMCAtIG91dGNvbC5yKTsNCg0KCWlmIChvdXRjb2wuZyA8IDAuNSkNCgkJb3V0Y29sLmcgKj0gZmFjbSArIDIuMCAqIGZhYyAqIGNvbDIuZzsNCgllbHNlDQoJCW91dGNvbC5nID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWMgKiAoMS4wIC0gY29sMi5nKSkgKiAoMS4wIC0gb3V0Y29sLmcpOw0KDQoJaWYgKG91dGNvbC5iIDwgMC41KQ0KCQlvdXRjb2wuYiAqPSBmYWNtICsgMi4wICogZmFjICogY29sMi5iOw0KCWVsc2UNCgkJb3V0Y29sLmIgPSAxLjAgLSAoZmFjbSArIDIuMCAqIGZhYyAqICgxLjAgLSBjb2wyLmIpKSAqICgxLjAgLSBvdXRjb2wuYik7DQp9DQoNCnZvaWQgbWl4X3N1YihmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gbWl4KGNvbDEsIGNvbDEgLSBjb2wyLCBmYWMpOw0KCW91dGNvbC5hID0gY29sMS5hOw0KfQ0KDQp2b2lkIG1peF9kaXYoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCglvdXRjb2wgPSBjb2wxOw0KDQoJaWYgKGNvbDIuciAhPSAwLjApIG91dGNvbC5yID0gZmFjbSAqIG91dGNvbC5yICsgZmFjICogb3V0Y29sLnIgLyBjb2wyLnI7DQoJaWYgKGNvbDIuZyAhPSAwLjApIG91dGNvbC5nID0gZmFjbSAqIG91dGNvbC5nICsgZmFjICogb3V0Y29sLmcgLyBjb2wyLmc7DQoJaWYgKGNvbDIuYiAhPSAwLjApIG91dGNvbC5iID0gZmFjbSAqIG91dGNvbC5iICsgZmFjICogb3V0Y29sLmIgLyBjb2wyLmI7DQp9DQoNCnZvaWQgbWl4X2RpZmYoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCW91dGNvbCA9IG1peChjb2wxLCBhYnMoY29sMSAtIGNvbDIpLCBmYWMpOw0KCW91dGNvbC5hID0gY29sMS5hOw0KfQ0KDQp2b2lkIG1peF9kYXJrKGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wucmdiID0gbWluKGNvbDEucmdiLCBjb2wyLnJnYiAqIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X2xpZ2h0KGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wucmdiID0gbWF4KGNvbDEucmdiLCBjb2wyLnJnYiAqIGZhYyk7DQoJb3V0Y29sLmEgPSBjb2wxLmE7DQp9DQoNCnZvaWQgbWl4X2RvZGdlKGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglvdXRjb2wgPSBjb2wxOw0KDQoJaWYgKG91dGNvbC5yICE9IDAuMCkgew0KCQlmbG9hdCB0bXAgPSAxLjAgLSBmYWMgKiBjb2wyLnI7DQoJCWlmICh0bXAgPD0gMC4wKQ0KCQkJb3V0Y29sLnIgPSAxLjA7DQoJCWVsc2UgaWYgKCh0bXAgPSBvdXRjb2wuciAvIHRtcCkgPiAxLjApDQoJCQlvdXRjb2wuciA9IDEuMDsNCgkJZWxzZQ0KCQkJb3V0Y29sLnIgPSB0bXA7DQoJfQ0KCWlmIChvdXRjb2wuZyAhPSAwLjApIHsNCgkJZmxvYXQgdG1wID0gMS4wIC0gZmFjICogY29sMi5nOw0KCQlpZiAodG1wIDw9IDAuMCkNCgkJCW91dGNvbC5nID0gMS4wOw0KCQllbHNlIGlmICgodG1wID0gb3V0Y29sLmcgLyB0bXApID4gMS4wKQ0KCQkJb3V0Y29sLmcgPSAxLjA7DQoJCWVsc2UNCgkJCW91dGNvbC5nID0gdG1wOw0KCX0NCglpZiAob3V0Y29sLmIgIT0gMC4wKSB7DQoJCWZsb2F0IHRtcCA9IDEuMCAtIGZhYyAqIGNvbDIuYjsNCgkJaWYgKHRtcCA8PSAwLjApDQoJCQlvdXRjb2wuYiA9IDEuMDsNCgkJZWxzZSBpZiAoKHRtcCA9IG91dGNvbC5iIC8gdG1wKSA+IDEuMCkNCgkJCW91dGNvbC5iID0gMS4wOw0KCQllbHNlDQoJCQlvdXRjb2wuYiA9IHRtcDsNCgl9DQp9DQoNCnZvaWQgbWl4X2J1cm4oZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IHRtcCwgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IGNvbDE7DQoNCgl0bXAgPSBmYWNtICsgZmFjICogY29sMi5yOw0KCWlmICh0bXAgPD0gMC4wKQ0KCQlvdXRjb2wuciA9IDAuMDsNCgllbHNlIGlmICgodG1wID0gKDEuMCAtICgxLjAgLSBvdXRjb2wucikgLyB0bXApKSA8IDAuMCkNCgkJb3V0Y29sLnIgPSAwLjA7DQoJZWxzZSBpZiAodG1wID4gMS4wKQ0KCQlvdXRjb2wuciA9IDEuMDsNCgllbHNlDQoJCW91dGNvbC5yID0gdG1wOw0KDQoJdG1wID0gZmFjbSArIGZhYyAqIGNvbDIuZzsNCglpZiAodG1wIDw9IDAuMCkNCgkJb3V0Y29sLmcgPSAwLjA7DQoJZWxzZSBpZiAoKHRtcCA9ICgxLjAgLSAoMS4wIC0gb3V0Y29sLmcpIC8gdG1wKSkgPCAwLjApDQoJCW91dGNvbC5nID0gMC4wOw0KCWVsc2UgaWYgKHRtcCA+IDEuMCkNCgkJb3V0Y29sLmcgPSAxLjA7DQoJZWxzZQ0KCQlvdXRjb2wuZyA9IHRtcDsNCg0KCXRtcCA9IGZhY20gKyBmYWMgKiBjb2wyLmI7DQoJaWYgKHRtcCA8PSAwLjApDQoJCW91dGNvbC5iID0gMC4wOw0KCWVsc2UgaWYgKCh0bXAgPSAoMS4wIC0gKDEuMCAtIG91dGNvbC5iKSAvIHRtcCkpIDwgMC4wKQ0KCQlvdXRjb2wuYiA9IDAuMDsNCgllbHNlIGlmICh0bXAgPiAxLjApDQoJCW91dGNvbC5iID0gMS4wOw0KCWVsc2UNCgkJb3V0Y29sLmIgPSB0bXA7DQp9DQoNCnZvaWQgbWl4X2h1ZShmbG9hdCBmYWMsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJZmFjID0gY2xhbXAoZmFjLCAwLjAsIDEuMCk7DQoJZmxvYXQgZmFjbSA9IDEuMCAtIGZhYzsNCg0KCW91dGNvbCA9IGNvbDE7DQoNCgl2ZWM0IGhzdiwgaHN2MiwgdG1wOw0KCXJnYl90b19oc3YoY29sMiwgaHN2Mik7DQoNCglpZiAoaHN2Mi55ICE9IDAuMCkgew0KCQlyZ2JfdG9faHN2KG91dGNvbCwgaHN2KTsNCgkJaHN2LnggPSBoc3YyLng7DQoJCWhzdl90b19yZ2IoaHN2LCB0bXApOw0KDQoJCW91dGNvbCA9IG1peChvdXRjb2wsIHRtcCwgZmFjKTsNCgkJb3V0Y29sLmEgPSBjb2wxLmE7DQoJfQ0KfQ0KDQp2b2lkIG1peF9zYXQoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCglvdXRjb2wgPSBjb2wxOw0KDQoJdmVjNCBoc3YsIGhzdjI7DQoJcmdiX3RvX2hzdihvdXRjb2wsIGhzdik7DQoNCglpZiAoaHN2LnkgIT0gMC4wKSB7DQoJCXJnYl90b19oc3YoY29sMiwgaHN2Mik7DQoNCgkJaHN2LnkgPSBmYWNtICogaHN2LnkgKyBmYWMgKiBoc3YyLnk7DQoJCWhzdl90b19yZ2IoaHN2LCBvdXRjb2wpOw0KCX0NCn0NCg0Kdm9pZCBtaXhfdmFsKGZsb2F0IGZhYywgdmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglmYWMgPSBjbGFtcChmYWMsIDAuMCwgMS4wKTsNCglmbG9hdCBmYWNtID0gMS4wIC0gZmFjOw0KDQoJdmVjNCBoc3YsIGhzdjI7DQoJcmdiX3RvX2hzdihjb2wxLCBoc3YpOw0KCXJnYl90b19oc3YoY29sMiwgaHN2Mik7DQoNCgloc3YueiA9IGZhY20gKiBoc3YueiArIGZhYyAqIGhzdjIuejsNCgloc3ZfdG9fcmdiKGhzdiwgb3V0Y29sKTsNCn0NCg0Kdm9pZCBtaXhfY29sb3IoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCglvdXRjb2wgPSBjb2wxOw0KDQoJdmVjNCBoc3YsIGhzdjIsIHRtcDsNCglyZ2JfdG9faHN2KGNvbDIsIGhzdjIpOw0KDQoJaWYgKGhzdjIueSAhPSAwLjApIHsNCgkJcmdiX3RvX2hzdihvdXRjb2wsIGhzdik7DQoJCWhzdi54ID0gaHN2Mi54Ow0KCQloc3YueSA9IGhzdjIueTsNCgkJaHN2X3RvX3JnYihoc3YsIHRtcCk7DQoNCgkJb3V0Y29sID0gbWl4KG91dGNvbCwgdG1wLCBmYWMpOw0KCQlvdXRjb2wuYSA9IGNvbDEuYTsNCgl9DQp9DQoNCnZvaWQgbWl4X3NvZnQoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KCWZsb2F0IGZhY20gPSAxLjAgLSBmYWM7DQoNCgl2ZWM0IG9uZSA9IHZlYzQoMS4wKTsNCgl2ZWM0IHNjciA9IG9uZSAtIChvbmUgLSBjb2wyKSAqIChvbmUgLSBjb2wxKTsNCglvdXRjb2wgPSBmYWNtICogY29sMSArIGZhYyAqICgob25lIC0gY29sMSkgKiBjb2wyICogY29sMSArIGNvbDEgKiBzY3IpOw0KfQ0KDQp2b2lkIG1peF9saW5lYXIoZmxvYXQgZmFjLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KDQoJb3V0Y29sID0gY29sMSArIGZhYyAqICgyLjAgKiAoY29sMiAtIHZlYzQoMC41KSkpOw0KfQ0KDQp2b2lkIHZhbHRvcmdiKGZsb2F0IGZhYywgc2FtcGxlcjJEIGNvbG9ybWFwLCBvdXQgdmVjNCBvdXRjb2wsIG91dCBmbG9hdCBvdXRhbHBoYSkNCnsNCglvdXRjb2wgPSB0ZXh0dXJlMkQoY29sb3JtYXAsIHZlYzIoZmFjLCAwLjApKTsNCglvdXRhbHBoYSA9IG91dGNvbC5hOw0KfQ0KDQp2b2lkIHJnYnRvYncodmVjNCBjb2xvciwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCiNpZmRlZiBVU0VfTkVXX1NIQURJTkcNCglvdXR2YWwgPSBjb2xvci5yICogMC4yMTI2ICsgY29sb3IuZyAqIDAuNzE1MiArIGNvbG9yLmIgKiAwLjA3MjI7DQojZWxzZQ0KCW91dHZhbCA9IGNvbG9yLnIgKiAwLjM1ICsgY29sb3IuZyAqIDAuNDUgKyBjb2xvci5iICogMC4yOyAvKiBrZWVwIHRoZXNlIGZhY3RvcnMgdmFyeWluZyBzeW5jIHdpdGggdGV4dHVyZS5oOlJHQlRPQlcgKi8NCiNlbmRpZg0KfQ0KDQp2b2lkIGludmVydChmbG9hdCBmYWMsIHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sLnh5eiA9IG1peChjb2wueHl6LCB2ZWMzKDEuMCwgMS4wLCAxLjApIC0gY29sLnh5eiwgZmFjKTsNCglvdXRjb2wudyA9IGNvbC53Ow0KfQ0KDQp2b2lkIGNsYW1wX3ZlYzModmVjMyB2ZWMsIHZlYzMgbWluLCB2ZWMzIG1heCwgb3V0IHZlYzMgb3V0X3ZlYykNCnsNCglvdXRfdmVjID0gY2xhbXAodmVjLCBtaW4sIG1heCk7DQp9DQoNCnZvaWQgY2xhbXBfdmFsKGZsb2F0IHZhbHVlLCBmbG9hdCBtaW4sIGZsb2F0IG1heCwgb3V0IGZsb2F0IG91dF92YWx1ZSkNCnsNCglvdXRfdmFsdWUgPSBjbGFtcCh2YWx1ZSwgbWluLCBtYXgpOw0KfQ0KDQp2b2lkIGh1ZV9zYXQoZmxvYXQgaHVlLCBmbG9hdCBzYXQsIGZsb2F0IHZhbHVlLCBmbG9hdCBmYWMsIHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJdmVjNCBoc3Y7DQoNCglyZ2JfdG9faHN2KGNvbCwgaHN2KTsNCg0KCWhzdlswXSArPSAoaHVlIC0gMC41KTsNCglpZiAoaHN2WzBdID4gMS4wKSBoc3ZbMF0gLT0gMS4wOyBlbHNlIGlmIChoc3ZbMF0gPCAwLjApIGhzdlswXSArPSAxLjA7DQoJaHN2WzFdICo9IHNhdDsNCglpZiAoaHN2WzFdID4gMS4wKSBoc3ZbMV0gPSAxLjA7IGVsc2UgaWYgKGhzdlsxXSA8IDAuMCkgaHN2WzFdID0gMC4wOw0KCWhzdlsyXSAqPSB2YWx1ZTsNCglpZiAoaHN2WzJdID4gMS4wKSBoc3ZbMl0gPSAxLjA7IGVsc2UgaWYgKGhzdlsyXSA8IDAuMCkgaHN2WzJdID0gMC4wOw0KDQoJaHN2X3RvX3JnYihoc3YsIG91dGNvbCk7DQoNCglvdXRjb2wgPSBtaXgoY29sLCBvdXRjb2wsIGZhYyk7DQp9DQoNCnZvaWQgc2VwYXJhdGVfcmdiKHZlYzQgY29sLCBvdXQgZmxvYXQgciwgb3V0IGZsb2F0IGcsIG91dCBmbG9hdCBiKQ0Kew0KCXIgPSBjb2wucjsNCglnID0gY29sLmc7DQoJYiA9IGNvbC5iOw0KfQ0KDQp2b2lkIGNvbWJpbmVfcmdiKGZsb2F0IHIsIGZsb2F0IGcsIGZsb2F0IGIsIG91dCB2ZWM0IGNvbCkNCnsNCgljb2wgPSB2ZWM0KHIsIGcsIGIsIDEuMCk7DQp9DQoNCnZvaWQgc2VwYXJhdGVfeHl6KHZlYzMgdmVjLCBvdXQgZmxvYXQgeCwgb3V0IGZsb2F0IHksIG91dCBmbG9hdCB6KQ0Kew0KCXggPSB2ZWMucjsNCgl5ID0gdmVjLmc7DQoJeiA9IHZlYy5iOw0KfQ0KDQp2b2lkIGNvbWJpbmVfeHl6KGZsb2F0IHgsIGZsb2F0IHksIGZsb2F0IHosIG91dCB2ZWMzIHZlYykNCnsNCgl2ZWMgPSB2ZWMzKHgsIHksIHopOw0KfQ0KDQp2b2lkIHNlcGFyYXRlX2hzdih2ZWM0IGNvbCwgb3V0IGZsb2F0IGgsIG91dCBmbG9hdCBzLCBvdXQgZmxvYXQgdikNCnsNCgl2ZWM0IGhzdjsNCg0KCXJnYl90b19oc3YoY29sLCBoc3YpOw0KCWggPSBoc3ZbMF07DQoJcyA9IGhzdlsxXTsNCgl2ID0gaHN2WzJdOw0KfQ0KDQp2b2lkIGNvbWJpbmVfaHN2KGZsb2F0IGgsIGZsb2F0IHMsIGZsb2F0IHYsIG91dCB2ZWM0IGNvbCkNCnsNCgloc3ZfdG9fcmdiKHZlYzQoaCwgcywgdiwgMS4wKSwgY29sKTsNCn0NCg0Kdm9pZCBvdXRwdXRfbm9kZSh2ZWM0IHJnYiwgZmxvYXQgYWxwaGEsIG91dCB2ZWM0IG91dHJnYikNCnsNCglvdXRyZ2IgPSB2ZWM0KHJnYi5yZ2IsIGFscGhhKTsNCn0NCg0KLyoqKioqKioqKioqIFRFWFRVUkVTICoqKioqKioqKioqKioqKi8NCg0Kdm9pZCB0ZXh0dXJlX2ZsaXBfYmxlbmQodmVjMyB2ZWMsIG91dCB2ZWMzIG91dHZlYykNCnsNCglvdXR2ZWMgPSB2ZWMueXh6Ow0KfQ0KDQp2b2lkIHRleHR1cmVfYmxlbmRfbGluKHZlYzMgdmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9ICgxLjAgKyB2ZWMueCkgLyAyLjA7DQp9DQoNCnZvaWQgdGV4dHVyZV9ibGVuZF9xdWFkKHZlYzMgdmVjLCBvdXQgZmxvYXQgb3V0dmFsKQ0Kew0KCW91dHZhbCA9IG1heCgoMS4wICsgdmVjLngpIC8gMi4wLCAwLjApOw0KCW91dHZhbCAqPSBvdXR2YWw7DQp9DQoNCnZvaWQgdGV4dHVyZV93b29kX3Npbih2ZWMzIHZlYywgb3V0IGZsb2F0IHZhbHVlLCBvdXQgdmVjNCBjb2xvciwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCWZsb2F0IGEgPSBzcXJ0KHZlYy54ICogdmVjLnggKyB2ZWMueSAqIHZlYy55ICsgdmVjLnogKiB2ZWMueikgKiAyMC4wOw0KCWZsb2F0IHdpID0gMC41ICsgMC41ICogc2luKGEpOw0KDQoJdmFsdWUgPSB3aTsNCgljb2xvciA9IHZlYzQod2ksIHdpLCB3aSwgMS4wKTsNCglub3JtYWwgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOw0KfQ0KDQp2b2lkIHRleHR1cmVfaW1hZ2UodmVjMyB2ZWMsIHNhbXBsZXIyRCBpbWEsIG91dCBmbG9hdCB2YWx1ZSwgb3V0IHZlYzQgY29sb3IsIG91dCB2ZWMzIG5vcm1hbCkNCnsNCgljb2xvciA9IHRleHR1cmUyRChpbWEsICh2ZWMueHkgKyB2ZWMyKDEuMCwgMS4wKSkgKiAwLjUpOw0KCXZhbHVlID0gY29sb3IuYTsNCg0KCW5vcm1hbC54ID0gMi4wICogKGNvbG9yLnIgLSAwLjUpOw0KCW5vcm1hbC55ID0gMi4wICogKDAuNSAtIGNvbG9yLmcpOw0KCW5vcm1hbC56ID0gMi4wICogKGNvbG9yLmIgLSAwLjUpOw0KfQ0KDQovKioqKioqKioqKioqKiBNVEVYICoqKioqKioqKioqKioqKioqLw0KDQp2b2lkIHRleGNvX29yY28odmVjMyBhdHRvcmNvLCBvdXQgdmVjMyBvcmNvKQ0Kew0KCW9yY28gPSBhdHRvcmNvOw0KfQ0KDQp2b2lkIHRleGNvX3V2KHZlYzIgYXR0dXYsIG91dCB2ZWMzIHV2KQ0Kew0KCS8qIGRpc2FibGVkIGZvciBub3csIHdvcmtzIHRvZ2V0aGVyIHdpdGggbGVhdmluZyBvdXQgbXRleF8yZF9tYXBwaW5nDQoJICAgdXYgPSB2ZWMzKGF0dHV2KjIuMCAtIHZlYzIoMS4wLCAxLjApLCAwLjApOyAqLw0KCXV2ID0gdmVjMyhhdHR1diwgMC4wKTsNCn0NCg0Kdm9pZCB0ZXhjb19ub3JtKHZlYzMgbm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJLyogY29ycmVzcG9uZHMgdG8gc2hpLT5vcm4sIHdoaWNoIGlzIG5lZ2F0ZWQgc28gY2FuY2Vscw0KCSAgIG91dCBibGVuZGVyIG5vcm1hbCBuZWdhdGlvbiAqLw0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZShub3JtYWwpOw0KfQ0KDQp2b2lkIHRleGNvX3RhbmdlbnQodmVjNCB0YW5nZW50LCBvdXQgdmVjMyBvdXR0YW5nZW50KQ0Kew0KCW91dHRhbmdlbnQgPSBub3JtYWxpemUodGFuZ2VudC54eXopOw0KfQ0KDQp2b2lkIHRleGNvX2dsb2JhbChtYXQ0IHZpZXdpbnZtYXQsIHZlYzMgY28sIG91dCB2ZWMzIGdsb2JhbCkNCnsNCglnbG9iYWwgPSAodmlld2ludm1hdCAqIHZlYzQoY28sIDEuMCkpLnh5ejsNCn0NCg0Kdm9pZCB0ZXhjb19vYmplY3QobWF0NCB2aWV3aW52bWF0LCBtYXQ0IG9iaW52bWF0LCB2ZWMzIGNvLCBvdXQgdmVjMyBvYmplY3QpDQp7DQoJb2JqZWN0ID0gKG9iaW52bWF0ICogKHZpZXdpbnZtYXQgKiB2ZWM0KGNvLCAxLjApKSkueHl6Ow0KfQ0KDQp2b2lkIHRleGNvX3JlZmwodmVjMyB2biwgdmVjMyB2aWV3LCBvdXQgdmVjMyByZWYpDQp7DQoJcmVmID0gdmlldyAtIDIuMCAqIGRvdCh2biwgdmlldykgKiB2bjsNCn0NCg0Kdm9pZCBzaGFkZV9ub3JtKHZlYzMgbm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJLyogYmxlbmRlciByZW5kZXIgbm9ybWFsIGlzIG5lZ2F0ZWQgKi8NCglvdXRub3JtYWwgPSAtbm9ybWFsaXplKG5vcm1hbCk7DQp9DQoNCnZvaWQgbXRleF9taXJyb3IodmVjMyB0Y29sLCB2ZWM0IHJlZmNvbCwgZmxvYXQgdGluLCBmbG9hdCBjb2xtaXJmYWMsIG91dCB2ZWM0IG91dHJlZmNvbCkNCnsNCglvdXRyZWZjb2wgPSBtaXgocmVmY29sLCB2ZWM0KDEuMCwgdGNvbCksIHRpbiAqIGNvbG1pcmZhYyk7DQp9DQoNCnZvaWQgbXRleF9yZ2JfYmxlbmQodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaW5jb2wgPSBmYWN0ICogdGV4Y29sICsgZmFjbSAqIG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9tdWwodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaW5jb2wgPSAoZmFjbSArIGZhY3QgKiB0ZXhjb2wpICogb3V0Y29sOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX3NjcmVlbih2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoNCglmYWN0ICo9IGZhY2c7DQoJZmFjbSA9IDEuMCAtIGZhY3Q7DQoNCglpbmNvbCA9IHZlYzMoMS4wKSAtICh2ZWMzKGZhY20pICsgZmFjdCAqICh2ZWMzKDEuMCkgLSB0ZXhjb2wpKSAqICh2ZWMzKDEuMCkgLSBvdXRjb2wpOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX292ZXJsYXkodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaWYgKG91dGNvbC5yIDwgMC41KQ0KCQlpbmNvbC5yID0gb3V0Y29sLnIgKiAoZmFjbSArIDIuMCAqIGZhY3QgKiB0ZXhjb2wucik7DQoJZWxzZQ0KCQlpbmNvbC5yID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWN0ICogKDEuMCAtIHRleGNvbC5yKSkgKiAoMS4wIC0gb3V0Y29sLnIpOw0KDQoJaWYgKG91dGNvbC5nIDwgMC41KQ0KCQlpbmNvbC5nID0gb3V0Y29sLmcgKiAoZmFjbSArIDIuMCAqIGZhY3QgKiB0ZXhjb2wuZyk7DQoJZWxzZQ0KCQlpbmNvbC5nID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWN0ICogKDEuMCAtIHRleGNvbC5nKSkgKiAoMS4wIC0gb3V0Y29sLmcpOw0KDQoJaWYgKG91dGNvbC5iIDwgMC41KQ0KCQlpbmNvbC5iID0gb3V0Y29sLmIgKiAoZmFjbSArIDIuMCAqIGZhY3QgKiB0ZXhjb2wuYik7DQoJZWxzZQ0KCQlpbmNvbC5iID0gMS4wIC0gKGZhY20gKyAyLjAgKiBmYWN0ICogKDEuMCAtIHRleGNvbC5iKSkgKiAoMS4wIC0gb3V0Y29sLmIpOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX3N1Yih2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWluY29sID0gLWZhY3QgKiBmYWNnICogdGV4Y29sICsgb3V0Y29sOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2FkZCh2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWluY29sID0gZmFjdCAqIGZhY2cgKiB0ZXhjb2wgKyBvdXRjb2w7DQp9DQoNCnZvaWQgbXRleF9yZ2JfZGl2KHZlYzMgb3V0Y29sLCB2ZWMzIHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IHZlYzMgaW5jb2wpDQp7DQoJZmxvYXQgZmFjbTsNCg0KCWZhY3QgKj0gZmFjZzsNCglmYWNtID0gMS4wIC0gZmFjdDsNCg0KCWlmICh0ZXhjb2wuciAhPSAwLjApIGluY29sLnIgPSBmYWNtICogb3V0Y29sLnIgKyBmYWN0ICogb3V0Y29sLnIgLyB0ZXhjb2wucjsNCglpZiAodGV4Y29sLmcgIT0gMC4wKSBpbmNvbC5nID0gZmFjbSAqIG91dGNvbC5nICsgZmFjdCAqIG91dGNvbC5nIC8gdGV4Y29sLmc7DQoJaWYgKHRleGNvbC5iICE9IDAuMCkgaW5jb2wuYiA9IGZhY20gKiBvdXRjb2wuYiArIGZhY3QgKiBvdXRjb2wuYiAvIHRleGNvbC5iOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2RpZmYodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KDQoJZmFjdCAqPSBmYWNnOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIGFicyh0ZXhjb2wgLSBvdXRjb2wpOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2RhcmsodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmbG9hdCBmYWNtLCBjb2w7DQoNCglmYWN0ICo9IGZhY2c7DQoJZmFjbSA9IDEuMCAtIGZhY3Q7DQoNCglpbmNvbC5yID0gbWluKG91dGNvbC5yLCB0ZXhjb2wucikgKiBmYWN0ICsgb3V0Y29sLnIgKiBmYWNtOw0KCWluY29sLmcgPSBtaW4ob3V0Y29sLmcsIHRleGNvbC5nKSAqIGZhY3QgKyBvdXRjb2wuZyAqIGZhY207DQoJaW5jb2wuYiA9IG1pbihvdXRjb2wuYiwgdGV4Y29sLmIpICogZmFjdCArIG91dGNvbC5iICogZmFjbTsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9saWdodCh2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCWZsb2F0IGZhY20sIGNvbDsNCg0KCWZhY3QgKj0gZmFjZzsNCg0KCWNvbCA9IGZhY3QgKiB0ZXhjb2wucjsNCglpZiAoY29sID4gb3V0Y29sLnIpIGluY29sLnIgPSBjb2w7IGVsc2UgaW5jb2wuciA9IG91dGNvbC5yOw0KCWNvbCA9IGZhY3QgKiB0ZXhjb2wuZzsNCglpZiAoY29sID4gb3V0Y29sLmcpIGluY29sLmcgPSBjb2w7IGVsc2UgaW5jb2wuZyA9IG91dGNvbC5nOw0KCWNvbCA9IGZhY3QgKiB0ZXhjb2wuYjsNCglpZiAoY29sID4gb3V0Y29sLmIpIGluY29sLmIgPSBjb2w7IGVsc2UgaW5jb2wuYiA9IG91dGNvbC5iOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2h1ZSh2ZWMzIG91dGNvbCwgdmVjMyB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCB2ZWMzIGluY29sKQ0Kew0KCXZlYzQgY29sOw0KDQoJbWl4X2h1ZShmYWN0ICogZmFjZywgdmVjNChvdXRjb2wsIDEuMCksIHZlYzQodGV4Y29sLCAxLjApLCBjb2wpOw0KCWluY29sLnJnYiA9IGNvbC5yZ2I7DQp9DQoNCnZvaWQgbXRleF9yZ2Jfc2F0KHZlYzMgb3V0Y29sLCB2ZWMzIHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IHZlYzMgaW5jb2wpDQp7DQoJdmVjNCBjb2w7DQoNCgltaXhfc2F0KGZhY3QgKiBmYWNnLCB2ZWM0KG91dGNvbCwgMS4wKSwgdmVjNCh0ZXhjb2wsIDEuMCksIGNvbCk7DQoJaW5jb2wucmdiID0gY29sLnJnYjsNCn0NCg0Kdm9pZCBtdGV4X3JnYl92YWwodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCgl2ZWM0IGNvbDsNCg0KCW1peF92YWwoZmFjdCAqIGZhY2csIHZlYzQob3V0Y29sLCAxLjApLCB2ZWM0KHRleGNvbCwgMS4wKSwgY29sKTsNCglpbmNvbC5yZ2IgPSBjb2wucmdiOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX2NvbG9yKHZlYzMgb3V0Y29sLCB2ZWMzIHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IHZlYzMgaW5jb2wpDQp7DQoJdmVjNCBjb2w7DQoNCgltaXhfY29sb3IoZmFjdCAqIGZhY2csIHZlYzQob3V0Y29sLCAxLjApLCB2ZWM0KHRleGNvbCwgMS4wKSwgY29sKTsNCglpbmNvbC5yZ2IgPSBjb2wucmdiOw0KfQ0KDQp2b2lkIG10ZXhfcmdiX3NvZnQodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCgl2ZWM0IGNvbDsNCg0KCW1peF9zb2Z0KGZhY3QgKiBmYWNnLCB2ZWM0KG91dGNvbCwgMS4wKSwgdmVjNCh0ZXhjb2wsIDEuMCksIGNvbCk7DQoJaW5jb2wucmdiID0gY29sLnJnYjsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9saW5lYXIodmVjMyBvdXRjb2wsIHZlYzMgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgdmVjMyBpbmNvbCkNCnsNCglmYWN0ICo9IGZhY2c7DQoNCglpZiAodGV4Y29sLnIgPiAwLjUpDQoJCWluY29sLnIgPSBvdXRjb2wuciArIGZhY3QgKiAoMi4wICogKHRleGNvbC5yIC0gMC41KSk7DQoJZWxzZQ0KCQlpbmNvbC5yID0gb3V0Y29sLnIgKyBmYWN0ICogKDIuMCAqICh0ZXhjb2wucikgLSAxLjApOw0KDQoJaWYgKHRleGNvbC5nID4gMC41KQ0KCQlpbmNvbC5nID0gb3V0Y29sLmcgKyBmYWN0ICogKDIuMCAqICh0ZXhjb2wuZyAtIDAuNSkpOw0KCWVsc2UNCgkJaW5jb2wuZyA9IG91dGNvbC5nICsgZmFjdCAqICgyLjAgKiAodGV4Y29sLmcpIC0gMS4wKTsNCg0KCWlmICh0ZXhjb2wuYiA+IDAuNSkNCgkJaW5jb2wuYiA9IG91dGNvbC5iICsgZmFjdCAqICgyLjAgKiAodGV4Y29sLmIgLSAwLjUpKTsNCgllbHNlDQoJCWluY29sLmIgPSBvdXRjb2wuYiArIGZhY3QgKiAoMi4wICogKHRleGNvbC5iKSAtIDEuMCk7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV92YXJzKGlub3V0IGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCBmbG9hdCBmYWNtKQ0Kew0KCWZhY3QgKj0gYWJzKGZhY2cpOw0KCWZhY20gPSAxLjAgLSBmYWN0Ow0KDQoJaWYgKGZhY2cgPCAwLjApIHsNCgkJZmxvYXQgdG1wID0gZmFjdDsNCgkJZmFjdCA9IGZhY207DQoJCWZhY20gPSB0bXA7DQoJfQ0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfYmxlbmQoZmxvYXQgb3V0Y29sLCBmbG9hdCB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCBmbG9hdCBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KCW10ZXhfdmFsdWVfdmFycyhmYWN0LCBmYWNnLCBmYWNtKTsNCg0KCWluY29sID0gZmFjdCAqIHRleGNvbCArIGZhY20gKiBvdXRjb2w7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV9tdWwoZmxvYXQgb3V0Y29sLCBmbG9hdCB0ZXhjb2wsIGZsb2F0IGZhY3QsIGZsb2F0IGZhY2csIG91dCBmbG9hdCBpbmNvbCkNCnsNCglmbG9hdCBmYWNtOw0KCW10ZXhfdmFsdWVfdmFycyhmYWN0LCBmYWNnLCBmYWNtKTsNCg0KCWZhY20gPSAxLjAgLSBmYWNnOw0KCWluY29sID0gKGZhY20gKyBmYWN0ICogdGV4Y29sKSAqIG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX3NjcmVlbihmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmFjbSA9IDEuMCAtIGZhY2c7DQoJaW5jb2wgPSAxLjAgLSAoZmFjbSArIGZhY3QgKiAoMS4wIC0gdGV4Y29sKSkgKiAoMS4wIC0gb3V0Y29sKTsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX3N1YihmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmFjdCA9IC1mYWN0Ow0KCWluY29sID0gZmFjdCAqIHRleGNvbCArIG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX2FkZChmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmFjdCA9IGZhY3Q7DQoJaW5jb2wgPSBmYWN0ICogdGV4Y29sICsgb3V0Y29sOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfZGl2KGZsb2F0IG91dGNvbCwgZmxvYXQgdGV4Y29sLCBmbG9hdCBmYWN0LCBmbG9hdCBmYWNnLCBvdXQgZmxvYXQgaW5jb2wpDQp7DQoJZmxvYXQgZmFjbTsNCgltdGV4X3ZhbHVlX3ZhcnMoZmFjdCwgZmFjZywgZmFjbSk7DQoNCglpZiAodGV4Y29sICE9IDAuMCkNCgkJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIG91dGNvbCAvIHRleGNvbDsNCgllbHNlDQoJCWluY29sID0gMC4wOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfZGlmZihmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIGFicyh0ZXhjb2wgLSBvdXRjb2wpOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfZGFyayhmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJaW5jb2wgPSBmYWNtICogb3V0Y29sICsgZmFjdCAqIG1pbihvdXRjb2wsIHRleGNvbCk7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV9saWdodChmbG9hdCBvdXRjb2wsIGZsb2F0IHRleGNvbCwgZmxvYXQgZmFjdCwgZmxvYXQgZmFjZywgb3V0IGZsb2F0IGluY29sKQ0Kew0KCWZsb2F0IGZhY207DQoJbXRleF92YWx1ZV92YXJzKGZhY3QsIGZhY2csIGZhY20pOw0KDQoJZmxvYXQgY29sID0gZmFjdCAqIHRleGNvbDsNCglpZiAoY29sID4gb3V0Y29sKSBpbmNvbCA9IGNvbDsgZWxzZSBpbmNvbCA9IG91dGNvbDsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX2NsYW1wX3Bvc2l0aXZlKGZsb2F0IGZhYywgb3V0IGZsb2F0IG91dGZhYykNCnsNCglvdXRmYWMgPSBtYXgoZmFjLCAwLjApOw0KfQ0KDQp2b2lkIG10ZXhfdmFsdWVfY2xhbXAoZmxvYXQgZmFjLCBvdXQgZmxvYXQgb3V0ZmFjKQ0Kew0KCW91dGZhYyA9IGNsYW1wKGZhYywgMC4wLCAxLjApOw0KfQ0KDQp2b2lkIG10ZXhfaGFyX2RpdmlkZShmbG9hdCBoYXIsIG91dCBmbG9hdCBvdXRoYXIpDQp7DQoJb3V0aGFyID0gaGFyIC8gMTI4LjA7DQp9DQoNCnZvaWQgbXRleF9oYXJfbXVsdGlwbHlfY2xhbXAoZmxvYXQgaGFyLCBvdXQgZmxvYXQgb3V0aGFyKQ0Kew0KCWhhciAqPSAxMjguMDsNCg0KCWlmIChoYXIgPCAxLjApIG91dGhhciA9IDEuMDsNCgllbHNlIGlmIChoYXIgPiA1MTEuMCkgb3V0aGFyID0gNTExLjA7DQoJZWxzZSBvdXRoYXIgPSBoYXI7DQp9DQoNCnZvaWQgbXRleF9hbHBoYV9mcm9tX2NvbCh2ZWM0IGNvbCwgb3V0IGZsb2F0IGFscGhhKQ0Kew0KCWFscGhhID0gY29sLmE7DQp9DQoNCnZvaWQgbXRleF9hbHBoYV90b19jb2wodmVjNCBjb2wsIGZsb2F0IGFscGhhLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gdmVjNChjb2wucmdiLCBhbHBoYSk7DQp9DQoNCnZvaWQgbXRleF9hbHBoYV9tdWx0aXBseV92YWx1ZSh2ZWM0IGNvbCwgZmxvYXQgdmFsdWUsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSB2ZWM0KGNvbC5yZ2IsIGNvbC5hICogdmFsdWUpOw0KfQ0KDQp2b2lkIG10ZXhfcmdidG9pbnQodmVjNCByZ2IsIG91dCBmbG9hdCBpbnRlbnNpdHkpDQp7DQoJaW50ZW5zaXR5ID0gZG90KHZlYzMoMC4zNSwgMC40NSwgMC4yKSwgcmdiLnJnYik7DQp9DQoNCnZvaWQgbXRleF92YWx1ZV9pbnZlcnQoZmxvYXQgaW52YWx1ZSwgb3V0IGZsb2F0IG91dHZhbHVlKQ0Kew0KCW91dHZhbHVlID0gMS4wIC0gaW52YWx1ZTsNCn0NCg0Kdm9pZCBtdGV4X3JnYl9pbnZlcnQodmVjNCBpbnJnYiwgb3V0IHZlYzQgb3V0cmdiKQ0Kew0KCW91dHJnYiA9IHZlYzQodmVjMygxLjApIC0gaW5yZ2IucmdiLCBpbnJnYi5hKTsNCn0NCg0Kdm9pZCBtdGV4X3ZhbHVlX3N0ZW5jaWwoZmxvYXQgc3RlbmNpbCwgZmxvYXQgaW50ZW5zaXR5LCBvdXQgZmxvYXQgb3V0c3RlbmNpbCwgb3V0IGZsb2F0IG91dGludGVuc2l0eSkNCnsNCglmbG9hdCBmYWN0ID0gaW50ZW5zaXR5Ow0KCW91dGludGVuc2l0eSA9IGludGVuc2l0eSAqIHN0ZW5jaWw7DQoJb3V0c3RlbmNpbCA9IHN0ZW5jaWwgKiBmYWN0Ow0KfQ0KDQp2b2lkIG10ZXhfcmdiX3N0ZW5jaWwoZmxvYXQgc3RlbmNpbCwgdmVjNCByZ2IsIG91dCBmbG9hdCBvdXRzdGVuY2lsLCBvdXQgdmVjNCBvdXRyZ2IpDQp7DQoJZmxvYXQgZmFjdCA9IHJnYi5hOw0KCW91dHJnYiA9IHZlYzQocmdiLnJnYiwgcmdiLmEgKiBzdGVuY2lsKTsNCglvdXRzdGVuY2lsID0gc3RlbmNpbCAqIGZhY3Q7DQp9DQoNCnZvaWQgbXRleF9tYXBwaW5nX29mcyh2ZWMzIHRleGNvLCB2ZWMzIG9mcywgb3V0IHZlYzMgb3V0dGV4Y28pDQp7DQoJb3V0dGV4Y28gPSB0ZXhjbyArIG9mczsNCn0NCg0Kdm9pZCBtdGV4X21hcHBpbmdfc2l6ZSh2ZWMzIHRleGNvLCB2ZWMzIHNpemUsIG91dCB2ZWMzIG91dHRleGNvKQ0Kew0KCW91dHRleGNvID0gc2l6ZSAqIHRleGNvOw0KfQ0KDQp2b2lkIG10ZXhfMmRfbWFwcGluZyh2ZWMzIHZlYywgb3V0IHZlYzMgb3V0dmVjKQ0Kew0KCW91dHZlYyA9IHZlYzModmVjLnh5ICogMC41ICsgdmVjMigwLjUpLCB2ZWMueik7DQp9DQoNCnZlYzMgbXRleF8yZF9tYXBwaW5nKHZlYzMgdmVjKQ0Kew0KCXJldHVybiB2ZWMzKHZlYy54eSAqIDAuNSArIHZlYzIoMC41KSwgdmVjLnopOw0KfQ0KDQp2b2lkIG10ZXhfY3ViZV9tYXAodmVjMyBjbywgc2FtcGxlckN1YmUgaW1hLCBvdXQgZmxvYXQgdmFsdWUsIG91dCB2ZWM0IGNvbG9yKQ0Kew0KCWNvbG9yID0gdGV4dHVyZUN1YmUoaW1hLCBjbyk7DQoJdmFsdWUgPSAxLjA7DQp9DQoNCnZvaWQgbXRleF9jdWJlX21hcF9yZWZsX2Zyb21fcmVmbGRpcigNCiAgICAgICAgc2FtcGxlckN1YmUgaW1hLCB2ZWMzIHJlZmxlY3RlZGRpcmVjdGlvbiwgb3V0IGZsb2F0IHZhbHVlLCBvdXQgdmVjNCBjb2xvcikNCnsNCiAgICAgICAgY29sb3IgPSB0ZXh0dXJlQ3ViZShpbWEsIHJlZmxlY3RlZGRpcmVjdGlvbik7DQogICAgICAgIHZhbHVlID0gMS4wOw0KfQ0KDQp2b2lkIG10ZXhfY3ViZV9tYXBfcmVmbCgNCiAgICAgICAgc2FtcGxlckN1YmUgaW1hLCB2ZWMzIHZwLCB2ZWMzIHZuLCBtYXQ0IHZpZXdtYXRyaXhpbnZlcnNlLCBtYXQ0IHZpZXdtYXRyaXgsDQogICAgICAgIG91dCBmbG9hdCB2YWx1ZSwgb3V0IHZlYzQgY29sb3IpDQp7DQoJdmVjMyB2aWV3ZGlyZWN0aW9uID0gdmVjMyh2aWV3bWF0cml4aW52ZXJzZSAqIHZlYzQodnAsIDAuMCkpOw0KCXZlYzMgbm9ybWFsZGlyZWN0aW9uID0gbm9ybWFsaXplKHZlYzModmVjNCh2biwgMC4wKSAqIHZpZXdtYXRyaXgpKTsNCgl2ZWMzIHJlZmxlY3RlZGRpcmVjdGlvbiA9IHJlZmxlY3Qodmlld2RpcmVjdGlvbiwgbm9ybWFsZGlyZWN0aW9uKTsNCgljb2xvciA9IHRleHR1cmVDdWJlKGltYSwgcmVmbGVjdGVkZGlyZWN0aW9uKTsNCgl2YWx1ZSA9IDEuMDsNCn0NCg0Kdm9pZCBtdGV4X2ltYWdlKHZlYzMgdGV4Y28sIHNhbXBsZXIyRCBpbWEsIG91dCBmbG9hdCB2YWx1ZSwgb3V0IHZlYzQgY29sb3IpDQp7DQoJY29sb3IgPSB0ZXh0dXJlMkQoaW1hLCB0ZXhjby54eSk7DQoJdmFsdWUgPSAxLjA7DQp9DQoNCnZvaWQgbXRleF9ub3JtYWwodmVjMyB0ZXhjbywgc2FtcGxlcjJEIGltYSwgb3V0IHZlYzMgbm9ybWFsKQ0Kew0KCS8vIFRoZSBpbnZlcnQgb2YgdGhlIHJlZCBjaGFubmVsIGlzIHRvIG1ha2UNCgkvLyB0aGUgbm9ybWFsIG1hcCBjb21wbGlhbnQgd2l0aCB0aGUgb3V0c2lkZSB3b3JsZC4NCgkvLyBJdCBuZWVkcyB0byBiZSBkb25lIGJlY2F1c2UgdmFyeWluZyBCbGVuZGVyDQoJLy8gdGhlIG5vcm1hbCB1c2VkIHBvaW50cyBpbndhcmQuDQoJLy8gU2hvdWxkIHRoaXMgZXZlciBjaGFuZ2UgdGhpcyBuZWdhdGUgbXVzdCBiZSByZW1vdmVkLg0KCXZlYzQgY29sb3IgPSB0ZXh0dXJlMkQoaW1hLCB0ZXhjby54eSk7DQoJbm9ybWFsID0gMi4wICogKHZlYzMoLWNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIpIC0gdmVjMygtMC41LCAwLjUsIDAuNSkpOw0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9ub3JtYWxzX2luaXQodmVjMyB2Tiwgb3V0IHZlYzMgdk5vcmcsIG91dCB2ZWMzIHZOYWNjLCBvdXQgZmxvYXQgZlByZXZNYWduaXR1ZGUpDQp7DQoJdk5vcmcgPSB2TjsNCgl2TmFjYyA9IHZOOw0KCWZQcmV2TWFnbml0dWRlID0gMS4wOw0KfQ0KDQovKiogaGVscGVyIG1ldGhvZCB0byBleHRyYWN0IHRoZSB1cHBlciBsZWZ0IDN4MyBtYXRyaXggZnJvbSBhIDR4NCBtYXRyaXggKi8NCm1hdDMgdG9fbWF0MyhtYXQ0IG00KQ0Kew0KCW1hdDMgbTM7DQoJbTNbMF0gPSBtNFswXS54eXo7DQoJbTNbMV0gPSBtNFsxXS54eXo7DQoJbTNbMl0gPSBtNFsyXS54eXo7DQoJcmV0dXJuIG0zOw0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9pbml0X29ianNwYWNlKA0KICAgICAgICB2ZWMzIHN1cmZfcG9zLCB2ZWMzIHN1cmZfbm9ybSwNCiAgICAgICAgbWF0NCBtVmlldywgbWF0NCBtVmlld0ludiwgbWF0NCBtT2JqLCBtYXQ0IG1PYmpJbnYsDQogICAgICAgIGZsb2F0IGZQcmV2TWFnbml0dWRlX2luLCB2ZWMzIHZOYWNjX2luLA0KICAgICAgICBvdXQgZmxvYXQgZlByZXZNYWduaXR1ZGVfb3V0LCBvdXQgdmVjMyB2TmFjY19vdXQsDQogICAgICAgIG91dCB2ZWMzIHZSMSwgb3V0IHZlYzMgdlIyLCBvdXQgZmxvYXQgZkRldCkNCnsNCgltYXQzIG9iajJ2aWV3ID0gdG9fbWF0MyhibF9Nb2RlbFZpZXdNYXRyaXgpOw0KCW1hdDMgdmlldzJvYmogPSB0b19tYXQzKGJsX01vZGVsVmlld01hdHJpeEludmVyc2UpOw0KDQoJdmVjMyB2U2lnbWFTID0gdmlldzJvYmogKiBkRmR4KHN1cmZfcG9zKTsNCgl2ZWMzIHZTaWdtYVQgPSB2aWV3Mm9iaiAqIGRGZHkoc3VyZl9wb3MpOw0KCXZlYzMgdk4gPSBub3JtYWxpemUoc3VyZl9ub3JtICogb2JqMnZpZXcpOw0KDQoJdlIxID0gY3Jvc3ModlNpZ21hVCwgdk4pOw0KCXZSMiA9IGNyb3NzKHZOLCB2U2lnbWFTKTsNCglmRGV0ID0gZG90KHZTaWdtYVMsIHZSMSk7DQoNCgkvKiBwcmV0cmFuc2Zvcm0gdk5hY2MgKHZhcnlpbmcgbXRleF9idW1wX2FwcGx5KSB1c2luZyB0aGUgaW52ZXJzZSB0cmFuc3Bvc2VkICovDQoJdlIxID0gdlIxICogdmlldzJvYmo7DQoJdlIyID0gdlIyICogdmlldzJvYmo7DQoJdk4gPSB2TiAqIHZpZXcyb2JqOw0KDQoJZmxvYXQgZk1hZ25pdHVkZSA9IGFicyhmRGV0KSAqIGxlbmd0aCh2Tik7DQoJdk5hY2Nfb3V0ID0gdk5hY2NfaW4gKiAoZk1hZ25pdHVkZSAvIGZQcmV2TWFnbml0dWRlX2luKTsNCglmUHJldk1hZ25pdHVkZV9vdXQgPSBmTWFnbml0dWRlOw0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9pbml0X3RleHR1cmVzcGFjZSgNCiAgICAgICAgdmVjMyBzdXJmX3BvcywgdmVjMyBzdXJmX25vcm0sDQogICAgICAgIGZsb2F0IGZQcmV2TWFnbml0dWRlX2luLCB2ZWMzIHZOYWNjX2luLA0KICAgICAgICBvdXQgZmxvYXQgZlByZXZNYWduaXR1ZGVfb3V0LCBvdXQgdmVjMyB2TmFjY19vdXQsDQogICAgICAgIG91dCB2ZWMzIHZSMSwgb3V0IHZlYzMgdlIyLCBvdXQgZmxvYXQgZkRldCkNCnsNCgl2ZWMzIHZTaWdtYVMgPSBkRmR4KHN1cmZfcG9zKTsNCgl2ZWMzIHZTaWdtYVQgPSBkRmR5KHN1cmZfcG9zKTsNCgl2ZWMzIHZOID0gc3VyZl9ub3JtOyAvKiBub3JtYWxpemVkIGludGVycG9sYXRlZCB2ZXJ0ZXggbm9ybWFsICovDQoNCgl2UjEgPSBub3JtYWxpemUoY3Jvc3ModlNpZ21hVCwgdk4pKTsNCgl2UjIgPSBub3JtYWxpemUoY3Jvc3Modk4sIHZTaWdtYVMpKTsNCglmRGV0ID0gc2lnbihkb3QodlNpZ21hUywgdlIxKSk7DQoNCglmbG9hdCBmTWFnbml0dWRlID0gYWJzKGZEZXQpOw0KCXZOYWNjX291dCA9IHZOYWNjX2luICogKGZNYWduaXR1ZGUgLyBmUHJldk1hZ25pdHVkZV9pbik7DQoJZlByZXZNYWduaXR1ZGVfb3V0ID0gZk1hZ25pdHVkZTsNCn0NCg0Kdm9pZCBtdGV4X2J1bXBfaW5pdF92aWV3c3BhY2UoDQogICAgICAgIHZlYzMgc3VyZl9wb3MsIHZlYzMgc3VyZl9ub3JtLA0KICAgICAgICBmbG9hdCBmUHJldk1hZ25pdHVkZV9pbiwgdmVjMyB2TmFjY19pbiwNCiAgICAgICAgb3V0IGZsb2F0IGZQcmV2TWFnbml0dWRlX291dCwgb3V0IHZlYzMgdk5hY2Nfb3V0LA0KICAgICAgICBvdXQgdmVjMyB2UjEsIG91dCB2ZWMzIHZSMiwgb3V0IGZsb2F0IGZEZXQpDQp7DQoJdmVjMyB2U2lnbWFTID0gZEZkeChzdXJmX3Bvcyk7DQoJdmVjMyB2U2lnbWFUID0gZEZkeShzdXJmX3Bvcyk7DQoJdmVjMyB2TiA9IHN1cmZfbm9ybTsgLyogbm9ybWFsaXplZCBpbnRlcnBvbGF0ZWQgdmVydGV4IG5vcm1hbCAqLw0KDQoJdlIxID0gY3Jvc3ModlNpZ21hVCwgdk4pOw0KCXZSMiA9IGNyb3NzKHZOLCB2U2lnbWFTKTsNCglmRGV0ID0gZG90KHZTaWdtYVMsIHZSMSk7DQoNCglmbG9hdCBmTWFnbml0dWRlID0gYWJzKGZEZXQpOw0KCXZOYWNjX291dCA9IHZOYWNjX2luICogKGZNYWduaXR1ZGUgLyBmUHJldk1hZ25pdHVkZV9pbik7DQoJZlByZXZNYWduaXR1ZGVfb3V0ID0gZk1hZ25pdHVkZTsNCn0NCg0Kdm9pZCBtdGV4X2J1bXBfdGFwMygNCiAgICAgICAgdmVjMyB0ZXhjbywgc2FtcGxlcjJEIGltYSwgZmxvYXQgaFNjYWxlLA0KICAgICAgICBvdXQgZmxvYXQgZEJzLCBvdXQgZmxvYXQgZEJ0KQ0Kew0KCXZlYzIgU1RsbCA9IHRleGNvLnh5Ow0KCXZlYzIgU1RsciA9IHRleGNvLnh5ICsgZEZkeCh0ZXhjby54eSk7DQoJdmVjMiBTVHVsID0gdGV4Y28ueHkgKyBkRmR5KHRleGNvLnh5KTsNCg0KCWZsb2F0IEhsbCwgSGxyLCBIdWw7DQoJcmdidG9idyh0ZXh0dXJlMkQoaW1hLCBTVGxsKSwgSGxsKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUbHIpLCBIbHIpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1R1bCksIEh1bCk7DQoNCglkQnMgPSBoU2NhbGUgKiAoSGxyIC0gSGxsKTsNCglkQnQgPSBoU2NhbGUgKiAoSHVsIC0gSGxsKTsNCn0NCg0KI2lmZGVmIEJVTVBfQklDVUJJQw0KDQp2b2lkIG10ZXhfYnVtcF9iaWN1YmljKA0KICAgICAgICB2ZWMzIHRleGNvLCBzYW1wbGVyMkQgaW1hLCBmbG9hdCBoU2NhbGUsDQogICAgICAgIG91dCBmbG9hdCBkQnMsIG91dCBmbG9hdCBkQnQgKQ0Kew0KCWZsb2F0IEhsOw0KCWZsb2F0IEhyOw0KCWZsb2F0IEhkOw0KCWZsb2F0IEh1Ow0KDQoJdmVjMiBUZXhEeCA9IGRGZHgodGV4Y28ueHkpOw0KCXZlYzIgVGV4RHkgPSBkRmR5KHRleGNvLnh5KTsNCg0KCXZlYzIgU1RsID0gdGV4Y28ueHkgLSAwLjUgKiBUZXhEeDsNCgl2ZWMyIFNUciA9IHRleGNvLnh5ICsgMC41ICogVGV4RHg7DQoJdmVjMiBTVGQgPSB0ZXhjby54eSAtIDAuNSAqIFRleER5Ow0KCXZlYzIgU1R1ID0gdGV4Y28ueHkgKyAwLjUgKiBUZXhEeTsNCg0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1RsKSwgSGwpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1RyKSwgSHIpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1RkKSwgSGQpOw0KCXJnYnRvYncodGV4dHVyZTJEKGltYSwgU1R1KSwgSHUpOw0KDQoJdmVjMiBkSGR4eSA9IHZlYzIoSHIgLSBIbCwgSHUgLSBIZCk7DQoJZmxvYXQgZkJsZW5kID0gY2xhbXAoMS4wIC0gdGV4dHVyZVF1ZXJ5TE9EKGltYSwgdGV4Y28ueHkpLngsIDAuMCwgMS4wKTsNCglpZiAoZkJsZW5kICE9IDAuMCkgew0KCQkvLyB0aGUgZGVyaXZhdGl2ZSBvZiB0aGUgYmljdWJpYyBzYW1wbGluZyBvZiBsZXZlbCAwDQoJCWl2ZWMyIHZEaW07DQoJCXZEaW0gPSB0ZXh0dXJlU2l6ZShpbWEsIDApOw0KDQoJCS8vIHRha2luZyB0aGUgZnJhY3QgcGFydCBvZiB0aGUgdGV4dHVyZSBjb29yZGluYXRlIGlzIGEgaGFyZGNvZGVkIHdyYXAgbW9kZS4NCgkJLy8gdGhpcyBpcyBhY2NlcHRhYmxlIGFzIHRleHR1cmVzIHVzZSB3cmFwIG1vZGUgZXhjbHVzaXZlbHkgdmFyeWluZyAzRCB2aWV3IGVsc2V3aGVyZSB2YXJ5aW5nIGJsZW5kZXIuDQoJCS8vIHRoaXMgaXMgZG9uZSBzbyB0aGF0IHdlIGNhbiBzdGlsbCBnZXQgYSB2YWxpZCB0ZXhlbCB3aXRoIHV2cyBvdXRzaWRlIHRoZSAwLDEgcmFuZ2UNCgkJLy8gYnkgdGV4ZWxGZXRjaCBiZWxvdywgYXMgY29vcmRpbmF0ZXMgYXJlIGNsYW1wZWQgd2hlbiB1c2luZyB0aGlzIGZ1bmN0aW9uLg0KCQl2ZWMyIGZUZXhMb2MgPSB2RGltICogZnJhY3QodGV4Y28ueHkpIC0gdmVjMigwLjUsIDAuNSk7DQoJCWl2ZWMyIGlUZXhMb2MgPSBpdmVjMihmbG9vcihmVGV4TG9jKSk7DQoJCXZlYzIgdCA9IGNsYW1wKGZUZXhMb2MgLSBpVGV4TG9jLCAwLjAsIDEuMCk7ICAgICAgICAvLyBzYXQganVzdCB0byBiZSBwZWRhbnRpYw0KDQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICogVGhpcyBibG9jayB3aWxsIHJlcGxhY2UgdGhlIG9uZSBiZWxvdyB3aGVuIG9uZSBjaGFubmVsIHRleHR1cmVzIGFyZSBwcm9wZXJseSBzdXBwb3J0ZWQuICoNCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoJCXZlYzQgdlNhbXBsZXNVTCA9IHRleHR1cmVHYXRoZXIoaW1hLCAoaVRleExvYytpdmVjMigtMSwtMSkgKyB2ZWMyKDAuNSwwLjUpKS92RGltKTsNCgkJdmVjNCB2U2FtcGxlc1VSID0gdGV4dHVyZUdhdGhlcihpbWEsIChpVGV4TG9jK2l2ZWMyKDEsLTEpICsgdmVjMigwLjUsMC41KSkvdkRpbSk7DQoJCXZlYzQgdlNhbXBsZXNMTCA9IHRleHR1cmVHYXRoZXIoaW1hLCAoaVRleExvYytpdmVjMigtMSwxKSArIHZlYzIoMC41LDAuNSkpL3ZEaW0pOw0KCQl2ZWM0IHZTYW1wbGVzTFIgPSB0ZXh0dXJlR2F0aGVyKGltYSwgKGlUZXhMb2MraXZlYzIoMSwxKSArIHZlYzIoMC41LDAuNSkpL3ZEaW0pOw0KDQoJCW1hdDQgSCA9IG1hdDQodlNhbXBsZXNVTC53LCB2U2FtcGxlc1VMLngsIHZTYW1wbGVzTEwudywgdlNhbXBsZXNMTC54LA0KCQkgICAgICAgICAgICB2U2FtcGxlc1VMLnosIHZTYW1wbGVzVUwueSwgdlNhbXBsZXNMTC56LCB2U2FtcGxlc0xMLnksDQoJCSAgICAgICAgICAgIHZTYW1wbGVzVVIudywgdlNhbXBsZXNVUi54LCB2U2FtcGxlc0xSLncsIHZTYW1wbGVzTFIueCwNCgkJICAgICAgICAgICAgdlNhbXBsZXNVUi56LCB2U2FtcGxlc1VSLnksIHZTYW1wbGVzTFIueiwgdlNhbXBsZXNMUi55KTsNCiAqLw0KCQlpdmVjMiBpVGV4TG9jTW9kID0gaVRleExvYyArIGl2ZWMyKC0xLCAtMSk7DQoNCgkJbWF0NCBIOw0KDQoJCWZvciAoaW50IGkgPSAwOyBpIDwgNDsgaSsrKSB7DQoJCQlmb3IgKGludCBqID0gMDsgaiA8IDQ7IGorKykgew0KCQkJCWl2ZWMyIGlUZXhUbXAgPSBpVGV4TG9jTW9kICsgaXZlYzIoaSwgaik7DQoNCgkJCQkvLyB3cmFwIHRleHR1cmUgY29vcmRpbmF0ZXMgbWFudWFsbHkgZm9yIHRleGVsRmV0Y2ggdG8gd29yayBvbiB1dnMgb2l0c2lkZSB0aGUgMCwxIHJhbmdlLg0KCQkJCS8vIHRoaXMgaXMgZ3VhcmFudGVlZCB0byB3b3JrIHNpbmNlIHdlIHRha2UgdGhlIGZyYWN0aW9uYWwgcGFydCBvZiB0aGUgdXYgYWJvdmUuDQoJCQkJaVRleFRtcC54ID0gKGlUZXhUbXAueCA8IDApID8gaVRleFRtcC54ICsgdkRpbS54IDogKChpVGV4VG1wLnggPj0gdkRpbS54KSA/IGlUZXhUbXAueCAtIHZEaW0ueCA6IGlUZXhUbXAueCk7DQoJCQkJaVRleFRtcC55ID0gKGlUZXhUbXAueSA8IDApID8gaVRleFRtcC55ICsgdkRpbS55IDogKChpVGV4VG1wLnkgPj0gdkRpbS55KSA/IGlUZXhUbXAueSAtIHZEaW0ueSA6IGlUZXhUbXAueSk7DQoNCgkJCQlyZ2J0b2J3KHRleGVsRmV0Y2goaW1hLCBpVGV4VG1wLCAwKSwgSFtpXVtqXSk7DQoJCQl9DQoJCX0NCg0KCQlmbG9hdCB4ID0gdC54LCB5ID0gdC55Ow0KCQlmbG9hdCB4MiA9IHggKiB4LCB4MyA9IHgyICogeCwgeTIgPSB5ICogeSwgeTMgPSB5MiAqIHk7DQoNCgkJdmVjNCBYICA9IHZlYzQoLTAuNSAqICh4MyArIHgpICsgeDIsICAgIDEuNSAqIHgzIC0gMi41ICogeDIgKyAxLCAtMS41ICogeDMgKyAyICogeDIgKyAwLjUgKiB4LCAwLjUgKiAoeDMgLSB4MikpOw0KCQl2ZWM0IFkgID0gdmVjNCgtMC41ICogKHkzICsgeSkgKyB5MiwgICAgMS41ICogeTMgLSAyLjUgKiB5MiArIDEsIC0xLjUgKiB5MyArIDIgKiB5MiArIDAuNSAqIHksIDAuNSAqICh5MyAtIHkyKSk7DQoJCXZlYzQgZFggPSB2ZWM0KC0xLjUgKiB4MiArIDIgKiB4IC0gMC41LCA0LjUgKiB4MiAtIDUgKiB4LCAgICAgICAgLTQuNSAqIHgyICsgNCAqIHggKyAwLjUsICAgICAgMS41ICogeDIgLSB4KTsNCgkJdmVjNCBkWSA9IHZlYzQoLTEuNSAqIHkyICsgMiAqIHkgLSAwLjUsIDQuNSAqIHkyIC0gNSAqIHksICAgICAgICAtNC41ICogeTIgKyA0ICogeSArIDAuNSwgICAgICAxLjUgKiB5MiAtIHkpOw0KDQoJCS8vIGNvbXBsZXRlIGRlcml2YXRpdmUgdmFyeWluZyBub3JtYWxpemVkIGNvb3JkaW5hdGVzIChtdWwgYnkgdkRpbSkNCgkJdmVjMiBkSGRTVCA9IHZEaW0gKiB2ZWMyKGRvdChZLCBIICogZFgpLCBkb3QoZFksIEggKiBYKSk7DQoNCgkJLy8gdHJhbnNmb3JtIGRlcml2YXRpdmUgdG8gc2NyZWVuLXNwYWNlDQoJCXZlYzIgZEhkeHlfYmljdWJpYyA9IHZlYzIoZEhkU1QueCAqIFRleER4LnggKyBkSGRTVC55ICogVGV4RHgueSwNCgkJICAgICAgICAgICAgICAgICAgICAgICAgICBkSGRTVC54ICogVGV4RHkueCArIGRIZFNULnkgKiBUZXhEeS55KTsNCg0KCQkvLyBibGVuZCBiZXR3ZWVuIHRoZSB0d28NCgkJZEhkeHkgPSBkSGR4eSAqICgxIC0gZkJsZW5kKSArIGRIZHh5X2JpY3ViaWMgKiBmQmxlbmQ7DQoJfQ0KDQoJZEJzID0gaFNjYWxlICogZEhkeHkueDsNCglkQnQgPSBoU2NhbGUgKiBkSGR4eS55Ow0KfQ0KDQojZW5kaWYNCg0Kdm9pZCBtdGV4X2J1bXBfdGFwNSgNCiAgICAgICAgdmVjMyB0ZXhjbywgc2FtcGxlcjJEIGltYSwgZmxvYXQgaFNjYWxlLA0KICAgICAgICBvdXQgZmxvYXQgZEJzLCBvdXQgZmxvYXQgZEJ0KQ0Kew0KCXZlYzIgVGV4RHggPSBkRmR4KHRleGNvLnh5KTsNCgl2ZWMyIFRleER5ID0gZEZkeSh0ZXhjby54eSk7DQoNCgl2ZWMyIFNUYyA9IHRleGNvLnh5Ow0KCXZlYzIgU1RsID0gdGV4Y28ueHkgLSAwLjUgKiBUZXhEeDsNCgl2ZWMyIFNUciA9IHRleGNvLnh5ICsgMC41ICogVGV4RHg7DQoJdmVjMiBTVGQgPSB0ZXhjby54eSAtIDAuNSAqIFRleER5Ow0KCXZlYzIgU1R1ID0gdGV4Y28ueHkgKyAwLjUgKiBUZXhEeTsNCg0KCWZsb2F0IEhjLCBIbCwgSHIsIEhkLCBIdTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUYyksIEhjKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUbCksIEhsKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUciksIEhyKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUZCksIEhkKTsNCglyZ2J0b2J3KHRleHR1cmUyRChpbWEsIFNUdSksIEh1KTsNCg0KCWRCcyA9IGhTY2FsZSAqIChIciAtIEhsKTsNCglkQnQgPSBoU2NhbGUgKiAoSHUgLSBIZCk7DQp9DQoNCnZvaWQgbXRleF9idW1wX2Rlcml2KA0KICAgICAgICB2ZWMzIHRleGNvLCBzYW1wbGVyMkQgaW1hLCBmbG9hdCBpbWFfeCwgZmxvYXQgaW1hX3ksIGZsb2F0IGhTY2FsZSwNCiAgICAgICAgb3V0IGZsb2F0IGRCcywgb3V0IGZsb2F0IGRCdCkNCnsNCglmbG9hdCBzID0gMS4wOyAgICAgIC8vIG5lZ2F0ZSB0aGlzIGlmIGZsaXBwZWQgdGV4dHVyZSBjb29yZGluYXRlDQoJdmVjMiBUZXhEeCA9IGRGZHgodGV4Y28ueHkpOw0KCXZlYzIgVGV4RHkgPSBkRmR5KHRleGNvLnh5KTsNCg0KCS8vIHRoaXMgdmFyaWFudCB1c2luZyBhIGRlcml2YXRpdmUgbWFwIGlzIGRlc2NyaWJlZCBoZXJlDQoJLy8gaHR0cDovL21taWtrZWxzZW4zZC5ibG9nc3BvdC5jb20vMjAxMS8wNy9kZXJpdmF0aXZlLW1hcHMuaHRtbA0KCXZlYzIgZGltID0gdmVjMihpbWFfeCwgaW1hX3kpOw0KCXZlYzIgZEJkdXYgPSBoU2NhbGUgKiBkaW0gKiAoMi4wICogdGV4dHVyZTJEKGltYSwgdGV4Y28ueHkpLnh5IC0gMS4wKTsNCg0KCWRCcyA9IGRCZHV2LnggKiBUZXhEeC54ICsgcyAqIGRCZHV2LnkgKiBUZXhEeC55Ow0KCWRCdCA9IGRCZHV2LnggKiBUZXhEeS54ICsgcyAqIGRCZHV2LnkgKiBUZXhEeS55Ow0KfQ0KDQp2b2lkIG10ZXhfYnVtcF9hcHBseSgNCiAgICAgICAgZmxvYXQgZkRldCwgZmxvYXQgZEJzLCBmbG9hdCBkQnQsIHZlYzMgdlIxLCB2ZWMzIHZSMiwgdmVjMyB2TmFjY19pbiwNCiAgICAgICAgb3V0IHZlYzMgdk5hY2Nfb3V0LCBvdXQgdmVjMyBwZXJ0dXJiZWRfbm9ybSkNCnsNCgl2ZWMzIHZTdXJmR3JhZCA9IHNpZ24oZkRldCkgKiAoZEJzICogdlIxICsgZEJ0ICogdlIyKTsNCg0KCXZOYWNjX291dCA9IHZOYWNjX2luIC0gdlN1cmZHcmFkOw0KCXBlcnR1cmJlZF9ub3JtID0gbm9ybWFsaXplKHZOYWNjX291dCk7DQp9DQoNCnZvaWQgbXRleF9idW1wX2FwcGx5X3RleHNwYWNlKA0KICAgICAgICBmbG9hdCBmRGV0LCBmbG9hdCBkQnMsIGZsb2F0IGRCdCwgdmVjMyB2UjEsIHZlYzMgdlIyLA0KICAgICAgICBzYW1wbGVyMkQgaW1hLCB2ZWMzIHRleGNvLCBmbG9hdCBpbWFfeCwgZmxvYXQgaW1hX3ksIHZlYzMgdk5hY2NfaW4sDQogICAgICAgIG91dCB2ZWMzIHZOYWNjX291dCwgb3V0IHZlYzMgcGVydHVyYmVkX25vcm0pDQp7DQoJdmVjMiBUZXhEeCA9IGRGZHgodGV4Y28ueHkpOw0KCXZlYzIgVGV4RHkgPSBkRmR5KHRleGNvLnh5KTsNCg0KCXZlYzMgdlN1cmZHcmFkID0gc2lnbihmRGV0KSAqICgNCgkgICAgICAgIGRCcyAvIGxlbmd0aCh2ZWMyKGltYV94ICogVGV4RHgueCwgaW1hX3kgKiBUZXhEeC55KSkgKiB2UjEgKw0KCSAgICAgICAgZEJ0IC8gbGVuZ3RoKHZlYzIoaW1hX3ggKiBUZXhEeS54LCBpbWFfeSAqIFRleER5LnkpKSAqIHZSMik7DQoNCgl2TmFjY19vdXQgPSB2TmFjY19pbiAtIHZTdXJmR3JhZDsNCglwZXJ0dXJiZWRfbm9ybSA9IG5vcm1hbGl6ZSh2TmFjY19vdXQpOw0KfQ0KDQp2b2lkIG10ZXhfbmVnYXRlX3RleG5vcm1hbCh2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCW91dG5vcm1hbCA9IHZlYzMoLW5vcm1hbC54LCAtbm9ybWFsLnksIG5vcm1hbC56KTsNCn0NCg0Kdm9pZCBtdGV4X25zcGFjZV90YW5nZW50KHZlYzQgdGFuZ2VudCwgdmVjMyBub3JtYWwsIHZlYzMgdGV4bm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJdmVjMyBCID0gdGFuZ2VudC53ICogY3Jvc3Mobm9ybWFsLCB0YW5nZW50Lnh5eik7DQoNCglvdXRub3JtYWwgPSB0ZXhub3JtYWwueCAqIHRhbmdlbnQueHl6ICsgdGV4bm9ybWFsLnkgKiBCICsgdGV4bm9ybWFsLnogKiBub3JtYWw7DQoJb3V0bm9ybWFsID0gbm9ybWFsaXplKG91dG5vcm1hbCk7DQp9DQoNCnZvaWQgbXRleF9uc3BhY2Vfd29ybGQobWF0NCB2aWV3bWF0LCB2ZWMzIHRleG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZSgodmlld21hdCAqIHZlYzQodGV4bm9ybWFsLCAwLjApKS54eXopOw0KfQ0KDQp2b2lkIG10ZXhfbnNwYWNlX29iamVjdCh2ZWMzIHRleG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZShibF9Ob3JtYWxNYXRyaXggKiB0ZXhub3JtYWwpOw0KfQ0KDQp2b2lkIG10ZXhfYmxlbmRfbm9ybWFsKGZsb2F0IG5vcmZhYywgdmVjMyBub3JtYWwsIHZlYzMgbmV3bm9ybWFsLCBvdXQgdmVjMyBvdXRub3JtYWwpDQp7DQoJb3V0bm9ybWFsID0gKDEuMCAtIG5vcmZhYykgKiBub3JtYWwgKyBub3JmYWMgKiBuZXdub3JtYWw7DQoJb3V0bm9ybWFsID0gbm9ybWFsaXplKG91dG5vcm1hbCk7DQp9DQoNCi8qKioqKioqIE1BVEVSSUFMICoqKioqKioqKi8NCg0Kdm9pZCBsYW1wX3Zpc2liaWxpdHlfc3VuX2hlbWkodmVjMyBsYW1wdmVjLCBvdXQgdmVjMyBsdiwgb3V0IGZsb2F0IGRpc3QsIG91dCBmbG9hdCB2aXNpZmFjKQ0Kew0KCWx2ID0gbGFtcHZlYzsNCglkaXN0ID0gMS4wOw0KCXZpc2lmYWMgPSAxLjA7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X290aGVyKHZlYzMgY28sIHZlYzMgbGFtcGNvLCBvdXQgdmVjMyBsdiwgb3V0IGZsb2F0IGRpc3QsIG91dCBmbG9hdCB2aXNpZmFjKQ0Kew0KCWx2ID0gY28gLSBsYW1wY287DQoJZGlzdCA9IGxlbmd0aChsdik7DQoJbHYgPSBub3JtYWxpemUobHYpOw0KCXZpc2lmYWMgPSAxLjA7DQp9DQoNCnZvaWQgbGFtcF9mYWxsb2ZmX2ludmxpbmVhcihmbG9hdCBsYW1wZGlzdCwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJdmlzaWZhYyA9IGxhbXBkaXN0IC8gKGxhbXBkaXN0ICsgZGlzdCk7DQp9DQoNCnZvaWQgbGFtcF9mYWxsb2ZmX2ludnNxdWFyZShmbG9hdCBsYW1wZGlzdCwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJdmlzaWZhYyA9IGxhbXBkaXN0IC8gKGxhbXBkaXN0ICsgZGlzdCAqIGRpc3QpOw0KfQ0KDQp2b2lkIGxhbXBfZmFsbG9mZl9zbGlkZXJzKGZsb2F0IGxhbXBkaXN0LCBmbG9hdCBsZDEsIGZsb2F0IGxkMiwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJZmxvYXQgbGFtcGRpc3RrdyA9IGxhbXBkaXN0ICogbGFtcGRpc3Q7DQoNCgl2aXNpZmFjID0gbGFtcGRpc3QgLyAobGFtcGRpc3QgKyBsZDEgKiBkaXN0KTsNCgl2aXNpZmFjICo9IGxhbXBkaXN0a3cgLyAobGFtcGRpc3RrdyArIGxkMiAqIGRpc3QgKiBkaXN0KTsNCn0NCg0Kdm9pZCBsYW1wX2ZhbGxvZmZfaW52Y29lZmZpY2llbnRzKGZsb2F0IGNvZWZmX2NvbnN0LCBmbG9hdCBjb2VmZl9saW4sIGZsb2F0IGNvZWZmX3F1YWQsIGZsb2F0IGRpc3QsIG91dCBmbG9hdCB2aXNpZmFjKQ0Kew0KCXZlYzMgY29lZmYgPSB2ZWMzKGNvZWZmX2NvbnN0LCBjb2VmZl9saW4sIGNvZWZmX3F1YWQpOw0KCXZlYzMgZF9jb2VmZiA9IHZlYzMoMS4wLCBkaXN0LCBkaXN0ICogZGlzdCk7DQoJZmxvYXQgdmlzaWZhY19yID0gZG90KGNvZWZmLCBkX2NvZWZmKTsNCglpZiAodmlzaWZhY19yID4gMC4wKQ0KCQl2aXNpZmFjID0gMS4wIC8gdmlzaWZhY19yOw0KCWVsc2UNCgkJdmlzaWZhYyA9IDAuMDsNCn0NCg0Kdm9pZCBsYW1wX2ZhbGxvZmZfY3VydmUoZmxvYXQgbGFtcGRpc3QsIHNhbXBsZXIyRCBjdXJ2ZW1hcCwgZmxvYXQgZGlzdCwgb3V0IGZsb2F0IHZpc2lmYWMpDQp7DQoJdmlzaWZhYyA9IHRleHR1cmUyRChjdXJ2ZW1hcCwgdmVjMihkaXN0IC8gbGFtcGRpc3QsIDAuMCkpLng7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X3NwaGVyZShmbG9hdCBsYW1wZGlzdCwgZmxvYXQgZGlzdCwgZmxvYXQgdmlzaWZhYywgb3V0IGZsb2F0IG91dHZpc2lmYWMpDQp7DQoJZmxvYXQgdCA9IGxhbXBkaXN0IC0gZGlzdDsNCg0KCW91dHZpc2lmYWMgPSB2aXNpZmFjICogbWF4KHQsIDAuMCkgLyBsYW1wZGlzdDsNCn0NCg0Kdm9pZCBsYW1wX3Zpc2liaWxpdHlfc3BvdF9zcXVhcmUodmVjMyBsYW1wdmVjLCBtYXQ0IGxhbXBpbWF0LCB2ZWMyIHNjYWxlLCB2ZWMzIGx2LCBvdXQgZmxvYXQgaW5wcikNCnsNCglpZiAoZG90KGx2LCBsYW1wdmVjKSA+IDAuMCkgew0KCQl2ZWMzIGx2cm90ID0gKGxhbXBpbWF0ICogdmVjNChsdiwgMC4wKSkueHl6Ow0KCQkvKiB3aXRob3V0IGNsZXZlciBub24tdW5pZm9ybSBzY2FsZSwgd2UgY291bGQgZG86ICovDQoJCS8vIGZsb2F0IHggPSBtYXgoYWJzKGx2cm90LnggLyBsdnJvdC56KSwgYWJzKGx2cm90LnkgLyBsdnJvdC56KSk7DQoJCWZsb2F0IHggPSBtYXgoYWJzKChsdnJvdC54IC8gc2NhbGUueCkgLyBsdnJvdC56KSwgYWJzKChsdnJvdC55IC8gc2NhbGUueSkgLyBsdnJvdC56KSk7DQoNCgkJaW5wciA9IDEuMCAvIHNxcnQoMS4wICsgeCAqIHgpOw0KCX0NCgllbHNlDQoJCWlucHIgPSAwLjA7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X3Nwb3RfY2lyY2xlKHZlYzMgbGFtcHZlYywgbWF0NCBsYW1waW1hdCwgdmVjMiBzY2FsZSwgdmVjMyBsdiwgb3V0IGZsb2F0IGlucHIpDQp7DQoJLyogd2l0aG91dCBjbGV2ZXIgbm9uLXVuaWZvcm0gc2NhbGUsIHdlIGNvdWxkIGRvOiAqLw0KCS8vIGlucHIgPSBkb3QobHYsIGxhbXB2ZWMpOw0KCWlmIChkb3QobHYsIGxhbXB2ZWMpID4gMC4wKSB7DQoJCXZlYzMgbHZyb3QgPSAobGFtcGltYXQgKiB2ZWM0KGx2LCAwLjApKS54eXo7DQoJCWZsb2F0IHggPSBhYnMobHZyb3QueCAvIGx2cm90LnopOw0KCQlmbG9hdCB5ID0gYWJzKGx2cm90LnkgLyBsdnJvdC56KTsNCg0KCQlmbG9hdCBlbGxpcHNlID0gYWJzKCh4ICogeCkgLyAoc2NhbGUueCAqIHNjYWxlLngpICsgKHkgKiB5KSAvIChzY2FsZS55ICogc2NhbGUueSkpOw0KDQoJCWlucHIgPSAxLjAgLyBzcXJ0KDEuMCArIGVsbGlwc2UpOw0KCX0NCgllbHNlDQoJCWlucHIgPSAwLjA7DQp9DQoNCnZvaWQgbGFtcF92aXNpYmlsaXR5X3Nwb3QoZmxvYXQgc3BvdHNpLCBmbG9hdCBzcG90YmwsIGZsb2F0IGlucHIsIGZsb2F0IHZpc2lmYWMsIG91dCBmbG9hdCBvdXR2aXNpZmFjKQ0Kew0KCWZsb2F0IHQgPSBzcG90c2k7DQoNCglpZiAoaW5wciA8PSB0KSB7DQoJCW91dHZpc2lmYWMgPSAwLjA7DQoJfQ0KCWVsc2Ugew0KCQl0ID0gaW5wciAtIHQ7DQoNCgkJLyogc29mdCBhcmVhICovDQoJCWlmIChzcG90YmwgIT0gMC4wKQ0KCQkJaW5wciAqPSBzbW9vdGhzdGVwKDAuMCwgMS4wLCB0IC8gc3BvdGJsKTsNCg0KCQlvdXR2aXNpZmFjID0gdmlzaWZhYyAqIGlucHI7DQoJfQ0KfQ0KDQp2b2lkIGxhbXBfdmlzaWJpbGl0eV9jbGFtcChmbG9hdCB2aXNpZmFjLCBvdXQgZmxvYXQgb3V0dmlzaWZhYykNCnsNCglvdXR2aXNpZmFjID0gKHZpc2lmYWMgPCAwLjAwMSkgPyAwLjAgOiB2aXNpZmFjOw0KfQ0KDQp2b2lkIHdvcmxkX3BhcGVyX3ZpZXcodmVjMyB2ZWMsIG91dCB2ZWMzIG91dHZlYykNCnsNCgl2ZWMzIG52ZWMgPSBub3JtYWxpemUodmVjKTsNCglvdXR2ZWMgPSAoYmxfUHJvamVjdGlvbk1hdHJpeFszXVszXSA9PSAwLjApID8gdmVjMyhudmVjLngsIDAuMCwgbnZlYy55KSA6IHZlYzMoMC4wLCAwLjAsIC0xLjApOw0KfQ0KDQp2b2lkIHdvcmxkX3plbl9tYXBwaW5nKHZlYzMgdmlldywgZmxvYXQgemVudXAsIGZsb2F0IHplbmRvd24sIG91dCBmbG9hdCB6ZW5mYWMpDQp7DQoJaWYgKHZpZXcueiA+PSAwLjApDQoJCXplbmZhYyA9IHplbnVwOw0KCWVsc2UNCgkJemVuZmFjID0gemVuZG93bjsNCn0NCg0Kdm9pZCB3b3JsZF9ibGVuZF9wYXBlcl9yZWFsKHZlYzMgdmVjLCBvdXQgZmxvYXQgYmxlbmQpDQp7DQoJYmxlbmQgPSBhYnModmVjLnkpOw0KfQ0KDQp2b2lkIHdvcmxkX2JsZW5kX3BhcGVyKHZlYzMgdmVjLCBvdXQgZmxvYXQgYmxlbmQpDQp7DQoJYmxlbmQgPSAodmVjLnkgKyAxLjApICogMC41Ow0KfQ0KDQp2b2lkIHdvcmxkX2JsZW5kX3JlYWwodmVjMyB2ZWMsIG91dCBmbG9hdCBibGVuZCkNCnsNCglibGVuZCA9IGFicyhub3JtYWxpemUodmVjKS56KTsNCn0NCg0Kdm9pZCB3b3JsZF9ibGVuZCh2ZWMzIHZlYywgb3V0IGZsb2F0IGJsZW5kKQ0Kew0KCWJsZW5kID0gKG5vcm1hbGl6ZSh2ZWMpLnogKyAxLjApICogMC41Ow0KfQ0KDQp2b2lkIHNoYWRlX3ZpZXcodmVjMyBjbywgb3V0IHZlYzMgdmlldykNCnsNCgkvKiBoYW5kbGUgcGVyc3BlY3RpdmUvb3J0aG9ncmFwaGljICovDQoJdmlldyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPyBub3JtYWxpemUoY28pIDogdmVjMygwLjAsIDAuMCwgLTEuMCk7DQp9DQoNCnZvaWQgc2hhZGVfdGFuZ2VudF92KHZlYzMgbHYsIHZlYzMgdGFuZywgb3V0IHZlYzMgdm4pDQp7DQoJdmVjMyBjID0gY3Jvc3MobHYsIHRhbmcpOw0KCXZlYzMgdm5vciA9IGNyb3NzKGMsIHRhbmcpOw0KDQoJdm4gPSAtbm9ybWFsaXplKHZub3IpOw0KfQ0KDQp2b2lkIHNoYWRlX2lucCh2ZWMzIHZuLCB2ZWMzIGx2LCBvdXQgZmxvYXQgaW5wKQ0Kew0KCWlucCA9IGRvdCh2biwgbHYpOw0KfQ0KDQp2b2lkIHNoYWRlX2lzX25vX2RpZmZ1c2Uob3V0IGZsb2F0IGlzKQ0Kew0KCWlzID0gMC4wOw0KfQ0KDQp2b2lkIHNoYWRlX2lzX2hlbWkoZmxvYXQgaW5wLCBvdXQgZmxvYXQgaXMpDQp7DQoJaXMgPSAwLjUgKiBpbnAgKyAwLjU7DQp9DQoNCmZsb2F0IGFyZWFfbGFtcF9lbmVyZ3kobWF0NCBhcmVhLCB2ZWMzIGNvLCB2ZWMzIHZuKQ0Kew0KCXZlYzMgdmVjWzRdLCBjWzRdOw0KCWZsb2F0IHJhZFs0XSwgZmFjOw0KDQoJdmVjWzBdID0gbm9ybWFsaXplKGNvIC0gYXJlYVswXS54eXopOw0KCXZlY1sxXSA9IG5vcm1hbGl6ZShjbyAtIGFyZWFbMV0ueHl6KTsNCgl2ZWNbMl0gPSBub3JtYWxpemUoY28gLSBhcmVhWzJdLnh5eik7DQoJdmVjWzNdID0gbm9ybWFsaXplKGNvIC0gYXJlYVszXS54eXopOw0KDQoJY1swXSA9IG5vcm1hbGl6ZShjcm9zcyh2ZWNbMF0sIHZlY1sxXSkpOw0KCWNbMV0gPSBub3JtYWxpemUoY3Jvc3ModmVjWzFdLCB2ZWNbMl0pKTsNCgljWzJdID0gbm9ybWFsaXplKGNyb3NzKHZlY1syXSwgdmVjWzNdKSk7DQoJY1szXSA9IG5vcm1hbGl6ZShjcm9zcyh2ZWNbM10sIHZlY1swXSkpOw0KDQoJcmFkWzBdID0gYWNvcyhkb3QodmVjWzBdLCB2ZWNbMV0pKTsNCglyYWRbMV0gPSBhY29zKGRvdCh2ZWNbMV0sIHZlY1syXSkpOw0KCXJhZFsyXSA9IGFjb3MoZG90KHZlY1syXSwgdmVjWzNdKSk7DQoJcmFkWzNdID0gYWNvcyhkb3QodmVjWzNdLCB2ZWNbMF0pKTsNCg0KCWZhYyA9ICByYWRbMF0gKiBkb3Qodm4sIGNbMF0pOw0KCWZhYyArPSByYWRbMV0gKiBkb3Qodm4sIGNbMV0pOw0KCWZhYyArPSByYWRbMl0gKiBkb3Qodm4sIGNbMl0pOw0KCWZhYyArPSByYWRbM10gKiBkb3Qodm4sIGNbM10pOw0KDQoJcmV0dXJuIG1heChmYWMsIDAuMCk7DQp9DQoNCnZvaWQgc2hhZGVfaW5wX2FyZWEoDQogICAgICAgIHZlYzMgcG9zaXRpb24sIHZlYzMgbGFtcGNvLCB2ZWMzIGxhbXB2ZWMsIHZlYzMgdm4sIG1hdDQgYXJlYSwgZmxvYXQgYXJlYXNpemUsIGZsb2F0IGssDQogICAgICAgIG91dCBmbG9hdCBpbnApDQp7DQoJdmVjMyBjbyA9IHBvc2l0aW9uOw0KCXZlYzMgdmVjID0gY28gLSBsYW1wY287DQoNCglpZiAoZG90KHZlYywgbGFtcHZlYykgPCAwLjApIHsNCgkJaW5wID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJZmxvYXQgaW50ZW5zID0gYXJlYV9sYW1wX2VuZXJneShhcmVhLCBjbywgdm4pOw0KDQoJCWlucCA9IHBvdyhpbnRlbnMgKiBhcmVhc2l6ZSwgayk7DQoJfQ0KfQ0KDQp2b2lkIHNoYWRlX2RpZmZ1c2Vfb3Jlbl9uYXllcihmbG9hdCBubCwgdmVjMyBuLCB2ZWMzIGwsIHZlYzMgdiwgZmxvYXQgcm91Z2gsIG91dCBmbG9hdCBpcykNCnsNCgl2ZWMzIGggPSBub3JtYWxpemUodiArIGwpOw0KCWZsb2F0IG5oID0gbWF4KGRvdChuLCBoKSwgMC4wKTsNCglmbG9hdCBudiA9IG1heChkb3QobiwgdiksIDAuMCk7DQoJZmxvYXQgcmVhbG5sID0gZG90KG4sIGwpOw0KDQoJaWYgKHJlYWxubCA8IDAuMCkgew0KCQlpcyA9IDAuMDsNCgl9DQoJZWxzZSBpZiAobmwgPCAwLjApIHsNCgkJaXMgPSAwLjA7DQoJfQ0KCWVsc2Ugew0KCQlmbG9hdCB2aCA9IG1heChkb3QodiwgaCksIDAuMCk7DQoJCWZsb2F0IExpdF9BID0gYWNvcyhyZWFsbmwpOw0KCQlmbG9hdCBWaWV3X0EgPSBhY29zKG52KTsNCg0KCQl2ZWMzIExpdF9CID0gbm9ybWFsaXplKGwgLSByZWFsbmwgKiBuKTsNCgkJdmVjMyBWaWV3X0IgPSBub3JtYWxpemUodiAtIG52ICogbik7DQoNCgkJZmxvYXQgdCA9IG1heChkb3QoTGl0X0IsIFZpZXdfQiksIDAuMCk7DQoNCgkJZmxvYXQgYSwgYjsNCg0KCQlpZiAoTGl0X0EgPiBWaWV3X0EpIHsNCgkJCWEgPSBMaXRfQTsNCgkJCWIgPSBWaWV3X0E7DQoJCX0NCgkJZWxzZSB7DQoJCQlhID0gVmlld19BOw0KCQkJYiA9IExpdF9BOw0KCQl9DQoNCgkJZmxvYXQgQSA9IDEuMCAtICgwLjUgKiAoKHJvdWdoICogcm91Z2gpIC8gKChyb3VnaCAqIHJvdWdoKSArIDAuMzMpKSk7DQoJCWZsb2F0IEIgPSAwLjQ1ICogKChyb3VnaCAqIHJvdWdoKSAvICgocm91Z2ggKiByb3VnaCkgKyAwLjA5KSk7DQoNCgkJYiAqPSAwLjk1Ow0KCQlpcyA9IG5sICogKEEgKyAoQiAqIHQgKiBzaW4oYSkgKiB0YW4oYikpKTsNCgl9DQp9DQoNCnZvaWQgc2hhZGVfZGlmZnVzZV90b29uKHZlYzMgbiwgdmVjMyBsLCB2ZWMzIHYsIGZsb2F0IHNpemUsIGZsb2F0IHRzbW9vdGgsIG91dCBmbG9hdCBpcykNCnsNCglmbG9hdCByc2x0ID0gZG90KG4sIGwpOw0KCWZsb2F0IGFuZyA9IGFjb3MocnNsdCk7DQoNCglpZiAoYW5nIDwgc2l6ZSkgaXMgPSAxLjA7DQoJZWxzZSBpZiAoYW5nID4gKHNpemUgKyB0c21vb3RoKSB8fCB0c21vb3RoID09IDAuMCkgaXMgPSAwLjA7DQoJZWxzZSBpcyA9IDEuMCAtICgoYW5nIC0gc2l6ZSkgLyB0c21vb3RoKTsNCn0NCg0Kdm9pZCBzaGFkZV9kaWZmdXNlX21pbm5hZXJ0KGZsb2F0IG5sLCB2ZWMzIG4sIHZlYzMgdiwgZmxvYXQgZGFya25lc3MsIG91dCBmbG9hdCBpcykNCnsNCglpZiAobmwgPD0gMC4wKSB7DQoJCWlzID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJZmxvYXQgbnYgPSBtYXgoZG90KG4sIHYpLCAwLjApOw0KDQoJCWlmIChkYXJrbmVzcyA8PSAxLjApDQoJCQlpcyA9IG5sICogcG93KG1heChudiAqIG5sLCAwLjEpLCBkYXJrbmVzcyAtIDEuMCk7DQoJCWVsc2UNCgkJCWlzID0gbmwgKiBwb3coMS4wMDAxIC0gbnYsIGRhcmtuZXNzIC0gMS4wKTsNCgl9DQp9DQoNCmZsb2F0IGZyZXNuZWxfZmFjKHZlYzMgdmlldywgdmVjMyB2biwgZmxvYXQgZ3JhZCwgZmxvYXQgZmFjKQ0Kew0KCWZsb2F0IHQxLCB0MjsNCglmbG9hdCBmZmFjOw0KDQoJaWYgKGZhYyA9PSAwLjApIHsNCgkJZmZhYyA9IDEuMDsNCgl9DQoJZWxzZSB7DQoJCXQxID0gZG90KHZpZXcsIHZuKTsNCgkJaWYgKHQxID4gMC4wKSB0MiA9IDEuMCArIHQxOw0KCQllbHNlIHQyID0gMS4wIC0gdDE7DQoNCgkJdDIgPSBncmFkICsgKDEuMCAtIGdyYWQpICogcG93KHQyLCBmYWMpOw0KDQoJCWlmICh0MiA8IDAuMCkgZmZhYyA9IDAuMDsNCgkJZWxzZSBpZiAodDIgPiAxLjApIGZmYWMgPSAxLjA7DQoJCWVsc2UgZmZhYyA9IHQyOw0KCX0NCg0KCXJldHVybiBmZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX2RpZmZ1c2VfZnJlc25lbCh2ZWMzIHZuLCB2ZWMzIGx2LCB2ZWMzIHZpZXcsIGZsb2F0IGZhY19pLCBmbG9hdCBmYWMsIG91dCBmbG9hdCBpcykNCnsNCglpcyA9IGZyZXNuZWxfZmFjKGx2LCB2biwgZmFjX2ksIGZhYyk7DQp9DQoNCnZvaWQgc2hhZGVfY3ViaWMoZmxvYXQgaXMsIG91dCBmbG9hdCBvdXRpcykNCnsNCglpZiAoaXMgPiAwLjAgJiYgaXMgPCAxLjApDQoJCW91dGlzID0gc21vb3Roc3RlcCgwLjAsIDEuMCwgaXMpOw0KCWVsc2UNCgkJb3V0aXMgPSBpczsNCn0NCg0Kdm9pZCBzaGFkZV92aXNpZmFjKGZsb2F0IGksIGZsb2F0IHZpc2lmYWMsIGZsb2F0IHJlZmwsIG91dCBmbG9hdCBvdXRpKQ0Kew0KCS8qaWYgKGkgPiAwLjApKi8NCglvdXRpID0gbWF4KGkgKiB2aXNpZmFjICogcmVmbCwgMC4wKTsNCgkvKmVsc2UNCgkgICAgb3V0aSA9IGk7Ki8NCn0NCg0Kdm9pZCBzaGFkZV90YW5nZW50X3Zfc3BlYyh2ZWMzIHRhbmcsIG91dCB2ZWMzIHZuKQ0Kew0KCXZuID0gdGFuZzsNCn0NCg0Kdm9pZCBzaGFkZV9hZGRfdG9fZGlmZnVzZShmbG9hdCBpLCB2ZWMzIGxhbXBjb2wsIHZlYzMgY29sLCBvdXQgdmVjMyBvdXRjb2wpDQp7DQoJaWYgKGkgPiAwLjApDQoJCW91dGNvbCA9IGkgKiBsYW1wY29sICogY29sOw0KCWVsc2UNCgkJb3V0Y29sID0gdmVjMygwLjAsIDAuMCwgMC4wKTsNCn0NCg0Kdm9pZCBzaGFkZV9oZW1pX3NwZWModmVjMyB2biwgdmVjMyBsdiwgdmVjMyB2aWV3LCBmbG9hdCBzcGVjLCBmbG9hdCBoYXJkLCBmbG9hdCB2aXNpZmFjLCBvdXQgZmxvYXQgdCkNCnsNCglsdiArPSB2aWV3Ow0KCWx2ID0gbm9ybWFsaXplKGx2KTsNCg0KCXQgPSBkb3Qodm4sIGx2KTsNCgl0ID0gMC41ICogdCArIDAuNTsNCg0KCXQgPSB2aXNpZmFjICogc3BlYyAqIHBvdyh0LCBoYXJkKTsNCn0NCg0Kdm9pZCBzaGFkZV9waG9uZ19zcGVjKHZlYzMgbiwgdmVjMyBsLCB2ZWMzIHYsIGZsb2F0IGhhcmQsIG91dCBmbG9hdCBzcGVjZmFjKQ0Kew0KCXZlYzMgaCA9IG5vcm1hbGl6ZShsICsgdik7DQoJZmxvYXQgcnNsdCA9IG1heChkb3QoaCwgbiksIDAuMCk7DQoNCglzcGVjZmFjID0gcG93KHJzbHQsIGhhcmQpOw0KfQ0KDQp2b2lkIHNoYWRlX2Nvb2t0b3JyX3NwZWModmVjMyBuLCB2ZWMzIGwsIHZlYzMgdiwgZmxvYXQgaGFyZCwgb3V0IGZsb2F0IHNwZWNmYWMpDQp7DQoJdmVjMyBoID0gbm9ybWFsaXplKHYgKyBsKTsNCglmbG9hdCBuaCA9IGRvdChuLCBoKTsNCg0KCWlmIChuaCA8IDAuMCkgew0KCQlzcGVjZmFjID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJZmxvYXQgbnYgPSBtYXgoZG90KG4sIHYpLCAwLjApOw0KCQlmbG9hdCBpID0gcG93KG5oLCBoYXJkKTsNCg0KCQlpID0gaSAvICgwLjEgKyBudik7DQoJCXNwZWNmYWMgPSBpOw0KCX0NCn0NCg0Kdm9pZCBzaGFkZV9ibGlubl9zcGVjKHZlYzMgbiwgdmVjMyBsLCB2ZWMzIHYsIGZsb2F0IHJlZnJhYywgZmxvYXQgc3BlY19wb3dlciwgb3V0IGZsb2F0IHNwZWNmYWMpDQp7DQoJaWYgKHJlZnJhYyA8IDEuMCkgew0KCQlzcGVjZmFjID0gMC4wOw0KCX0NCgllbHNlIGlmIChzcGVjX3Bvd2VyID09IDAuMCkgew0KCQlzcGVjZmFjID0gMC4wOw0KCX0NCgllbHNlIHsNCgkJaWYgKHNwZWNfcG93ZXIgPCAxMDAuMCkNCgkJCXNwZWNfcG93ZXIgPSBzcXJ0KDEuMCAvIHNwZWNfcG93ZXIpOw0KCQllbHNlDQoJCQlzcGVjX3Bvd2VyID0gMTAuMCAvIHNwZWNfcG93ZXI7DQoNCgkJdmVjMyBoID0gbm9ybWFsaXplKHYgKyBsKTsNCgkJZmxvYXQgbmggPSBkb3QobiwgaCk7DQoJCWlmIChuaCA8IDAuMCkgew0KCQkJc3BlY2ZhYyA9IDAuMDsNCgkJfQ0KCQllbHNlIHsNCgkJCWZsb2F0IG52ID0gbWF4KGRvdChuLCB2KSwgMC4wMSk7DQoJCQlmbG9hdCBubCA9IGRvdChuLCBsKTsNCgkJCWlmIChubCA8PSAwLjAxKSB7DQoJCQkJc3BlY2ZhYyA9IDAuMDsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCWZsb2F0IHZoID0gbWF4KGRvdCh2LCBoKSwgMC4wMSk7DQoNCgkJCQlmbG9hdCBhID0gMS4wOw0KCQkJCWZsb2F0IGIgPSAoMi4wICogbmggKiBudikgLyB2aDsNCgkJCQlmbG9hdCBjID0gKDIuMCAqIG5oICogbmwpIC8gdmg7DQoNCgkJCQlmbG9hdCBnID0gMC4wOw0KDQoJCQkJaWYgKGEgPCBiICYmIGEgPCBjKSBnID0gYTsNCgkJCQllbHNlIGlmIChiIDwgYSAmJiBiIDwgYykgZyA9IGI7DQoJCQkJZWxzZSBpZiAoYyA8IGEgJiYgYyA8IGIpIGcgPSBjOw0KDQoJCQkJZmxvYXQgcCA9IHNxcnQoKChyZWZyYWMgKiByZWZyYWMpICsgKHZoICogdmgpIC0gMS4wKSk7DQoJCQkJZmxvYXQgZiA9ICgoKChwIC0gdmgpICogKHAgLSB2aCkpIC8gKChwICsgdmgpICogKHAgKyB2aCkpKSAqDQoJCQkJICAgICAgICAgICAoMS4wICsgKCgoKHZoICogKHAgKyB2aCkpIC0gMS4wKSAqICgodmggKiAocCArIHZoKSkgLSAxLjApKSAvDQoJCQkJICAgICAgICAgICAgICAgICAgICgoKHZoICogKHAgLSB2aCkpICsgMS4wKSAqICgodmggKiAocCAtIHZoKSkgKyAxLjApKSkpKTsNCgkJCQlmbG9hdCBhbmcgPSBhY29zKG5oKTsNCg0KCQkJCXNwZWNmYWMgPSBtYXgoZiAqIGcgKiBleHBfYmxlbmRlcigoLShhbmcgKiBhbmcpIC8gKDIuMCAqIHNwZWNfcG93ZXIgKiBzcGVjX3Bvd2VyKSkpLCAwLjApOw0KCQkJfQ0KCQl9DQoJfQ0KfQ0KDQp2b2lkIHNoYWRlX3dhcmRpc29fc3BlYyh2ZWMzIG4sIHZlYzMgbCwgdmVjMyB2LCBmbG9hdCBybXMsIG91dCBmbG9hdCBzcGVjZmFjKQ0Kew0KCXZlYzMgaCA9IG5vcm1hbGl6ZShsICsgdik7DQoJZmxvYXQgbmggPSBtYXgoZG90KG4sIGgpLCAwLjAwMSk7DQoJZmxvYXQgbnYgPSBtYXgoZG90KG4sIHYpLCAwLjAwMSk7DQoJZmxvYXQgbmwgPSBtYXgoZG90KG4sIGwpLCAwLjAwMSk7DQoJZmxvYXQgYW5nbGUgPSB0YW4oYWNvcyhuaCkpOw0KCWZsb2F0IGFscGhhID0gbWF4KHJtcywgMC4wMDEpOw0KDQoJc3BlY2ZhYyA9IG5sICogKDEuMCAvICg0LjAgKiBNX1BJICogYWxwaGEgKiBhbHBoYSkpICogKGV4cF9ibGVuZGVyKC0oYW5nbGUgKiBhbmdsZSkgLyAoYWxwaGEgKiBhbHBoYSkpIC8gKHNxcnQobnYgKiBubCkpKTsNCn0NCg0Kdm9pZCBzaGFkZV90b29uX3NwZWModmVjMyBuLCB2ZWMzIGwsIHZlYzMgdiwgZmxvYXQgc2l6ZSwgZmxvYXQgdHNtb290aCwgb3V0IGZsb2F0IHNwZWNmYWMpDQp7DQoJdmVjMyBoID0gbm9ybWFsaXplKGwgKyB2KTsNCglmbG9hdCByc2x0ID0gZG90KGgsIG4pOw0KCWZsb2F0IGFuZyA9IGFjb3MocnNsdCk7DQoNCglpZiAoYW5nIDwgc2l6ZSkgcnNsdCA9IDEuMDsNCgllbHNlIGlmIChhbmcgPj0gKHNpemUgKyB0c21vb3RoKSB8fCB0c21vb3RoID09IDAuMCkgcnNsdCA9IDAuMDsNCgllbHNlIHJzbHQgPSAxLjAgLSAoKGFuZyAtIHNpemUpIC8gdHNtb290aCk7DQoNCglzcGVjZmFjID0gcnNsdDsNCn0NCg0Kdm9pZCBzaGFkZV9zcGVjX2FyZWFfaW5wKGZsb2F0IHNwZWNmYWMsIGZsb2F0IGlucCwgb3V0IGZsb2F0IG91dHNwZWNmYWMpDQp7DQoJb3V0c3BlY2ZhYyA9IHNwZWNmYWMgKiBpbnA7DQp9DQoNCnZvaWQgc2hhZGVfc3BlY190KGZsb2F0IHNoYWRmYWMsIGZsb2F0IHNwZWMsIGZsb2F0IHZpc2lmYWMsIGZsb2F0IHNwZWNmYWMsIG91dCBmbG9hdCB0KQ0Kew0KCXQgPSBzaGFkZmFjICogc3BlYyAqIHZpc2lmYWMgKiBzcGVjZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX2FkZF9zcGVjKGZsb2F0IHQsIHZlYzMgbGFtcGNvbCwgdmVjMyBzcGVjY29sLCBvdXQgdmVjMyBvdXRjb2wpDQp7DQoJb3V0Y29sID0gdCAqIGxhbXBjb2wgKiBzcGVjY29sOw0KfQ0KDQp2b2lkIHNoYWRlX2FkZF9taXJyb3IodmVjMyBtaXIsIHZlYzQgcmVmY29sLCB2ZWMzIGNvbWJpbmVkLCBvdXQgdmVjMyByZXN1bHQpDQp7DQoJcmVzdWx0ID0gbWlyICogcmVmY29sLmdiYSArICh2ZWMzKDEuMCkgLSBtaXIgKiByZWZjb2wucnJyKSAqIGNvbWJpbmVkOw0KfQ0KDQp2b2lkIGFscGhhX3NwZWNfY29ycmVjdGlvbih2ZWMzIHNwZWMsIGZsb2F0IHNwZWN0cmEsIGZsb2F0IGFscGhhLCBvdXQgZmxvYXQgb3V0YWxwaGEpDQp7DQoJaWYgKHNwZWN0cmEgPiAwLjApIHsNCgkJZmxvYXQgdCA9IGNsYW1wKG1heChtYXgoc3BlYy5yLCBzcGVjLmcpLCBzcGVjLmIpICogc3BlY3RyYSwgMC4wLCAxLjApOw0KCQlvdXRhbHBoYSA9ICgxLjAgLSB0KSAqIGFscGhhICsgdDsNCgl9DQoJZWxzZSB7DQoJCW91dGFscGhhID0gYWxwaGE7DQoJfQ0KfQ0KDQp2b2lkIHNoYWRlX2FkZCh2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDEgKyBjb2wyOw0KfQ0KDQp2b2lkIHNoYWRlX21hZGQodmVjNCBjb2wsIHZlYzQgY29sMSwgdmVjNCBjb2wyLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gY29sICsgY29sMSAqIGNvbDI7DQp9DQoNCnZvaWQgc2hhZGVfYWRkX2NsYW1wZWQodmVjNCBjb2wxLCB2ZWM0IGNvbDIsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSBjb2wxICsgbWF4KGNvbDIsIHZlYzQoMC4wLCAwLjAsIDAuMCwgMC4wKSk7DQp9DQoNCnZvaWQgc2hhZGVfbWFkZF9jbGFtcGVkKHZlYzQgY29sLCB2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbCArIG1heChjb2wxICogY29sMiwgdmVjNCgwLjAsIDAuMCwgMC4wLCAwLjApKTsNCn0NCg0Kdm9pZCBlbnZfYXBwbHkodmVjNCBjb2wsIHZlYzMgaG9yLCB2ZWMzIHplbiwgdmVjNCBmLCBtYXQ0IHZtLCB2ZWMzIHZuLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJdmVjMyB2diA9IG5vcm1hbGl6ZSh2bVsyXS54eXopOw0KCWZsb2F0IHNreWZhYyA9IDAuNSAqICgxLjAgKyBkb3Qodm4sIC12dikpOw0KCW91dGNvbCA9IGNvbCArIGYgKiB2ZWM0KG1peChob3IsIHplbiwgc2t5ZmFjKSwgMCk7DQp9DQoNCnZvaWQgc2hhZGVfbWFkZGYodmVjNCBjb2wsIGZsb2F0IGYsIHZlYzQgY29sMSwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbCArIGYgKiBjb2wxOw0KfQ0KDQp2b2lkIHNoYWRlX211bCh2ZWM0IGNvbDEsIHZlYzQgY29sMiwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDEgKiBjb2wyOw0KfQ0KDQp2b2lkIHNoYWRlX211bF92YWx1ZShmbG9hdCBmYWMsIHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gY29sICogZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX211bF92YWx1ZV92MyhmbG9hdCBmYWMsIHZlYzMgY29sLCBvdXQgdmVjMyBvdXRjb2wpDQp7DQoJb3V0Y29sID0gY29sICogZmFjOw0KfQ0KDQp2b2lkIHNoYWRlX29iY29sb3IodmVjNCBjb2wsIHZlYzQgb2Jjb2wsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSB2ZWM0KGNvbC5yZ2IgKiBvYmNvbC5yZ2IsIGNvbC5hKTsNCn0NCg0Kdm9pZCByYW1wX3JnYnRvYncodmVjMyBjb2xvciwgb3V0IGZsb2F0IG91dHZhbCkNCnsNCglvdXR2YWwgPSBjb2xvci5yICogMC4zICsgY29sb3IuZyAqIDAuNTggKyBjb2xvci5iICogMC4xMjsNCn0NCg0Kdm9pZCBzaGFkZV9vbmx5X3NoYWRvdyhmbG9hdCBpLCBmbG9hdCBzaGFkZmFjLCBmbG9hdCBlbmVyZ3ksIHZlYzMgc2hhZGNvbCwgb3V0IHZlYzMgb3V0c2hhZHJnYikNCnsNCglvdXRzaGFkcmdiID0gaSAqIGVuZXJneSAqICgxLjAgLSBzaGFkZmFjKSAqICh2ZWMzKDEuMCkgLSBzaGFkY29sKTsNCn0NCg0Kdm9pZCBzaGFkZV9vbmx5X3NoYWRvd19kaWZmdXNlKHZlYzMgc2hhZHJnYiwgdmVjMyByZ2IsIHZlYzQgZGlmZiwgb3V0IHZlYzQgb3V0ZGlmZikNCnsNCglvdXRkaWZmID0gZGlmZiAtIHZlYzQocmdiICogc2hhZHJnYiwgMC4wKTsNCn0NCg0Kdm9pZCBzaGFkZV9vbmx5X3NoYWRvd19zcGVjdWxhcih2ZWMzIHNoYWRyZ2IsIHZlYzMgc3BlY3JnYiwgdmVjNCBzcGVjLCBvdXQgdmVjNCBvdXRzcGVjKQ0Kew0KCW91dHNwZWMgPSBzcGVjIC0gdmVjNChzcGVjcmdiICogc2hhZHJnYiwgMC4wKTsNCn0NCg0Kdm9pZCBzaGFkZV9jbGFtcF9wb3NpdGl2ZSh2ZWM0IGNvbCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IG1heChjb2wsIHZlYzQoMC4wKSk7DQp9DQoNCnZvaWQgdGVzdF9zaGFkb3didWYoDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsIGZsb2F0IHNoYWRvd2JpYXMsIGZsb2F0IGlucCwNCiAgICAgICAgb3V0IGZsb2F0IHJlc3VsdCkNCnsNCglpZiAoaW5wIDw9IDAuMCkgew0KCQlyZXN1bHQgPSAwLjA7DQoJfQ0KCWVsc2Ugew0KCQl2ZWM0IGNvID0gc2hhZG93cGVyc21hdCAqIHZlYzQocmNvLCAxLjApOw0KDQoJCS8vZmxvYXQgYmlhcyA9ICgxLjUgLSBpbnAqaW5wKSpzaGFkb3diaWFzOw0KCQljby56IC09IHNoYWRvd2JpYXMgKiBjby53Ow0KDQoJCWlmIChjby53ID4gMC4wICYmIGNvLnggPiAwLjAgJiYgY28ueCAvIGNvLncgPCAxLjAgJiYgY28ueSA+IDAuMCAmJiBjby55IC8gY28udyA8IDEuMCkNCgkJCXJlc3VsdCA9IHRleHR1cmUyRFByb2ooc2hhZG93bWFwLCBjbykueDsNCgkJZWxzZQ0KCQkJcmVzdWx0ID0gMS4wOw0KCX0NCn0NCg0Kdm9pZCB0ZXN0X3NoYWRvd2J1Zl92c20oDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsIGZsb2F0IHNoYWRvd2JpYXMsIGZsb2F0IGJsZWVkYmlhcywgZmxvYXQgaW5wLA0KICAgICAgICBvdXQgZmxvYXQgcmVzdWx0KQ0Kew0KCWlmIChpbnAgPD0gMC4wKSB7DQoJCXJlc3VsdCA9IDAuMDsNCgl9DQoJZWxzZSB7DQoJCXZlYzQgY28gPSBzaGFkb3dwZXJzbWF0ICogdmVjNChyY28sIDEuMCk7DQoJCWlmIChjby53ID4gMC4wICYmIGNvLnggPiAwLjAgJiYgY28ueCAvIGNvLncgPCAxLjAgJiYgY28ueSA+IDAuMCAmJiBjby55IC8gY28udyA8IDEuMCkgew0KCQkJdmVjMiBtb21lbnRzID0gdGV4dHVyZTJEUHJvaihzaGFkb3dtYXAsIGNvKS5yZzsNCgkJCWZsb2F0IGRpc3QgPSBjby56IC8gY28udzsNCgkJCWZsb2F0IHAgPSAwLjA7DQoNCgkJCWlmIChkaXN0IDw9IG1vbWVudHMueCkNCgkJCQlwID0gMS4wOw0KDQoJCQlmbG9hdCB2YXJpYW5jZSA9IG1vbWVudHMueSAtIChtb21lbnRzLnggKiBtb21lbnRzLngpOw0KCQkJdmFyaWFuY2UgPSBtYXgodmFyaWFuY2UsIHNoYWRvd2JpYXMgLyAxMC4wKTsNCg0KCQkJZmxvYXQgZCA9IG1vbWVudHMueCAtIGRpc3Q7DQoJCQlmbG9hdCBwX21heCA9IHZhcmlhbmNlIC8gKHZhcmlhbmNlICsgZCAqIGQpOw0KDQoJCQkvLyBOb3cgcmVkdWNlIGxpZ2h0LWJsZWVkaW5nIGJ5IHJlbW92aW5nIHRoZSBbMCwgeF0gdGFpbCBhbmQgbGluZWFybHkgcmVzY2FsaW5nICh4LCAxXQ0KCQkJcF9tYXggPSBjbGFtcCgocF9tYXggLSBibGVlZGJpYXMpIC8gKDEuMCAtIGJsZWVkYmlhcyksIDAuMCwgMS4wKTsNCg0KCQkJcmVzdWx0ID0gbWF4KHAsIHBfbWF4KTsNCgkJfQ0KCQllbHNlIHsNCgkJCXJlc3VsdCA9IDEuMDsNCgkJfQ0KCX0NCn0NCg0Kdm9pZCBzaGFkb3dzX29ubHkoDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsDQogICAgICAgIGZsb2F0IHNoYWRvd2JpYXMsIHZlYzMgc2hhZG93Y29sb3IsIGZsb2F0IGlucCwNCiAgICAgICAgb3V0IHZlYzMgcmVzdWx0KQ0Kew0KCXJlc3VsdCA9IHZlYzMoMS4wKTsNCg0KCWlmIChpbnAgPiAwLjApIHsNCgkJZmxvYXQgc2hhZGZhYzsNCg0KCQl0ZXN0X3NoYWRvd2J1ZihyY28sIHNoYWRvd21hcCwgc2hhZG93cGVyc21hdCwgc2hhZG93YmlhcywgaW5wLCBzaGFkZmFjKTsNCgkJcmVzdWx0IC09ICgxLjAgLSBzaGFkZmFjKSAqICh2ZWMzKDEuMCkgLSBzaGFkb3djb2xvcik7DQoJfQ0KfQ0KDQp2b2lkIHNoYWRvd3Nfb25seV92c20oDQogICAgICAgIHZlYzMgcmNvLCBzYW1wbGVyMkQgc2hhZG93bWFwLCBtYXQ0IHNoYWRvd3BlcnNtYXQsDQogICAgICAgIGZsb2F0IHNoYWRvd2JpYXMsIGZsb2F0IGJsZWVkYmlhcywgdmVjMyBzaGFkb3djb2xvciwgZmxvYXQgaW5wLA0KICAgICAgICBvdXQgdmVjMyByZXN1bHQpDQp7DQoJcmVzdWx0ID0gdmVjMygxLjApOw0KDQoJaWYgKGlucCA+IDAuMCkgew0KCQlmbG9hdCBzaGFkZmFjOw0KDQoJCXRlc3Rfc2hhZG93YnVmX3ZzbShyY28sIHNoYWRvd21hcCwgc2hhZG93cGVyc21hdCwgc2hhZG93YmlhcywgYmxlZWRiaWFzLCBpbnAsIHNoYWRmYWMpOw0KCQlyZXN1bHQgLT0gKDEuMCAtIHNoYWRmYWMpICogKHZlYzMoMS4wKSAtIHNoYWRvd2NvbG9yKTsNCgl9DQp9DQoNCnZvaWQgc2hhZGVfbGlnaHRfdGV4dHVyZSh2ZWMzIHJjbywgc2FtcGxlcjJEIGNvb2tpZSwgbWF0NCBzaGFkb3dwZXJzbWF0LCBvdXQgdmVjNCByZXN1bHQpDQp7DQoNCgl2ZWM0IGNvID0gc2hhZG93cGVyc21hdCAqIHZlYzQocmNvLCAxLjApOw0KDQoJcmVzdWx0ID0gdGV4dHVyZTJEUHJvaihjb29raWUsIGNvKTsNCn0NCg0Kdm9pZCBzaGFkZV9leHBvc3VyZV9jb3JyZWN0KHZlYzMgY29sLCBmbG9hdCBsaW5mYWMsIGZsb2F0IGxvZ2ZhYywgb3V0IHZlYzMgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGxpbmZhYyAqICgxLjAgLSBleHAoY29sICogbG9nZmFjKSk7DQp9DQoNCnZvaWQgc2hhZGVfbWlzdF9mYWN0b3IoDQogICAgICAgIHZlYzMgY28sIGZsb2F0IGVuYWJsZSwgZmxvYXQgbWlzdHN0YSwgZmxvYXQgbWlzdGRpc3QsIGZsb2F0IG1pc3R0eXBlLCBmbG9hdCBtaXNpLA0KICAgICAgICBvdXQgZmxvYXQgb3V0ZmFjKQ0Kew0KCWlmIChlbmFibGUgPT0gMS4wKSB7DQoJCWZsb2F0IGZhYywgemNvcjsNCg0KCQl6Y29yID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IGxlbmd0aChjbykgOiAtY29bMl07DQoNCgkJZmFjID0gY2xhbXAoKHpjb3IgLSBtaXN0c3RhKSAvIG1pc3RkaXN0LCAwLjAsIDEuMCk7DQoJCWlmIChtaXN0dHlwZSA9PSAwLjApIGZhYyAqPSBmYWM7DQoJCWVsc2UgaWYgKG1pc3R0eXBlID09IDEuMCkgOw0KCQllbHNlIGZhYyA9IHNxcnQoZmFjKTsNCg0KCQlvdXRmYWMgPSAxLjAgLSAoMS4wIC0gZmFjKSAqICgxLjAgLSBtaXNpKTsNCgl9DQoJZWxzZSB7DQoJCW91dGZhYyA9IDAuMDsNCgl9DQp9DQoNCnZvaWQgc2hhZGVfd29ybGRfbWl4KHZlYzMgaG9yLCB2ZWM0IGNvbCwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCWZsb2F0IGZhYyA9IGNsYW1wKGNvbC5hLCAwLjAsIDEuMCk7DQoJb3V0Y29sID0gdmVjNChtaXgoaG9yLCBjb2wucmdiLCBmYWMpLCBjb2wuYSk7DQp9DQoNCnZvaWQgc2hhZGVfYWxwaGFfb3BhcXVlKHZlYzQgY29sLCBvdXQgdmVjNCBvdXRjb2wpDQp7DQoJb3V0Y29sID0gdmVjNChjb2wucmdiLCAxLjApOw0KfQ0KDQp2b2lkIHNoYWRlX2FscGhhX29iY29sb3IodmVjNCBjb2wsIHZlYzQgb2Jjb2wsIG91dCB2ZWM0IG91dGNvbCkNCnsNCglvdXRjb2wgPSB2ZWM0KGNvbC5yZ2IsIGNvbC5hICogb2Jjb2wuYSk7DQp9DQoNCi8qKioqKioqKioqKiBORVcgU0hBREVSIFVUSUxJVElFUyAqKioqKioqKioqKioqKi8NCg0KZmxvYXQgZnJlc25lbF9kaWVsZWN0cmljKHZlYzMgSW5jb21pbmcsIHZlYzMgTm9ybWFsLCBmbG9hdCBldGEpDQp7DQoJLyogY29tcHV0ZSBmcmVzbmVsIHJlZmxlY3RhbmNlIHdpdGhvdXQgZXhwbGljaXRseSBjb21wdXRpbmcNCgkgKiB0aGUgcmVmcmFjdGVkIGRpcmVjdGlvbiAqLw0KCWZsb2F0IGMgPSBhYnMoZG90KEluY29taW5nLCBOb3JtYWwpKTsNCglmbG9hdCBnID0gZXRhICogZXRhIC0gMS4wICsgYyAqIGM7DQoJZmxvYXQgcmVzdWx0Ow0KDQoJaWYgKGcgPiAwLjApIHsNCgkJZyA9IHNxcnQoZyk7DQoJCWZsb2F0IEEgPSAoZyAtIGMpIC8gKGcgKyBjKTsNCgkJZmxvYXQgQiA9IChjICogKGcgKyBjKSAtIDEuMCkgLyAoYyAqIChnIC0gYykgKyAxLjApOw0KCQlyZXN1bHQgPSAwLjUgKiBBICogQSAqICgxLjAgKyBCICogQik7DQoJfQ0KCWVsc2Ugew0KCQlyZXN1bHQgPSAxLjA7ICAvKiBUSVIgKG5vIHJlZnJhY3RlZCBjb21wb25lbnQpICovDQoJfQ0KDQoJcmV0dXJuIHJlc3VsdDsNCn0NCg0KZmxvYXQgaHlwb3QoZmxvYXQgeCwgZmxvYXQgeSkNCnsNCglyZXR1cm4gc3FydCh4ICogeCArIHkgKiB5KTsNCn0NCg0Kdm9pZCBnZW5lcmF0ZWRfZnJvbV9vcmNvKHZlYzMgb3Jjbywgb3V0IHZlYzMgZ2VuZXJhdGVkKQ0Kew0KCWdlbmVyYXRlZCA9IG9yY28gKiAwLjUgKyB2ZWMzKDAuNSk7DQp9DQoNCmludCBmbG9vcl90b19pbnQoZmxvYXQgeCkNCnsNCglyZXR1cm4gaW50KGZsb29yKHgpKTsNCn0NCg0KaW50IHF1aWNrX2Zsb29yKGZsb2F0IHgpDQp7DQoJcmV0dXJuIGludCh4KSAtICgoeCA8IDApID8gMSA6IDApOw0KfQ0KDQojaWZkZWYgQklUX09QRVJBVElPTlMNCmZsb2F0IGludGVnZXJfbm9pc2UoaW50IG4pDQp7DQoJaW50IG5uOw0KCW4gPSAobiArIDEwMTMpICYgMHg3ZmZmZmZmZjsNCgluID0gKG4gPj4gMTMpIF4gbjsNCglubiA9IChuICogKG4gKiBuICogNjA0OTMgKyAxOTk5MDMwMykgKyAxMzc2MzEyNTg5KSAmIDB4N2ZmZmZmZmY7DQoJcmV0dXJuIDAuNSAqIChmbG9hdChubikgLyAxMDczNzQxODI0LjApOw0KfQ0KDQp1aW50IGhhc2godWludCBreCwgdWludCBreSwgdWludCBreikNCnsNCiNkZWZpbmUgcm90KHgsIGspICgoKHgpIDw8IChrKSkgfCAoKHgpID4+ICgzMiAtIChrKSkpKQ0KI2RlZmluZSBmaW5hbChhLCBiLCBjKSBcDQp7IFwNCgljIF49IGI7IGMgLT0gcm90KGIsIDE0KTsgXA0KCWEgXj0gYzsgYSAtPSByb3QoYywgMTEpOyBcDQoJYiBePSBhOyBiIC09IHJvdChhLCAyNSk7IFwNCgljIF49IGI7IGMgLT0gcm90KGIsIDE2KTsgXA0KCWEgXj0gYzsgYSAtPSByb3QoYywgNCk7ICBcDQoJYiBePSBhOyBiIC09IHJvdChhLCAxNCk7IFwNCgljIF49IGI7IGMgLT0gcm90KGIsIDI0KTsgXA0KfQ0KCS8vIG5vdyBoYXNoIHRoZSBkYXRhIQ0KCXVpbnQgYSwgYiwgYywgbGVuID0gM3U7DQoJYSA9IGIgPSBjID0gMHhkZWFkYmVlZnUgKyAobGVuIDw8IDJ1KSArIDEzdTsNCg0KCWMgKz0ga3o7DQoJYiArPSBreTsNCglhICs9IGt4Ow0KCWZpbmFsIChhLCBiLCBjKTsNCg0KCXJldHVybiBjOw0KI3VuZGVmIHJvdA0KI3VuZGVmIGZpbmFsDQp9DQoNCnVpbnQgaGFzaChpbnQga3gsIGludCBreSwgaW50IGt6KQ0Kew0KCXJldHVybiBoYXNoKHVpbnQoa3gpLCB1aW50KGt5KSwgdWludChreikpOw0KfQ0KDQpmbG9hdCBiaXRzX3RvXzAxKHVpbnQgYml0cykNCnsNCglmbG9hdCB4ID0gZmxvYXQoYml0cykgKiAoMS4wIC8gZmxvYXQoMHhmZmZmZmZmZnUpKTsNCglyZXR1cm4geDsNCn0NCg0KZmxvYXQgY2VsbG5vaXNlKHZlYzMgcCkNCnsNCglpbnQgaXggPSBxdWlja19mbG9vcihwLngpOw0KCWludCBpeSA9IHF1aWNrX2Zsb29yKHAueSk7DQoJaW50IGl6ID0gcXVpY2tfZmxvb3IocC56KTsNCg0KCXJldHVybiBiaXRzX3RvXzAxKGhhc2godWludChpeCksIHVpbnQoaXkpLCB1aW50KGl6KSkpOw0KfQ0KDQp2ZWMzIGNlbGxub2lzZV9jb2xvcih2ZWMzIHApDQp7DQoJZmxvYXQgciA9IGNlbGxub2lzZShwKTsNCglmbG9hdCBnID0gY2VsbG5vaXNlKHZlYzMocC55LCBwLngsIHAueikpOw0KCWZsb2F0IGIgPSBjZWxsbm9pc2UodmVjMyhwLnksIHAueiwgcC54KSk7DQoNCglyZXR1cm4gdmVjMyhyLCBnLCBiKTsNCn0NCiNlbmRpZiAgLy8gQklUX09QRVJBVElPTlMNCg0KZmxvYXQgZmxvb3JmcmFjKGZsb2F0IHgsIG91dCBpbnQgaSkNCnsNCglpID0gZmxvb3JfdG9faW50KHgpOw0KCXJldHVybiB4IC0gaTsNCn0NCg0KLyoqKioqKioqKioqIE5FVyBTSEFERVIgTk9ERVMgKioqKioqKioqKioqKioqLw0KDQojZGVmaW5lIE5VTV9MSUdIVFMgMw0KDQovKiBic2RmcyAqLw0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCnZvaWQgbm9kZV9hbWJpZW50X29jY2x1c2lvbih2ZWM0IGNvbG9yLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJcmVzdWx0ID0gY29sb3I7DQp9DQoNCi8qIGVtaXNzaW9uICovDQoNCnZvaWQgbm9kZV9lbWlzc2lvbih2ZWM0IGNvbG9yLCBmbG9hdCBzdHJlbmd0aCwgdmVjMyBOLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJcmVzdWx0ID0gY29sb3IgKiBzdHJlbmd0aDsNCn0NCg0KLyogYmFja2dyb3VuZCAqLw0KDQp2b2lkIGJhY2tncm91bmRfdHJhbnNmb3JtX3RvX3dvcmxkKHZlYzMgdmlld3ZlYywgb3V0IHZlYzMgd29ybGR2ZWMpDQp7DQoJdmVjNCB2ID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IHZlYzQodmlld3ZlYywgMS4wKSA6IHZlYzQoMC4wLCAwLjAsIDEuMCwgMS4wKTsNCgl2ZWM0IGNvX2hvbW9nZW5vdXMgPSAoYmxfUHJvamVjdGlvbk1hdHJpeEludmVyc2UgKiB2KTsNCg0KCXZlYzQgY28gPSB2ZWM0KGNvX2hvbW9nZW5vdXMueHl6IC8gY29faG9tb2dlbm91cy53LCAwLjApOw0KCXdvcmxkdmVjID0gKGJsX01vZGVsVmlld01hdHJpeEludmVyc2UgKiBjbykueHl6Ow0KfQ0KDQp2b2lkIG5vZGVfYmFja2dyb3VuZCh2ZWM0IGNvbG9yLCBmbG9hdCBzdHJlbmd0aCwgdmVjMyBOLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJcmVzdWx0ID0gY29sb3IgKiBzdHJlbmd0aDsNCn0NCg0KLyogY2xvc3VyZXMgKi8NCg0Kdm9pZCBub2RlX21peF9zaGFkZXIoZmxvYXQgZmFjLCB2ZWM0IHNoYWRlcjEsIHZlYzQgc2hhZGVyMiwgb3V0IHZlYzQgc2hhZGVyKQ0Kew0KCXNoYWRlciA9IG1peChzaGFkZXIxLCBzaGFkZXIyLCBmYWMpOw0KfQ0KDQp2b2lkIG5vZGVfYWRkX3NoYWRlcih2ZWM0IHNoYWRlcjEsIHZlYzQgc2hhZGVyMiwgb3V0IHZlYzQgc2hhZGVyKQ0Kew0KCXNoYWRlciA9IHNoYWRlcjEgKyBzaGFkZXIyOw0KfQ0KDQovKiBmcmVzbmVsICovDQoNCnZvaWQgbm9kZV9mcmVzbmVsKGZsb2F0IGlvciwgdmVjMyBOLCB2ZWMzIEksIG91dCBmbG9hdCByZXN1bHQpDQp7DQoJLyogaGFuZGxlIHBlcnNwZWN0aXZlL29ydGhvZ3JhcGhpYyAqLw0KCXZlYzMgSV92aWV3ID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IG5vcm1hbGl6ZShJKSA6IHZlYzMoMC4wLCAwLjAsIC0xLjApOw0KDQoJZmxvYXQgZXRhID0gbWF4KGlvciwgMC4wMDAwMSk7DQoJcmVzdWx0ID0gZnJlc25lbF9kaWVsZWN0cmljKElfdmlldywgTiwgKGdsX0Zyb250RmFjaW5nKSA/IGV0YSA6IDEuMCAvIGV0YSk7DQp9DQoNCi8qIGxheWVyX3dlaWdodCAqLw0KDQp2b2lkIG5vZGVfbGF5ZXJfd2VpZ2h0KGZsb2F0IGJsZW5kLCB2ZWMzIE4sIHZlYzMgSSwgb3V0IGZsb2F0IGZyZXNuZWwsIG91dCBmbG9hdCBmYWNpbmcpDQp7DQoJLyogZnJlc25lbCAqLw0KCWZsb2F0IGV0YSA9IG1heCgxLjAgLSBibGVuZCwgMC4wMDAwMSk7DQoJdmVjMyBJX3ZpZXcgPSAoYmxfUHJvamVjdGlvbk1hdHJpeFszXVszXSA9PSAwLjApID8gbm9ybWFsaXplKEkpIDogdmVjMygwLjAsIDAuMCwgLTEuMCk7DQoNCglmcmVzbmVsID0gZnJlc25lbF9kaWVsZWN0cmljKElfdmlldywgTiwgKGdsX0Zyb250RmFjaW5nKSA/IDEuMCAvIGV0YSA6IGV0YSk7DQoNCgkvKiBmYWNpbmcgKi8NCglmYWNpbmcgPSBhYnMoZG90KElfdmlldywgTikpOw0KCWlmIChibGVuZCAhPSAwLjUpIHsNCgkJYmxlbmQgPSBjbGFtcChibGVuZCwgMC4wLCAwLjk5OTk5KTsNCgkJYmxlbmQgPSAoYmxlbmQgPCAwLjUpID8gMi4wICogYmxlbmQgOiAwLjUgLyAoMS4wIC0gYmxlbmQpOw0KCQlmYWNpbmcgPSBwb3coZmFjaW5nLCBibGVuZCk7DQoJfQ0KCWZhY2luZyA9IDEuMCAtIGZhY2luZzsNCn0NCg0KLyogZ2FtbWEgKi8NCg0Kdm9pZCBub2RlX2dhbW1hKHZlYzQgY29sLCBmbG9hdCBnYW1tYSwgb3V0IHZlYzQgb3V0Y29sKQ0Kew0KCW91dGNvbCA9IGNvbDsNCg0KCWlmIChjb2wuciA+IDAuMCkNCgkJb3V0Y29sLnIgPSBjb21wYXRpYmxlX3Bvdyhjb2wuciwgZ2FtbWEpOw0KCWlmIChjb2wuZyA+IDAuMCkNCgkJb3V0Y29sLmcgPSBjb21wYXRpYmxlX3Bvdyhjb2wuZywgZ2FtbWEpOw0KCWlmIChjb2wuYiA+IDAuMCkNCgkJb3V0Y29sLmIgPSBjb21wYXRpYmxlX3Bvdyhjb2wuYiwgZ2FtbWEpOw0KfQ0KDQovKiBnZW9tZXRyeSAqLw0KDQp2b2lkIG5vZGVfYXR0cmlidXRlKHZlYzMgYXR0ciwgb3V0IHZlYzQgb3V0Y29sLCBvdXQgdmVjMyBvdXR2ZWMsIG91dCBmbG9hdCBvdXRmKQ0Kew0KCW91dGNvbCA9IHZlYzQoYXR0ciwgMS4wKTsNCglvdXR2ZWMgPSBhdHRyOw0KCW91dGYgPSAoYXR0ci54ICsgYXR0ci55ICsgYXR0ci56KSAvIDMuMDsNCn0NCg0Kdm9pZCBub2RlX3V2bWFwKHZlYzMgYXR0cl91diwgb3V0IHZlYzMgb3V0dmVjKQ0Kew0KCW91dHZlYyA9IGF0dHJfdXY7DQp9DQoNCnZvaWQgbm9kZV9nZW9tZXRyeSgNCiAgICAgICAgdmVjMyBJLCB2ZWMzIE4sIG1hdDQgdG93b3JsZCwNCiAgICAgICAgb3V0IHZlYzMgcG9zaXRpb24sIG91dCB2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgdGFuZ2VudCwNCiAgICAgICAgb3V0IHZlYzMgdHJ1ZV9ub3JtYWwsIG91dCB2ZWMzIGluY29taW5nLCBvdXQgdmVjMyBwYXJhbWV0cmljLA0KICAgICAgICBvdXQgZmxvYXQgYmFja2ZhY2luZywgb3V0IGZsb2F0IHBvaW50aW5lc3MpDQp7DQoJcG9zaXRpb24gPSAodG93b3JsZCAqIHZlYzQoSSwgMS4wKSkueHl6Ow0KCW5vcm1hbCA9ICh0b3dvcmxkICogdmVjNChOLCAwLjApKS54eXo7DQoJdGFuZ2VudCA9IHZlYzMoMC4wKTsNCgl0cnVlX25vcm1hbCA9IG5vcm1hbDsNCg0KCS8qIGhhbmRsZSBwZXJzcGVjdGl2ZS9vcnRob2dyYXBoaWMgKi8NCgl2ZWMzIElfdmlldyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPyBub3JtYWxpemUoSSkgOiB2ZWMzKDAuMCwgMC4wLCAtMS4wKTsNCglpbmNvbWluZyA9IC0odG93b3JsZCAqIHZlYzQoSV92aWV3LCAwLjApKS54eXo7DQoNCglwYXJhbWV0cmljID0gdmVjMygwLjApOw0KCWJhY2tmYWNpbmcgPSAoZ2xfRnJvbnRGYWNpbmcpID8gMC4wIDogMS4wOw0KCXBvaW50aW5lc3MgPSAwLjU7DQp9DQoNCnZvaWQgbm9kZV90ZXhfY29vcmQoDQogICAgICAgIHZlYzMgSSwgdmVjMyBOLCBtYXQ0IHZpZXdpbnZtYXQsIG1hdDQgb2JpbnZtYXQsIHZlYzQgY2FtZXJhZmFjLA0KICAgICAgICB2ZWMzIGF0dHJfb3JjbywgdmVjMyBhdHRyX3V2LA0KICAgICAgICBvdXQgdmVjMyBnZW5lcmF0ZWQsIG91dCB2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgdXYsIG91dCB2ZWMzIG9iamVjdCwNCiAgICAgICAgb3V0IHZlYzMgY2FtZXJhLCBvdXQgdmVjMyB3aW5kb3csIG91dCB2ZWMzIHJlZmxlY3Rpb24pDQp7DQoJZ2VuZXJhdGVkID0gYXR0cl9vcmNvICogMC41ICsgdmVjMygwLjUpOw0KCW5vcm1hbCA9IG5vcm1hbGl6ZSgob2JpbnZtYXQgKiAodmlld2ludm1hdCAqIHZlYzQoTiwgMC4wKSkpLnh5eik7DQoJdXYgPSBhdHRyX3V2Ow0KCW9iamVjdCA9IChvYmludm1hdCAqICh2aWV3aW52bWF0ICogdmVjNChJLCAxLjApKSkueHl6Ow0KCWNhbWVyYSA9IHZlYzMoSS54eSwgLUkueik7DQoJdmVjNCBwcm9qdmVjID0gYmxfUHJvamVjdGlvbk1hdHJpeCAqIHZlYzQoSSwgMS4wKTsNCgl3aW5kb3cgPSB2ZWMzKG10ZXhfMmRfbWFwcGluZyhwcm9qdmVjLnh5eiAvIHByb2p2ZWMudykueHkgKiBjYW1lcmFmYWMueHkgKyBjYW1lcmFmYWMuencsIDAuMCk7DQoNCgl2ZWMzIHNoYWRlX0k7DQoJc2hhZGVfdmlldyhJLCBzaGFkZV9JKTsNCgl2ZWMzIHZpZXdfcmVmbGVjdGlvbiA9IHJlZmxlY3Qoc2hhZGVfSSwgbm9ybWFsaXplKE4pKTsNCglyZWZsZWN0aW9uID0gKHZpZXdpbnZtYXQgKiB2ZWM0KHZpZXdfcmVmbGVjdGlvbiwgMC4wKSkueHl6Ow0KfQ0KDQp2b2lkIG5vZGVfdGV4X2Nvb3JkX2JhY2tncm91bmQoDQogICAgICAgIHZlYzMgSSwgdmVjMyBOLCBtYXQ0IHZpZXdpbnZtYXQsIG1hdDQgb2JpbnZtYXQsIHZlYzQgY2FtZXJhZmFjLA0KICAgICAgICB2ZWMzIGF0dHJfb3JjbywgdmVjMyBhdHRyX3V2LA0KICAgICAgICBvdXQgdmVjMyBnZW5lcmF0ZWQsIG91dCB2ZWMzIG5vcm1hbCwgb3V0IHZlYzMgdXYsIG91dCB2ZWMzIG9iamVjdCwNCiAgICAgICAgb3V0IHZlYzMgY2FtZXJhLCBvdXQgdmVjMyB3aW5kb3csIG91dCB2ZWMzIHJlZmxlY3Rpb24pDQp7DQoJdmVjNCB2ID0gKGJsX1Byb2plY3Rpb25NYXRyaXhbM11bM10gPT0gMC4wKSA/IHZlYzQoSSwgMS4wKSA6IHZlYzQoMC4wLCAwLjAsIDEuMCwgMS4wKTsNCgl2ZWM0IGNvX2hvbW9nZW5vdXMgPSAoYmxfUHJvamVjdGlvbk1hdHJpeEludmVyc2UgKiB2KTsNCg0KCXZlYzQgY28gPSB2ZWM0KGNvX2hvbW9nZW5vdXMueHl6IC8gY29faG9tb2dlbm91cy53LCAwLjApOw0KDQoJY28gPSBub3JtYWxpemUoY28pOw0KCXZlYzMgY29vcmRzID0gKGJsX01vZGVsVmlld01hdHJpeEludmVyc2UgKiBjbykueHl6Ow0KDQoJZ2VuZXJhdGVkID0gY29vcmRzOw0KCW5vcm1hbCA9IC1jb29yZHM7DQoJdXYgPSB2ZWMzKGF0dHJfdXYueHksIDAuMCk7DQoJb2JqZWN0ID0gY29vcmRzOw0KDQoJY2FtZXJhID0gdmVjMyhjby54eSwgLWNvLnopOw0KCXdpbmRvdyA9IChibF9Qcm9qZWN0aW9uTWF0cml4WzNdWzNdID09IDAuMCkgPw0KCSAgICAgICAgIHZlYzMobXRleF8yZF9tYXBwaW5nKEkpLnh5ICogY2FtZXJhZmFjLnh5ICsgY2FtZXJhZmFjLnp3LCAwLjApIDoNCgkgICAgICAgICB2ZWMzKHZlYzIoMC41KSAqIGNhbWVyYWZhYy54eSArIGNhbWVyYWZhYy56dywgMC4wKTsNCg0KCXJlZmxlY3Rpb24gPSAtY29vcmRzOw0KfQ0KDQovKiB0ZXh0dXJlcyAqLw0KDQpmbG9hdCBjYWxjX2dyYWRpZW50KHZlYzMgcCwgaW50IGdyYWRpZW50X3R5cGUpDQp7DQoJZmxvYXQgeCwgeSwgejsNCgl4ID0gcC54Ow0KCXkgPSBwLnk7DQoJeiA9IHAuejsNCglpZiAoZ3JhZGllbnRfdHlwZSA9PSAwKSB7ICAvKiBsaW5lYXIgKi8NCgkJcmV0dXJuIHg7DQoJfQ0KCWVsc2UgaWYgKGdyYWRpZW50X3R5cGUgPT0gMSkgeyAgLyogcXVhZHJhdGljICovDQoJCWZsb2F0IHIgPSBtYXgoeCwgMC4wKTsNCgkJcmV0dXJuIHIgKiByOw0KCX0NCgllbHNlIGlmIChncmFkaWVudF90eXBlID09IDIpIHsgIC8qIGVhc2luZyAqLw0KCQlmbG9hdCByID0gbWluKG1heCh4LCAwLjApLCAxLjApOw0KCQlmbG9hdCB0ID0gciAqIHI7DQoJCXJldHVybiAoMy4wICogdCAtIDIuMCAqIHQgKiByKTsNCgl9DQoJZWxzZSBpZiAoZ3JhZGllbnRfdHlwZSA9PSAzKSB7ICAvKiBkaWFnb25hbCAqLw0KCQlyZXR1cm4gKHggKyB5KSAqIDAuNTsNCgl9DQoJZWxzZSBpZiAoZ3JhZGllbnRfdHlwZSA9PSA0KSB7ICAvKiByYWRpYWwgKi8NCgkJcmV0dXJuIGF0YW4oeSwgeCkgLyAoTV9QSSAqIDIpICsgMC41Ow0KCX0NCgllbHNlIHsNCgkJZmxvYXQgciA9IG1heCgxLjAgLSBzcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeiksIDAuMCk7DQoJCWlmIChncmFkaWVudF90eXBlID09IDUpIHsgIC8qIHF1YWRyYXRpYyBzcGhlcmUgKi8NCgkJCXJldHVybiByICogcjsNCgkJfQ0KCQllbHNlIGlmIChncmFkaWVudF90eXBlID09IDYpIHsgIC8qIHNwaGVyZSAqLw0KCQkJcmV0dXJuIHI7DQoJCX0NCgl9DQoJcmV0dXJuIDAuMDsNCn0NCg0Kdm9pZCBub2RlX3RleF9ncmFkaWVudCh2ZWMzIGNvLCBmbG9hdCBncmFkaWVudF90eXBlLCBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCglmbG9hdCBmID0gY2FsY19ncmFkaWVudChjbywgaW50KGdyYWRpZW50X3R5cGUpKTsNCglmID0gY2xhbXAoZiwgMC4wLCAxLjApOw0KDQoJY29sb3IgPSB2ZWM0KGYsIGYsIGYsIDEuMCk7DQoJZmFjID0gZjsNCn0NCg0Kdm9pZCBub2RlX3RleF9jaGVja2VyKHZlYzMgY28sIHZlYzQgY29sb3IxLCB2ZWM0IGNvbG9yMiwgZmxvYXQgc2NhbGUsIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgZmFjKQ0Kew0KCXZlYzMgcCA9IGNvICogc2NhbGU7DQoNCgkvKiBQcmV2ZW50IHByZWNpc2lvbiBpc3N1ZXMgb24gdW5pdCBjb29yZGluYXRlcy4gKi8NCglwLnggPSAocC54ICsgMC4wMDAwMDEpICogMC45OTk5OTk7DQoJcC55ID0gKHAueSArIDAuMDAwMDAxKSAqIDAuOTk5OTk5Ow0KCXAueiA9IChwLnogKyAwLjAwMDAwMSkgKiAwLjk5OTk5OTsNCg0KCWludCB4aSA9IGludChhYnMoZmxvb3IocC54KSkpOw0KCWludCB5aSA9IGludChhYnMoZmxvb3IocC55KSkpOw0KCWludCB6aSA9IGludChhYnMoZmxvb3IocC56KSkpOw0KDQoJYm9vbCBjaGVjayA9ICgobW9kKHhpLCAyKSA9PSBtb2QoeWksIDIpKSA9PSBib29sKG1vZCh6aSwgMikpKTsNCg0KCWNvbG9yID0gY2hlY2sgPyBjb2xvcjEgOiBjb2xvcjI7DQoJZmFjID0gY2hlY2sgPyAxLjAgOiAwLjA7DQp9DQoNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KdmVjMiBjYWxjX2JyaWNrX3RleHR1cmUodmVjMyBwLCBmbG9hdCBtb3J0YXJfc2l6ZSwgZmxvYXQgYmlhcywNCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IGJyaWNrX3dpZHRoLCBmbG9hdCByb3dfaGVpZ2h0LA0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgb2Zmc2V0X2Ftb3VudCwgaW50IG9mZnNldF9mcmVxdWVuY3ksDQogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBzcXVhc2hfYW1vdW50LCBpbnQgc3F1YXNoX2ZyZXF1ZW5jeSkNCnsNCglpbnQgYnJpY2tudW0sIHJvd251bTsNCglmbG9hdCBvZmZzZXQgPSAwLjA7DQoJZmxvYXQgeCwgeTsNCg0KCXJvd251bSA9IGZsb29yX3RvX2ludChwLnkgLyByb3dfaGVpZ2h0KTsNCg0KCWlmIChvZmZzZXRfZnJlcXVlbmN5ICE9IDAgJiYgc3F1YXNoX2ZyZXF1ZW5jeSAhPSAwKSB7DQoJCWJyaWNrX3dpZHRoICo9IChyb3dudW0gJSBzcXVhc2hfZnJlcXVlbmN5ICE9IDApID8gMS4wIDogc3F1YXNoX2Ftb3VudDsgLyogc3F1YXNoICovDQoJCW9mZnNldCA9IChyb3dudW0gJSBvZmZzZXRfZnJlcXVlbmN5ICE9IDApID8gMC4wIDogKGJyaWNrX3dpZHRoICogb2Zmc2V0X2Ftb3VudCk7IC8qIG9mZnNldCAqLw0KCX0NCg0KCWJyaWNrbnVtID0gZmxvb3JfdG9faW50KChwLnggKyBvZmZzZXQpIC8gYnJpY2tfd2lkdGgpOw0KDQoJeCA9IChwLnggKyBvZmZzZXQpIC0gYnJpY2tfd2lkdGggKiBicmlja251bTsNCgl5ID0gcC55IC0gcm93X2hlaWdodCAqIHJvd251bTsNCg0KCXJldHVybiB2ZWMyKGNsYW1wKChpbnRlZ2VyX25vaXNlKChyb3dudW0gPDwgMTYpICsgKGJyaWNrbnVtICYgMHhGRkZGKSkgKyBiaWFzKSwgMC4wLCAxLjApLA0KCSAgICAgICAgICAgICh4IDwgbW9ydGFyX3NpemUgfHwgeSA8IG1vcnRhcl9zaXplIHx8DQoJICAgICAgICAgICAgIHggPiAoYnJpY2tfd2lkdGggLSBtb3J0YXJfc2l6ZSkgfHwNCgkgICAgICAgICAgICAgeSA+IChyb3dfaGVpZ2h0IC0gbW9ydGFyX3NpemUpKSA/IDEuMCA6IDAuMCk7DQp9DQojZW5kaWYNCg0Kdm9pZCBub2RlX3RleF9icmljayh2ZWMzIGNvLA0KICAgICAgICAgICAgICAgICAgICB2ZWM0IGNvbG9yMSwgdmVjNCBjb2xvcjIsDQogICAgICAgICAgICAgICAgICAgIHZlYzQgbW9ydGFyLCBmbG9hdCBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgbW9ydGFyX3NpemUsIGZsb2F0IGJpYXMsDQogICAgICAgICAgICAgICAgICAgIGZsb2F0IGJyaWNrX3dpZHRoLCBmbG9hdCByb3dfaGVpZ2h0LA0KICAgICAgICAgICAgICAgICAgICBmbG9hdCBvZmZzZXRfYW1vdW50LCBmbG9hdCBvZmZzZXRfZnJlcXVlbmN5LA0KICAgICAgICAgICAgICAgICAgICBmbG9hdCBzcXVhc2hfYW1vdW50LCBmbG9hdCBzcXVhc2hfZnJlcXVlbmN5LA0KICAgICAgICAgICAgICAgICAgICBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KCXZlYzIgZjIgPSBjYWxjX2JyaWNrX3RleHR1cmUoY28gKiBzY2FsZSwNCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcnRhcl9zaXplLCBiaWFzLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJpY2tfd2lkdGgsIHJvd19oZWlnaHQsDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRfYW1vdW50LCBpbnQob2Zmc2V0X2ZyZXF1ZW5jeSksDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcXVhc2hfYW1vdW50LCBpbnQoc3F1YXNoX2ZyZXF1ZW5jeSkpOw0KCWZsb2F0IHRpbnQgPSBmMi54Ow0KCWZsb2F0IGYgPSBmMi55Ow0KCWlmIChmICE9IDEuMCkgew0KCQlmbG9hdCBmYWNtID0gMS4wIC0gdGludDsNCgkJY29sb3IxID0gZmFjbSAqIGNvbG9yMSArIHRpbnQgKiBjb2xvcjI7DQoJfQ0KCWNvbG9yID0gKGYgPT0gMS4wKSA/IG1vcnRhciA6IGNvbG9yMTsNCglmYWMgPSBmOw0KI2Vsc2UNCgljb2xvciA9IHZlYzQoMS4wKTsNCglmYWMgPSAxLjA7DQojZW5kaWYNCn0NCg0Kdm9pZCBub2RlX3RleF9jbG91ZHModmVjMyBjbywgZmxvYXQgc2l6ZSwgb3V0IHZlYzQgY29sb3IsIG91dCBmbG9hdCBmYWMpDQp7DQoJY29sb3IgPSB2ZWM0KDEuMCk7DQoJZmFjID0gMS4wOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2Vudmlyb25tZW50X2VxdWlyZWN0YW5ndWxhcih2ZWMzIGNvLCBzYW1wbGVyMkQgaW1hLCBvdXQgdmVjNCBjb2xvcikNCnsNCgl2ZWMzIG5jbyA9IG5vcm1hbGl6ZShjbyk7DQoJZmxvYXQgdSA9IC1hdGFuKG5jby55LCBuY28ueCkgLyAoMi4wICogTV9QSSkgKyAwLjU7DQoJZmxvYXQgdiA9IGF0YW4obmNvLnosIGh5cG90KG5jby54LCBuY28ueSkpIC8gTV9QSSArIDAuNTsNCg0KCWNvbG9yID0gdGV4dHVyZTJEKGltYSwgdmVjMih1LCB2KSk7DQp9DQoNCnZvaWQgbm9kZV90ZXhfZW52aXJvbm1lbnRfbWlycm9yX2JhbGwodmVjMyBjbywgc2FtcGxlcjJEIGltYSwgb3V0IHZlYzQgY29sb3IpDQp7DQoJdmVjMyBuY28gPSBub3JtYWxpemUoY28pOw0KDQoJbmNvLnkgLT0gMS4wOw0KDQoJZmxvYXQgZGl2ID0gMi4wICogc3FydChtYXgoLTAuNSAqIG5jby55LCAwLjApKTsNCglpZiAoZGl2ID4gMC4wKQ0KCQluY28gLz0gZGl2Ow0KDQoJZmxvYXQgdSA9IDAuNSAqIChuY28ueCArIDEuMCk7DQoJZmxvYXQgdiA9IDAuNSAqIChuY28ueiArIDEuMCk7DQoNCgljb2xvciA9IHRleHR1cmUyRChpbWEsIHZlYzIodSwgdikpOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2Vudmlyb25tZW50X2VtcHR5KHZlYzMgY28sIG91dCB2ZWM0IGNvbG9yKQ0Kew0KCWNvbG9yID0gdmVjNCgxLjAsIDAuMCwgMS4wLCAxLjApOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2ltYWdlKHZlYzMgY28sIHNhbXBsZXIyRCBpbWEsIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgYWxwaGEpDQp7DQoJY29sb3IgPSB0ZXh0dXJlMkQoaW1hLCBjby54eSk7DQoJYWxwaGEgPSBjb2xvci5hOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2ltYWdlX2JveCh2ZWMzIHRleGNvLA0KICAgICAgICAgICAgICAgICAgICAgICAgdmVjMyBub2IsDQogICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVyMkQgaW1hLA0KICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgYmxlbmQsDQogICAgICAgICAgICAgICAgICAgICAgICBvdXQgdmVjNCBjb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICAgIG91dCBmbG9hdCBhbHBoYSkNCnsNCgkvKiBwcm9qZWN0IGZyb20gZGlyZWN0aW9uIHZlY3RvciB0byBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyB2YXJ5aW5nIHRyaWFuZ2xlcyAqLw0KCW5vYiA9IHZlYzMoYWJzKG5vYi54KSwgYWJzKG5vYi55KSwgYWJzKG5vYi56KSk7DQoJbm9iIC89IChub2IueCArIG5vYi55ICsgbm9iLnopOw0KDQoJLyogYmFzaWMgaWRlYSBpcyB0byB0aGluayBvZiB0aGlzIGFzIGEgdHJpYW5nbGUsIGVhY2ggY29ybmVyIHJlcHJlc2VudGluZw0KCSAqIG9uZSBvZiB0aGUgMyBmYWNlcyBvZiB0aGUgY3ViZS4gdmFyeWluZyB0aGUgY29ybmVycyB3ZSBoYXZlIHNpbmdsZSB0ZXh0dXJlcywNCgkgKiB2YXJ5aW5nIGJldHdlZW4gd2UgYmxlbmQgYmV0d2VlbiB0d28gdGV4dHVyZXMsIGFuZCB2YXJ5aW5nIHRoZSBtaWRkbGUgd2UgYSBibGVuZA0KCSAqIGJldHdlZW4gdGhyZWUgdGV4dHVyZXMuDQoJICoNCgkgKiB0aGUgTnh5eiB2YWx1ZXMgYXJlIHRoZSBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyB2YXJ5aW5nIGFuIGVxdWlsYXRlcmFsDQoJICogdHJpYW5nbGUsIHdoaWNoIHZhcnlpbmcgY2FzZSBvZiBibGVuZGluZywgdmFyeWluZyB0aGUgbWlkZGxlIGhhcyBhIHNtYWxsZXINCgkgKiBlcXVpbGF0ZXJhbCB0cmlhbmdsZSB3aGVyZSAzIHRleHR1cmVzIGJsZW5kLiB0aGlzIGRpdmlkZXMgdGhpbmdzIGludG8NCgkgKiA3IHpvbmVzLCB3aXRoIGFuIGlmICgpIHRlc3QgZm9yIGVhY2ggem9uZSAqLw0KDQoJdmVjMyB3ZWlnaHQgPSB2ZWMzKDAuMCwgMC4wLCAwLjApOw0KCWZsb2F0IGxpbWl0ID0gMC41ICogKDEuMCArIGJsZW5kKTsNCg0KCS8qIGZpcnN0IHRlc3QgZm9yIGNvcm5lcnMgd2l0aCBzaW5nbGUgdGV4dHVyZSAqLw0KCWlmIChub2IueCA+IGxpbWl0ICogKG5vYi54ICsgbm9iLnkpICYmIG5vYi54ID4gbGltaXQgKiAobm9iLnggKyBub2IueikpIHsNCgkJd2VpZ2h0LnggPSAxLjA7DQoJfQ0KCWVsc2UgaWYgKG5vYi55ID4gbGltaXQgKiAobm9iLnggKyBub2IueSkgJiYgbm9iLnkgPiBsaW1pdCAqIChub2IueSArIG5vYi56KSkgew0KCQl3ZWlnaHQueSA9IDEuMDsNCgl9DQoJZWxzZSBpZiAobm9iLnogPiBsaW1pdCAqIChub2IueCArIG5vYi56KSAmJiBub2IueiA+IGxpbWl0ICogKG5vYi55ICsgbm9iLnopKSB7DQoJCXdlaWdodC56ID0gMS4wOw0KCX0NCgllbHNlIGlmIChibGVuZCA+IDAuMCkgew0KCQkvKiB2YXJ5aW5nIGNhc2Ugb2YgYmxlbmRpbmcsIHRlc3QgZm9yIG1peGVzIGJldHdlZW4gdHdvIHRleHR1cmVzICovDQoJCWlmIChub2IueiA8ICgxLjAgLSBsaW1pdCkgKiAobm9iLnkgKyBub2IueCkpIHsNCgkJCXdlaWdodC54ID0gbm9iLnggLyAobm9iLnggKyBub2IueSk7DQoJCQl3ZWlnaHQueCA9IGNsYW1wKCh3ZWlnaHQueCAtIDAuNSAqICgxLjAgLSBibGVuZCkpIC8gYmxlbmQsIDAuMCwgMS4wKTsNCgkJCXdlaWdodC55ID0gMS4wIC0gd2VpZ2h0Lng7DQoJCX0NCgkJZWxzZSBpZiAobm9iLnggPCAoMS4wIC0gbGltaXQpICogKG5vYi55ICsgbm9iLnopKSB7DQoJCQl3ZWlnaHQueSA9IG5vYi55IC8gKG5vYi55ICsgbm9iLnopOw0KCQkJd2VpZ2h0LnkgPSBjbGFtcCgod2VpZ2h0LnkgLSAwLjUgKiAoMS4wIC0gYmxlbmQpKSAvIGJsZW5kLCAwLjAsIDEuMCk7DQoJCQl3ZWlnaHQueiA9IDEuMCAtIHdlaWdodC55Ow0KCQl9DQoJCWVsc2UgaWYgKG5vYi55IDwgKDEuMCAtIGxpbWl0KSAqIChub2IueCArIG5vYi56KSkgew0KCQkJd2VpZ2h0LnggPSBub2IueCAvIChub2IueCArIG5vYi56KTsNCgkJCXdlaWdodC54ID0gY2xhbXAoKHdlaWdodC54IC0gMC41ICogKDEuMCAtIGJsZW5kKSkgLyBibGVuZCwgMC4wLCAxLjApOw0KCQkJd2VpZ2h0LnogPSAxLjAgLSB3ZWlnaHQueDsNCgkJfQ0KCQllbHNlIHsNCgkJCS8qIGxhc3QgY2FzZSwgd2UgaGF2ZSBhIG1peCBiZXR3ZWVuIHRocmVlICovDQoJCQl3ZWlnaHQueCA9ICgoMi4wIC0gbGltaXQpICogbm9iLnggKyAobGltaXQgLSAxLjApKSAvICgyLjAgKiBsaW1pdCAtIDEuMCk7DQoJCQl3ZWlnaHQueSA9ICgoMi4wIC0gbGltaXQpICogbm9iLnkgKyAobGltaXQgLSAxLjApKSAvICgyLjAgKiBsaW1pdCAtIDEuMCk7DQoJCQl3ZWlnaHQueiA9ICgoMi4wIC0gbGltaXQpICogbm9iLnogKyAobGltaXQgLSAxLjApKSAvICgyLjAgKiBsaW1pdCAtIDEuMCk7DQoJCX0NCgl9DQoJZWxzZSB7DQoJCS8qIERlc3BlcmF0ZSBtb2RlLCBubyB2YWxpZCBjaG9pY2UgYW55d2F5LCBmYWxsYmFjayB0byBvbmUgc2lkZS4qLw0KCQl3ZWlnaHQueCA9IDEuMDsNCgl9DQoJY29sb3IgPSB2ZWM0KDApOw0KCWlmICh3ZWlnaHQueCA+IDAuMCkgew0KCQljb2xvciArPSB3ZWlnaHQueCAqIHRleHR1cmUyRChpbWEsIHRleGNvLnl6KTsNCgl9DQoJaWYgKHdlaWdodC55ID4gMC4wKSB7DQoJCWNvbG9yICs9IHdlaWdodC55ICogdGV4dHVyZTJEKGltYSwgdGV4Y28ueHopOw0KCX0NCglpZiAod2VpZ2h0LnogPiAwLjApIHsNCgkJY29sb3IgKz0gd2VpZ2h0LnogKiB0ZXh0dXJlMkQoaW1hLCB0ZXhjby55eCk7DQoJfQ0KDQoJYWxwaGEgPSBjb2xvci5hOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X2ltYWdlX2VtcHR5KHZlYzMgY28sIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgYWxwaGEpDQp7DQoJY29sb3IgPSB2ZWM0KDAuMCk7DQoJYWxwaGEgPSAwLjA7DQp9DQoNCnZvaWQgbm9kZV90ZXhfbWFnaWModmVjMyBjbywgZmxvYXQgc2NhbGUsIGZsb2F0IGRpc3RvcnRpb24sIGZsb2F0IGRlcHRoLCBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCgl2ZWMzIHAgPSBjbyAqIHNjYWxlOw0KCWZsb2F0IHggPSBzaW4oKHAueCArIHAueSArIHAueikgKiA1LjApOw0KCWZsb2F0IHkgPSBjb3MoKC1wLnggKyBwLnkgLSBwLnopICogNS4wKTsNCglmbG9hdCB6ID0gLWNvcygoLXAueCAtIHAueSArIHAueikgKiA1LjApOw0KDQoJaWYgKGRlcHRoID4gMCkgew0KCQl4ICo9IGRpc3RvcnRpb247DQoJCXkgKj0gZGlzdG9ydGlvbjsNCgkJeiAqPSBkaXN0b3J0aW9uOw0KCQl5ID0gLWNvcyh4IC0geSArIHopOw0KCQl5ICo9IGRpc3RvcnRpb247DQoJCWlmIChkZXB0aCA+IDEpIHsNCgkJCXggPSBjb3MoeCAtIHkgLSB6KTsNCgkJCXggKj0gZGlzdG9ydGlvbjsNCgkJCWlmIChkZXB0aCA+IDIpIHsNCgkJCQl6ID0gc2luKC14IC0geSAtIHopOw0KCQkJCXogKj0gZGlzdG9ydGlvbjsNCgkJCQlpZiAoZGVwdGggPiAzKSB7DQoJCQkJCXggPSAtY29zKC14ICsgeSAtIHopOw0KCQkJCQl4ICo9IGRpc3RvcnRpb247DQoJCQkJCWlmIChkZXB0aCA+IDQpIHsNCgkJCQkJCXkgPSAtc2luKC14ICsgeSArIHopOw0KCQkJCQkJeSAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJaWYgKGRlcHRoID4gNSkgew0KCQkJCQkJCXkgPSAtY29zKC14ICsgeSArIHopOw0KCQkJCQkJCXkgKj0gZGlzdG9ydGlvbjsNCgkJCQkJCQlpZiAoZGVwdGggPiA2KSB7DQoJCQkJCQkJCXggPSBjb3MoeCArIHkgKyB6KTsNCgkJCQkJCQkJeCAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJCQlpZiAoZGVwdGggPiA3KSB7DQoJCQkJCQkJCQl6ID0gc2luKHggKyB5IC0geik7DQoJCQkJCQkJCQl6ICo9IGRpc3RvcnRpb247DQoJCQkJCQkJCQlpZiAoZGVwdGggPiA4KSB7DQoJCQkJCQkJCQkJeCA9IC1jb3MoLXggLSB5ICsgeik7DQoJCQkJCQkJCQkJeCAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJCQkJCWlmIChkZXB0aCA+IDkpIHsNCgkJCQkJCQkJCQkJeSA9IC1zaW4oeCAtIHkgKyB6KTsNCgkJCQkJCQkJCQkJeSAqPSBkaXN0b3J0aW9uOw0KCQkJCQkJCQkJCX0NCgkJCQkJCQkJCX0NCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KCX0NCglpZiAoZGlzdG9ydGlvbiAhPSAwLjApIHsNCgkJZGlzdG9ydGlvbiAqPSAyLjA7DQoJCXggLz0gZGlzdG9ydGlvbjsNCgkJeSAvPSBkaXN0b3J0aW9uOw0KCQl6IC89IGRpc3RvcnRpb247DQoJfQ0KDQoJY29sb3IgPSB2ZWM0KDAuNSAtIHgsIDAuNSAtIHksIDAuNSAtIHosIDEuMCk7DQoJZmFjID0gKGNvbG9yLnggKyBjb2xvci55ICsgY29sb3IueikgLyAzLjA7DQp9DQoNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KZmxvYXQgbm9pc2VfZmFkZShmbG9hdCB0KQ0Kew0KCXJldHVybiB0ICogdCAqIHQgKiAodCAqICh0ICogNi4wIC0gMTUuMCkgKyAxMC4wKTsNCn0NCg0KZmxvYXQgbm9pc2Vfc2NhbGUzKGZsb2F0IHJlc3VsdCkNCnsNCglyZXR1cm4gMC45ODIwICogcmVzdWx0Ow0KfQ0KDQpmbG9hdCBub2lzZV9uZXJwKGZsb2F0IHQsIGZsb2F0IGEsIGZsb2F0IGIpDQp7DQoJcmV0dXJuICgxLjAgLSB0KSAqIGEgKyB0ICogYjsNCn0NCg0KZmxvYXQgbm9pc2VfZ3JhZCh1aW50IGhhc2gsIGZsb2F0IHgsIGZsb2F0IHksIGZsb2F0IHopDQp7DQoJdWludCBoID0gaGFzaCAmIDE1dTsNCglmbG9hdCB1ID0gaCA8IDh1ID8geCA6IHk7DQoJZmxvYXQgdnQgPSAoKGggPT0gMTJ1KSB8fCAoaCA9PSAxNHUpKSA/IHggOiB6Ow0KCWZsb2F0IHYgPSBoIDwgNHUgPyB5IDogdnQ7DQoJcmV0dXJuICgoKGggJiAxdSkgIT0gMHUpID8gLXUgOiB1KSArICgoKGggJiAydSkgIT0gMHUpID8gLXYgOiB2KTsNCn0NCg0KZmxvYXQgbm9pc2VfcGVybGluKGZsb2F0IHgsIGZsb2F0IHksIGZsb2F0IHopDQp7DQoJaW50IFg7IGZsb2F0IGZ4ID0gZmxvb3JmcmFjKHgsIFgpOw0KCWludCBZOyBmbG9hdCBmeSA9IGZsb29yZnJhYyh5LCBZKTsNCglpbnQgWjsgZmxvYXQgZnogPSBmbG9vcmZyYWMoeiwgWik7DQoNCglmbG9hdCB1ID0gbm9pc2VfZmFkZShmeCk7DQoJZmxvYXQgdiA9IG5vaXNlX2ZhZGUoZnkpOw0KCWZsb2F0IHcgPSBub2lzZV9mYWRlKGZ6KTsNCg0KCWZsb2F0IHJlc3VsdDsNCg0KCXJlc3VsdCA9IG5vaXNlX25lcnAodywgbm9pc2VfbmVycCh2LCBub2lzZV9uZXJwKHUsIG5vaXNlX2dyYWQoaGFzaChYLCBZLCBaKSwgZngsIGZ5LCBmeiksDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9pc2VfZ3JhZChoYXNoKFggKyAxLCBZLCBaKSwgZnggLSAxLjAsIGZ5LCBmeikpLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2lzZV9uZXJwKHUsIG5vaXNlX2dyYWQoaGFzaChYLCBZICsgMSwgWiksIGZ4LCBmeSAtIDEuMCwgZnopLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX2dyYWQoaGFzaChYICsgMSwgWSArIDEsIFopLCBmeCAtIDEuMCwgZnkgLSAxLjAsIGZ6KSkpLA0KCSAgICAgICAgICAgICAgICAgICAgbm9pc2VfbmVycCh2LCBub2lzZV9uZXJwKHUsIG5vaXNlX2dyYWQoaGFzaChYLCBZLCBaICsgMSksIGZ4LCBmeSwgZnogLSAxLjApLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX2dyYWQoaGFzaChYICsgMSwgWSwgWiArIDEpLCBmeCAtIDEuMCwgZnksIGZ6IC0gMS4wKSksDQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX25lcnAodSwgbm9pc2VfZ3JhZChoYXNoKFgsIFkgKyAxLCBaICsgMSksIGZ4LCBmeSAtIDEuMCwgZnogLSAxLjApLA0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlX2dyYWQoaGFzaChYICsgMSwgWSArIDEsIFogKyAxKSwgZnggLSAxLjAsIGZ5IC0gMS4wLCBmeiAtIDEuMCkpKSk7DQoJcmV0dXJuIG5vaXNlX3NjYWxlMyhyZXN1bHQpOw0KfQ0KDQpmbG9hdCBub2lzZSh2ZWMzIHApDQp7DQoJcmV0dXJuIDAuNSAqIG5vaXNlX3BlcmxpbihwLngsIHAueSwgcC56KSArIDAuNTsNCn0NCg0KZmxvYXQgc25vaXNlKHZlYzMgcCkNCnsNCglyZXR1cm4gbm9pc2VfcGVybGluKHAueCwgcC55LCBwLnopOw0KfQ0KDQpmbG9hdCBub2lzZV90dXJidWxlbmNlKHZlYzMgcCwgZmxvYXQgb2N0YXZlcywgaW50IGhhcmQpDQp7DQoJZmxvYXQgZnNjYWxlID0gMS4wOw0KCWZsb2F0IGFtcCA9IDEuMDsNCglmbG9hdCBzdW0gPSAwLjA7DQoJaW50IGksIG47DQoJb2N0YXZlcyA9IGNsYW1wKG9jdGF2ZXMsIDAuMCwgMTYuMCk7DQoJbiA9IGludChvY3RhdmVzKTsNCglmb3IgKGkgPSAwOyBpIDw9IG47IGkrKykgew0KCQlmbG9hdCB0ID0gbm9pc2UoZnNjYWxlICogcCk7DQoJCWlmIChoYXJkICE9IDApIHsNCgkJCXQgPSBhYnMoMi4wICogdCAtIDEuMCk7DQoJCX0NCgkJc3VtICs9IHQgKiBhbXA7DQoJCWFtcCAqPSAwLjU7DQoJCWZzY2FsZSAqPSAyLjA7DQoJfQ0KCWZsb2F0IHJtZCA9IG9jdGF2ZXMgLSBmbG9vcihvY3RhdmVzKTsNCglpZiAgKHJtZCAhPSAwLjApIHsNCgkJZmxvYXQgdCA9IG5vaXNlKGZzY2FsZSAqIHApOw0KCQlpZiAoaGFyZCAhPSAwKSB7DQoJCQl0ID0gYWJzKDIuMCAqIHQgLSAxLjApOw0KCQl9DQoJCWZsb2F0IHN1bTIgPSBzdW0gKyB0ICogYW1wOw0KCQlzdW0gKj0gKGZsb2F0KDEgPDwgbikgLyBmbG9hdCgoMSA8PCAobiArIDEpKSAtIDEpKTsNCgkJc3VtMiAqPSAoZmxvYXQoMSA8PCAobiArIDEpKSAvIGZsb2F0KCgxIDw8IChuICsgMikpIC0gMSkpOw0KCQlyZXR1cm4gKDEuMCAtIHJtZCkgKiBzdW0gKyBybWQgKiBzdW0yOw0KCX0NCgllbHNlIHsNCgkJc3VtICo9IChmbG9hdCgxIDw8IG4pIC8gZmxvYXQoKDEgPDwgKG4gKyAxKSkgLSAxKSk7DQoJCXJldHVybiBzdW07DQoJfQ0KfQ0KI2VuZGlmICAvLyBCSVRfT1BFUkFUSU9OUw0KDQp2b2lkIG5vZGVfdGV4X25vaXNlKHZlYzMgY28sIGZsb2F0IHNjYWxlLCBmbG9hdCBkZXRhaWwsIGZsb2F0IGRpc3RvcnRpb24sIG91dCB2ZWM0IGNvbG9yLCBvdXQgZmxvYXQgZmFjKQ0Kew0KI2lmZGVmIEJJVF9PUEVSQVRJT05TDQoJdmVjMyBwID0gY28gKiBzY2FsZTsNCglpbnQgaGFyZCA9IDA7DQoJaWYgKGRpc3RvcnRpb24gIT0gMC4wKSB7DQoJCXZlYzMgciwgb2Zmc2V0ID0gdmVjMygxMy41LCAxMy41LCAxMy41KTsNCgkJci54ID0gbm9pc2UocCArIG9mZnNldCkgKiBkaXN0b3J0aW9uOw0KCQlyLnkgPSBub2lzZShwKSAqIGRpc3RvcnRpb247DQoJCXIueiA9IG5vaXNlKHAgLSBvZmZzZXQpICogZGlzdG9ydGlvbjsNCgkJcCArPSByOw0KCX0NCg0KCWZhYyA9IG5vaXNlX3R1cmJ1bGVuY2UocCwgZGV0YWlsLCBoYXJkKTsNCgljb2xvciA9IHZlYzQoZmFjLA0KCSAgICAgICAgICAgICBub2lzZV90dXJidWxlbmNlKHZlYzMocC55LCBwLngsIHAueiksIGRldGFpbCwgaGFyZCksDQoJICAgICAgICAgICAgIG5vaXNlX3R1cmJ1bGVuY2UodmVjMyhwLnksIHAueiwgcC54KSwgZGV0YWlsLCBoYXJkKSwNCgkgICAgICAgICAgICAgMSk7DQojZWxzZSAgLy8gQklUX09QRVJBVElPTlMNCgljb2xvciA9IHZlYzQoMS4wKTsNCglmYWMgPSAxLjA7DQojZW5kaWYgIC8vIEJJVF9PUEVSQVRJT05TDQp9DQoNCg0KI2lmZGVmIEJJVF9PUEVSQVRJT05TDQoNCi8qIE11c2dyYXZlIGZCbQ0KICoNCiAqIEg6IGZyYWN0YWwgaW5jcmVtZW50IHBhcmFtZXRlcg0KICogbGFjdW5hcml0eTogZ2FwIGJldHdlZW4gc3VjY2Vzc2l2ZSBmcmVxdWVuY2llcw0KICogb2N0YXZlczogbnVtYmVyIG9mIGZyZXF1ZW5jaWVzIHZhcnlpbmcgdGhlIGZCbQ0KICoNCiAqIGZyb20gIlRleHR1cmluZyBhbmQgTW9kZWxsaW5nOiBBIHByb2NlZHVyYWwgYXBwcm9hY2giDQogKi8NCg0KZmxvYXQgbm9pc2VfbXVzZ3JhdmVfZkJtKHZlYzMgcCwgZmxvYXQgSCwgZmxvYXQgbGFjdW5hcml0eSwgZmxvYXQgb2N0YXZlcykNCnsNCglmbG9hdCBybWQ7DQoJZmxvYXQgdmFsdWUgPSAwLjA7DQoJZmxvYXQgcHdyID0gMS4wOw0KCWZsb2F0IHB3SEwgPSBwb3cobGFjdW5hcml0eSwgLUgpOw0KCWludCBpOw0KDQoJZm9yIChpID0gMDsgaSA8IGludChvY3RhdmVzKTsgaSsrKSB7DQoJCXZhbHVlICs9IHNub2lzZShwKSAqIHB3cjsNCgkJcHdyICo9IHB3SEw7DQoJCXAgKj0gbGFjdW5hcml0eTsNCgl9DQoNCglybWQgPSBvY3RhdmVzIC0gZmxvb3Iob2N0YXZlcyk7DQoJaWYgKHJtZCAhPSAwLjApDQoJCXZhbHVlICs9IHJtZCAqIHNub2lzZShwKSAqIHB3cjsNCg0KCXJldHVybiB2YWx1ZTsNCn0NCg0KLyogTXVzZ3JhdmUgTXVsdGlmcmFjdGFsDQogKg0KICogSDogaGlnaGVzdCBmcmFjdGFsIGRpbWVuc2lvbg0KICogbGFjdW5hcml0eTogZ2FwIGJldHdlZW4gc3VjY2Vzc2l2ZSBmcmVxdWVuY2llcw0KICogb2N0YXZlczogbnVtYmVyIG9mIGZyZXF1ZW5jaWVzIHZhcnlpbmcgdGhlIGZCbQ0KICovDQoNCmZsb2F0IG5vaXNlX211c2dyYXZlX211bHRpX2ZyYWN0YWwodmVjMyBwLCBmbG9hdCBILCBmbG9hdCBsYWN1bmFyaXR5LCBmbG9hdCBvY3RhdmVzKQ0Kew0KCWZsb2F0IHJtZDsNCglmbG9hdCB2YWx1ZSA9IDEuMDsNCglmbG9hdCBwd3IgPSAxLjA7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJaW50IGk7DQoNCglmb3IgKGkgPSAwOyBpIDwgaW50KG9jdGF2ZXMpOyBpKyspIHsNCgkJdmFsdWUgKj0gKHB3ciAqIHNub2lzZShwKSArIDEuMCk7DQoJCXB3ciAqPSBwd0hMOw0KCQlwICo9IGxhY3VuYXJpdHk7DQoJfQ0KDQoJcm1kID0gb2N0YXZlcyAtIGZsb29yKG9jdGF2ZXMpOw0KCWlmIChybWQgIT0gMC4wKQ0KCQl2YWx1ZSAqPSAocm1kICogcHdyICogc25vaXNlKHApICsgMS4wKTsgLyogY29ycmVjdD8gKi8NCg0KCXJldHVybiB2YWx1ZTsNCn0NCg0KLyogTXVzZ3JhdmUgSGV0ZXJvZ2VuZW91cyBUZXJyYWluDQogKg0KICogSDogZnJhY3RhbCBkaW1lbnNpb24gb2YgdGhlIHJvdWdoZXN0IGFyZWENCiAqIGxhY3VuYXJpdHk6IGdhcCBiZXR3ZWVuIHN1Y2Nlc3NpdmUgZnJlcXVlbmNpZXMNCiAqIG9jdGF2ZXM6IG51bWJlciBvZiBmcmVxdWVuY2llcyB2YXJ5aW5nIHRoZSBmQm0NCiAqIG9mZnNldDogcmFpc2VzIHRoZSB0ZXJyYWluIGZyb20gYHNlYSBsZXZlbCcNCiAqLw0KDQpmbG9hdCBub2lzZV9tdXNncmF2ZV9oZXRlcm9fdGVycmFpbih2ZWMzIHAsIGZsb2F0IEgsIGZsb2F0IGxhY3VuYXJpdHksIGZsb2F0IG9jdGF2ZXMsIGZsb2F0IG9mZnNldCkNCnsNCglmbG9hdCB2YWx1ZSwgaW5jcmVtZW50LCBybWQ7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJZmxvYXQgcHdyID0gcHdITDsNCglpbnQgaTsNCg0KCS8qIGZpcnN0IHVuc2NhbGVkIG9jdGF2ZSBvZiBmdW5jdGlvbjsgbGF0ZXIgb2N0YXZlcyBhcmUgc2NhbGVkICovDQoJdmFsdWUgPSBvZmZzZXQgKyBzbm9pc2UocCk7DQoJcCAqPSBsYWN1bmFyaXR5Ow0KDQoJZm9yIChpID0gMTsgaSA8IGludChvY3RhdmVzKTsgaSsrKSB7DQoJCWluY3JlbWVudCA9IChzbm9pc2UocCkgKyBvZmZzZXQpICogcHdyICogdmFsdWU7DQoJCXZhbHVlICs9IGluY3JlbWVudDsNCgkJcHdyICo9IHB3SEw7DQoJCXAgKj0gbGFjdW5hcml0eTsNCgl9DQoNCglybWQgPSBvY3RhdmVzIC0gZmxvb3Iob2N0YXZlcyk7DQoJaWYgKHJtZCAhPSAwLjApIHsNCgkJaW5jcmVtZW50ID0gKHNub2lzZShwKSArIG9mZnNldCkgKiBwd3IgKiB2YWx1ZTsNCgkJdmFsdWUgKz0gcm1kICogaW5jcmVtZW50Ow0KCX0NCg0KCXJldHVybiB2YWx1ZTsNCn0NCg0KLyogSHlicmlkIEFkZGl0aXZlL011bHRpcGxpY2F0aXZlIE11bHRpZnJhY3RhbCBUZXJyYWluDQogKg0KICogSDogZnJhY3RhbCBkaW1lbnNpb24gb2YgdGhlIHJvdWdoZXN0IGFyZWENCiAqIGxhY3VuYXJpdHk6IGdhcCBiZXR3ZWVuIHN1Y2Nlc3NpdmUgZnJlcXVlbmNpZXMNCiAqIG9jdGF2ZXM6IG51bWJlciBvZiBmcmVxdWVuY2llcyB2YXJ5aW5nIHRoZSBmQm0NCiAqIG9mZnNldDogcmFpc2VzIHRoZSB0ZXJyYWluIGZyb20gYHNlYSBsZXZlbCcNCiAqLw0KDQpmbG9hdCBub2lzZV9tdXNncmF2ZV9oeWJyaWRfbXVsdGlfZnJhY3RhbCh2ZWMzIHAsIGZsb2F0IEgsIGZsb2F0IGxhY3VuYXJpdHksIGZsb2F0IG9jdGF2ZXMsIGZsb2F0IG9mZnNldCwgZmxvYXQgZ2FpbikNCnsNCglmbG9hdCByZXN1bHQsIHNpZ25hbCwgd2VpZ2h0LCBybWQ7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJZmxvYXQgcHdyID0gcHdITDsNCglpbnQgaTsNCg0KCXJlc3VsdCA9IHNub2lzZShwKSArIG9mZnNldDsNCgl3ZWlnaHQgPSBnYWluICogcmVzdWx0Ow0KCXAgKj0gbGFjdW5hcml0eTsNCg0KCWZvciAoaSA9IDE7ICh3ZWlnaHQgPiAwLjAwMWYpICYmIChpIDwgaW50KG9jdGF2ZXMpKTsgaSsrKSB7DQoJCWlmICh3ZWlnaHQgPiAxLjApDQoJCQl3ZWlnaHQgPSAxLjA7DQoNCgkJc2lnbmFsID0gKHNub2lzZShwKSArIG9mZnNldCkgKiBwd3I7DQoJCXB3ciAqPSBwd0hMOw0KCQlyZXN1bHQgKz0gd2VpZ2h0ICogc2lnbmFsOw0KCQl3ZWlnaHQgKj0gZ2FpbiAqIHNpZ25hbDsNCgkJcCAqPSBsYWN1bmFyaXR5Ow0KCX0NCg0KCXJtZCA9IG9jdGF2ZXMgLSBmbG9vcihvY3RhdmVzKTsNCglpZiAocm1kICE9IDAuMCkNCgkJcmVzdWx0ICs9IHJtZCAqICgoc25vaXNlKHApICsgb2Zmc2V0KSAqIHB3cik7DQoNCglyZXR1cm4gcmVzdWx0Ow0KfQ0KDQovKiBSaWRnZWQgTXVsdGlmcmFjdGFsIFRlcnJhaW4NCiAqDQogKiBIOiBmcmFjdGFsIGRpbWVuc2lvbiBvZiB0aGUgcm91Z2hlc3QgYXJlYQ0KICogbGFjdW5hcml0eTogZ2FwIGJldHdlZW4gc3VjY2Vzc2l2ZSBmcmVxdWVuY2llcw0KICogb2N0YXZlczogbnVtYmVyIG9mIGZyZXF1ZW5jaWVzIHZhcnlpbmcgdGhlIGZCbQ0KICogb2Zmc2V0OiByYWlzZXMgdGhlIHRlcnJhaW4gZnJvbSBgc2VhIGxldmVsJw0KICovDQoNCmZsb2F0IG5vaXNlX211c2dyYXZlX3JpZGdlZF9tdWx0aV9mcmFjdGFsKHZlYzMgcCwgZmxvYXQgSCwgZmxvYXQgbGFjdW5hcml0eSwgZmxvYXQgb2N0YXZlcywgZmxvYXQgb2Zmc2V0LCBmbG9hdCBnYWluKQ0Kew0KCWZsb2F0IHJlc3VsdCwgc2lnbmFsLCB3ZWlnaHQ7DQoJZmxvYXQgcHdITCA9IHBvdyhsYWN1bmFyaXR5LCAtSCk7DQoJZmxvYXQgcHdyID0gcHdITDsNCglpbnQgaTsNCg0KCXNpZ25hbCA9IG9mZnNldCAtIGFicyhzbm9pc2UocCkpOw0KCXNpZ25hbCAqPSBzaWduYWw7DQoJcmVzdWx0ID0gc2lnbmFsOw0KCXdlaWdodCA9IDEuMDsNCg0KCWZvciAoaSA9IDE7IGkgPCBpbnQob2N0YXZlcyk7IGkrKykgew0KCQlwICo9IGxhY3VuYXJpdHk7DQoJCXdlaWdodCA9IGNsYW1wKHNpZ25hbCAqIGdhaW4sIDAuMCwgMS4wKTsNCgkJc2lnbmFsID0gb2Zmc2V0IC0gYWJzKHNub2lzZShwKSk7DQoJCXNpZ25hbCAqPSBzaWduYWw7DQoJCXNpZ25hbCAqPSB3ZWlnaHQ7DQoJCXJlc3VsdCArPSBzaWduYWwgKiBwd3I7DQoJCXB3ciAqPSBwd0hMOw0KCX0NCg0KCXJldHVybiByZXN1bHQ7DQp9DQoNCmZsb2F0IHN2bV9tdXNncmF2ZShpbnQgdHlwZSwNCiAgICAgICAgICAgICAgICAgICBmbG9hdCBkaW1lbnNpb24sDQogICAgICAgICAgICAgICAgICAgZmxvYXQgbGFjdW5hcml0eSwNCiAgICAgICAgICAgICAgICAgICBmbG9hdCBvY3RhdmVzLA0KICAgICAgICAgICAgICAgICAgIGZsb2F0IG9mZnNldCwNCiAgICAgICAgICAgICAgICAgICBmbG9hdCBpbnRlbnNpdHksDQogICAgICAgICAgICAgICAgICAgZmxvYXQgZ2FpbiwNCiAgICAgICAgICAgICAgICAgICB2ZWMzIHApDQp7DQoJaWYgKHR5cGUgPT0gMCAvKk5PREVfTVVTR1JBVkVfTVVMVElGUkFDVEFMKi8pDQoJCXJldHVybiBpbnRlbnNpdHkgKiBub2lzZV9tdXNncmF2ZV9tdWx0aV9mcmFjdGFsKHAsIGRpbWVuc2lvbiwgbGFjdW5hcml0eSwgb2N0YXZlcyk7DQoJZWxzZSBpZiAodHlwZSA9PSAxIC8qTk9ERV9NVVNHUkFWRV9GQk0qLykNCgkJcmV0dXJuIGludGVuc2l0eSAqIG5vaXNlX211c2dyYXZlX2ZCbShwLCBkaW1lbnNpb24sIGxhY3VuYXJpdHksIG9jdGF2ZXMpOw0KCWVsc2UgaWYgKHR5cGUgPT0gMiAvKk5PREVfTVVTR1JBVkVfSFlCUklEX01VTFRJRlJBQ1RBTCovKQ0KCQlyZXR1cm4gaW50ZW5zaXR5ICogbm9pc2VfbXVzZ3JhdmVfaHlicmlkX211bHRpX2ZyYWN0YWwocCwgZGltZW5zaW9uLCBsYWN1bmFyaXR5LCBvY3RhdmVzLCBvZmZzZXQsIGdhaW4pOw0KCWVsc2UgaWYgKHR5cGUgPT0gMyAvKk5PREVfTVVTR1JBVkVfUklER0VEX01VTFRJRlJBQ1RBTCovKQ0KCQlyZXR1cm4gaW50ZW5zaXR5ICogbm9pc2VfbXVzZ3JhdmVfcmlkZ2VkX211bHRpX2ZyYWN0YWwocCwgZGltZW5zaW9uLCBsYWN1bmFyaXR5LCBvY3RhdmVzLCBvZmZzZXQsIGdhaW4pOw0KCWVsc2UgaWYgKHR5cGUgPT0gNCAvKk5PREVfTVVTR1JBVkVfSEVURVJPX1RFUlJBSU4qLykNCgkJcmV0dXJuIGludGVuc2l0eSAqIG5vaXNlX211c2dyYXZlX2hldGVyb190ZXJyYWluKHAsIGRpbWVuc2lvbiwgbGFjdW5hcml0eSwgb2N0YXZlcywgb2Zmc2V0KTsNCglyZXR1cm4gMC4wOw0KfQ0KI2VuZGlmICAvLyAjaWZkZWYgQklUX09QRVJBVElPTlMNCg0Kdm9pZCBub2RlX3RleF9tdXNncmF2ZSh2ZWMzIGNvLA0KICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBzY2FsZSwNCiAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgZGV0YWlsLA0KICAgICAgICAgICAgICAgICAgICAgICBmbG9hdCBkaW1lbnNpb24sDQogICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IGxhY3VuYXJpdHksDQogICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IG9mZnNldCwNCiAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgZ2FpbiwNCiAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgdHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgb3V0IHZlYzQgY29sb3IsDQogICAgICAgICAgICAgICAgICAgICAgIG91dCBmbG9hdCBmYWMpDQp7DQojaWZkZWYgQklUX09QRVJBVElPTlMNCglmYWMgPSBzdm1fbXVzZ3JhdmUoaW50KHR5cGUpLA0KCSAgICAgICAgICAgICAgICAgICBkaW1lbnNpb24sDQoJICAgICAgICAgICAgICAgICAgIGxhY3VuYXJpdHksDQoJICAgICAgICAgICAgICAgICAgIGRldGFpbCwNCgkgICAgICAgICAgICAgICAgICAgb2Zmc2V0LA0KCSAgICAgICAgICAgICAgICAgICAxLjAsDQoJICAgICAgICAgICAgICAgICAgIGdhaW4sDQoJICAgICAgICAgICAgICAgICAgIGNvICogc2NhbGUpOw0KI2Vsc2UNCglmYWMgPSAxLjA7DQojZW5kaWYNCg0KCWNvbG9yID0gdmVjNChmYWMsIGZhYywgZmFjLCAxLjApOw0KfQ0KDQp2b2lkIG5vZGVfdGV4X3NreSh2ZWMzIGNvLCBvdXQgdmVjNCBjb2xvcikNCnsNCgljb2xvciA9IHZlYzQoMS4wKTsNCn0NCg0Kdm9pZCBub2RlX3RleF92b3Jvbm9pKHZlYzMgY28sIGZsb2F0IHNjYWxlLCBmbG9hdCBjb2xvcmluZywgb3V0IHZlYzQgY29sb3IsIG91dCBmbG9hdCBmYWMpDQp7DQojaWZkZWYgQklUX09QRVJBVElPTlMNCgl2ZWMzIHAgPSBjbyAqIHNjYWxlOw0KCWludCB4eCwgeXksIHp6LCB4aSwgeWksIHppOw0KCWZsb2F0IGRhWzRdOw0KCXZlYzMgcGFbNF07DQoNCgl4aSA9IGZsb29yX3RvX2ludChwWzBdKTsNCgl5aSA9IGZsb29yX3RvX2ludChwWzFdKTsNCgl6aSA9IGZsb29yX3RvX2ludChwWzJdKTsNCg0KCWRhWzBdID0gMWUrMTA7DQoJZGFbMV0gPSAxZSsxMDsNCglkYVsyXSA9IDFlKzEwOw0KCWRhWzNdID0gMWUrMTA7DQoNCglmb3IgKHh4ID0geGkgLSAxOyB4eCA8PSB4aSArIDE7IHh4KyspIHsNCgkJZm9yICh5eSA9IHlpIC0gMTsgeXkgPD0geWkgKyAxOyB5eSsrKSB7DQoJCQlmb3IgKHp6ID0gemkgLSAxOyB6eiA8PSB6aSArIDE7IHp6KyspIHsNCgkJCQl2ZWMzIGlwID0gdmVjMyh4eCwgeXksIHp6KTsNCgkJCQl2ZWMzIHZwID0gY2VsbG5vaXNlX2NvbG9yKGlwKTsNCgkJCQl2ZWMzIHBkID0gcCAtICh2cCArIGlwKTsNCgkJCQlmbG9hdCBkID0gZG90KHBkLCBwZCk7DQoJCQkJdnAgKz0gdmVjMyh4eCwgeXksIHp6KTsNCgkJCQlpZiAoZCA8IGRhWzBdKSB7DQoJCQkJCWRhWzNdID0gZGFbMl07DQoJCQkJCWRhWzJdID0gZGFbMV07DQoJCQkJCWRhWzFdID0gZGFbMF07DQoJCQkJCWRhWzBdID0gZDsNCgkJCQkJcGFbM10gPSBwYVsyXTsNCgkJCQkJcGFbMl0gPSBwYVsxXTsNCgkJCQkJcGFbMV0gPSBwYVswXTsNCgkJCQkJcGFbMF0gPSB2cDsNCgkJCQl9DQoJCQkJZWxzZSBpZiAoZCA8IGRhWzFdKSB7DQoJCQkJCWRhWzNdID0gZGFbMl07DQoJCQkJCWRhWzJdID0gZGFbMV07DQoJCQkJCWRhWzFdID0gZDsNCg0KCQkJCQlwYVszXSA9IHBhWzJdOw0KCQkJCQlwYVsyXSA9IHBhWzFdOw0KCQkJCQlwYVsxXSA9IHZwOw0KCQkJCX0NCgkJCQllbHNlIGlmIChkIDwgZGFbMl0pIHsNCgkJCQkJZGFbM10gPSBkYVsyXTsNCgkJCQkJZGFbMl0gPSBkOw0KDQoJCQkJCXBhWzNdID0gcGFbMl07DQoJCQkJCXBhWzJdID0gdnA7DQoJCQkJfQ0KCQkJCWVsc2UgaWYgKGQgPCBkYVszXSkgew0KCQkJCQlkYVszXSA9IGQ7DQoJCQkJCXBhWzNdID0gdnA7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfQ0KDQoJaWYgKGNvbG9yaW5nID09IDAuMCkgew0KCQlmYWMgPSBhYnMoZGFbMF0pOw0KCQljb2xvciA9IHZlYzQoZmFjLCBmYWMsIGZhYywgMSk7DQoJfQ0KCWVsc2Ugew0KCQljb2xvciA9IHZlYzQoY2VsbG5vaXNlX2NvbG9yKHBhWzBdKSwgMSk7DQoJCWZhYyA9IChjb2xvci54ICsgY29sb3IueSArIGNvbG9yLnopICogKDEuMCAvIDMuMCk7DQoJfQ0KI2Vsc2UgIC8vIEJJVF9PUEVSQVRJT05TDQoJY29sb3IgPSB2ZWM0KDEuMCk7DQoJZmFjID0gMS4wOw0KI2VuZGlmICAvLyBCSVRfT1BFUkFUSU9OUw0KfQ0KDQojaWZkZWYgQklUX09QRVJBVElPTlMNCmZsb2F0IGNhbGNfd2F2ZSh2ZWMzIHAsIGZsb2F0IGRpc3RvcnRpb24sIGZsb2F0IGRldGFpbCwgZmxvYXQgZGV0YWlsX3NjYWxlLCBpbnQgd2F2ZV90eXBlLCBpbnQgd2F2ZV9wcm9maWxlKQ0Kew0KCWZsb2F0IG47DQoNCglpZiAod2F2ZV90eXBlID09IDApIC8qIHR5cGUgYmFuZHMgKi8NCgkJbiA9IChwLnggKyBwLnkgKyBwLnopICogMTAuMDsNCgllbHNlIC8qIHR5cGUgcmluZ3MgKi8NCgkJbiA9IGxlbmd0aChwKSAqIDIwLjA7DQoNCglpZiAoZGlzdG9ydGlvbiAhPSAwLjApDQoJCW4gKz0gZGlzdG9ydGlvbiAqIG5vaXNlX3R1cmJ1bGVuY2UocCAqIGRldGFpbF9zY2FsZSwgZGV0YWlsLCAwKTsNCg0KCWlmICh3YXZlX3Byb2ZpbGUgPT0gMCkgeyAvKiBwcm9maWxlIHNpbiAqLw0KCQlyZXR1cm4gMC41ICsgMC41ICogc2luKG4pOw0KCX0NCgllbHNlIHsgLyogcHJvZmlsZSBzYXcgKi8NCgkJbiAvPSAyLjAgKiBNX1BJOw0KCQluIC09IGludChuKTsNCgkJcmV0dXJuIChuIDwgMC4wKSA/IG4gKyAxLjAgOiBuOw0KCX0NCn0NCiNlbmRpZiAgLy8gQklUX09QRVJBVElPTlMNCg0Kdm9pZCBub2RlX3RleF93YXZlKA0KICAgICAgICB2ZWMzIGNvLCBmbG9hdCBzY2FsZSwgZmxvYXQgZGlzdG9ydGlvbiwgZmxvYXQgZGV0YWlsLCBmbG9hdCBkZXRhaWxfc2NhbGUsIGZsb2F0IHdhdmVfdHlwZSwgZmxvYXQgd2F2ZV9wcm9maWxlLA0KICAgICAgICBvdXQgdmVjNCBjb2xvciwgb3V0IGZsb2F0IGZhYykNCnsNCiNpZmRlZiBCSVRfT1BFUkFUSU9OUw0KCWZsb2F0IGY7DQoJZiA9IGNhbGNfd2F2ZShjbyAqIHNjYWxlLCBkaXN0b3J0aW9uLCBkZXRhaWwsIGRldGFpbF9zY2FsZSwgaW50KHdhdmVfdHlwZSksIGludCh3YXZlX3Byb2ZpbGUpKTsNCg0KCWNvbG9yID0gdmVjNChmLCBmLCBmLCAxLjApOw0KCWZhYyA9IGY7DQojZWxzZSAgLy8gQklUX09QRVJBVElPTlMNCgljb2xvciA9IHZlYzQoMS4wKTsNCglmYWMgPSAxOw0KI2VuZGlmICAvLyBCSVRfT1BFUkFUSU9OUw0KfQ0KDQovKiBsaWdodCBwYXRoICovDQoNCnZvaWQgbm9kZV9saWdodF9wYXRoKA0KCW91dCBmbG9hdCBpc19jYW1lcmFfcmF5LA0KCW91dCBmbG9hdCBpc19zaGFkb3dfcmF5LA0KCW91dCBmbG9hdCBpc19kaWZmdXNlX3JheSwNCglvdXQgZmxvYXQgaXNfZ2xvc3N5X3JheSwNCglvdXQgZmxvYXQgaXNfc2luZ3VsYXJfcmF5LA0KCW91dCBmbG9hdCBpc19yZWZsZWN0aW9uX3JheSwNCglvdXQgZmxvYXQgaXNfdHJhbnNtaXNzaW9uX3JheSwNCglvdXQgZmxvYXQgcmF5X2xlbmd0aCwNCglvdXQgZmxvYXQgcmF5X2RlcHRoLA0KCW91dCBmbG9hdCB0cmFuc3BhcmVudF9kZXB0aCwNCglvdXQgZmxvYXQgdHJhbnNtaXNzaW9uX2RlcHRoKQ0Kew0KCWlzX2NhbWVyYV9yYXkgPSAxLjA7DQoJaXNfc2hhZG93X3JheSA9IDAuMDsNCglpc19kaWZmdXNlX3JheSA9IDAuMDsNCglpc19nbG9zc3lfcmF5ID0gMC4wOw0KCWlzX3Npbmd1bGFyX3JheSA9IDAuMDsNCglpc19yZWZsZWN0aW9uX3JheSA9IDAuMDsNCglpc190cmFuc21pc3Npb25fcmF5ID0gMC4wOw0KCXJheV9sZW5ndGggPSAxLjA7DQoJcmF5X2RlcHRoID0gMS4wOw0KCXRyYW5zcGFyZW50X2RlcHRoID0gMS4wOw0KCXRyYW5zbWlzc2lvbl9kZXB0aCA9IDEuMDsNCn0NCg0Kdm9pZCBub2RlX2xpZ2h0X2ZhbGxvZmYoZmxvYXQgc3RyZW5ndGgsIGZsb2F0IHRzbW9vdGgsIG91dCBmbG9hdCBxdWFkcmF0aWMsIG91dCBmbG9hdCBsaW5lYXIsIG91dCBmbG9hdCBjb25zdGFudCkNCnsNCglxdWFkcmF0aWMgPSBzdHJlbmd0aDsNCglsaW5lYXIgPSBzdHJlbmd0aDsNCgljb25zdGFudCA9IHN0cmVuZ3RoOw0KfQ0KDQp2b2lkIG5vZGVfb2JqZWN0X2luZm8ob3V0IHZlYzMgbG9jYXRpb24sIG91dCBmbG9hdCBvYmplY3RfaW5kZXgsIG91dCBmbG9hdCBtYXRlcmlhbF9pbmRleCwgb3V0IGZsb2F0IHJhbmRvbSkNCnsNCglsb2NhdGlvbiA9IHZlYzMoMC4wKTsNCglvYmplY3RfaW5kZXggPSAwLjA7DQoJbWF0ZXJpYWxfaW5kZXggPSAwLjA7DQoJcmFuZG9tID0gMC4wOw0KfQ0KDQp2b2lkIG5vZGVfbm9ybWFsX21hcCh2ZWM0IHRhbmdlbnQsIHZlYzMgbm9ybWFsLCB2ZWMzIHRleG5vcm1hbCwgb3V0IHZlYzMgb3V0bm9ybWFsKQ0Kew0KCXZlYzMgQiA9IHRhbmdlbnQudyAqIGNyb3NzKG5vcm1hbCwgdGFuZ2VudC54eXopOw0KDQoJb3V0bm9ybWFsID0gdGV4bm9ybWFsLnggKiB0YW5nZW50Lnh5eiArIHRleG5vcm1hbC55ICogQiArIHRleG5vcm1hbC56ICogbm9ybWFsOw0KCW91dG5vcm1hbCA9IG5vcm1hbGl6ZShvdXRub3JtYWwpOw0KfQ0KDQp2b2lkIG5vZGVfYnVtcChmbG9hdCBzdHJlbmd0aCwgZmxvYXQgZGlzdCwgZmxvYXQgaGVpZ2h0LCB2ZWMzIE4sIHZlYzMgc3VyZl9wb3MsIGZsb2F0IGludmVydCwgb3V0IHZlYzMgcmVzdWx0KQ0Kew0KCWlmIChpbnZlcnQgIT0gMC4wKSB7DQoJCWRpc3QgKj0gLTEuMDsNCgl9DQoJdmVjMyBkUGR4ID0gZEZkeChzdXJmX3Bvcyk7DQoJdmVjMyBkUGR5ID0gZEZkeShzdXJmX3Bvcyk7DQoNCgkvKiBHZXQgc3VyZmFjZSB0YW5nZW50cyBmcm9tIG5vcm1hbC4gKi8NCgl2ZWMzIFJ4ID0gY3Jvc3MoZFBkeSwgTik7DQoJdmVjMyBSeSA9IGNyb3NzKE4sIGRQZHgpOw0KDQoJLyogQ29tcHV0ZSBzdXJmYWNlIGdyYWRpZW50IGFuZCBkZXRlcm1pbmFudC4gKi8NCglmbG9hdCBkZXQgPSBkb3QoZFBkeCwgUngpOw0KCWZsb2F0IGFic2RldCA9IGFicyhkZXQpOw0KDQoJZmxvYXQgZEhkeCA9IGRGZHgoaGVpZ2h0KTsNCglmbG9hdCBkSGR5ID0gZEZkeShoZWlnaHQpOw0KCXZlYzMgc3VyZmdyYWQgPSBkSGR4ICogUnggKyBkSGR5ICogUnk7DQoNCglzdHJlbmd0aCA9IG1heChzdHJlbmd0aCwgMC4wKTsNCg0KCXJlc3VsdCA9IG5vcm1hbGl6ZShhYnNkZXQgKiBOIC0gZGlzdCAqIHNpZ24oZGV0KSAqIHN1cmZncmFkKTsNCglyZXN1bHQgPSBub3JtYWxpemUoc3RyZW5ndGggKiByZXN1bHQgKyAoMS4wIC0gc3RyZW5ndGgpICogTik7DQp9DQoNCi8qIG91dHB1dCAqLw0KDQp2b2lkIG5vZGVfb3V0cHV0X21hdGVyaWFsKHZlYzQgc3VyZmFjZSwgdmVjNCB2b2x1bWUsIGZsb2F0IGRpc3BsYWNlbWVudCwgb3V0IHZlYzQgcmVzdWx0KQ0Kew0KCXJlc3VsdCA9IHN1cmZhY2U7DQp9DQoNCnZvaWQgbm9kZV9vdXRwdXRfd29ybGQodmVjNCBzdXJmYWNlLCB2ZWM0IHZvbHVtZSwgb3V0IHZlYzQgcmVzdWx0KQ0Kew0KCXJlc3VsdCA9IHN1cmZhY2U7DQp9DQoNCi8qICoqKioqKioqKioqKioqKioqKioqKiogbWF0Y2FwIHN0eWxlIHJlbmRlciAqKioqKioqKioqKioqKioqKioqKiAqLw0KDQp2b2lkIG1hdGVyaWFsX3ByZXZpZXdfbWF0Y2FwKHZlYzQgY29sb3IsIHNhbXBsZXIyRCBpbWEsIHZlYzQgTiwgdmVjNCBtYXNrLCBvdXQgdmVjNCByZXN1bHQpDQp7DQoJdmVjMyBub3JtYWw7DQoJdmVjMiB0ZXg7DQoJDQojaWZuZGVmIFVTRV9PUEVOU1VCRElWDQoJLyogcmVtYXAgdG8gMC4wIC0gMS4wIHJhbmdlLiBUaGlzIGlzIGRvbmUgYmVjYXVzZSBPcGVuR0wgMi4wIGNsYW1wcyBjb2xvcnMNCgkgKiBiZXR3ZWVuIHNoYWRlciBzdGFnZXMgYW5kIHdlIHdhbnQgdGhlIGZ1bGwgcmFuZ2Ugb2YgdGhlIG5vcm1hbCAqLw0KCW5vcm1hbCA9IHZlYzMoMi4wLCAyLjAsIDIuMCkgKiB2ZWMzKE4ueCwgTi55LCBOLnopIC0gdmVjMygxLjAsIDEuMCwgMS4wKTsNCglpZiAobm9ybWFsLnogPCAwLjApIHsNCgkJbm9ybWFsLnogPSAwLjA7DQoJfQ0KCW5vcm1hbCA9IG5vcm1hbGl6ZShub3JtYWwpOw0KI2Vsc2UNCglub3JtYWwgPSBpbnB0LnYubm9ybWFsOw0KCW1hc2sgPSB2ZWM0KDEuMCwgMS4wLCAxLjAsIDEuMCk7DQojZW5kaWYNCg0KCXRleC54ID0gMC41ICsgMC40OSAqIG5vcm1hbC54Ow0KCXRleC55ID0gMC41ICsgMC40OSAqIG5vcm1hbC55Ow0KCXJlc3VsdCA9IHRleHR1cmUyRChpbWEsIHRleCkgKiBtYXNrOw0KfQ0KY29uc3QgdmVjNCBjb25zMSA9IHZlYzQoMC44MDAwMDAsIDAuODAwMDAwLCAwLjgwMDAwMCwgMS4wMDAwMDApOwpjb25zdCBmbG9hdCBjb25zMiA9IGZsb2F0KDAuMDAwMDAwKTsKdmFyeWluZyB2ZWMzIHZhcm5vcm1hbDsKCnZvaWQgbWFpbigpCnsKCXZlYzMgZmFjaW5nbm9ybWFsID0gZ2xfRnJvbnRGYWNpbmc/IHZhcm5vcm1hbDogLXZhcm5vcm1hbDsKCXZlYzQgdG1wNDsKCXZlYzQgdG1wNjsKCglub2RlX2JzZGZfZGlmZnVzZShjb25zMSwgY29uczIsIGZhY2luZ25vcm1hbCwgdG1wNCk7CglsaW5lYXJyZ2JfdG9fc3JnYih0bXA0LCB0bXA2KTsKCglnbF9GcmFnQ29sb3IgPSB0bXA2Owp9Cg=="
        },
        "MaterialVS": {
            "type": 35633,
            "uri": "data:text/plain;base64,I3ZlcnNpb24gMTAwCgpwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKYXR0cmlidXRlIHZlYzQgYmxfVmVydGV4OwphdHRyaWJ1dGUgdmVjMyBibF9Ob3JtYWw7CnVuaWZvcm0gbWF0NCBibF9Nb2RlbFZpZXdNYXRyaXg7CnVuaWZvcm0gbWF0NCBibF9Qcm9qZWN0aW9uTWF0cml4Owp1bmlmb3JtIG1hdDMgYmxfTm9ybWFsTWF0cml4OwoKDQoNCnZhcnlpbmcgdmVjMyB2YXJwb3NpdGlvbjsNCnZhcnlpbmcgdmVjMyB2YXJub3JtYWw7DQoNCg0KDQoNCi8qIENvbG9yLCBrZWVwIGF0dHJpYnV0ZSBzeW5jIHdpdGg6IGdwdV9zaGFkZXJfdmVydGV4X3dvcmxkLmdsc2wgKi8NCg0KZmxvYXQgc3JnYl90b19saW5lYXJyZ2IoZmxvYXQgYykNCnsNCglpZiAoYyA8IDAuMDQwNDUpDQoJCXJldHVybiAoYyA8IDAuMCkgPyAwLjAgOiBjICogKDEuMCAvIDEyLjkyKTsNCgllbHNlDQoJCXJldHVybiBwb3coKGMgKyAwLjA1NSkgKiAoMS4wIC8gMS4wNTUpLCAyLjQpOw0KfQ0KDQp2b2lkIHNyZ2JfdG9fbGluZWFycmdiKHZlYzMgY29sX2Zyb20sIHZhcnlpbmcgdmVjMyBjb2xfdG8pDQp7DQoJY29sX3RvLnIgPSBzcmdiX3RvX2xpbmVhcnJnYihjb2xfZnJvbS5yKTsNCgljb2xfdG8uZyA9IHNyZ2JfdG9fbGluZWFycmdiKGNvbF9mcm9tLmcpOw0KCWNvbF90by5iID0gc3JnYl90b19saW5lYXJyZ2IoY29sX2Zyb20uYik7DQp9DQoNCnZvaWQgc3JnYl90b19saW5lYXJyZ2IodmVjNCBjb2xfZnJvbSwgdmFyeWluZyB2ZWM0IGNvbF90bykNCnsNCgljb2xfdG8uciA9IHNyZ2JfdG9fbGluZWFycmdiKGNvbF9mcm9tLnIpOw0KCWNvbF90by5nID0gc3JnYl90b19saW5lYXJyZ2IoY29sX2Zyb20uZyk7DQoJY29sX3RvLmIgPSBzcmdiX3RvX2xpbmVhcnJnYihjb2xfZnJvbS5iKTsNCgljb2xfdG8uYSA9IGNvbF9mcm9tLmE7DQp9DQoNCmJvb2wgaXNfc3JnYihpbnQgaW5mbykNCnsNCiNpZmRlZiBVU0VfTkVXX1NIQURJTkcNCglyZXR1cm4gKGluZm8gPT0gMSk/IHRydWU6IGZhbHNlOw0KI2Vsc2UNCglyZXR1cm4gZmFsc2U7DQojZW5kaWYNCn0NCg0Kdm9pZCBzZXRfdmFyX2Zyb21fYXR0cihmbG9hdCBhdHRyLCBpbnQgaW5mbywgdmFyeWluZyBmbG9hdCB2YXIpDQp7DQoJdmFyID0gYXR0cjsNCn0NCg0Kdm9pZCBzZXRfdmFyX2Zyb21fYXR0cih2ZWMyIGF0dHIsIGludCBpbmZvLCB2YXJ5aW5nIHZlYzIgdmFyKQ0Kew0KCXZhciA9IGF0dHI7DQp9DQoNCnZvaWQgc2V0X3Zhcl9mcm9tX2F0dHIodmVjMyBhdHRyLCBpbnQgaW5mbywgdmFyeWluZyB2ZWMzIHZhcikNCnsNCglpZiAoaXNfc3JnYihpbmZvKSkgew0KCQlzcmdiX3RvX2xpbmVhcnJnYihhdHRyLCB2YXIpOw0KCX0NCgllbHNlIHsNCgkJdmFyID0gYXR0cjsNCgl9DQp9DQoNCnZvaWQgc2V0X3Zhcl9mcm9tX2F0dHIodmVjNCBhdHRyLCBpbnQgaW5mbywgdmFyeWluZyB2ZWM0IHZhcikNCnsNCglpZiAoaXNfc3JnYihpbmZvKSkgew0KCQlzcmdiX3RvX2xpbmVhcnJnYihhdHRyLCB2YXIpOw0KCX0NCgllbHNlIHsNCgkJdmFyID0gYXR0cjsNCgl9DQp9DQoNCi8qIGVuZCBjb2xvciBjb2RlICovDQoNCg0Kdm9pZCBtYWluKCkNCnsNCg0KCXZlYzQgcG9zaXRpb24gPSBibF9WZXJ0ZXg7DQoJdmVjMyBub3JtYWwgPSBibF9Ob3JtYWw7DQoNCg0KCXZlYzQgY28gPSBibF9Nb2RlbFZpZXdNYXRyaXggKiBwb3NpdGlvbjsNCg0KCXZhcnBvc2l0aW9uID0gY28ueHl6Ow0KCXZhcm5vcm1hbCA9IG5vcm1hbGl6ZShibF9Ob3JtYWxNYXRyaXggKiBub3JtYWwpOw0KCWdsX1Bvc2l0aW9uID0gYmxfUHJvamVjdGlvbk1hdHJpeCAqIGNvOw0KDQogDQoNCg0KfQo="
        }
    },
    "techniques": {
        "Material.002Technique": {
            "attributes": {
                "bl_Normal": "bl_Normal",
                "bl_Vertex": "bl_Vertex"
            },
            "parameters": {
                "bl_ModelViewMatrix": {
                    "semantic": "MODELVIEW",
                    "type": 35676
                },
                "bl_Normal": {
                    "semantic": "NORMAL",
                    "type": 35665
                },
                "bl_NormalMatrix": {
                    "semantic": "MODELVIEWINVERSETRANSPOSE",
                    "type": 35675
                },
                "bl_ProjectionMatrix": {
                    "semantic": "PROJECTION",
                    "type": 35676
                },
                "bl_Vertex": {
                    "semantic": "POSITION",
                    "type": 35666
                }
            },
            "program": "Material.002Program",
            "uniforms": {
                "bl_ModelViewMatrix": "bl_ModelViewMatrix",
                "bl_NormalMatrix": "bl_NormalMatrix",
                "bl_ProjectionMatrix": "bl_ProjectionMatrix"
            }
        },
        "MaterialTechnique": {
            "attributes": {
                "bl_Normal": "bl_Normal",
                "bl_Vertex": "bl_Vertex"
            },
            "parameters": {
                "bl_ModelViewMatrix": {
                    "semantic": "MODELVIEW",
                    "type": 35676
                },
                "bl_Normal": {
                    "semantic": "NORMAL",
                    "type": 35665
                },
                "bl_NormalMatrix": {
                    "semantic": "MODELVIEWINVERSETRANSPOSE",
                    "type": 35675
                },
                "bl_ProjectionMatrix": {
                    "semantic": "PROJECTION",
                    "type": 35676
                },
                "bl_Vertex": {
                    "semantic": "POSITION",
                    "type": 35666
                }
            },
            "program": "MaterialProgram",
            "uniforms": {
                "bl_ModelViewMatrix": "bl_ModelViewMatrix",
                "bl_NormalMatrix": "bl_NormalMatrix",
                "bl_ProjectionMatrix": "bl_ProjectionMatrix"
            }
        }
    }
}
